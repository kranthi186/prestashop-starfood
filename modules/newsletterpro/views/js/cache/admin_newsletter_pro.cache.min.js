/**
* 2013-2015 Ovidiu Cimpean
*
* Ovidiu Cimpean - Newsletter Pro Â© All rights reserved.
*
* DISCLAIMER
*
* Do not edit, modify or copy this file.
* If you wish to customize it, contact us at addons4prestashop@gmail.com.
*
* @author    Ovidiu Cimpean <addons4prestashop@gmail.com>
* @copyright 2013-2015 Ovidiu Cimpean
* @version   Release: 4
* @license   Do not edit, modify or copy this file
*/

function gkWindow(e){function t(){var t=e.title||"",a=$('<div class="gk-background"></div>'),r=$('<div><div class="gk-header"><span class="gk-title"></span><a href="javascript:{}" class="gk-close"><i class="icon icon-remove"></i></a></div><div class="bootstrap gk-content"></div></div>'),i=$("body"),o=e.width||0,l=e.height||0;a.css({width:"100%",height:"100%",top:0,left:0,position:"fixed",display:"none","z-index":"9999"}),a.appendTo(i),r.css({width:e.width||"auto",height:e.height||"auto",position:"fixed",left:0!=o?i.width()/2-o/2:i.width()/2,top:0!=l?$(window).height()/2-l/2:$(window).height()/2,display:"none","z-index":"99999"}),r.header=r.find(".gk-header"),r.title=r.find(".gk-title"),t&&r.title.html(t),r.content=r.find(".gk-content");var c="function"==typeof e.content?e.content(s,r.content):"";return c&&r.content.html(c),r.close=r.find(".gk-close"),r.background=a,r.addClass("gk-task-window"),r.addClass(e.className),a.addClass(e.className+"-background"),r.appendTo(i),n(r,a),"function"==typeof e.getTemplate&&e.getTemplate(r),"undefined"!=typeof e.setScrollContent&&r.content.css({height:e.setScrollContent+"px","overflow-y":"scroll","overflow-x":"hidden"}),r}function n(t,n){t.close.on("click",function(t){s.hide(),"function"==typeof e.close&&e.close(s)}),n.on("click",function(){t.close.trigger("click")}),$(window).resize(function(e){s.resetPosition()})}if(!(this instanceof gkWindow))return new gkWindow(e);var s=this;return task=NewsletterPro.modules.task,l=NewsletterPro.translations.l(NewsletterPro.translations.modules.task),this.template=t(),this.resetPosition=function(){s.template.css({left:$("body").width()/2-s.template.width()/2,top:$(window).height()/2-s.template.height()/2})},this.setHeader=function(e){this.template.header.find(".gk-title").html(e)},this.getHeader=function(){return this.template.header.find(".gk-title").html()},this.setContent=function(e){this.template.content.html(e)},this.getContent=function(){return this.template.content},this.hide=function(){return this.template.fadeOut(200),this.template.background.fadeOut(200).promise()},this.show=function(t){return this.resetPosition(),this.template.fadeIn(200),"function"==typeof e.show&&e.show(s),"undefined"!=typeof t&&this.setContent(t),this.template.background.fadeIn(200).promise()},this}function NP_RunTabPerformanceTest(){var e=NewsletterProComponents.objs.tabItems.buttons;for(var t in e){var n=(new Date).getTime();e[t].trigger("click");var s=(new Date).getTime();console.log("delay: "+(s-n)+" milliseconds")}}function gkSlider(e){function t(){s(),n(),a(),r(),j()}function n(){z=e.snap||!1,U=parseInt(e.min)||0,q=e.max||parseInt(ie.sliderBar.width()),Y=parseInt(e.step)||1,K=e.value||0,re=e.prefix||"",te=e.values||[],ne=e.remplaceValues||{},J=e.move,Z=e.start,ee=e.done}function s(){l("target",e.target),l("instance",p(e)),l("sliderController",[ie.instance,".slider-controller"]),l("sliderBar",[ie.instance,".slider-bar"]),l("rulesBar",[ie.instance,".rules-bar"]),l("sliderInfo",u()),l("sliderInfoInput",[ie.sliderInfo,".slider-value"]),ie.sliderBar.prepend(ie.sliderInfo),ie.target.empty(),ie.target.append(ie.instance)}function a(){ie.rulesBar.css("width",c()),ie.sliderInfo.css({position:"absolute"}),ie.instance.css({position:"relative"}),ie.sliderController.css({position:"absolute"}),ie.sliderBar.css({position:"absolute"}),ie.rulesBar.css({position:"absolute"})}function r(){ie.sliderController.on("mousedown",function(e){return V(),!1}),ie.sliderController.on("mouseup",function(e){return F(),!1}),B(function(e){return 1==Q&&F(),!1})}function i(){ie.rulesBar.empty(),H(te)}function o(){i()}function l(e,t){"[object Array]"===Object.prototype.toString.call(t)?ie[e]=t[0].find(t[1]):ie[e]=t}function c(){return O()/d()*100+"%"}function d(){return ie.sliderBar.parent().width()}function u(){var e='<span class="slider-value-container" style="left:'+C(K)+'">';return e+='<span class="slider-value">'+_()+"</span>",e+="</span>",$(e)}function p(t){var n,s=e.id||"",a="undefined"==typeof e.className?"":"array"==typeof e.className?e.className.join(" "):e.className;return n='<div id="'+s+'" class="slider style-dark '+a+'">',n+='<div class="slider-bar">',n+='<a href="javascript:{}" class="slider-controller">&nbsp;</a>',n+="</div>",n+='<div class="rules-bar">&nbsp;</div>',n+="</div>",n=$(n),n.css({"margin-top":"28px","margin-bottom":"34px"}),n}function m(e){X=e,h(),K=x(),k(),z&&5>se&&$.each(te,function(e,t){R()>t-z&&R()<t+z&&f(t)})}function f(e){K=e,X=C(),k()}function h(){0>X?X=0:X>O()&&(X=O())}function g(){return ie.sliderController.width()}function v(){return w()/O()*100}function w(){return X*((O()-g())/O())}function b(){return w()-y()/2+g()/2-1}function y(){return ie.sliderInfo.width()}function S(){return b()/ie.sliderBar.width()*100}function k(){ie.sliderController.css({left:v()+"%"}),ie.sliderInfo.css({left:S()+"%"}),P(R())}function P(e){ie.sliderInfoInput.text(e+re)}function _(){return K+re}function N(){return q-U}function x(){return Math.round(T(X))}function T(e){return N()*e/O()+U}function C(){return I(K)-I(U)}function I(e){return O()*e/N()}function E(t){K=t,m(C()),e.hasOwnProperty("onSetValue")&&e.onSetValue(K,G)}function j(){m(C()),o()}function A(){ie.target.parent().show(),ie.instance.show(),j()}function D(){ie.target.parent().hide()}function L(){return ie.sliderBar.offset().left}function O(){return ie.sliderBar.width()}function M(e){$(window).on("mousemove",function(t){e(t)})}function B(e){$(window).on("mouseup",function(t){e(t)})}function V(){Q=!0,M(function(e){m(-L()+e.pageX),null!=J&&J(G),ae>-1&&(se=Math.abs(e.pageX-ae)),ae=e.pageX}),null!=Z&&Z(G)}function F(){Q=!1,$(window).unbind("mousemove"),null!=ee&&ee(G)}function R(){return K}function H(t){var n=[],s=g(),a=O();for(var r in t){var i=t[r];U>i?i=U:i>q&&(i=q);var o=(a-s)/(q-U)*(i-U)+s/2,l=o/a*100,c=("undefined"!=typeof e.corectPosition?o+e.corectPosition:o)/a*100,d=['<div class="rule-line-'+i+'">','<span class="rule" style="left: '+l+'%;"></span>','<span class="rule-value" style="left: '+c+'%;">'+W(i)+"</span>","</div>"];n.push(d.join(""))}ie.rulesBar.html(n.join(""))}function W(e){return ne.hasOwnProperty(e)?ne[e]:e}if(!(this instanceof gkSlider))return new gkSlider(e);var G=this,z=null,U=null,q=null,Y=null,X=null,K=null,Q=!1,J=null,Z=null,ee=null,te=[],ne={},se=0,ae=-1,re="",ie={};return t(),G.dom=ie,G.getValue=function(){return R()},G.setValue=function(e){E(e)},G.refresh=function(){return j()},G.show=function(){return A()},G.hide=function(){return D()},this}function gkSliderRange(e){function t(){s(),n(),a(),r(),U()}function n(){le=e.snap||!1,ce=parseInt(e.min)||0,de=e.max||parseInt($e.sliderBar.width()),ue=parseInt(e.step)||1,fe=e.valueMin||0,he=e.valueMax||0,_e=e.prefix||"",ye=e.values||[],Se=e.remplaceValues||{},ve=e.move,we=e.start,be=e.done}function s(){o("target",e.target),o("instance",u(e)),o("sliderController",[$e.instance,".slider-controller"]),o("sliderControllerMax",[$e.instance,".slider-controller-max"]),o("sliderBar",[$e.instance,".slider-bar"]),o("rulesBar",[$e.instance,".rules-bar"]),o("sliderInfo",d()),o("sliderInfoMax",d("max")),o("sliderInfoInput",[$e.sliderInfo,".slider-value"]),o("sliderInfoInputMax",[$e.sliderInfoMax,".slider-value-max"]),o("sliderRange",$('<div class="slider-range"></div>')),$e.sliderBar.prepend($e.sliderInfo),$e.sliderBar.prepend($e.sliderInfoMax),$e.sliderBar.prepend($e.sliderRange),$e.target.append($e.instance)}function a(){$e.rulesBar.css("width",l()),$e.sliderInfo.css({position:"absolute"}),$e.sliderInfoMax.css({position:"absolute"}),$e.instance.css({position:"relative"}),$e.sliderController.css({position:"absolute"}),$e.sliderControllerMax.css({position:"absolute"}),$e.sliderBar.css({position:"absolute"}),$e.rulesBar.css({position:"absolute"}),$e.sliderRange.css({position:"absolute"})}function r(){$e.sliderController.on("mousedown",function(e){return Ne={controller:$e.sliderController,info:$e.sliderInfo,infoInput:$e.sliderInfoInput,value:fe,position:pe},te("min"),!1}),$e.sliderController.on("mouseup",function(e){return ne(),!1}),$e.sliderControllerMax.on("mousedown",function(e){return Ne={controller:$e.sliderControllerMax,info:$e.sliderInfoMax,infoInput:$e.sliderInfoInputMax,value:fe,position:me},te("max"),!1}),$e.sliderControllerMax.on("mouseup",function(e){return ne(),!1}),J(function(e){return 1==ge&&ne(),!1})}function i(){$e.rulesBar.empty(),$.each(ye,function(e,t){re(parseInt(t))})}function o(e,t){"[object Array]"===Object.prototype.toString.call(t)?$e[e]=t[0].find(t[1]):$e[e]=t}function l(){return K()/c()*100+"%"}function c(){return $e.sliderBar.parent().width()}function d(e){e=e||"min";var t=R(fe),n=H(he);isNaN(t)&&(t=0),isNaN(n)&&(n=0);var s="";switch(e){case"min":s+='<span class="slider-value-container" style="left:'+t+'">',s+=xe?'<input type="text" class="slider-value np-slider-range-input-text" value="'+L()+'">':'<span class="slider-value">'+L()+"</span>",s+="</span>";break;case"max":s+='<span class="slider-value-container-max" style="left:'+n+'">',s+=xe?'<input type="text" class="slider-value-max np-slider-range-input-text" value="'+O()+'">':'<span class="slider-value-max">'+O()+"</span>",s+="</span>"}var a=$(s);return xe&&(a.find("input.slider-value").on("change",function(){var e=$(this).val();G(e)}),a.find("input.slider-value-max").on("change",function(){var e=$(this).val();z(e)})),a}function u(t){var n,s=e.id||"",a="undefined"==typeof e.className?"":"array"==typeof e.className?e.className.join(" "):e.className;return n='<div id="'+s+'" class="slider style-dark '+a+'">',n+='<div class="slider-bar">',n+='<a href="javascript:{}" class="slider-controller">&nbsp;</a>',n+='<a href="javascript:{}" class="slider-controller-max">&nbsp;</a>',n+="</div>",n+='<div class="rules-bar">&nbsp;</div>',n+="</div>",n=$(n),n.css({"margin-top":"28px","margin-bottom":"34px"}),n}function p(e){pe=e,g(),fe=B(),E(),le&&5>ke&&$.each(ye,function(e,t){se()>t-le&&se()<t+le&&f(t)})}function m(e){me=e,w(),he=V(),j(),le&&5>ke&&$.each(ye,function(e,t){ae()>t-le&&ae()<t+le&&h(t)})}function f(e){fe=e,pe=R(),E()}function h(e){he=e,me=H(),j()}function g(){0>pe?pe=0:pe>K()&&!v()?pe=K():v()&&(pe=me)}function v(){return fe>=he&&pe>=me}function w(){0>me&&!v()?me=0:me>K()?me=K():v()&&(me=pe)}function b(){return $e.sliderController.width()}function y(){return k()/K()*100}function S(){return P()/K()*100}function k(){return pe*((K()-b())/K())}function P(){return me*((K()-b())/K())}function _(){return k()-x()/2+b()/2-1}function N(){return P()-x()/2+b()/2-1}function x(){return $e.sliderInfo.width()}function T(){return _()/$e.sliderBar.width()*100}function C(){return N()/$e.sliderBar.width()*100}function I(){return S()-y()}function E(){$e.sliderController.css({left:y()+"%"}),$e.sliderInfo.css({left:T()+"%"}),$e.sliderRange.css({left:y()+"%"}),$e.sliderRange.css({width:I()+"%"}),A(se())}function j(){$e.sliderControllerMax.css({left:S()+"%"}),$e.sliderInfoMax.css({left:C()+"%"}),$e.sliderRange.css({left:y()+"%"}),$e.sliderRange.css({width:I()+"%"}),D(ae())}function A(e){xe?$e.sliderInfo.find("input").val(e):$e.sliderInfo.text(e+_e)}function D(e){xe?$e.sliderInfoMax.find("input").val(e):$e.sliderInfoMax.text(e+_e)}function L(){return fe||(fe=0),xe?fe:fe+_e}function O(){return he||(he=0),xe?he:he+_e}function M(){return de-ce}function B(){return Math.round(F(pe))}function V(){return Math.round(F(me))}function F(e){return M()*e/K()+ce}function R(){return W(fe)-W(ce)}function H(){return W(he)-W(ce)}function W(e){return K()*e/M()}function G(e){fe=e,p(R())}function z(e){he=e,m(H())}function U(){p(R()),m(H()),i()}function q(t){t=t||{},$.each(t,function(t,n){e[t]=n}),n(),U()}function Y(){$e.instance.show(),U()}function X(){return $e.sliderBar.offset().left}function K(){return $e.sliderBar.width()}function Q(e){$(window).on("mousemove",function(t){e(t)})}function J(e){$(window).on("mouseup",function(t){e(t)})}function Z(){p(-X())}function ee(){m(-X()+K())}function te(e){e=e||"min",ge=!0,Q(function(t){switch(e){case"min":p(-X()+t.pageX);break;case"max":m(-X()+t.pageX)}null!=ve&&ve(oe),Pe>-1&&(ke=Math.abs(t.pageX-Pe)),Pe=t.pageX}),null!=we&&we(oe)}function ne(){ge=!1,$(window).unbind("mousemove"),null!=be&&be(oe)}function se(){return fe}function ae(){return he}function re(e){ce>e?e=ce:e>de&&(e=de);var t=(K()-b())/(de-ce)*(e-ce)+b()/2;t=t/K()*100;var n='<div class="rule-line-'+e+'">';n+='<span class="rule" style="left: '+t+'%;"></span>',n+='<span class="rule-value" style="left: '+t+'%;">'+ie(e)+"</span>",n+="</div>",n=$(n);var s=n.find(".rule-value");$e.rulesBar.append(n),s.css({left:t-s.width()/2/K()*100+"%"})}function ie(e){return Se.hasOwnProperty(e)?Se[e]:e}if(!(this instanceof gkSliderRange))return new gkSliderRange(e);var oe=this,le=null,ce=null,de=null,ue=null,pe=null,me=null,fe=null,he=null,ge=!1,ve=null,we=null,be=null,ye=[],Se={},ke=0,Pe=-1,_e="",Ne=null,xe="undefined"!=typeof e.editable?e.editable:!1,$e={};return t(),oe.dom=$e,oe.getValueMin=function(){return se()},oe.getValueMax=function(){return ae()},oe.setValueMin=function(e){G(e)},oe.setValueMax=function(e){z(e)},oe.refresh=function(){return U()},oe.reset=function(e){return q(e)},oe.show=function(){return Y()},oe.resetPositionMin=function(){Z()},oe.resetPositionMax=function(){ee()},this}function gkSearch(e){function t(){n(),s(),a()}function n(){if("undefined"==typeof f)throw"The search read is undefined!"}function s(){v.element=e.element,v.ajaxLoader=e.ajaxLoader}function a(){v.element.on("keyup",function(e){o().length>=p?c(o()):l()}),v.element.on("focus",function(e){1!=d()&&o()!=m||i("")}),v.element.on("focusout",function(e){1!=d()&&o()!=m||i(m)})}function r(){i(""),v.element.trigger("focusout")}function i(e){v.element.val(e)}function o(e){return v.element.val()}function l(){d()&&$.isFunction(g)&&g()}function c(e){null!=u&&clearTimeout(u),v.ajaxLoader.show(),u=setTimeout(function(){f.query=o(),$.postAjax(f).done(function(e){v.ajaxLoader.hide(),$.isFunction(h)&&h(e)})},200)}function d(){return""==o()?(v.element.hasClass("empty")||v.element.addClass("empty"),!0):(v.element.hasClass("empty")&&v.element.removeClass("empty"),!1)}if(!(this instanceof gkSearch))return new gkSearch(e);var u=null,p=e.minLength||4,m=e.element.val(),f=e.read,h=e.result,g=e.reset,v={};return t(),this.clearVal=function(){r()},this}function gkProductList(e){function t(){n()}function n(){dom.element=e.element}function s(e){a(),$.each(e,function(e,t){t.thumb={path:t.thumb_path,width:t.thumb_width,height:t.thumb_height},o(c(l(t),t))})}function a(){u=[],p=[],m=null,f=null,r()}function r(){dom.element.empty()}function i(e){dom.element.append(e)}function o(e){u.push(e)}function l(e){function t(){return!!parseInt(e.active)}function n(){return!!parseInt(e.quantity)}var s='<td class="options">								<a class="btn btn-default add-product" href="javascript:{}" data-id="'+e.id_product+'" data-value="-1" >									<i class="icon icon-plus-circle"></i> <span>'+h("add")+"</span>								</a>							</td>",a='<td class="options">								<a class="btn btn-default add-product" href="javascript:{}" data-id="'+e.id_product+'" data-value="1">									<i class="icon icon-minus-circle"></i> <span>'+h("remove")+"</span>								</a>							</td>";f=null==f?"even":"even"==f?"odd":"even";var r='<tr class="'+f+'">';return r+=1==NewsletterPro.dataStorage.getNumber("configuration.DISPLAY_PRODUCT_IMAGE")?'<td class="image"><img src="'+e.thumb.path+'" alt="" height="'+e.thumb.height+'" width="'+e.thumb.width+'"></td>':"",r+='<td class="name '+(t()?"":"inactive")+'">'+e.name+"</td>",r+='<td class="reference '+(t()?"":"inactive")+'">'+(null!=e.reference?e.reference:"")+"</td>",r+='<td class="search-price '+(t()?"":"inactive")+'">'+(null!=e.price_display?e.price_display:"")+"</td>",r+='<td class="search-active">'+(t()?'<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>':'<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>')+"</td>",r+='<td class="search-stock '+(n()?"":"inactive")+'">'+(null!=e.quantity?e.quantity:'<span style="color: red;">0</span>')+"</td>",r+=g(e)?s:a,r+="</tr>",r=$(r),i(r),r}function c(e,t){var e=e,n=e.find("a.add-product"),s=n.find("span"),a=n.find("img"),r=n.data("value"),i=n.data("id"),o={init:function(){return this.instance=e,this.button=n,this.value=r,this.data=t,this.text=s,this.img=a,this.id=i,this.initEvents(),this},initEvents:function(){var e=this;this.button.on("click",function(t){m=e,m.toggleValue(),t.stopPropagation()})},click:function(){return this.button.trigger("click"),this.val()},val:function(){return this.value},toggleValue:function(){"1"==this.val()?this.remove():this.add()},remove:function(){this.value="-1",this.text.html(h("add")),this.img.attr("src",NewsletterPro.dataStorage.get("module_img_path")+"add.gif"),$.isFunction(removeCallback)&&removeCallback(this.data,this)},add:function(){this.value="1",this.text.html(h("remove")),this.img.attr("src",NewsletterPro.dataStorage.get("module_img_path")+"remove.gif"),$.isFunction(v)&&v(this.data,this)}}.init();return o}function d(e){if(1==e){var t=$.grep(u,function(e){return"-1"==e.val()});return t}if(0==e){var t=$.grep(u,function(e){return"1"==e.val()});return t}return u}if(!(this instanceof gkProductList))return new gkProductList(e);var u=[],p=[],m=null,f=null,h=e.l||function(e){return e},g=e.inList||function(){return!0},v=e.add;return removeCallback=e.remove,dom={},this.createItems=function(e){s(e)},this.removeItems=function(){return a()},this.getItems=function(e){return d(e)},t(),this}var NEWSLETTER_PRO_DEBUG_MODE=!0,jQueryNewsletterProNew="undefined"!=typeof NPRO_JQUERY_NEW?NPRO_JQUERY_NEW:jQuery,jQueryNewsletterProOld="undefined"!=typeof NPRO_JQUERY_OLD?NPRO_JQUERY_OLD:jQuery;!function(e){e.postAjax=function(t,n,s){return n=n||"json",s="undefined"!=typeof s?s:!0,e.ajax({url:NewsletterPro.dataStorage.get("ajax_url"),type:"POST",dataType:n,data:t,error:function(e){if(1==NEWSLETTER_PRO_DEBUG_MODE&&"json"==n){if(1==s){var t="true"===e.getResponseHeader("Login");t?alert('The login session has expired. You must refresh the browser and login again. The next time when you are login check the button "Stay logged in".'):alert("Ajax request error, please check your console for more details!")}console.warn("error: the returned data must be json, your response text is: "),console.warn(e.responseText)}}}).promise()},e.updateConfiguration=function(t,n){return e.postAjax({submit:"jsUpdateConfiguration",name:t,value:n}).promise()},e.objSize=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},e.fn.getFormData=function(){form=this;for(var e,t=form.serializeArray(),n={},s=0,a=t.length;a>s;s++)e=t[s],n[e.name]=e.value;return n?n:{}},e.setCookie=function(e,t,n){var s=new Date;s.setDate(s.getDate()+n);var a=escape(t)+(null==n?"":"; expires="+s.toUTCString());document.cookie=e+"="+a},e.getCookie=function(e){var t,n,s,a=document.cookie.split(";");for(t=0;t<a.length;t++)if(n=a[t].substr(0,a[t].indexOf("=")),s=a[t].substr(a[t].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n==e)return unescape(s)},e.deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT;"},e.submitAjax=function(t,n,s){s="undefined"!=typeof s?s:!0,n=n||"json";this.form=t.form;var a=this.form.serializeArray(),r=!1;window.FormData&&(r=new FormData);for(var i,o=this.form.find('input[type="file"]'),l=0,c=o.length;c>l;l++){i=e(o[l]);for(var d,u=0,p=i[0].files.length;p>u;u++)d=i[0].files[u],r&&r.append(i.attr("name")+"",d)}for(var m,f=0,p=a.length;p>f;f++)m=a[f],r&&r.append(m.name,m.value);var h=null;for(var g in t)if(/^submit_\w+/.test(g)){h=g;break}if(r){if(t.hasOwnProperty("name")){var v=!0;t.hasOwnProperty("value")&&(v=t.value),r.append(t.name,v)}t.hasOwnProperty("submit")?r.append("submit",t.submit):h&&r.append(h,t[h]),t.hasOwnProperty("data")&&e.each(t.data,function(e,t){r.append(e,t)})}var w=function(e){1==NEWSLETTER_PRO_DEBUG_MODE&&"json"==n&&(1==s&&alert("You have an request error, check the console for more details."),console.log("error: the returned data must be json, your response text is: "),console.log(e.responseText))};if(r)return e.ajax({url:NewsletterPro.dataStorage.get("ajax_url"),type:"POST",data:r,processData:!1,contentType:!1,dataType:n,error:w}).promise();var b=this.form.getFormData();return t.hasOwnProperty("submit")?b.submit=t.submit:h&&r.append(h,t[h]),e.ajax({url:NewsletterPro.dataStorage.get("ajax_url"),type:"POST",data:b,dataType:n,error:w}).promise()},e.fn.getPaddingWidth=function(){var e=parseFloat(this.css("padding-left")),t=parseFloat(this.css("padding-right"));return e+t},e.fn.widthCSS=function(t){var n=e(this);if("undefined"!=typeof t){var s=0;return s=/%/.test(new RegExp(String(t)))?t:/px/.test(new RegExp(String(t)))?t:parseInt(t)+"px",n.css("width",s),n}return parseInt(n.css("width"))},e.fn.quickOuterWidth=function(){var e=this.get(0);if(window.getComputedStyle){var t=window.getComputedStyle(e,null);return e.offsetWidth+(parseInt(t.getPropertyValue("margin-left"),10)||0)+(parseInt(t.getPropertyValue("margin-right"),10)||0)}return e.offsetWidth+(parseInt(e.currentStyle.marginLeft)||0)+(parseInt(e.currentStyle.marginRight)||0)}}(jQueryNewsletterProNew),$.fn.gkGrid=function(e){var t=this;"undefined"==typeof id_grid&&(id_grid=0),id_grid++,t.addClass("gk-data-grid"),t.pageable="undefined"!=$.type(e.pageable)?e.pageable:!0,t.currentPage=e.currentPage||1,t.template=e.template||null,t.events=e.events||null,t.selectable=e.selectable||!1,t.checkable=e.checkable||!1,t.footer=null,t.countChecked=0,this.defineSelected=e.defineSelected||null,$.isFunction(e.start)&&e.start();var n={setFields:function(){var n=[],s=[],a=t.find("tr");$.each(a.find("th"),function(e,a){$(a).addClass("gk-header-datagrid");var r=$(a).attr("class").split(" ");r="undefined"!=typeof r[0]?r[0]:"";var i="undefined"!=$.type($(a).attr("class"))?$.trim(r):null,o=$(a).text();if("undefined"!=$.type($(a).data("field"))){var l="undefined"!=$.type($(a).data("template"))?$(a).data("template"):null!=t.template&&"function"==$.type(t.template[$(a).data("field")])?$(a).data("field"):null,c={field:$(a).data("field"),name:o,className:i,template:l};n.push(c),s.push(c)}else{var l="undefined"!=$.type($(a).data("template"))?$(a).data("template"):null;s.push({field:"gk_"+e,name:o,className:i,template:l})}}),e.dataSource.schema.model.fields=n,e.dataSource.schema.model.columns=s},setFooter:function(){if(t.pageable){var n={instance:null,eFirst:null,ePrev:null,eInput:null,eNext:null,eLast:null,ePageTotal:null,eItemsInfo:null,init:function(){var s=e.dataSource.schema.model.columns,a="";a+='<div class="gk-pagination form-inline">',a+='<a class="btn btn-default gk-page-first" href="javascript:{}">											<i class="icon icon-step-backward gk-icon gk-icon-first"></i>										</a>',a+='<a class="btn btn-default gk-page-prev" href="javascript:{}">											<i class="icon icon-chevron-left gk-icon gk-icon-prev"></i>										</a>',a+="<span>"+l("page")+" </span>",a+='<input class="form-control text-center gk-page-input" type="text" value="'+t.currentPage+'">',a+='<span class="gk-page-total"></span>',a+='<a class="btn btn-default gk-page-next" href="javascript:{}">											<i class="icon icon-chevron-right gk-icon gk-icon-next"></i>										</a>',a+='<a class="btn btn-default gk-page-last" href="javascript:{}">											<i class="icon icon-step-forward gk-icon gk-icon-last"></i>										</a>',a+="</div>",a+='<div class="gk-checked" '+(t.checkable?"":'style="display: none;"')+'><span>( <span class="gk-checked-count">0</span> ) '+l("selected")+"</span></div>",a+='<div class="gk-pagination-info">',a+='<span class="gk-items-info"></span>',a+="</div>";var r="";return r+="<tfoot>",r+="<tr>",r+='<td class="gk-footer" colspan="'+s.length+'">'+a+"</td>",r+="</tr>",r+="</tfoot>",r=$(r),n.instance=r,t.append(r),n.setComponents(),t.footer=n,t.page},setComponents:function(){n.eFirst=t.find(".gk-page-first"),n.ePrev=t.find(".gk-page-prev"),n.eInput=t.find(".gk-page-input"),n.eNext=t.find(".gk-page-next"),n.eLast=t.find(".gk-page-last"),n.ePageTotal=t.find(".gk-page-total"),n.eItemsInfo=t.find(".gk-items-info"),n.eChecked=t.find(".gk-checked"),n.eCheckedCount=t.find(".gk-checked-count"),n.eFirst.on("click",n.first),n.ePrev.on("click",n.prev),n.eInput.on("keyup",n.input),n.eNext.on("click",n.next),n.eLast.on("click",n.last)},first:function(e){n.goToPage(1)},prev:function(e){n.setCurrentPage(--t.currentPage),n.goToPage(t.currentPage)},input:function(e){if(13==e.keyCode){var t=$(e.currentTarget).val();if(0==/^-?[\d]+$/.test(t))return!1;t=parseInt(t),n.goToPage(t)}},next:function(e){n.setCurrentPage(++t.currentPage),n.goToPage(t.currentPage)},last:function(t){n.goToPage(e.dataSource.getPageInfo().lastPage())},goToPage:function(s){n.setCurrentPage(s),e.dataSource.setView(t.currentPage)},setCurrentPage:function(e){t.currentPage=e,n.eInput.val(t.currentPage)},writePageTotal:function(){return t.pageable?(n.ePageTotal.html(l("of")+" "+e.dataSource.getPageInfo().lastPage()),!0):!1},writeItemsInfo:function(){if(t.pageable){var s=e.dataSource.getPageInfo().countIntems(),a=e.dataSource.getPageInfo().start(),r=e.dataSource.getPageInfo().end(),i="<span>"+a+" - "+r+" "+l("of")+" "+s+" "+l("items")+" <span>";n.eItemsInfo.html(i)}},writeCheckedInfo:function(e){t.checkable?(n.eChecked.show(),t.countChecked=t.countChecked+e,t.countChecked<0&&(t.countChecked=0),n.eCheckedCount.html(t.countChecked)):n.eChecked.hide()},setCheckedInfo:function(e){t.checkable?(n.eChecked.show(),t.countChecked=e,n.eCheckedCount.html(t.countChecked)):n.eChecked.hide()}};n.init()}}};return t.updateFooter=function(){null!=t.footer&&(t.footer.writePageTotal(),t.footer.writeItemsInfo())},t.addFooter=function(n,s){s=s||"append";var a,r=e.dataSource.schema.model.columns.length,i=n.call(this,r);return a=t.find("tfoot"),a[s](i),i},t.addHeader=function(n,s){s=s||"append";var a,r=e.dataSource.schema.model.columns.length,i=n(r);return a=t.first(),a[s](i),i},t.makeRow=function(t,n){n=n||e.dataSource.schema.model.columns.length;var s,a;return s=$("<tr></tr>"),a=$('<td class="gk-footer" colspan="'+n+'"></td>'),$.each(t,function(e,t){a.append(t)}),s.html(a),s},n.setFields(),n.setFooter(),e.dataSource.dataGrid=t,e.dataSource.sync().done(function(t){"function"==typeof e.done&&e.done.call(t,t)}),t},$.fn.gkButton=function(e){var t=$.extend(!0,{vars:{title:e.title||null,name:e.name||"",className:e.className||null,item:e.item||null,command:e.command||null,css:e.css||null,attr:e.attr||null,icon:e.icon||null},setup:function(){var e=t.fn.getSelector(),n=t.fn.getId();0==t.length&&(t=$('<a href="javascript:{}" style="display: inline-block;"></a>'),t.vars=this.vars,t.fn=this.fn,t.obj=this.obj),"id"==e.type?t.attr("id",e.name+n):"class"==e.type&&t.attr("class",e.name+n);var s=(t.vars.item,$("<span></span>"));return t.addClass("btn"),t.addClass("btn-default"),null!=t.vars.className&&t.addClass(t.vars.className),null!=t.vars.icon&&s.append(t.vars.icon),null!=t.vars.title&&s.append("<span>"+t.vars.title+"</span>"),null!=s&&t.html(s),null!=t.vars.css&&t.css(t.vars.css),null!=t.vars.attr&&t.attr(t.vars.attr),t.disable=function(){t.off(),t.addClass("gk-button-disabled"),t.removeClass("gk-button")},t.enable=function(){t.fn.addEvents(),t.addClass("gk-button"),t.removeClass("gk-button-disabled")},t.changeTitle=function(e){t.html(e)},t.fn.addEvents(),t},obj:{},fn:{addEvents:function(){var n=t.vars.item,s=$.trim(t.vars.command);t.on("click",function(t){if(t.preventDefault(),t.stopPropagation(),("function"!=$.type(e.click)||e.click.call(this,t)!==!1)&&null!=s)switch(s){case"delete":"function"===$.type(e.confirm)?e.confirm.call(this,t)&&n.destroy():n.destroy()}})},getSelector:function(){var e=t.selector,n=!1;return/^\#/.test(e)?(n="id",e=e.slice(1,e.length)):/^\./.test(e)&&(n="class",e=e.slice(1,e.length)),{name:e,type:n}},getId:function(){var e="";return e=null!=t.vars.item?"_"+t.vars.item.data.id:"_"+gk.fn.uniqueId()}}},this);return t.setup()};var gk={template:function(e,t){return this.fn.replaceCallback(e,t)},fn:{ajax:function(e){return $.ajax({url:e.url||"",type:e.type||"POST",dataType:e.dataType||"json",data:e.data||null,success:function(t){"function"==$.type(e.success)&&e.success(t,e.data)},error:function(t,n,s){s.hasOwnProperty("message")&&"string"==typeof s.message&&console.error(s.message+"  when creating the dataGrid. Please check the ajax request!");var a={xhr:t,ajaxOptions:n,thrownError:s};"function"==$.type(e.error)&&e.error(a,e.data)},complete:function(t){"function"==$.type(e.complete)&&e.complete(t,e.data)}}).promise()},replaceCallback:function(e,t){return t=t||{},$.each(t,function(t,n){e=e.replace(new RegExp("\\#=\\s?"+t+"\\s?\\#","g"),n)}),e},uniqueId:function(){return Math.random().toString(36).substr(2,9)}},data:{DataSource:function DataSource(cfg){if(!(this instanceof DataSource))return new DataSource(cfg);var readyDfd=$.Deferred(),self=this;this.selected=null,this.pageSize=cfg.pageSize||0,this.view=[],this.items=[],this.searchItems=[],this.searchActive=!1,this.itemsIndex={},this.errors=cfg.errors||{},this.trySteps=cfg.trySteps||1,this.trySetpsCount=0,this.schema=cfg.schema,this.transport=cfg.transport||{},this.ready=function(){return readyDfd.promise()},this.read=function(){return gk.fn.ajax(cfg.transport.read).promise()},this.getData=function(){return cfg.transport.data},this.setData=function(e){cfg.transport.data=e},this.addSyncStep=function(){self.trySetpsCount++},this.syncStepAvailable=function(){return self.trySetpsCount<this.trySteps},this.syncStepAvailableAdd=function(e,t){e=e||0;var n=self.syncStepAvailable();self.addSyncStep(),setTimeout(function(){n&&t()},e)},this.create=function(e){var t=$.extend(!0,{},cfg.transport.create);return t.url=t.url,t.data=e||{},gk.fn.ajax(t).promise()},this.update=function(e){var t=$.extend(!0,{},cfg.transport.update);return t.url=t.url+"="+e.id,t.data=e||{},gk.fn.ajax(t).promise()},this.destroy=function(e){var t=$.extend(!0,{},cfg.transport.destroy);return t.url=t.url+"="+e.id,t.data=e||{},gk.fn.ajax(t).promise()},this.search=function(e,t){var n=$.extend(!0,{},cfg.transport.search);return n.url=n.url+"="+e,n.data=t||{},gk.fn.ajax(n).promise()},this.filter=function(e){var t=$.extend(!0,{},cfg.transport.filter);return t.url=t.url,t.data=e||{},gk.fn.ajax(t).promise()},this.checkAll=function(){var e=self.searchActive?self.searchItems:self.items;$.each(e,function(e,t){t.check()})},this.uncheckAll=function(){var e=self.searchActive?self.searchItems:self.items;$.each(e,function(e,t){t.uncheck()})},this.setSelected=function(e){fn.setSelected(e)},this.getItemByValue=function(name,value){for(var usedItems=self.searchActive?self.searchItems:self.items,i=0;i<usedItems.length;i++){var item=usedItems[i],path="item."+name;if("undefined"!=typeof eval(path)&&eval(path)===value)return item}return!1},this.parse=function(e){for(var t=0;t<self.items.length;t++)e(self.items[t])},this.getItems=function(){return self.items},this.getSelection=function(){var e=[];return self.parse(function(t){1==t.checked&&e.push(t)}),e},this.grep=function(func,value){var selection=[];return self.parse(function(item){if("undefined"!=typeof value){var variable=eval("item."+value);1==func(item)&&"undefined"!=typeof variable&&selection.push(variable)}else 1==func(item)&&selection.push(item)}),selection},this.getSelectedEmails=function(e,t){for(var n=[],s=0;s<self.items.length;s++){var a=self.items[s];a.checked&&n.push(a.data.email)}return n},this.getSelectedIds=function(e){e="undefined"!=typeof e?e:!1;for(var t=[],n=0;n<self.items.length;n++){var s=self.items[n];s.checked&&t.push(Number(s.data.id))}if(t.sort(function(e,t){return e-t}),e){for(var a=[],r=[],n=0,i=t.length;i>n;n++){var o=t[n];if(t[n+1]&&t[n+1]==o+1)r.push(o);else if(r.length>0){var l=String(r[0])+"-"+String(r[r.length-1]+1);a.push(l),r=[]}else a.push(String(o))}if(r.length>0){var l=String(r[0])+"-"+String(r[r.length-1]+1);a.push(l),r=[]}return a}return t},this.count=function(){return self.items.length};var obj={item:{data:{},checked:!1,instance:null,init:function(e){var t=$.extend(!0,{},this);return t.instance=$("<tr></tr>"),
t.data=e,"undefined"!=$.type(e[self.schema.model.id])&&(t.data.id=e[self.schema.model.id]),t},destroy:function(e){var t=this,n=!1,s=self.searchActive?self.searchItems:self.items,a=s.indexOf(t);if(a>-1){t.instance.remove(),s.splice(a,1);var r=self.view.indexOf(t);return r>-1&&self.view.splice(r,1),self.destroy(t.data).done(function(i){if("string"==typeof e&&"undefined"!=typeof i[e]&&(i=i[e]),i){if(self.searchActive){var o=t.data.id;"undefined"!=typeof self.items[self.itemsIndex[o]]&&self.itemsIndex.hasOwnProperty(o)&&(self.items[self.itemsIndex[o]].instance.remove(),self.items.splice(self.itemsIndex[o],1))}n=!0}else s.splice(a,0,t),r>-1&&self.view.splice(r,0,t),self.refreshView()}),self.refreshView(),fn.runEvent.call(this,"destroy",t),n}return n},update:function(e){var t=this,n="undefined"!=typeof e?e:t.data;return self.update(n).promise()},select:function(e){fn.setSelected(e.data.current),fn.runEvent.call(this,"select",self.selected)},checkToggle:function(e){var t=e.data.current;t.isChecked()?t.uncheck():t.check(),fn.runEvent.call(t,"checkToggle",t,t.isChecked())},check:function(){var e=this.data.id;if(self.searchActive&&"undefined"!=typeof self.items[self.itemsIndex[e]]&&self.itemsIndex.hasOwnProperty(e)&&(self.items[self.itemsIndex[e]].checked=!0),this.checked||self.dataGrid.footer.writeCheckedInfo(1),this.checked=!0,fn.itemInView(this)&&self.dataGrid.checkable){var t=this.instance.find('input[type="checkbox"]');t.prop("checked",!0)}fn.runEvent.call(this,"check",this,!0)},uncheck:function(){var e=this.data.id;if(self.searchActive&&self.itemsIndex.hasOwnProperty(e)&&(self.items[self.itemsIndex[e]].checked=!1),this.checked&&self.dataGrid.footer.writeCheckedInfo(-1),this.checked=!1,fn.itemInView(this)&&self.dataGrid.checkable){var t=this.instance.find('input[type="checkbox"]');t.prop("checked",!1)}fn.runEvent.call(this,"check",this,!1)},isChecked:function(){return this.checked},render:function(){var e=this,t=e.data,n=fn.getItemFields(t);self.dataGrid.selectable&&e.instance.on("click",{current:e},e.select),self.dataGrid.checkable&&e.instance.on("click",{current:e},e.checkToggle),e.instance.empty(),$.each(n,function(n,s){var a,r,i=' class="'+(null!=s.className?s.className:"")+'" ';if(t.hasOwnProperty(s.field))e.data[n]=null!=t[s.field]?t[s.field]:"",a=e.data[n],"function"==$.type(self.dataGrid.template[s.template])&&(a=self.dataGrid.template[s.template](e,a)),r=$("<td "+i+"></td>").html(a);else{var a="";"function"==$.type(self.dataGrid.template[s.template])&&(a=self.dataGrid.template[s.template](e,a)),r=$("<td "+i+"></td>").html(a)}e.instance.append(r)});var s=e.instance.prev();s.length>0?s.after(e.instance):(self.dataGrid.append(e.instance),e.addOddAndEven())},addOddAndEven:function(){self.hasOwnProperty("lastClass")?self.lastClass="odd"==self.lastClass?"even":"odd":self.lastClass="odd",this.instance.removeClass("even odd"),this.instance.addClass(self.lastClass)},removeFromView:function(){var e=this,t=self.view.indexOf(e);t>-1&&(e.instance.remove(),self.view.splice(t,1))},removeFromScreen:function(){var e=this,t=self.view.indexOf(e),n=self.items.indexOf(e);n>-1&&self.items.splice(n,1),t>-1&&(e.instance.remove(),self.view.splice(t,1)),self.refreshView()},hide:function(){this.instance.hide()},show:function(){this.instance.show()}}},fn={setSelected:function(e){self.selected=e,self.hasOwnProperty("prevItemSelected")?(self.prevItemSelected.instance.removeClass("selected"),self.prevItemSelected=self.selected):self.prevItemSelected=self.selected,self.selected.instance.addClass("selected")},getItemFields:function(e){if("undefined"==$.type(self.itemFieldsDefined)){var t={},n=self.schema.model.getColumns();$.each(e,function(e,s){$.each(n,function(e,n){"null"!==$.type(s)&&$.type("undefined"!==s.field)&&"undefined"===$.type(t[n.field])&&(t[n.field]=n)})}),self.itemFieldsDefined=t}return self.itemFieldsDefined},runEvent:function(e){var t=Array.prototype.slice.call(arguments,1);null!=self.dataGrid.events&&"function"==$.type(self.dataGrid.events[e])&&self.dataGrid.events[e].apply(this,t)},initItems:function(e){self.dataGrid.footer.setCheckedInfo(0),e.length>0&&$.each(e,function(e,t){fn.initItem({key:e,data:t})})},initItem:function(e){var t=e.key,n=e.data,s=obj.item.init(n),a=self.searchActive?self.searchItems:self.items,r=a.push(s)-1;self.searchActive||(self.itemsIndex[s.data.id]=r),"function"==typeof self.dataGrid.defineSelected&&self.dataGrid.defineSelected(s)&&fn.setSelected(s),self.itemsIndex.hasOwnProperty(s.data.id)&&("undefined"!=typeof self.items[self.itemsIndex[s.data.id]]&&self.items[self.itemsIndex[s.data.id]].checked?s.checked=!0:s.checked=!1);var i=(self.dataGrid.currentPage-1)*self.pageSize;(0==self.dataGrid.pageable||0==self.pageSize||self.view.length<self.pageSize&&t>=i)&&self.view.push(s)},displayItems:function(e){$.each(self.view,function(e,t){t.render()}),self.dataGrid.updateFooter(),self.dfdDone.resolve(self)},clearView:function(){for(var e=self.view.length;e--;)self.view[e].removeFromView(),self.view.splice(e,1)},setView:function(e){fn.clearView(),delete self.lastClass,1>e?e=1:e>self.getPageInfo().lastPage()&&(e=self.getPageInfo().lastPage());var t=(e-1)*self.pageSize,n=t+self.pageSize,s=self.searchActive?self.searchItems:self.items;self.view=s.filter(function(e,s){return s>=t&&n>s?(e.render(),!0):void 0}),self.dataGrid.footer.setCurrentPage(e),self.dataGrid.updateFooter()},getItemById:function(e){var t=self.searchActive?self.searchItems:self.items,n=$.grep(t,function(t,n){return t.data.id==e});return n.length>0?n[0]:!1},itemInView:function(e){var t=self.view.indexOf(e);return t>-1}};return self.dfdDone=new $.Deferred,this.sync=function(e){if(cfg.transport.hasOwnProperty("read"))self.read().done(function(t){0==self.items.length?(fn.initItems(t),fn.displayItems()):(self.items=[],this.itemsIndex={},fn.clearView(),self.lastClass=null,fn.initItems(t),fn.displayItems()),"function"==typeof e&&e.call(self,self),readyDfd.resolve()}).fail(function(e,t,n){"function"==typeof self.errors.read&&self.errors.read(e,t,n)});else{var t=self.getData();0==self.items.length?(fn.initItems(t),fn.displayItems()):(self.items=[],this.itemsIndex={},fn.clearView(),self.lastClass=null,fn.initItems(t),fn.displayItems()),"function"==typeof e&&e.call(self,self),readyDfd.resolve()}return self.dfdDone.promise()},this.applySearch=function(e){self.searchItems=[],self.searchActive=!0,self.dataGrid.currentPage=1,fn.clearView(),self.lastClass=null,fn.initItems(e),fn.displayItems()},this.clearSearch=function(){self.searchItems=[],self.searchActive=!1,self.setView(1)},this.syncDataById=function(e,t){t.id=e;var n=fn.getItemById(e);n&&(n.data=t,fn.itemInView(n)&&n.render())},this.getItemById=function(e){return fn.getItemById(e)},this.refreshView=function(){fn.setView(self.dataGrid.currentPage)},this.setView=function(e){fn.setView(e)},this.getPageInfo=function(){return{lastPage:function(){if(0==self.pageSize)return 1;var e=self.searchActive?self.searchItems:self.items;return Math.ceil(e.length/self.pageSize)},countIntems:function(){var e=self.searchActive?self.searchItems:self.items;return e.length},start:function(){var e=(self.dataGrid.currentPage-1)*self.pageSize+1;return 0>e&&(e=0),e},end:function(){var e=this.start()+self.pageSize;return e>=this.countIntems()?this.countIntems():e}}},this},Model:function(e){var t=this;return this.id=e.id||null,this.fields=e.fields||[],this.columns=[],$.each(e,function(e,n){t.fields[e]=n}),this.getFields=function(){return t.fields},this.getColumns=function(){return t.columns},this}}};$.fn.gkDropDownMenu=function(e){var t=$.extend(!0,{vars:{title:e.title||null,name:e.name||"",className:e.className||null,css:e.css||null,attr:e.attr||null,data:e.data||[],checkall:e.checkall||!0,change:e.change||null},setup:function(){function n(n){var s={instance:null,data:n,init:function(){return this.instance=this.getTemplate(n),this.instance.checkbox=this.instance.find('input[type="checkbox"].item-checkbox'),this.addEvents(),this},getTemplate:function(t){var n="";"undefined"!=typeof e.activeClass&&t.hasOwnProperty("active")&&(n=1==parseInt(t.active)?e.activeClass.enable:e.activeClass.disable);var s="";return s+="<tr>",s+='<td class="gk-m-checkbox"><input type="checkbox" value="'+t.value+'" class="item-checkbox"/></td>',s+='<td class="gk-m-value"><a href="javascript:{}" class="'+n+'">'+t.title+"</a></td>",s+="</tr>",s=$(s)},addEvents:function(){function e(){a.is(":checked")?a.prop("checked",!1):a.prop("checked",!0)}var n=this,s=n.instance,a=n.instance.checkbox;s.on("click",function(n){e(),t.fn.change()}),a.on("click",function(e){e.stopPropagation(),t.fn.change()})}}.init();return t.items=t.items||[],t.items.push(s),s.instance}function s(e,t){e.length&&$.each(e,function(e,s){t.append(n(s))})}var a=t.fn.getSelector(),r=t.fn.getId();return 0==t.length&&(t="",t+='<div class="gk-dropdown-menu-div" tabindex="-1" style="outline: none;">',t+='<a href="javascript:{}" class="btn btn-default gk-dropdown-menu-button" style="display:block;"><input type="checkbox" class="menu-checkall">'+this.vars.title+'<i class="icon icon-caret-down down-arrorw"></i></a>',t+='<div class="gk-dropdown-menu-table-div" style="display: none;">',t+='<table class="gk-dropdown-menu-table">',t+="</table>",t+="</div>",t+='<div class="clear">&nbsp;</div>',t+="</div>",t=$(t),t.vars=this.vars,t.fn=this.fn,t.obj=this.obj,t.button=t.find(".gk-dropdown-menu-button"),t.menu=t.find(".gk-dropdown-menu-table-div"),t.table=t.find(".gk-dropdown-menu-table"),t.checkall=t.find('input[type="checkbox"].menu-checkall'),t.items=[],s(this.vars.data,t.table),t.hitTest=!1),"id"==a.type?t.attr("id",a.name+r):"class"==a.type&&t.attr("class",a.name+r),t.addClass("gk-dropdown-menu"),null!=t.vars.className&&t.addClass(t.vars.className),null!=t.vars.css&&t.css(t.vars.css),null!=t.vars.attr&&t.attr(t.vars.attr),t.toggleMenu=function(){t.menu.is(":visible")?t.menu.hide():t.menu.show()},t.showMenu=function(){t.menu.show()},t.hideMenu=function(){t.menu.hide()},t.getSelected=function(){return t.fn.getSelected()},t.select=function(e){return t.fn.select(e)},t.mark=function(e){return t.fn.mark.call(this,e)},t.uncheckAll=function(){return t.fn.uncheckAll()},t.fn.addEvents(),t},obj:{},fn:{addEvents:function(){t.button.on("click",function(e){e.preventDefault(),e.stopPropagation(),t.focus(),t.toggleMenu()}),t.on("focusout",function(e){0==t.hitTest&&t.hideMenu()}),t.on("mouseleave",function(){t.hitTest=!1}),t.on("mouseenter",function(){t.hitTest=!0}),t.checkall.on("click",function(e){e.stopPropagation()}),t.checkall.on("change",function(){$.each(t.items,function(e,n){t.checkall.is(":checked")?n.instance.checkbox.prop("checked",!0):n.instance.checkbox.prop("checked",!1)}),t.fn.change()})},change:function(){if(null!=t.vars.change){var e=t.fn.getSelected();0==e.length?t.checkall.prop("checked",!1):t.checkall.prop("checked",!0),t.vars.change(e)}},getSelected:function(){var e=[];return $.each(t.items,function(t,n){var s=n.instance.checkbox;s.is(":checked")&&e.push(s.val())}),e},select:function(e){for(var n=[],s=0;s<e.length;s++)n.push(Number(e[s]));$.each(t.items,function(e,t){var s=t.instance.checkbox;-1==n.indexOf(Number(t.data.value))||s.is(":checked")||t.instance.click()})},mark:function(e){var t=this,n=!1,s=[];if(idsStrimg=[],e.length>0){isNaN(Number(e[0]));n=!0}if(n)for(var a=0;a<e.length;a++)idsStrimg.push(e[a]);else for(var a=0;a<e.length;a++)s.push(Number(e[a]));$.each(t.items,function(e,a){var r=a.instance.checkbox;n?-1==idsStrimg.indexOf(a.data.value)||r.is(":checked")||(a.instance.checkbox.prop("checked",!0),t.checkall.prop("checked",!0)):-1==s.indexOf(Number(a.data.value))||r.is(":checked")||(a.instance.checkbox.prop("checked",!0),t.checkall.prop("checked",!0))})},uncheckAll:function(){t.checkall.prop("checked",!1),$.each(t.items,function(e,t){var n=t.instance.checkbox;n.prop("checked",!1)})},getSelector:function(){var e=t.selector,n=!1;return/^\#/.test(e)?(n="id",e=e.slice(1,e.length)):/^\./.test(e)&&(n="class",e=e.slice(1,e.length)),{name:e,type:n}},getId:function(){var e="";return e=null!=t.vars.item?"_"+t.vars.item.data.id:"_"+gk.fn.uniqueId()}}},this);return t.setup()};var NewsletterPro=NewsletterPro||{};!function($){$(function(){try{NewsletterPro.modifyTextarea()}catch(e){console.warn(e)}}),NewsletterPro.define={SEND_METHOD_DEFAULT:0,SEND_METHOD_ANTIFLOOD:1,SEND_THROTTLER_TYPE_EMAILS:0,SEND_THROTTLER_TYPE_MB:1},NewsletterPro.prototype={name:"Newsletter Pro",version:"4.0.1"},NewsletterPro.namespace=function(e){var t,n=e.split("."),s=NewsletterPro;for("NewsletterPro"===n[0]&&(n=n.slice(1)),t=0;t<n.length;t++)"undefined"==typeof s[n[t]]&&(s[n[t]]={}),s=s[n[t]];return s},NewsletterPro.alertErrors=function(e){var t;t="string"==typeof e?e.replace(/\&quot;/g,'"'):String(e.join("\n")).replace(/\&quot;/g,'"'),t=t.replace(/\&\#039;/g,'"'),alert(t)},NewsletterPro.displayAlert=function(e,t){return t=t||"\n","object"==typeof e&&(e=e.join(t)),e=e.replace(/\&quot;/g,'"'),e=e.replace(/\&\#039;/g,'"'),e=e.replace(/\&\gt;/g,">"),e=e.replace(/\&\lt;/g,"<")},NewsletterPro.showAjaxLoader=function(e){var t=e.find(".btn-ajax-loader");t.length>0?t.show():(t=e.find(".ajax-loader"),t.length>0&&t.show())},NewsletterPro.hideAjaxLoader=function(e){var t=e.find(".btn-ajax-loader");t.length>0?t.hide():(t=e.find(".ajax-loader"),t.length>0&&t.hide())},NewsletterPro.getUrl=function(e){return NewsletterPro.dataStorage.get("ajax_url")+this.parseUrl(e)},NewsletterPro.parseUrl=function(e,t){"undefined"==typeof t&&(t=!1);var n="";for(var s in e){var a=e[s];n+="&"+s+"="+a}return 1==t?n.substr(1):n},NewsletterPro.extendSubscribeFeature=function(e){e.subscriptionFeature=e.subscriptionFeature||{},e.subscribe=function(t,n,s){e.subscriptionFeature.hasOwnProperty(t)||(e.subscriptionFeature[t]=[]),e.subscriptionFeature[t].push({func:n,instance:s})},e.publish=function(t,n){if(e.subscriptionFeature.hasOwnProperty(t))for(var s=0;s<e.subscriptionFeature[t].length;s++){var a="function"==typeof n?n():n,r=e.subscriptionFeature[t][s].func,i=e.subscriptionFeature[t][s].instance||e;r.call(i,a)}}},NewsletterPro.dataStorage={data:{},init:function(){return NewsletterPro.extendSubscribeFeature(this),this},get:function(name){if("undefined"==typeof name)return this.data;var split=name.split(".");if(split.length>1){var target="NewsletterPro.dataStorage.data."+split.join(".");try{if("undefined"!==eval("typeof "+target))return eval(target)}catch(e){return!1}}else if(this.data.hasOwnProperty(name))return this.data[name];return!1},getNumber:function(e){var t=Number(this.get(e));return isNaN(t)?0:t},has:function(name){if("undefined"==typeof name)return this.data;var split=name.split(".");if(split.length>1){var target="NewsletterPro.dataStorage.data."+split.join(".");try{if("undefined"!==eval("typeof "+target))return!0}catch(e){return!1}}else if(this.data.hasOwnProperty(name))return!0;return!1},add:function(e,t){var n,s=e.split("."),a=this.data;for(n=0;n<s.length;n++)n==s.length-1?a[s[n]]=t:"object"!=typeof a[s[n]]&&(a[s[n]]={}),"object"==typeof a&&(a=a[s[n]])},set:function(e,t){this.add(e,t),this.publish("change"+e,t)},addObject:function(e){for(var t in e)this.data[t]=e[t]},append:function(e,t){this.data.hasOwnProperty(e)?this.data[e].push(t):(this.data[e]=[],this.data[e].push(t))},on:function(e,t,n){switch(e){case"change":this.subscribe("change"+t,n)}}}.init(),NewsletterPro.test={dom:function(){var e=NewsletterPro.modules;for(var t in e){var n=t,s=e[t];dom=s.dom;for(var a in dom){var r=a,i=dom[a];if(0==i.length)throw Error('Error: The element "'+r+'" does not exist in the module "'+n+'"')}}}},NewsletterPro.onObject={callback:{},setCallback:function(e,t){this.callback[e]=t},run:function(e,t){this.callback.hasOwnProperty(e)&&this.callback[e](t)}},NewsletterPro.uniqueId=function(e){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}e=e||3;for(var n="",s=0;e>s;s++)n+=t()+"-";return n.replace(/-$/,"")},NewsletterPro.ucfirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},NewsletterPro.modifyTextarea=function(){HTMLTextAreaElement.prototype.getCaretPosition=function(){return this.selectionStart},HTMLTextAreaElement.prototype.setCaretPosition=function(e){this.selectionStart=e,this.selectionEnd=e,this.focus()},HTMLTextAreaElement.prototype.hasSelection=function(){return this.selectionStart!=this.selectionEnd},HTMLTextAreaElement.prototype.getSelectedText=function(){return this.value.substring(this.selectionStart,this.selectionEnd)},HTMLTextAreaElement.prototype.setSelection=function(e,t){this.selectionStart=e,this.selectionEnd=t,this.focus()}},NewsletterPro.setBoxSizeing=function(e){for(var t in e)e[t].css({"box-sizing":"content-box"})},NewsletterPro.versionCompare=function(e,t,n){function s(e){return(a?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}var a=n&&n.lexicographical,r=n&&n.zeroExtend,i=e.split("."),o=t.split(".");if(!i.every(s)||!o.every(s))return NaN;if(r){for(;i.length<o.length;)i.push("0");for(;o.length<i.length;)o.push("0")}a||(i=i.map(Number),o=o.map(Number));for(var l=0;l<i.length;++l){if(o.length==l)return 1;if(i[l]!=o[l])return i[l]>o[l]?1:-1}return i.length!=o.length?-1:0},NewsletterPro.subscription=function(e,t){for(var n=0;n<e.subscription.length;n++){var s=e.subscription[n];s[0].subscribe(s[1],e[s[2]],e)}},NewsletterPro.htmlEncode=function(e){return $("<div/>").text(e).html()},NewsletterPro.htmlDecode=function(e){return $("<div/>").html(e).text()},NewsletterPro.getXHRError=function(e,t){t=t||1e3;var n=e.responseText,s=this.htmlEncode(n.slice(0,1e3));return n.length>1e3&&(s+="..."),s},NewsletterPro.bootstrap=function(e){var t=Number(this.dataStorage.get("bootstrap"));return e(t)},NewsletterPro.isTinyHigherVersion=function(){return tinyMCE.majorVersion>=4},NewsletterPro.linkAdd=function(e,t,n){if(t=t||"",n=n||"",e){var s=e.indexOf("#");/\?/.test(e)&&t.length>0?e=-1!=s?e.substr(0,s)+"&"+t+e.substr(s):e+"&"+t:t.length>0&&(e=-1!=s?e.substr(0,s)+"?"+t+e.substr(s):e+"?"+t),-1!=s&&n.length>0?e+=n:n.length>0&&(e=e+"#"+n)}return e},NewsletterPro.trimString=function(e,t,n){return n=n||"...",t=parseInt(t),e.length>t+n.length&&(e=e.slice(0,t)+n),e},NewsletterPro.objSize=function(e){var t=0;for(var n in e)t++;return t},NewsletterPro.parseProductHeader=function(e,t){t="undefined"!=typeof t?t:!0;var n=function(e){var t=e.split("\n"),n="";if(null!=t&&t.length>0)for(var s=0;s<t.length;s++){var a=t[s].replace(/\s+/g,"");""!=a&&(n+=a,";"!==a[a.length-1]&&(n+=";"))}var r=n.split(";"),i={};if(null!=r&&r.length>0)for(var s=0;s<r.length;s++){var o=r[s].replace(/\s+/g,"");if(""!=o){var l=o.split("=");"undefined"!=typeof l[1]&&(i[l[0]]="false"===l[1]?!1:"true"===l[1]?!0:isNaN(Number(l[1]))?l[1]:Number(l[1]))}}return i},s=function(e){var s=e.match(/<!-- start header -->\s*?<!--([\s\S]*)-->\s*?<!-- end header -->/);t||(s=[],s[0]="",s[1]=e);var a,r,i={};return null!=s&&s.length>0&&(a=s[0],r=s[1],i=n(r),e=e.replace(a,"")),i};return s(e)}}(jQueryNewsletterProNew),NewsletterPro.namespace("modules.createCustomField"),NewsletterPro.modules.createCustomField={dom:null,box:null,init:function(e){var t=this;this.box=e,this.ready(function(n){var s,a,r,i,o=[];for(var c in e.dataStorage.get("custom_field.types_editable"))o.push(Number(c));var d=function(e,t){"undefined"!=typeof i&&(i.transport.read.data={id:e,id_lang:t},i.sync())};t.l=l=e.translations.l(e.translations.modules.createCustomField),t.win=win=new gkWindow({width:800,height:600,setScrollContent:540,title:l("Create Custom Fields"),className:"np-costum-fields-win",show:function(e){},close:function(e){},content:function(c){var u=t.tempalte();return n.btnAddNewVariable.on("click",function(){var e=$(this);Number(e.data("active"))?(e.data("active",0),e.html('<i class="icon icon-plus-square"></i> '+t.l("Add New Variable")),n.fiedAdd.slideUp()):(e.data("active",1),e.html('<i class="icon icon-minus-square"></i> '+t.l("Add New Variable")),n.fiedAdd.slideDown())}),n.btnSaveVariable.on("click",function(){var t=$(this),s=n.inputVariableName.val(),r=n.inputVariableType.val(),i=Number($('[name="np_custom_field_required"]:checked').val());e.showAjaxLoader(t),$.postAjax({submit_custom_field:"addField",variable_name:s,type:r,required:i}).done(function(t){t.success?"undefined"!=typeof a&&a.sync():e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(t)})}),s=new gk.data.Model({id:"id_newsletter_pro_subscribers_custom_field"}),a=new gk.data.DataSource({pageSize:6,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit_custom_field=getFieldsList",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit_custom_field=deleteField&id",type:"POST",dateType:"json",success:function(t,n){t.success||e.alertErrors(t.errors)},error:function(t,n){e.alertErrors(l("An error occurred."))},complete:function(e,t){}}},schema:{model:s},trySteps:2,errors:{read:function(e,t,n){a.syncStepAvailableAdd(3e3,function(){a.sync()})}}}),n.variablesList.gkGrid({dataSource:a,selectable:!1,currentPage:1,pageable:!0,template:{variable_name:function(e,t){return"{"+t+"}"},type_name:function(e){return e.data.type_name},required:function(t,n){var s=$("<div>"),n=Number(n),a=$('										<a class="list-action-enable action-enabled" data-enabled="1" href="javascript:{}" title="Enabled">											<i class="icon-check"></i>											<i class="icon-remove hidden"></i>										</a>									'),r=$('										<a class="list-action-enable action-disabled" data-enabled="0" href="javascript:{}" title="Disabled">											<i class="icon-check hidden"></i>											<i class="icon-remove"></i>										</a>									');n?s.html(a):s.html(r);var i=function(n){var o=$(this),l=Number(o.data("enabled")),c=t.data.id_newsletter_pro_subscribers_custom_field,d=l?0:1;$.postAjax({submit_custom_field:"changeFieldRequired",id:c,value:d}).done(function(t){t.success?(l?s.html(r):s.html(a),a.on("click",i),r.on("click",i)):e.alertErrors(t.errors)})};return a.on("click",i),r.on("click",i),s},actions:function(s){var a=$("<div>"),r=$("#np-delete-custom-field-variables-list").gkButton({title:t.l("delete"),name:"np-delete-custom-field-variables-list",className:"btn btn-default btn-margin pull-right",click:function(e){return confirm(t.l("Are you sure you want to do this action? You will lose all the data collected with this field."))?void s.destroy("success"):!1},icon:'<i class="icon icon-trash-o"></i> '});if(a.append(r),-1!=o.indexOf(Number(s.data.type))){var i=$("#np-edit-custom-field-variables-list").gkButton({title:t.l("Edit"),name:"np-edit-custom-field-variables-list",className:"btn btn-default btn-margin pull-right",click:function(t){e.dataStorage.set("custom_field.current_field_id",Number(s.data.id_newsletter_pro_subscribers_custom_field)),n.spanEditVariableName.html("{"+s.data.variable_name+"}")},icon:'<i class="icon icon-edit"></i> '});a.append(i)}return a}}}),e.dataStorage.on("change","custom_field.current_field_id",function(s){var a=e.dataStorage.getNumber("id_selected_lang");"undefined"==typeof r&&(n.fiedEdit.show(),r=new gk.data.Model({id:"key"}),i=new gk.data.DataSource({pageSize:6,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit_custom_field=getValuesList",dataType:"json",data:{id:s,id_lang:a}}},schema:{model:r},trySteps:2,errors:{read:function(e,t,n){i.syncStepAvailableAdd(3e3,function(){i.sync()})}}}),n.valuesList.gkGrid({dataSource:i,selectable:!1,currentPage:1,pageable:!0,template:{value:function(e,t){return t},actions:function(s,a){var r=$("<div>"),o=$("#np-delete-custom-field-value").gkButton({title:t.l("delete"),name:"np-delete-custom-field-value",className:"btn btn-default btn-margin pull-right",click:function(t){var n=e.dataStorage.getNumber("custom_field.current_field_id"),a=s.data.key;$.postAjax({submit_custom_field:"removeValueByKey",id:n,key:a}).done(function(t){t.success?i.sync():e.alertErrors(t.errors)})},icon:'<i class="icon icon-trash-o btn-margin"></i> '});r.append(o);var l=$("#np-edit-custom-field-value").gkButton({title:t.l("Edit"),name:"np-edit-custom-field-value",className:"btn btn-default btn-margin pull-right",click:function(a){n.btnFieldAdd.html('<i class="icon icon-save"></i> '+t.l("Update")),n.btnFieldAdd.data("edit",1),n.btnFieldAdd.data("editKey",s.data.key);var r=e.dataStorage.getNumber("custom_field.current_field_id"),i=s.data.key;$.postAjax({submit_custom_field:"getValueByKey",id:r,key:i}).done(function(t){if(t.success){var s=t.value;$.each(n.customFieldVariable,function(e,t){var n=$(t),a=n.data("lang");s.hasOwnProperty(a)&&n.val(s[a])})}else e.alertErrors(t.errors)})},icon:'<i class="icon icon icon-edit btn-margin"></i> '});return r.append(l),r}}}),n.langSelect.on("click",function(){a=e.dataStorage.getNumber("id_selected_lang"),s=e.dataStorage.getNumber("custom_field.current_field_id"),d(s,a)}),n.btnFieldAdd.on("click",function(){var s=$(this),r=s.data("edit"),i=(s.data("editkey"),e.dataStorage.getNumber("custom_field.current_field_id"));if(r){var o=t.getInputsVal(n.customFieldVariable),l=n.btnFieldAdd.data("editKey");$.postAjax({submit_custom_field:"updateValue",id:i,key:l,value:o}).done(function(s){s.success?(n.btnFieldAdd.html('<i class="icon icon-plus-square"></i> '+t.l("Add")),n.btnFieldAdd.data("edit",0),n.btnFieldAdd.data("editKey",0),$.each(n.customFieldVariable,function(e,t){$(t).val("")}),a=e.dataStorage.getNumber("id_selected_lang"),d(i,a)):e.alertErrors(s.errors)})}else{var o=t.getInputsVal(n.customFieldVariable);$.postAjax({submit_custom_field:"addValue",id:i,value:o}).done(function(t){t.success?(a=e.dataStorage.getNumber("id_selected_lang"),d(i,a)):e.alertErrors(t.errors)})}})),d(s,a)}),u}}),n.btnOpenWindow.on("click",function(){win.show()}),n.btnDisplayNewColumns.on("click",function(){win.hide(),e.modules.sendNewsletters.vars.winDisplayCustomColumns.show()})})},getInputsVal:function(e){var t={};return $.each(e,function(e,n){var s=$(n).attr("name").match(/\d+$/),a=null!==s?s[0]:0;t[a]=$(n).val()}),t},tempalte:function(){var e=this.l,t=this.box,n=this,s=t.dataStorage.get("custom_field.types"),a=t.dataStorage.get("all_active_languages"),r="",i="";for(var o in s)r+='<option value="'+o+'">'+s[o]+"</option>";for(var o in a){var l=a[o];i+='<input data-lang="'+l.id_lang+'" name="np_custom_field_variable_input_'+l.id_lang+'" type="text" class="form-control fixed-width-xxl pull-left" style="'+(l.selected?"display: block;":"display: none;")+'">'}var c=$('			<div id="np-create-custom-field-content" class="np-create-custom-field-content">				<div class="form-group clearfix">					<a href="javascript:{}" id="np-add-new-variable" class="btn btn-default pull-right" date-active="0">						<i class="icon icon-plus-square"></i> '+n.l("Add New Variable")+'					</a>				</div>				<div id="np-custom-field-add" class="clearfix" style="display: none">					<hr style="margin-top: 0">					<div class="form-group clearfix">						<label class="control-label col-sm-3"><span class="label-tooltip">'+n.l("Variable Name")+'</span></label>						<div class="form-group col-sm-9">							<input id="np-create-custom-field-variable-name" type="text" class="form-control fixed-width-xxl pull-left">						</div>					</div>					<div class="form-group clearfix">						<label class="control-label col-sm-3"><span class="label-tooltip">'+n.l("Type")+'</span></label>						<div class="form-group col-sm-9">							<select class="form-control fixed-width-xxl pull-left" id="np-create-custom-field-variable-type">								<option value="0">- '+n.l("none")+" -</option>								"+r+'							</select>						</div>					</div>					<div class="form-group clearfix">						<label class="control-label col-sm-3"><span class="label-tooltip">'+e("Required")+'</span></label>						<div class="col-sm-9">							<div class="fixed-width-l clearfix">								<div class="col-sm-3">									<div class="row">										<span class="switch prestashop-switch">											<input id="np_custom_field_required_yes" type="radio" name="np_custom_field_required" value="1">											<label for="np_custom_field_required_yes">												'+e("Yes")+'											</label>											<input id="np_custom_field_required_no" type="radio" name="np_custom_field_required" value="0" checked="checked">											<label for="np_custom_field_required_no">												'+e("No")+'											</label>											<a class="slide-button btn"></a>										</span>									</div>								</div>							</div>						</div>					</div>					<div class="form-group clearfix">						<div class="col-sm-offset-3 com-sm-9">							<a id="np-create-custom-field-save-variable" href="javascript:{}" class="btn btn-success pull-left">								<span class="btn-ajax-loader"></span>								<i class="icon icon-save"></i>								'+n.l("Save Variable")+'							</a>						</div>					</div>					<hr style="margin-top: 0">				</div>				<div class="form-group clearfix">					<table id="np-custom-field-variables-list" class="table table-bordered np-custom-field-variables-list">						<thead>							<tr>								<th class="variable-name" data-field="variable_name">'+e("Variable Name")+'</th>								<th class="type-name" data-template="type_name">'+e("Type")+'</th>								<th class="required" data-field="required">'+e("Required")+'</th>								<th class="np-actions" data-template="actions">'+e("Actions")+'</th>							</tr>						</thead>					</table>				</div>				<div class="form-group clearfix">					<label class="control-label col-sm-3"><span class="label-tooltip">'+n.l("List Columns")+'</span></label>					<div class="col-sm-9">						<div class="form-group clearfix">							<a href="javascript:{}" id="np-display-new-columns-custom-field" class="btn btn-default pull-left"><i class="icon icon-eye"></i> '+n.l("Display Custom Columns")+'</a>						</div>						<p class="help-block">'+n.l("Display a new column for the created fields on the list Visitors Subscribed (at the Newsletter Pro module).")+'</p>					</div>				</div>				<div id="np-custom-field-edit" class="form-group clearfix" style="display: none">					<h4 class="np-win-h4">'+e("Edit Variable")+' <span id="np-custom-field-edit-variable-name"></span></h4>					<div class="form-group clearfix">						<label class="control-label col-sm-3"><span class="label-tooltip">'+e("Value")+'</span></label>						<div class="col-sm-9" style="padding-right: 0">							<div class="form-inline">								<div class="form-group">									'+i+'								</div>								<div class="form-group">									<div id="np-custom-field-value-lang" class="pull-right np-custom-field-value-lang gk_lang_select pull-left"></div>								</div>								<div class="form-group pull-right">									<a id="np-btn-custom-field-add" data-edit="0" data-editkey="0" href="javascript:{}" class="btn btn-default">										<i class="icon icon-plus-square"></i>										'+e("Add")+'									</a>								</div>							</div>						</div>					</div>					<div class="form-group clearfix">						<table id="np-custom-field-values-list" class="table table-bordered np-custom-field-values-list">							<thead>								<tr>									<th class="np-value" data-field="value">'+e("Value")+'</th>									<th class="np-actions" data-template="actions">'+e("Actions")+"</th>								</tr>							</thead>						</table>					</div>				</div>			</div>		");return $.extend(this.dom,{winTemplate:c,btnAddNewVariable:c.find("#np-add-new-variable"),fiedAdd:c.find("#np-custom-field-add"),fiedEdit:c.find("#np-custom-field-edit"),valuesList:c.find("#np-custom-field-values-list"),variablesList:c.find("#np-custom-field-variables-list"),inputVariableName:c.find("#np-create-custom-field-variable-name"),inputVariableType:c.find("#np-create-custom-field-variable-type"),btnSaveVariable:c.find("#np-create-custom-field-save-variable"),spanEditVariableName:c.find("#np-custom-field-edit-variable-name"),langSelect:c.find("#np-custom-field-value-lang"),btnFieldAdd:c.find("#np-btn-custom-field-add"),customFieldVariable:c.find('[name^="np_custom_field_variable_input_"]'),btnDisplayNewColumns:c.find("#np-display-new-columns-custom-field")}),c},ready:function(e){var t=this;$(document).ready(function(){t.dom={btnOpenWindow:$("#np-create-custom-field")},e(t.dom)})}}.init(NewsletterPro),
function(e){NewsletterPro.namespace("components.ProductSelection"),NewsletterPro.components.ProductSelection=function t(n){if(!(this instanceof t))return new t(n);var s=this,a=NewsletterPro;a.extendSubscribeFeature(this),this.dom={},this.winEdit=null,this.l=null,this.ready(function(t){s.l=a.translations.l(a.translations.components.ProductSelection);var n=NewsletterPro.components.CurrencySelect.getInstanceById("#products-currency-change");n.on("change","#products-currency-change",function(e){s.render(a.dataStorage.get("id_selected_lang"),Number(e))}),t.btnSort.on("change",function(){s.sort()}),t.sortOrder.on("change",function(){s.sort()}),s.winEdit=new gkWindow({width:800,height:600,setScrollContent:540,title:s.l("Edit")+" : %s",className:"np-product-attribute-edit-win",show:function(e){},close:function(e){},content:function(t){var n=e('						<div class="form-group clearfix">							<table id="np-edit-product-attibutes" class="table table-bordered np-edit-product-attibutes">								<thead>									<tr>										<th class="np-attribute-id" data-field="id">'+s.l("ID")+'</th>										<th class="np-attribute-image" data-template="image">'+s.l("Image")+'</th>										<th class="np-attribute-attribute-name" data-field="attribute_name">'+s.l("Name")+'</th>										<th class="np-attribute-value" data-template="value">'+s.l("Color")+'</th>										<th class="np-attribute-reference" data-field="reference">'+s.l("Reference")+'</th>										<th class="np-attribute-price" data-field="price">'+s.l("Price")+'</th>										<th class="np-attribute-available-date" data-field="available_date">'+s.l("Availalbe Date")+"</th>									</tr>								</thead>							</table>						</div>					");return t.dataModel=new gk.data.Model({id:"id"}),t.dataSource=new gk.data.DataSource({pageSize:9,transport:{data:[]},schema:{model:t.dataModel}}),t.dataGrid=n.find("#np-edit-product-attibutes").gkGrid({dataSource:t.dataSource,selectable:!0,currentPage:1,pageable:!0,template:{image:function(e,t){return'<img src="'+e.data.image+'" style="width: 40px; height: 40px;">'},value:function(e,t){var t="",n=Number(e.data.is_color_group);return n&&(t='<div style="width: 15px; height: 15px; border: solid 1px #CCCCCC; background-color: '+e.data.attribute_color+';"></div>'),t},available_date:function(e){return"0000-00-00"!==e?e:""}},events:{select:function(e){var n=e.data,s=a.components.Product.getInstanceById(n.id_product);s.viewInfo[n.id_lang].id_product_attribute=n.id_product_attribute,s.render(null,null,s.viewInfo[n.id_lang].id_product_attribute),t.hide()}},defineSelected:function(e){return e.data.selected}}),t.dataGrid}})})},NewsletterPro.components.ProductSelection.prototype.sort=function(){var e=NewsletterPro,t=this.dom,n=t.btnSort.val();"0"!==n?e.components.Product.sortProducts(n,Number(t.sortOrder.val())):e.components.Product.sortProducts("position",Number(t.sortOrder.val()))},NewsletterPro.components.ProductSelection.prototype.add=function(t){var n=this,s=NewsletterPro,a=n.dom,r=s.dataStorage.get("product_template");this.publish("beforeAdd",{template:r,idProduct:t,product:null,ids:s.components.Product.getProductsId()}),e.postAjax({submit_product_selection:"addProduct",id_product:t}).done(function(e){if(e.success){var i=e.product,o=new s.components.Product({data:i,template:r,view:a.containerLang});n.render(),n.sort(),n.publish("add",{template:r,idProduct:t,product:o,ids:s.components.Product.getProductsId()})}else s.alertErrors(e.errors)})},NewsletterPro.components.ProductSelection.prototype.remove=function(e){var t=NewsletterPro;t.components.Product.removeProduct(Number(e))},NewsletterPro.components.ProductSelection.prototype.render=function(e,t,n){var s=NewsletterPro;s.components.Product.render(e,t,n)},NewsletterPro.components.ProductSelection.prototype.ready=function(t){var n=this,s=NewsletterPro;e(document).ready(function(){n.dom={container:e("#selected-products"),containerLang:{},btnSort:e("#np-selected-products-sort"),sortOrder:e("#np-selected-products-sort-order"),languageSelect:e("#np-change-view-template-lang")};for(var a=s.dataStorage.get("all_languages"),r=s.dataStorage.getNumber("id_selected_lang"),i=0;i<a.length;i++){var o=Number(a[i].id_lang),l=e('<div id="selected-products-'+o+'" class="clearfix '+(o!=r?"np-lang-visible-hide":"")+'" data-lang="'+o+'" data-visible="1" style="padding 0; margin: 0 auto; display: block;"></div>');n.dom.containerLang[o]=l,n.dom.containerLang[o].sortable(),n.dom.container.append(n.dom.containerLang[o])}t(n.dom)})}}(jQueryNewsletterProNew),NewsletterPro.namespace("components.ProductRender"),NewsletterPro.components.ProductRender=function e(t,n){function s(e,n){t=t.replace(new RegExp("{"+e+"}","g"),n)}function a(e){return"undefined"==typeof e||null===e?"":e}function r(){var e=/\{if\s(?:\s+)?([^}]+)\}([\s\S]+?)(?:\{\/if\})/g,n=t.match(e),s=[];if(null!=n){var a=n.length;if(a>0)for(var r=0;a>r;r++){var n=e.exec(t),i=u(n[1]),o=n[1];s.push({match:n[0],condition:o,content:n[2],type:i,variable:f(o),value:h(o),sign:m(i),hasElse:function(){return/\{else\}/.test(this.match)},getElse:function(){if(this.hasElse()){var e=/\{else\}([\s\S]+)/.exec(this.content);if(null!=e)return e[1]}return""},getIf:function(){if(this.hasElse()){var e=/([\s\S]+?)\{else\}/.exec(this.content);if(null!=e)return e[1]}return this.content}})}}return s}function i(e){if(e.length>0)for(var t in e){var n=e[t];o(n)}}function o(e){var t=e.variable,n=e.value,s=e.getIf(),a=e.match;switch(e.type){case w:c(e.variable)?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"");break;case b:c(t)&&d(t)<n?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"");break;case y:c(t)&&d(t)<=n?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"");break;case S:c(t)&&d(t)==n?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"");break;case k:c(t)&&d(t)>=n?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"");break;case P:c(t)&&d(t)>n?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"");break;case _:c(t)&&d(t)===n?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"");break;case N:c(t)&&d(t)!=n?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"");break;case x:c(t)&&d(t)!==n?l(a,s):e.hasElse()?l(a,e.getElse()):l(a,"")}}function l(e,t){v=v.replace(e,t)}function c(e){return!!n.hasOwnProperty(e)}function d(e){return c(e)?n[e]:void 0}function u(e){var t;switch(!0){case/isset/.test(e):t=w;break;case p("<").test(e):t=b;break;case p("<=").test(e):t=y;break;case p("==").test(e):t=S;break;case p(">=").test(e):t=k;break;case p(">").test(e):t=P;break;case p("===").test(e):t=_;break;case p("!=").test(e):t=N;break;case p("!==").test(e):t=x}return t}function p(e){var t="(\\s|\\w+|\"')";return new RegExp(t+e+t)}function m(e){var t;switch(e){case w:t="isset";break;case b:t="<";break;case y:t="<=";break;case S:t="==";break;case k:t=">=";break;case P:t=">";break;case _:t="===";break;case N:t="!=";break;case x:t="!=="}return t}function f(e){var t=u(e);if(t!=w)return $.trim(e.match(/\w+/)[0]);var n=new RegExp(m(t)+"\\((\\w+)\\)"),s=n.exec(e);return"undefined"!=typeof s[1]?s[1]:void 0}function h(e){var t=/[=<>]+([^}]+)/.exec(e);return null!==t?g(t[1]):void 0}function g(e){if(e=$.trim(e),e.length>0){var t=e[0];e[e.length-1];if("'"==t||'"'==t)return e.substr(1,e.length-2)}return e}if(!(this instanceof e))return new e(t,n);var v,w=1,b=2,y=3,S=4,k=5,P=6,_=7,N=8,x=9;t=t.replace(/\&gt;/g,">"),t=t.replace(/\&lt;/g,"<"),this.render=function(){for(var e in n)s(e,a(n[e]));v=t;try{i(r())}catch(o){console.error(o.message)}return v}},NewsletterPro.namespace("components.ProductTemplate"),NewsletterPro.components.ProductTemplate=function t(e){if(!(this instanceof t))return new t(e);var n=NewsletterPro,s=0,a=null;this.cfg=e,this.header=this.cfg.header,a=this.cfg.template.match(/\<\!--\s+?\{columns=(\d+)\}\s+?--\>/),a&&a.length>1&&(s=Number(a[1]),isNaN(s)&&(s=0)),this.columns=s,this.template=this.cfg.template.replace(/\{columns=\d+\}|<!--\s+\{columns=\d+\}\s+-->|<!-- start header -->[\s\S]*?<!-- end header -->/g,""),this.isTemplate()?this.tree=n.components.ProductTemplateTree(this.template):this.tree=n.components.ProductTemplateTree(this.template,!1)},NewsletterPro.components.ProductTemplate.prototype={html:function(){return this.tree.get("np-product")},isTemplate:function(){return"template"===this.getHeader("content")},hasHeader:function(e){return!!this.header.hasOwnProperty(e)},getHeader:function(e){return this.hasHeader(e)?this.header[e]:void 0}},NewsletterPro.namespace("components.ProductTemplateTree"),NewsletterPro.components.ProductTemplateTree=function n(e,t){return this instanceof n?(t="undefined"==typeof t,this.string=e,this.storage={},void(t?this.init(this.string):this.storage["np-product"]=e)):new n(e,t)},NewsletterPro.components.ProductTemplateTree.prototype={init:function(e){var t,n,s,a,r,i,o=e.length,l=0,c=0,d=0,u=0;for(t=0;o>t;t++)n=e[t],s=e[t+1],a=e[t-1],"{"===n&&"{"===s?(r=e.substr(c,t-c).replace(/\s+|\:/g,""),0==l&&(rootName=r),c=t+2,u=c,l++):"}"===n&&"}"===s&&","===e[t+2]?(c=t+3,d=c,i=e.substr(u,t-u).trim(),l>1&&this.add(r,i),l--):"}"===n&&"}"===s&&l--},parse:function(e){for(var t=Object.keys(this.storage),n=0,s=t.length;s>n;n++)e(t[n],this.storage[t[n]])},add:function(e,t){this.storage[e]=t},get:function(e){return this.has(e)?this.storage[e]:void 0},getRender:function(e,t){if(this.has(e)){t=t||{};var n=NewsletterPro,s=this.get(e);return new n.components.ProductRender(s,t).render()}},has:function(e){return this.storage.hasOwnProperty(e)}},NewsletterPro.namespace("components.Product"),NewsletterPro.components.Product=function s(e){if(!(this instanceof s))return new s(e);var t=NewsletterPro.components.Product,n=NewsletterPro;this["static"]=t,this.data=e.data,this.templateHeader={},this.setTemplate(e.template),this.view=e.view,this.viewInstance={},this.viewInfo={},this.inView=[],this.edit={},this.id=Number(this.data.variables.id_product),this["static"].products.push(this),this["static"].lastPosition++,this.position=this["static"].lastPosition,this["static"].view=this.view,t.imageType||(t.imageType=n.dataStorage.get("configuration.IMAGE_TYPE"))},NewsletterPro.components.Product.prototype.setTemplate=function(e){var t=NewsletterPro,n=NewsletterPro.components.Product,s=t.modules.selectProducts.vars.sliderImageSize;this.templateHeader=this.getHeader(e),t.objSize(this.templateHeader)?this.templateHeader.hasOwnProperty("loadImageSize")&&n.setImageSize(Number(this.templateHeader.loadImageSize)):n.imageWidth=s.getValue(),this.template=t.components.ProductTemplate({header:this.templateHeader,template:e})},NewsletterPro.components.Product.prototype.getHeader=function(e){return NewsletterPro.parseProductHeader(e)},NewsletterPro.components.Product.prototype.addToView=function(){var e=NewsletterPro.components.Product;if(this.isInView())return!1;this.inView.push(this.id);for(var t in this.view){null==e.layout||e.layout.hasOwnProperty(t)||(e.layout[t]=$('				<table class="np-newsletter-layout-'+t+'" style="margin: 0 auto; padding; 0; border-collapse: collapse; border-spacing: 0;">				</table>			'));var n=this.view[t],s=$("<div>");if(this.viewInstance[t]=s,null!=e.layout){var a=e.layout[t].find('[class^="np-newsletter-row-"]:last');if(a.length>0){var r,i=a.find('[class^="np-newsletter-column-product-id-"]'),o=i.length,l=$('<td class="np-newsletter-column-product-id-'+this.id+'"></td>');if(l.append(s),o%e.columns==0){var c=a.attr("class"),d=Number(c.match(/np-newsletter-row-(\d+)/)[1])+1;r=$('<tr class="np-newsletter-row-'+d+'"></tr>'),r.append(l),r.insertAfter(a)}else a.append(l)}else{var r=$('<tr class="np-newsletter-row-1"></tr>'),l=$('<td class="np-newsletter-column-product-id-'+this.id+'"></td>');l.append(s),r.append(l),e.layout[t].append(r),this.view[t].sortable("disable"),this.view[t].empty(),this.view[t].append(e.layout[t])}}else if(this.template.isTemplate()){var u=this.getVars(t),p=Number(this.template.tree.get("np-columns")),m=$('<table class="np-responsive-table-container" border="0" cellpadding="0" cellspacing="0"></table>'),f=$(this.template.tree.getRender("np-row",u)),h=$(this.template.tree.getRender("np-row-separator",u)),g=$(this.template.tree.getRender("np-product-separator",u));0==n.find(".np-responsive-table-container").length?n.append(m):m=n.find(".np-responsive-table-container:last"),0==m.find(".np-row-products-target:last").length&&m.append(f);var v=e.products.length-1;v%p==0?(m.append(f),m.append(h),currentRowTarget=m.find(".np-row-products-target:last"),currentRowTarget.append(s),p>1&&currentRowTarget.append(g)):(currentRowTarget=m.find(".np-row-products-target:last"),currentRowTarget.append(s),p-1>v%p&&currentRowTarget.append(g))}else n.append(s)}return!0},NewsletterPro.components.Product.prototype.isInView=function(){return-1!=this.inView.indexOf(this.id)},NewsletterPro.components.Product.prototype.render=function(e,t,n){var s=this,a=NewsletterPro.components.Product;this.isInView()||this.addToView();var r=function(e){var r=$(s.renderWithOptions(e,t,n));a.productWidth>0?r.width(a.productWidth):0==a.productWidth&&r.width("auto"),s.viewInstance[e].replaceWith(r),s.viewInstance[e]=r,a.productWidth>0&&a.productWidth<r.width()&&(a.productWidth=r.width());var i=r.find(".np-edit-product-menu");if(!i.length){i=$('				<div data-id="'+s.id+'" style="position: absolute;" class="np-edit-product-menu">					<a data-id="'+s.id+'" data-on-lang="'+e+'" href="javascript:{}" class="np-edit-product-menu-btn-move np-edit-product-menu-btn pull-left">						<i class="icon icon-move"></i>					</a>					<a data-id="'+s.id+'" data-on-lang="'+e+'" href="javascript:{}" onclick="NewsletterPro.components.Product.editProduct('+s.id+", "+e+');" class="np-edit-product-menu-btn-edit np-edit-product-menu-btn pull-left">						<i class="icon icon-edit"></i>					</a>					<a data-id="'+s.id+'" data-on-lang="'+e+'" href="javascript:{}" onclick="NewsletterPro.components.Product.removeProduct('+s.id+", "+e+');" class="np-edit-product-menu-btn-remove np-edit-product-menu-btn pull-right">						<i class="icon icon-remove"></i>					</a>				</div>			');var o=r.find("td"),l=i.find(".np-edit-product-menu-btn-move");o.length||(o=r.find("div")),o.first().css("position","relative").prepend(i),l.length&&(null==a.layout?l.show():l.hide(),s.template.isTemplate()&&l.hide())}};null!=e?r(e):this.parseViewInstances(function(e,t){r(e)}),a.fixHeightAndWidthAndSliders()},NewsletterPro.components.Product.prototype.getViewInfo=function(e,t,n){var s=NewsletterPro;return null==t&&(t=this.viewInfo.hasOwnProperty(e)?this.viewInfo[e].currency:s.dataStorage.getNumber("configuration.CURRENCY")),null==n&&(n=this.viewInfo.hasOwnProperty(e)?this.viewInfo[e].id_product_attribute:0),{currency:t,id_product_attribute:n}},NewsletterPro.components.Product.prototype.setViewInfo=function(e,t,n){this.viewInfo[e]={currency:t,id_product_attribute:n}},NewsletterPro.components.Product.prototype.renderWithOptions=function(e,t,n){var s=NewsletterPro,a=(s.components.Product,this.getVars(e,t,n)),r=this.template.html();return new s.components.ProductRender(r,a).render()},NewsletterPro.components.Product.prototype.getVars=function(e,t,n){var s=NewsletterPro,a=NewsletterPro.components.Product,r=this.getViewInfo(e,t,n);t=r.currency,n=r.id_product_attribute,this.setViewInfo(e,t,n);var i,o,l,c,d=this.data,u=d.variables,p=d.variables_lang,m=d.prices.hasOwnProperty(t)?d.prices[t]:!1,f=d.images,h=a.imageType,g=f.cover_images[e][h],v=d.attributes_groups.attributes_groups,w=v.hasOwnProperty(e)&&$.isArray(v[e])?v[e]:!1,b=d.attributes_groups.combination_images.hasOwnProperty(e)&&d.attributes_groups.combination_images[e].hasOwnProperty(n)?d.attributes_groups.combination_images[e][n]:!1,y=d.prices_attributes.hasOwnProperty(n)&&d.prices_attributes[n].hasOwnProperty(t)?d.prices_attributes[n][t]:!1,S=d.attributes_combinations.attribute_anchor_separator,k=function(e,t){var n=Number(e),s=Number(t),r=s/n;return a.imageWidth>0&&(n=a.imageWidth,s=Math.round(n*r)),{width:Number(n),height:Number(s)}};i={};for(var P in u)i[P]=u[P];if(w&&Number(n)>0){for(var _={},N=0;N<w.length;N++){var x=w[N],T=x.id_product_attribute;_.hasOwnProperty(T)||(_[T]=[]),_[T].push(x)}if(_.hasOwnProperty(n)){var C=_[n];if($.trim(C[0].reference).length>0&&(i.reference=C[0].reference),l="",s.dataStorage.get("isPS16"))for(var N=0;N<C.length;N++)l+="/"+String(C[N].id_attribute+S+C[N].group_name+S+C[N].attribute_name).toLowerCase();else for(var N=0;N<C.length;N++)l+="/"+String(C[N].group_type+S+C[N].attribute_name).toLowerCase()}}for(var P in p)p[P].hasOwnProperty(e)&&(i[P]=p[P][e]);if(i.link=s.linkAdd(i.link,"SubmitCurrency=yes&id_currency="+t),l&&l.length>0&&(i.link=s.linkAdd(i.link,"",l)),-1!=a.productNameLength&&(i.name=s.trimString(i.name,a.productNameLength)),-1!=a.productShortDescriptionLength&&(i.description_short=s.trimString(i.description_short,a.productShortDescriptionLength)),-1!=a.productDescriptionLength&&(i.description=s.trimString(i.description,a.productDescriptionLength)),y&&(m=y),m)for(var P in m)i[P]=m[P];if(b&&$.isArray(b)&&b.length>0){var I=b[0].images;I.hasOwnProperty(h)&&(o=I[h])}return o?(c=k(o.width,o.height),i.image_path=o.link,i.image_width=c.width,i.image_height=c.height):(c=k(g.width,g.height),i.image_path=g.link,i.image_width=c.width,i.image_height=c.height),i},NewsletterPro.components.Product.prototype.parseViewInstances=function(e){for(var t in this.viewInstance)e(t,this.viewInstance[t])},NewsletterPro.components.Product.prototype.remove=function(){var e=NewsletterPro,t=NewsletterPro.components.Product;if(index=this["static"].products.indexOf(this),-1!==index){this["static"].products.splice(index,1);for(var n in this.viewInstance){var s=this.viewInstance[n];Number(s.data("id"))==Number(this.id)&&s.remove()}return e.modules.selectProducts.productSelection.publish("remove",{idProduct:this.id,ids:t.getProductsId()}),t.setLayout(),!0}return!1},NewsletterPro.components.Product.prototype.getEditData=function(e){var t=this.data,n=[],s=t.variables,a=t.variables_lang,r=(a.name[e],t.images),i=t.attributes_groups.attributes_groups&&t.attributes_groups.attributes_groups.hasOwnProperty(e)?t.attributes_groups.attributes_groups[e]:!1,o=t.attributes_combinations.attribute_anchor_separator,l=this.viewInfo[e].currency,c=this.viewInfo[e].id_product_attribute,d=t.prices[l].price_display,u=t.prices_attributes,p=!Number(c);if(n.push({id:0,id_product:this.id,id_lang:e,id_product_attribute:0,is_color_group:0,attribute_color:"",image:r.cover_images[e][t.images.image_type_small].link,attribute_name:"Default",reference:s.reference,price:d,available_date:"",selected:p}),i){for(var m,f={},h=0;h<i.length;h++){var g=i[h],v=g.id_product_attribute;f.hasOwnProperty(v)||(f[v]=[]),f[v].push(g)}for(var w in f){w=Number(w);for(var b,y,S,k=f[w],P="",_=0,N="",x=u.hasOwnProperty(w)&&u[w].hasOwnProperty(l)?u[w][l].price_display:!1,h=0;h<k.length;h++){var T=k[h];P+=T.public_group_name+" "+o+" "+T.attribute_name+", ",Number(T.is_color_group)&&(_=1,N=T.attribute_color),0==h&&(y=T.available_date,S=$.trim(T.reference).length>0?T.reference:s.reference)}P=P.replace(/, $/,""),m=t.attributes_groups.combination_images&&t.attributes_groups.combination_images.hasOwnProperty(e)&&t.attributes_groups.combination_images[e].hasOwnProperty(w)?t.attributes_groups.combination_images[e][w]:!1,b=m?m[0].images[t.images.image_type_small].link:r.cover_images[e][t.images.image_type_small].link,x&&(d=x);var g={id:w,id_product:this.id,id_lang:e,id_product_attribute:w,is_color_group:_,attribute_color:N,image:b,attribute_name:P,reference:S,price:d,available_date:y,selected:Number(c)==Number(w)};n.push(g)}}return n},NewsletterPro.components.Product.products=[],NewsletterPro.components.Product.view={},NewsletterPro.components.Product.lastPosition=0,NewsletterPro.components.Product.imageType=null,NewsletterPro.components.Product.imageWidth=0,NewsletterPro.components.Product.productWidth=-1,NewsletterPro.components.Product.productNameLength=-1,NewsletterPro.components.Product.productShortDescriptionLength=-1,NewsletterPro.components.Product.productDescriptionLength=-1,NewsletterPro.components.Product.layout=null,NewsletterPro.components.Product.editProduct=function(e,t){var n=NewsletterPro,s=NewsletterPro.components.Product,a=s.getInstanceById(e),r=n.modules.selectProducts.productSelection.winEdit;if(a&&r){var i=a.data,o=(i.variables,i.variables_lang),l=o.name[t],c=a.getEditData(t),d=r.getHeader().replace(/%s/,l);r.setHeader(d),r.dataSource.setData(c),r.dataSource.sync(),r.show()}},NewsletterPro.components.Product.removeProduct=function(e,t){var n=NewsletterPro.components.Product,s=n.getInstanceById(e);s&&s.remove()},NewsletterPro.components.Product.removeAllProducts=function(){for(var e=this.products.length-1;e>=0;e--){var t=this.products[e];t.remove()}},NewsletterPro.components.Product.getInstanceById=function(e){var t=this;return t.parseProducts(function(t,n){return e==t?n:void 0})},NewsletterPro.components.Product.getProductsId=function(){var e=[];return this.parseProducts(function(t,n){e.push(Number(t))}),e},NewsletterPro.components.Product.parseProducts=function(e){for(var t=this,n=0;n<t.products.length;n++){var s=e(t.products[n].id,t.products[n]);if(void 0!==s)return s}},NewsletterPro.components.Product.count=function(){return this.products.length},NewsletterPro.components.Product.first=function(){return this.products.length>0?this.products[0]:!1},NewsletterPro.components.Product.setImageSize=function(e){var t=NewsletterPro;this.imageWidth=Number(e),this.imageType=this.getImageTypeByWidthValue(this.imageWidth),this.render(),t.modules.selectProducts.displayProductsWidth()},NewsletterPro.components.Product.setNameLenght=function(e){var t=NewsletterPro;this.productNameLength=Number(e),this.render(),t.modules.selectProducts.displayProductsWidth()},NewsletterPro.components.Product.setWidth=function(e){var t=NewsletterPro;this.productWidth=Number(e),this.render(),t.modules.selectProducts.displayProductsWidth()},NewsletterPro.components.Product.setShortDescriptionLenght=function(e){var t=NewsletterPro;this.productShortDescriptionLength=Number(e),this.render(),t.modules.selectProducts.displayProductsWidth()},NewsletterPro.components.Product.setDescriptionLength=function(e){var t=NewsletterPro;this.productDescriptionLength=Number(e),this.render(),t.modules.selectProducts.displayProductsWidth()},NewsletterPro.components.Product.render=function(e,t,n){this.parseProducts(function(s,a){a.render(e,t,n)})},NewsletterPro.components.Product.columns=0,NewsletterPro.components.Product.setLayout=function(e,t){var n=NewsletterPro.components.Product,s=n.first();if(s&&s.template.isTemplate()){var a=this.getViewProducts(t);for(var r in this.view){this.view[r].sortable("disable"),this.view[r].empty();var i=this.view[r];if(a.hasOwnProperty(r))for(var o=0;o<a[r].length;o++){var l=a[r][o],c=l.viewInstance[r],d=c.find(".np-edit-product-menu .np-edit-product-menu-btn-move"),u=l.getVars(r);d.length>0&&d.hide();var p=c,e=Number(s.template.tree.get("np-columns")),m=$('<table class="np-responsive-table-container" border="0" cellpadding="0" cellspacing="0"></table>'),f=$(s.template.tree.getRender("np-row",u)),h=$(s.template.tree.getRender("np-row-separator",u)),g=$(s.template.tree.getRender("np-product-separator",u));0==i.find(".np-responsive-table-container").length?i.append(m):m=i.find(".np-responsive-table-container:last"),0==m.find(".np-row-products-target:last").length&&m.append(f),o%e==0?(m.append(f),m.append(h),currentRowTarget=m.find(".np-row-products-target:last"),currentRowTarget.append(p),e>1&&currentRowTarget.append(g)):(currentRowTarget=m.find(".np-row-products-target:last"),currentRowTarget.append(p),e-1>o%e&&currentRowTarget.append(g))}}return!1}var a=this.getViewProducts(t);if(null!=e?this.columns=e:e=this.columns,0==e){this.layout=null;for(var r in this.view)if(this.view[r].sortable("enable"),this.view[r].empty(),a.hasOwnProperty(r))for(var o=0;o<a[r].length;o++){var l=a[r][o],c=l.viewInstance[r],d=c.find(".np-edit-product-menu .np-edit-product-menu-btn-move");d.length>0&&d.show(),this.view[r].append(c)}}else{this.layout={};for(var r in this.view){var v=$('					<table class="np-newsletter-layout-'+r+'" style="margin: 0 auto; padding; 0; border-collapse: collapse; border-spacing: 0;">					</table>				'),w=0;if(this.view[r].sortable("disable"),this.view[r].empty(),this.view[r].append(v),a.hasOwnProperty(r))for(var o=0;o<a[r].length;o++){var d,b,l=a[r][o],c=l.viewInstance[r],y=$('<td class="np-newsletter-column-product-id-'+l.id+'"></td>');o%e==0&&(w++,b=$('<tr class="np-newsletter-row-'+w+'"></tr>'),v.append(b)),d=c.find(".np-edit-product-menu .np-edit-product-menu-btn-move"),d.length>0&&d.hide(),y.html(c),b.append(y)}this.layout[r]=v}}},NewsletterPro.components.Product.getViewProducts=function(e){var t=NewsletterPro;if(e=e||[],!e.length){var n=t.dataStorage.get("id_selected_lang");if(this.view.hasOwnProperty(n)){var s=this.view[n].find(".newsletter-pro-product");s.length>0&&$.each(s,function(t,n){e.push($(n).data("id"))})}}var a={};return this.parseProducts(function(t,n){n.parseViewInstances(function(s,r){a.hasOwnProperty(s)||(a[s]=[]),e.length>0?a[s][e.indexOf(Number(t))]=n:a[s].push(n)})}),a},NewsletterPro.components.Product.fixWidthAndSlidersTimeout=null,NewsletterPro.components.Product.fixHeightAndWidthAndSliders=function(){var e=NewsletterPro,t=this,n=e.dataStorage.get("id_selected_lang"),s={},a=e.modules.selectProducts.vars.sliderImageSize,r=(e.modules.selectProducts.vars.sliderProductsWidth,{}),i={};0==t.imageWidth&&(t.imageWidth=a.getValue()),null!=t.fixWidthAndSlidersTimeout&&clearTimeout(t.fixWidthAndSlidersTimeout),t.fixWidthAndSlidersTimeout=setTimeout(function(){t.parseProducts(function(e,t){if(t.viewInstance.hasOwnProperty(n)){var a=t.viewInstance[n],o=a.find(".newsletter-pro-image");if(o.length>0){var l=o.width(),c=o.height(),d=a.width();s[e]={width:d,imageWidth:l,imageHeight:c,imageRatio:c/l,diff:d-l}}}t.parseViewInstances(function(t,n){var s=n.height();r.hasOwnProperty(t)||(r[t]=0),i.hasOwnProperty(t)||(i[t]={}),i[t][e]=s,s>r[t]&&(r[t]=s)})}),t.parseProducts(function(e,t){!t.template.isTemplate()&&t.template.columns>1&&t.parseViewInstances(function(t,n){if(s.hasOwnProperty(e)){s[e]}if(r[t]>0&&i[t][e]<r[t]){var a="td:first",o=n.find(a);if(o.length>0){var l=i[t][e],c=r[t]-l,d=c+parseInt(o.css("padding-bottom"));o.css("padding-bottom",d+"px")}else n.css("min-height",r+"px")}})})},100)},NewsletterPro.components.Product.getImageTypeByWidthValue=function(e){var t=NewsletterPro,n=t.dataStorage.get("images_size"),s="";n.sort(function(e,t){return parseInt(e.width)<parseInt(t.width)?-1:parseInt(e.width)>parseInt(t.width)?1:0});for(var a=0;a<n.length;a++){var r=n[a],i=Number(r.width);e>i&&"undefined"!=typeof n[a+1]&&(s=n[a+1].name)}return n.length&&!s.length&&(s=n[0].name),s},NewsletterPro.components.Product.changeTemplate=function(e){this.parseProducts(function(t,n){n.setTemplate(e)}),this.render()},NewsletterPro.components.Product.sortProducts=function(e,t){var n=this;"undefined"==typeof t&&(t=!0);var n=NewsletterPro.components.Product,s={};n.parseProducts(function(e,t){t.parseViewInstances(function(e,n){var a=t.getVars(e),r=isNaN(Number(a.price))?0:Number(a.price),i=isNaN(Number(a.reduction))?0:Number(a.reduction),o=isNaN(parseFloat(a.discount_decimals))?0:parseFloat(a.discount_decimals);s.hasOwnProperty(e)||(s[e]=[]),s[e].push({position:t.position,price:r,name:a.name,reduction:i,discount:o,item:n,id:t.id,product:t,vars:a})})});var r=function(e){for(var r in s){var i=s[r],o=[],l=i.sort(function(n,s){if(a=n[e],b=s[e],t){if(a<b)return-1;if(a>b)return 1}else{if(null==b)return-1;if(a<b)return 1}return 0});if(null!=n.layout){for(var c=0;c<i.length;c++)o.push(Number(i[c].id));n.setLayout(null,o)}else{var d=n.first();if(d)if(d.template.isTemplate()){var u=n.view[r];u.empty();var p=0;$.each(l,function(e,t){var n=t.item,s=Number(d.template.tree.get("np-columns")),a=$('<table class="np-responsive-table-container" border="0" cellpadding="0" cellspacing="0"></table>'),r=$(d.template.tree.getRender("np-row",t.vars)),i=$(d.template.tree.getRender("np-row-separator",t.vars)),o=$(d.template.tree.getRender("np-product-separator",t.vars));0==u.find(".np-responsive-table-container").length?u.append(a):a=u.find(".np-responsive-table-container:last"),0==a.find(".np-row-products-target:last").length&&a.append(r),p%s==0?(a.append(r),a.append(i),currentRowTarget=a.find(".np-row-products-target:last"),currentRowTarget.append(n),s>1&&currentRowTarget.append(o)):(currentRowTarget=a.find(".np-row-products-target:last"),currentRowTarget.append(n),s-1>p%s&&currentRowTarget.append(o)),p++})}else $.each(l,function(e,t){n.view[r].append(t.item)})}}};switch(e){case"price":r("price");break;case"name":r("name");break;case"reduction":r("reduction");break;case"discount":r("discount");break;case"position":default:r("position")}},function(e){NewsletterPro.namespace("components.FilterSelection"),NewsletterPro.components.FilterSelection=function t(e){return this instanceof t?(this.customers=e.customers,this.visitors=e.visitors,this.visitors_np=e.visitors_np,this.added=e.added,this.customers_apply_callback=e.customers_apply_callback,this.visitor_apply_callback=e.visitor_apply_callback,this.visitor_np_apply_callback=e.visitor_np_apply_callback,this.added_apply_callback=e.added_apply_callback,this.clearfilters=function(){this.customers.clear.trigger("click"),"undefined"!=typeof this.visitors&&this.visitors.clear.trigger("click"),"undefined"!=typeof this.visitors_np&&this.visitors_np.clear.trigger("click"),this.added.clear.trigger("click")},this.parseFilters=function(e,t,n){for(var s in e){var a=e[s];for(var r in t){var i=t[r];n(s,a,r,i)}}},this.applyFilters=function(e){for(var t in e){var n=e[t];switch(t){case"customers":this.parseFilters(this.customers,n,function(e,t,n,s){switch(e){case"groups":case"languages":case"shops":case"gender":case"subscribed":e===n&&t.mark(s)}}),this.customers_apply_callback();break;case"visitors":"undefined"!=typeof this.visitors&&(this.parseFilters(this.visitors,n,function(e,t,n,s){switch(e){case"shops":case"subscribed":e===n&&t.mark(s)}}),this.visitor_apply_callback());break;case"visitors_np":"undefined"!=typeof this.visitors_np&&(this.parseFilters(this.visitors_np,n,function(e,t,n,s){switch(e){case"languages":case"shops":case"gender":case"subscribed":case"filter_by_interest":e===n&&t.mark(s)}}),this.visitor_np_apply_callback());break;case"added":this.parseFilters(this.added,n,function(e,t,n,s){switch(e){case"languages":case"shops":case"csv_name":case"subscribed":e===n&&t.mark(s)}}),this.added_apply_callback()}}},this.getFilters=function(){var e={};return e.customers=this.getCustomersFilter(),"undefined"!=typeof this.visitors&&(e.visitors=this.getVisitorsFilter()),"undefined"!=typeof this.visitors_np&&(e.visitors_np=this.getVisitorNpFilter()),e.added=this.getAddedFilter(),e},this.getCustomersFilter=function(){var e={};for(var t in this.customers){var n=this.customers[t];switch(t){case"groups":case"languages":case"shops":case"gender":case"subscribed":e[t]=n.getSelected()}}return e},this.getVisitorsFilter=function(){var e={};for(var t in this.visitors){var n=this.visitors[t];switch(t){case"shops":case"subscribed":e[t]=n.getSelected()}}return e},this.getVisitorNpFilter=function(){var e={};for(var t in this.visitors_np){var n=this.visitors_np[t];switch(t){case"languages":case"shops":case"gender":case"subscribed":case"filter_by_interest":e[t]=n.getSelected()}}return e},void(this.getAddedFilter=function(){var e={};for(var t in this.added){var n=this.added[t];switch(t){case"languages":case"shops":case"csv_name":case"subscribed":e[t]=n.getSelected()}}return e})):new t(e)}}(jQueryNewsletterProNew),NewsletterPro.namespace("components.LanguageSelect"),NewsletterPro.components.LanguageSelect=function r(e){function t(){return $("[data-lang]")}function n(){var e=u.header.innerWidth(),t=u.dropDown.innerWidth();u.dropDown.offset().left,$(window).width();u.dropDown.css({left:-t+e})}function s(e){var t=$('<button class="gk-lang-header btn btn-default dropdown-toggle" tabindex="-1"> </button>'),n=$('<span style="margin-right: 5px; display: inline-block;"></span>'),s=$('<i class="icon icon-caret-down"> </i> '),r=$('<ul id="lang_menu_'+i.uniqueId()+'" class="gk-lang-menu dropdown-menu" style="display: none;"></ul>'),o=[];
return e.css({position:"relative"}),t.append(n),t.append(s),e.append(t),e.append(r),a(function(e,t){var s=$('<li id="lang_item_'+i.uniqueId()+'"><a href="javascript:{}" style="width: 100%;">'+e.name+"</a></li>");1==e.selected&&n.html(e.iso_code),s.on("click",function(n){l.click(e,t)}),r.append(s),o.push(s)}),{header:t,headerText:n,headerIcon:s,dropDown:r,rows:o,selector:e}}function a(e){for(var t in d)e(d[t],t)}if(!(this instanceof r))return new r(e);var i=NewsletterPro,o=NewsletterPro.components.LanguageSelect,l=this,c=e.selector,d=e.languages,u=s(c),p=c.attr("id");return o.addInstance(p,l),i.extendSubscribeFeature(this),n(),this.setHeader=function(e){u.headerText.html(e)},this.getCfg=function(){return e},this.fixDropDownPosition=function(){n()},this.headerClick=function(){l.toggle()},this.click=function(n,s){l.publish("change",{lang:n,key:s}),$.each(t(),function(e,t){t=$(t);var s="1"==t.data("visible");Number(t.data("lang"))==Number(n.id_lang)?s?(t.removeClass("np-lang-visible-hide"),t.show()):t.show():s?t.addClass("np-lang-visible-hide"):t.hide()}),$.each(o.getInstances(),function(e,t){t.setHeader(n.iso_code)}),u.headerText.html(n.iso_code),l.close(),"function"==typeof e.click&&e.click(n,s),"function"==typeof o.clickEvent&&o.clickEvent(n,s),i.dataStorage.set("id_selected_lang",parseInt(n.id_lang))},this.open=function(){this.fixDropDownPosition(),u.dropDown.show(),setTimeout(function(){u.dropDown.focus()},1)},this.close=function(){u.dropDown.hide()},this.toggle=function(){u.dropDown.is(":visible")?l.close():l.open()},u.dropDown.focusout(function(){l.close()}),u.header.on("click",function(e){l.headerClick.call(header)}),this},NewsletterPro.components.LanguageSelect.instances={},NewsletterPro.components.LanguageSelect.addInstance=function(e,t){e=null==e?NewsletterPro.uniqueId():"#"+e;var n=NewsletterPro.components.LanguageSelect.instances;n[e]=t},NewsletterPro.components.LanguageSelect.getInstanceById=function(e){var t=NewsletterPro.components.LanguageSelect.instances;return t.hasOwnProperty(e)?t[e]:!1},NewsletterPro.components.LanguageSelect.getInstances=function(){return NewsletterPro.components.LanguageSelect.instances},NewsletterPro.components.LanguageSelect.parseInstances=function(e){var t=NewsletterPro.components.LanguageSelect.getInstances();for(var n in t)e(t[n],n)},NewsletterPro.components.LanguageSelect.initBySelection=function(e){var t=NewsletterPro;$.each(e,function(e,n){n=$(n),new t.components.LanguageSelect({selector:n,languages:t.dataStorage.get("all_languages")})})},NewsletterPro.components.LanguageSelect.updateLanguages=function(){var e=NewsletterPro,t=e.dataStorage.getNumber("id_selected_lang");t>0&&$.each($("[data-lang]"),function(e,n){n=$(n);var s="1"==n.data("visible");Number(n.data("lang"))==t?s?(n.removeClass("np-lang-visible-hide"),n.show()):n.show():s?n.addClass("np-lang-visible-hide"):n.hide()})},NewsletterPro.components.LanguageSelect.fixDropDownPosition=function(){this.parseInstances(function(e){e.fixDropDownPosition()})},NewsletterPro.namespace("components.CurrencySelect"),NewsletterPro.components.CurrencySelect=function i(e){if(!(this instanceof i))return new i(e);var t=NewsletterPro,n=t.components.CurrencySelect,s=this;t.extendSubscribeFeature(this),this.cfg=e,this.currency_id=0,this.selector=e.selector,this.currencies=e.currencies,this.dom=this.buildTemplate(this.selector),this.id="#"+this.selector.attr("id"),this.fixDropDownPosition(),this.dom.dropDown.focusout(function(){s.close()}),this.dom.header.on("click",function(e){s.headerClick.call(s,header)}),n.addInstance(this.id,this)},NewsletterPro.components.CurrencySelect.prototype.on=function(e,t,n){this.subscribe("change"+t,n)},NewsletterPro.components.CurrencySelect.prototype.setHeader=function(e){this.dom.headerText.html(e)},NewsletterPro.components.CurrencySelect.prototype.getCfg=function(){return this.cfg},NewsletterPro.components.CurrencySelect.prototype.headerClick=function(){this.toggle()},NewsletterPro.components.CurrencySelect.prototype.click=function(e,t){this.dom.headerText.html(e.iso_code),this.close(),"function"==typeof this.cfg.click&&this.cfg.click(e,t),this.currency_id=Number(e.id_currency),this.publish("change"+this.id,this.currency_id)},NewsletterPro.components.CurrencySelect.prototype.val=function(){return this.currency_id},NewsletterPro.components.CurrencySelect.prototype.open=function(){var e=this.dom;e.dropDown.show(),setTimeout(function(){e.dropDown.focus()},1)},NewsletterPro.components.CurrencySelect.prototype.close=function(){this.dom.dropDown.hide()},NewsletterPro.components.CurrencySelect.prototype.toggle=function(){this.dom.dropDown.is(":visible")?this.close():this.open()},NewsletterPro.components.CurrencySelect.prototype.fixDropDownPosition=function(){var e=this.dom,t=e.header.innerWidth(),n=e.dropDown.innerWidth();e.dropDown.offset().left,$(window).width();e.dropDown.css({left:-n+t})},NewsletterPro.components.CurrencySelect.prototype.buildTemplate=function(e){var t=NewsletterPro,n=this,s=$('<button class="np-currency-header btn btn-default dropdown-toggle" tabindex="-1"> </button>'),a=$('<span style="margin-right: 5px; display: inline-block;"></span>'),r=$('<i class="icon icon-caret-down"> </i> '),i=$('<ul id="currency_menu_'+t.uniqueId()+'" class="np-currency-menu dropdown-menu" style="display: none;"></ul>'),o=[];return e.css({position:"relative"}),s.append(a),s.append(r),e.append(s),e.append(i),this.parseCurrencyes(function(e,s){var r=$('<li id="currency_item_'+t.uniqueId()+'"><a href="javascript:{}" style="width: 100%;">'+e.name+"</a></li>");1==e.selected&&(a.html(e.iso_code),n.currency_id=Number(e.id_currency)),r.on("click",function(t){n.click(e,s)}),i.append(r),o.push(r)}),{header:s,headerText:a,headerIcon:r,dropDown:i,rows:o,selector:e}},NewsletterPro.components.CurrencySelect.prototype.parseCurrencyes=function(e){for(var t in this.currencies)e(this.currencies[t],t)},NewsletterPro.components.CurrencySelect.instances={},NewsletterPro.components.CurrencySelect.addInstance=function(e,t){e=""==e?NewsletterPro.uniqueId():e;var n=NewsletterPro.components.CurrencySelect.instances;n[e]=t},NewsletterPro.components.CurrencySelect.getInstanceById=function(e){var t=NewsletterPro.components.CurrencySelect.instances;return t.hasOwnProperty(e)?t[e]:!1},NewsletterPro.components.CurrencySelect.getInstances=function(){return NewsletterPro.components.CurrencySelect.instances},NewsletterPro.components.CurrencySelect.parseInstances=function(e){var t=NewsletterPro.components.CurrencySelect.getInstances();for(var n in t)e(t[n],n)},NewsletterPro.components.CurrencySelect.initBySelection=function(e){var t=NewsletterPro;$.each(e,function(e,n){n=$(n),new t.components.CurrencySelect({selector:n,currencies:t.dataStorage.get("currencies")})})},function(e){NewsletterPro.namespace("components.SyncNewsletters"),NewsletterPro.components.SyncNewsletters=function t(e){if(!(this instanceof t))return new t(e);if("undefined"==typeof e.connection)throw new Error("You must setup the connection.");var n=NewsletterPro;this.l=n.translations.l(n.translations.components.SyncNewsletters),this.cfg=e,this.connection=e.connection,this.limit=e.connection.limit||2500,this.url=e.connection.url,this.data=e.data||{},this.syncErrorsLimit=e.syncErrorsLimit||1e3,this.selectors=e.selectors||{},this.refreshRate=e.refreshRate||5e3,this.data.limit=this.limit,this.subscription={},this.syncErrorsCount=0,this.readyLength=0,this.sendId=0,this.syncInterval=null,this.syncStart=!1},NewsletterPro.components.SyncNewsletters.prototype.init=function(){this.sync()},NewsletterPro.components.SyncNewsletters.prototype.sync=function(){function t(e,t){return t=t||!1,{errors:e.emails_error,success:e.emails_success,emailsCount:e.emails_count,done:o.STATE_DONE==e.state,completed:t}}function n(e,t){return t=t||!1,{remaining:e.remaining,emailsToSend:e.emails_to_send,completed:t}}function s(e,t){return t=t||!1,{success:e.emails_success,errors:e.emails_error,emailsSent:e.emails_sent,completed:t}}function a(e,t,n){r.syncErrorsCount++;var s,a="true"===e.getResponseHeader("Login");alertErrors=!1,display=!1,a?(s=r.l('The login session has expired. You must refresh the browser and login again. The next time when you are login check the button "Stay logged in".'),alertErrors=!0,r.clearSync()):(s=r.l("Error ocurred at newsletter synchronisation")+" : "+NewsletterPro.getXHRError(e),r.syncErrorsCount>=r.syncErrorsLimit?(alertErrors=!0,r.clearSync()):display=!0),r.publish("syncError",{message:s,alertErrors:alertErrors,display:display,jqXHR:e,textStatus:t,errorThrown:n})}if(this.isSyncInProgress())return!1;var r=this,i=NewsletterPro.modules.sendManager,o=i.define;return r.publish("beforeRequest"),this.syncInterval=setInterval(function(){r.getEmails(function(l,c,d){r.sendId=l.id>0?l.id:r.sendId,r.publish("emailsToSend",n(l,!1)),r.publish("emailsSent",s(l,!1)),r.publish("progressbar",t(l,!1)),r.publish("syncSuccess",{response:l,textStatus:c,jqXHR:d}),r.syncStart||(r.syncStart=!0,r.publish("syncStart",{active:l.active,state:l.state})),l.active&&o.STATE_PAUSE==l.state?(r.publish("syncPause",{active:l.active,state:l.state}),r.clearSync()):l.active&&o.STATE_DONE!=l.state?l.active&&o.STATE_DEFAULT==l.state&&(r.publish("syncContinue",{active:l.active,state:l.state}),i.startSendNewsletters()):(r.sendId&&e.postAjax({submit:"syncNewsletters",id:r.sendId,limit:r.limit},"json",!1).done(function(e){r.sendId=0,r.publish("emailsToSend",n(e,!0)),r.publish("emailsSent",s(e,!1)),r.publish("progressbar",t(e,!0)),r.publish("syncEnd",{active:e.active,state:e.state})}).fail(function(e,t,n){a(e,t,n)}),r.publish("syncDone",{active:l.active,state:l.state}),r.clearSync())},function(e,t,n){a(e,t,n)})},this.refreshRate),!0},NewsletterPro.components.SyncNewsletters.prototype.clearSync=function(){return this.isSyncInProgress()?(clearInterval(this.syncInterval),this.syncInterval=null,this.syncStart=!1,!0):!1},NewsletterPro.components.SyncNewsletters.prototype.isSyncInProgress=function(){return null!=this.syncInterval},NewsletterPro.components.SyncNewsletters.prototype.getEmails=function(t,n,s){return e.ajax({url:this.url,type:"POST",dataType:"json",data:this.data,success:function(e,n,s){"function"==typeof t&&t(e,n,s)},error:function(e,t,s){"function"==typeof n&&n(e,t,s)},complete:function(e,t){"function"==typeof s&&s(e,t)}}).promise()},NewsletterPro.components.SyncNewsletters.prototype.setData=function(e,t){this.data[e]=t},NewsletterPro.components.SyncNewsletters.prototype.subscribe=function(e,t,n){this.subscription.hasOwnProperty(e)||(this.subscription[e]=[]),this.subscription[e].push({func:t,instance:n}),this.cfg.hasOwnProperty("subscription")&&this.cfg.subscription.hasOwnProperty("ready")&&(-1!=this.cfg.subscription.ready.indexOf(e)&&this.readyLength++,this.readyLength==this.cfg.subscription.ready.length&&this.init())},NewsletterPro.components.SyncNewsletters.prototype.publish=function(e,t){if(this.subscription.hasOwnProperty(e))for(var n=0;n<this.subscription[e].length;n++){var s="function"==typeof t?t():t,a=this.subscription[e][n].func,r=this.subscription[e][n].instance||this;a.call(r,s)}}}(jQueryNewsletterProNew),function(e){NewsletterPro.namespace("components.EmailsToSend"),NewsletterPro.components.EmailsToSend=function t(e){if(!(this instanceof t))return new t(e);if("undefined"==typeof e.selector)throw new Error("You must define a selector.");var n=NewsletterPro;if(self=this,this.l=n.translations.l(n.translations.components.EmailsToSend),this.selector=e.selector,this.fastPerformance="undefined"==typeof e.fastPerformance?!0:e.fastPerformance,this.emails=[],this.remainingEmails=0,"undefined"==typeof e.subscription)throw new Error("You must set the subscription value.");this.subscription=e.subscription,this.dom=this.initDom(),this.items=[],n.extendSubscribeFeature(this),n.subscription(this,this.subscription)},NewsletterPro.components.EmailsToSend.prototype.sync=function(e){var t=e.remaining,n=e.emailsToSend;e.completed;this.fastPerformance?this.clearOptimized(n):(this.clear(),this.createItems(n)),this.writeRemainingEmails(t)},NewsletterPro.components.EmailsToSend.prototype.clear=function(){this.writeRemainingEmails(0),this.emails=[],this.items=[],this.dom.list.empty()},NewsletterPro.components.EmailsToSend.prototype.writeRemainingEmails=function(e){this.remainingEmails=parseInt(e),this.dom.remainingEmails.html(this.remainingEmails)},NewsletterPro.components.EmailsToSend.prototype.initDom=function(){return this.selector.html(this.getTemplate()),{selector:this.selector,remainingEmails:this.selector.find(".emails-to-send-count"),list:this.selector.find(".userlist")}},NewsletterPro.components.EmailsToSend.prototype.createItems=function(e){this.emails=e;for(var t=0;t<this.emails.length;t++)this.createItem(this.emails[t])},NewsletterPro.components.EmailsToSend.prototype.createItemsOptimised=function(t){for(var n=new e.Deferred,s=0;s<t.length;s++)this.emails.push(t[s]),this.createItem(t[s],"append"),0==s&&this.publish("firstItemCreated",this.getItemByEmail(t[s])),s==t.length-1&&(this.publish("lastItemCreated",this.getItemByEmail(t[s])),n.resolve());return n.promise()},NewsletterPro.components.EmailsToSend.prototype.createItem=function(t,n){var n=n||"append",s=this.getNextClassName(n);return{template:null,parent:null,className:s,email:t,creationMethod:n,init:function(e){this.parent=e,this.template=this.getItemTemplate(),this.add(),"append"===n?e.items.push(this):e.items.unshift(this)},add:function(){this.parent.dom.list[this.creationMethod](this.template)},render:function(){this.parent.dom.list.find('[data-email="'+this.email+'"]')||this.add()},remove:function(){this.template.remove();var e=this.parent.emails.indexOf(this.email);return-1!=e?(this.parent.emails.splice(e,1),this.parent.items.splice(e,1),!0):!1},getItemTemplate:function(){return e('					<li class="'+this.className+'" data-email="'+this.email+'">						<span class="email_text">'+this.email+"</span>						<span>&nbsp;</span>					</li>				")},getClassName:function(){return this.className}}.init(this)},NewsletterPro.components.EmailsToSend.prototype.clearOptimized=function(e){for(var t=this,n=[],s=[],a=t.emails,r=0;r<e.length;r++)-1==a.indexOf(e[r])&&n.push(e[r]);for(var r=0;r<a.length;r++)-1==e.indexOf(a[r])&&s.push(a[r]);t.removeEmails(s).done(function(){t.createItemsOptimised(n)})},NewsletterPro.components.EmailsToSend.prototype.removeEmails=function(t){for(var n=new e.Deferred,s=[],a=0;a<t.length;a++){var r=this.emails.indexOf(t[a]);-1!=r&&s.push(r)}if(s.sort(),s.length)for(var a=s.length-1;a>=0;a--){var i=this.items[s[a]];"undefined"!=typeof i&&i.remove(),0==a&&n.resolve()}else n.resolve();return n.promise()},NewsletterPro.components.EmailsToSend.prototype.getNextClassName=function(e){var t,n=this.items.length,e=e||"append";return t=n?"append"==e?this.items[n-1].getClassName():this.items[0].getClassName():"even","odd"==t?"even":"odd"},NewsletterPro.components.EmailsToSend.prototype.getTemplate=function(){return e('			<label class="control-label">'+this.l("Emails to send:")+' <span class="emails-to-send-count">0</span> '+this.l("remaining")+'</label>			<div class="clear">&nbsp;</div>			<ul class="userlist"></ul>			<div class="clear">&nbsp;</div>		')},NewsletterPro.components.EmailsToSend.prototype.getIndex=function(e){return this.emails.indexOf(e)},NewsletterPro.components.EmailsToSend.prototype.getItemByEmail=function(e){var t=this.getIndex(e);return-1!=t?this.items[t]:!1},NewsletterPro.components.EmailsToSend.prototype.removeItemByEmail=function(e){var t=this.getItemByEmail(e);return t?t.remove():!1}}(jQueryNewsletterProNew),function(e){NewsletterPro.namespace("components.EmailsSent"),NewsletterPro.components.EmailsSent=function t(e){if(!(this instanceof t))return new t(e);if("undefined"==typeof e.selector)throw new Error("You must define a selector.");var n=NewsletterPro;if(self=this,this.l=n.translations.l(n.translations.components.EmailsSent),this.selector=e.selector,this.fastPerformance="undefined"==typeof e.fastPerformance?!0:e.fastPerformance,this.emailsData=[],this.emails=[],this.sentSuccess=0,this.sentErrors=0,"undefined"==typeof e.subscription)throw new Error("You must set the subscription value.");this.subscription=e.subscription,this.dom=this.initDom(),this.items=[],n.extendSubscribeFeature(this),n.subscription(this,this.subscription),this.windowErrors=new gkWindow({width:640,height:400,setScrollContent:340,title:this.l("Sent errors"),className:"np-emails-sent-window-error",show:function(e){},close:function(e){},content:function(e){return""}})},NewsletterPro.components.EmailsSent.prototype.sync=function(e){var t=e.success,n=e.errors,s=e.emailsSent;e.completed;this.fastPerformance?this.clearOptimized(s):(this.clear(),this.createItems(s)),this.writeSentSuccess(t),this.writeSentErrors(n)},NewsletterPro.components.EmailsSent.prototype.clear=function(){this.writeSentSuccess(0),this.writeSentErrors(0),this.emailsData=[],this.emails=[],this.items=[],this.dom.list.empty()},NewsletterPro.components.EmailsSent.prototype.clearOptimized=function(e){for(var t=this,n=[],s=[],a=[],r=t.emails,i=0;i<e.length;i++)a.push(e[i].email),-1==r.indexOf(e[i].email)&&n.push(e[i]);for(var i=0;i<r.length;i++)-1==a.indexOf(r[i])&&s.push(r[i]);a.length>0&&t.removeItems(s).done(function(){t.createItemsOptimised(n)})},NewsletterPro.components.EmailsSent.prototype.writeSentSuccess=function(e){this.sentSuccess=parseInt(e),this.dom.sentSuccess.html(this.sentSuccess)},NewsletterPro.components.EmailsSent.prototype.writeSentErrors=function(e){this.sentErrors=parseInt(e),this.dom.sentErrors.html(this.sentErrors)},NewsletterPro.components.EmailsSent.prototype.initDom=function(){return this.selector.html(this.getTemplate()),{selector:this.selector,sentSuccess:this.selector.find(".emails-sent-count-succ"),sentErrors:this.selector.find(".emails-sent-count-err"),list:this.selector.find(".userlist")}},NewsletterPro.components.EmailsSent.prototype.removeItems=function(t){for(var n=new e.Deferred,s=[],a=0;a<t.length;a++){var r=this.emails.indexOf(t[a]);-1!=r&&s.push(r)}if(s.sort(),s.length)for(var a=s.length-1;a>=0;a--){var i=this.items[s[a]];"undefined"!=typeof i&&i.remove(),0==a&&n.resolve()}else n.resolve();return n.promise()},NewsletterPro.components.EmailsSent.prototype.createItems=function(e){this.emailsData=e;for(var t=0;t<this.emailsData.length;t++){var n=this.emailsData[t];this.emails.push(n.email),this.createItem(n),0==t&&this.publish("firstItemCreated",this.getItemByEmail(this.emailsData[t].email)),t==this.emailsData.length-1&&this.publish("lastItemCreated",this.getItemByEmail(this.emailsData[t].email))}},NewsletterPro.components.EmailsSent.prototype.createItemsOptimised=function(t){for(var n=new e.Deferred,s=t.length-1;s>=0;s--)this.emails.unshift(t[s].email),this.emailsData.unshift(t[s]),this.createItem(t[s],"prepend"),s==t.length-1&&this.publish("firstItemCreated",this.getItemByEmail(t[s].email)),0==s&&(this.publish("lastItemCreated",this.getItemByEmail(t[s].email)),n.resolve());return n.promise()},NewsletterPro.components.EmailsSent.prototype.createItem=function(t,n){var n=n||"append",s=this.getNextClassName(n),a=t.email,r=t.status,i=t.fwd,o=t.errors;return{template:null,parent:null,className:s,email:a,status:r,fwd:i,errors:o,creationMethod:n,init:function(e){var t=this;this.parent=e,this.template=this.getItemTemplate(),this.btnErrors=this.template.find(".np-emails-sent-error"),this.btnErrors.on("click",function(){if(t.errors.length){var e="";e+='<span style="font-weight: bold;">'+t.email+"</span> <br>",e+="<br>"+t.errors.join("<br>"),t.parent.windowErrors.setContent(e),t.parent.windowErrors.show()}}),this.add(),"append"===n?e.items.push(this):e.items.unshift(this)},add:function(){this.parent.dom.list[this.creationMethod](this.template)},render:function(){this.parent.dom.list.find('[data-email="'+this.email+'"]')||this.add()},remove:function(){this.template.remove();var e=this.parent.emails.indexOf(this.email);return-1!=e?(this.parent.emails.splice(e,1),this.parent.items.splice(e,1),this.parent.emailsData.splice(e,1),!0):!1},getItemTemplate:function(){var t='<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>',n='<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>';return e('					<li class="'+this.className+'" data-email="'+this.email+'">						<span class="np-emails-sent-email">'+this.email+'</span>						<span class="status np-emails-sent-status">						'+(this.status?t:n)+'						</span>						<a href="javascript:{}" class="np-emails-sent-error" style="'+(this.errors.length>0?"display: inline-block;":"display: none;")+'"></a>						<span class="np-emails-sent-fwd" style="'+(this.fwd>0?"display: inline-block;":"display: none;")+'"> + '+this.fwd+" "+this.parent.l("forwarders")+'</span>						<div class="clear" style="clear: both;"></div>					</li>				')},getClassName:function(){return this.className}}.init(this)},NewsletterPro.components.EmailsSent.prototype.getNextClassName=function(e){var t,n=this.items.length,e=e||"append";return t=n?"append"==e?this.items[n-1].getClassName():this.items[0].getClassName():"even","odd"==t?"even":"odd"},NewsletterPro.components.EmailsSent.prototype.getTemplate=function(){return e('			<label class="control-label">'+this.l("Emails sent:")+' <span class="emails-sent-count-succ" style="color: green;">0</span> '+this.l("sent")+', <span class="emails-sent-count-err" style="color: red;">0</span> '+this.l("errors")+'</label>			<div class="clear">&nbsp;</div>			<ul class="userlist"></ul>			<div class="clear">&nbsp;</div>		')},NewsletterPro.components.EmailsSent.prototype.getIndex=function(e){return this.emails.indexOf(e)},NewsletterPro.components.EmailsSent.prototype.getItemByEmail=function(e){var t=this.getIndex(e);return-1!=t?this.items[t]:!1},NewsletterPro.components.EmailsSent.prototype.removeItemByEmail=function(e){var t=this.getItemByEmail(e);return t?t.remove():!1}}(jQueryNewsletterProNew),function(e){function t(){return e('			<div class="np-send-progressbar-bg"></div>			<div class="np-send-progressbar-bar"></div>			<div class="np-send-progressbar-percent"></div>			<div class="np-send-progressbar-total-box">				<span><span class="np-send-progressbar-total-left">0</span> <span>/</span> <span class="np-send-progressbar-total-right">0</span></span>			</div>			<div class="np-send-progressbar-err-succ-box">				<div class="np-send-progressbar-error">0</div>				<div class="np-send-progressbar-success">0</div>				<div class="clear" style="clear: both;"></div>			</div>		')}NewsletterPro.namespace("components.SendProgressbar"),NewsletterPro.components.SendProgressbar=function n(s){if(!(this instanceof n))return new n(s);var a=NewsletterPro,r=this,i=null;if(!s.hasOwnProperty("selector"))throw new Error("You must define the selector.");if(this.selector=s.selector,!s.hasOwnProperty("subscription"))throw new Error("You must set the subscription value.");this.subscription=s.subscription,this.percent=0,this.sent=0,this.total=0,this.sentErrors=0,this.sentSuccess=0,this.pause=!1,a.subscription(this,this.subscription),this.selector.html(t()),this.dom={selector:this.selector,bg:this.selector.find(".np-send-progressbar-bg"),bar:this.selector.find(".np-send-progressbar-bar"),percent:this.selector.find(".np-send-progressbar-percent"),totalBox:this.selector.find(".np-send-progressbar-total-box"),totalLeft:this.selector.find(".np-send-progressbar-total-left"),totalRight:this.selector.find(".np-send-progressbar-total-right"),errors:this.selector.find(".np-send-progressbar-error"),success:this.selector.find(".np-send-progressbar-success"),errSuccBox:this.selector.find(".np-send-progressbar-err-succ-box")},this.selector.addClass("np-send-progressbar"),e(window).resize(function(){null!==i&&clearTimeout(i),i=setTimeout(function(){r.refresh()},500)})},NewsletterPro.components.SendProgressbar.prototype.clear=function(){this.setPercent(0),this.setTotal(0),this.setSent(0),this.setSentErrors(0),this.setSentSuccess(0)},NewsletterPro.components.SendProgressbar.prototype.sync=function(e){var t=Number(e.errors),n=Number(e.success),s=Number(e.emailsCount);done=e.done,completed=e.completed,total=Number(t+n),done&&!completed||this.set(total,s,t,n)},NewsletterPro.components.SendProgressbar.prototype.set=function(e,t,n,s){e>t&&(e=t);var a=100*Number(e/t);this.setPercent(a),this.setTotal(t),this.setSent(e),this.setSentErrors(n),this.setSentSuccess(s)},NewsletterPro.components.SendProgressbar.prototype.setPause=function(e){this.pause=Boolean(e),this.isPause()?this.dom.bar.addClass("np-send-progressbar-bar-pause"):this.dom.bar.removeClass("np-send-progressbar-bar-pause")},NewsletterPro.components.SendProgressbar.prototype.isPause=function(){return this.pause},NewsletterPro.components.SendProgressbar.prototype.get=function(){return this.percent},NewsletterPro.components.SendProgressbar.prototype.refresh=function(){this.setPercent(this.percent)},NewsletterPro.components.SendProgressbar.prototype.setPercent=function(e){function t(){l>0?s.dom.percent.css({opacity:1}):s.dom.percent.css({opacity:0})}function n(){var e=s.dom.errSuccBox.position().left,t=s.dom.errSuccBox.width(),n=s.dom.totalBox.position().left+s.dom.totalBox.width(),a=s.selector.width(),r=s.dom.bar.width(),i=a-r;if(n>=e?s.dom.totalBox.css({opacity:0}):s.dom.totalBox.css({opacity:1}),t>=i){var o=s.dom.percent.position().left,t=s.dom.errSuccBox.width(),l=(o-t-10)/a*100;s.dom.errSuccBox.css({right:"initial",left:l+"%"})}else s.dom.errSuccBox.css({right:"5px",left:"initial"})}var s=this;this.percent=e,this.dom.percent.html(parseFloat(e).toFixed(2)+"%");var a=s.selector.width(),r=s.dom.percent.width(),i=10,o=(r+i)/a*100,l=e-o;s.dom.percent.animate({left:l+"%"},{progress:function(){t()},complete:function(){t()},queue:!1});var c=i/a*100,d=5>=r?5:0;s.dom.totalBox.animate({left:e+c+"%","margin-left":d+"px"},{queue:!1}),this.dom.bar.animate({width:e+"%"},{progress:function(){n()},complete:function(){n()},queue:!1})},NewsletterPro.components.SendProgressbar.prototype.setTotal=function(e){this.total=e,this.dom.totalRight.html(e)},NewsletterPro.components.SendProgressbar.prototype.setSent=function(e){this.sent=e,this.dom.totalLeft.html(e)},NewsletterPro.components.SendProgressbar.prototype.setSentErrors=function(e){this.sentErrors=e,this.dom.errors.html(e)},NewsletterPro.components.SendProgressbar.prototype.setSentSuccess=function(e){this.sentSuccess=e,this.dom.success.html(e)}}(jQueryNewsletterProNew),NewsletterPro.namespace("modules.settings"),NewsletterPro.modules.settings={dom:null,box:null,init:function(e){var t,n,s=this;return s.box=e,s.ready(function(a){function r(){return p.data.isPS16}function i(){if("undefined"!=typeof NewsletterProComponents.objs.tabItems&&null!=NewsletterProComponents.objs.tabItems){var e=NewsletterProComponents.objs.tabItems.lastItem,t=e.attr("id");"tab_newsletter_5"===t?NewsletterPro.modules.sendNewsletters.resetButtons():"tab_newsletter_3"===t?NewsletterPro.modules.selectProducts.refreshSliders():"tab_newsletter_4"===t&&("undefined"!=typeof NewsletterPro.modules.createTemplate.dom.tinyNewsletter&&NewsletterPro.modules.createTemplate.updateBoth(),NewsletterPro.modules.createTemplate.refreshSliders())}}function o(){return parseInt(e.dataStorage.get("left_menu_active"))}function l(){setTimeout(function(){i()},100)}function c(){a.npLeftSize.removeClass("col-sm-12"),a.npRightSize.removeClass("col-sm-12"),a.npLeftSize.addClass("col-sm-2"),a.npRightSize.addClass("col-sm-10"),e.dataStorage.set("left_menu_active",1);var s=a.menuToggle.find(".toggle-menu-text");s.length&&s.html(t("Top Menu"));for(var r in n){var i=n[r];i.hasClass(r)&&i.removeClass(r)}}function d(){a.npLeftSize.removeClass("col-sm-2"),a.npRightSize.removeClass("col-sm-10"),a.npLeftSize.addClass("col-sm-12"),a.npRightSize.addClass("col-sm-12"),e.dataStorage.set("left_menu_active",0);var s=a.menuToggle.find(".toggle-menu-text");s.length&&s.html(t("Left Menu"));for(var r in n){var i=n[r];i.hasClass(r)||i.addClass(r)}}function u(){o()?d():c()}s.dom=a,t=s.l=NewsletterPro.translations.l(NewsletterPro.translations.modules.settings),n={"np-menu-top-bg":a.npMenuTopBg,"np-menu-top":a.newsletterproTab,"np-menu-top-content":a.newsletterproTabContent};var p=e.dataStorage;r()&&(a.menuCollapse.on("click",function(e){l()}),$(window).resize(function(){l()}),l()),a.moduleCreateBackupButton.on("click",function(){var n=prompt(t("backup name"));if(!$.trim(n))return!1;var a=this;e.showAjaxLoader($(this)),$.postAjax({submit:"ajaxCreateBackup",name:n}).done(function(t){t.status?(e.alertErrors(t.msg),"undefined"!=typeof s.loadBackupDataSource&&s.loadBackupDataSource.sync()):e.alertErrors(t.errors.join("\n"))}).always(function(){e.hideAjaxLoader($(a))})}),a.moduleLoadBackupButton.on("click",function(){s.showLoadBackup()}),r()&&a.menuToggle.on("click",function(){u(),l(),$.postAjax({submit:"leftMenuActive",leftMenuActive:parseInt(e.dataStorage.get("left_menu_active"))}).done(function(t){t.status||e.alertErrors(t.errors)})}),a.topShortcuts.on("change",function(t){var n=$(t.currentTarget),s=n.val(),a=Number(n.is(":checked"));$.postAjax({submit:"updateTopShortcuts",name:s,value:a}).done(function(t){t.status?a?location.reload():$("[id^=page-header-desc-configuration-"+s.toLowerCase()+"]").hide():e.alertErrors(t.errors)})});var m=new gkWindow({width:800,height:500,setScrollContent:438,title:t("Log")});a.openLogFIle.on("click",function(t){t.preventDefault();var n=$(this),s=n.attr("href");e.showAjaxLoader(n),$.postAjax({submit:"openLogFIle",filename:s}).done(function(t){t.success?m.show('<pre class="np-log-display">'+t.content+"</pre>"):e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(n)})}),a.clearModuleCache.on("click",function(){$.postAjax({submit:"clearModuleCache"}).done(function(t){t.success?location.reload():e.alertErrors(t.errors)})})}),this},newsletterproSubscriptionOption:function(e){var t=this,n=t.dom,s=parseInt(e.val()),a=[n.npSubscribeOptions];$.each(a,function(e,t){s?t.stop().slideDown():t.stop().slideUp()})},newsletterproSubscriptionActive:function(){var e=NewsletterPro,t=$('input[name="newsletterproSubscriptionActive"]:checked').val(),n=$('input[name^="hook_"]'),s=[];n.length>0&&(s=$.map(n,function(e,t){return e=$(e),e.is(":checked")?e.val():void 0})),$.postAjax({submit:"newsletterproSubscriptionActive",newsletterproSubscriptionActive:t,hooks:s}).done(function(t){t.status?location.reload():e.alertErrors(t.errors)})},subscriptionSecureSubscribe:function(e){$.postAjax({submit:"subscriptionSecureSubscribe",subscriptionSecureSubscribe:e.val()}).done(function(e){e.status&&location.reload()})},importEmailsFromBlockNewsletter:function(e){var t=NewsletterPro;t.showAjaxLoader(e),$.postAjax({submit:"importEmailsFromBlockNewsletter"}).done(function(e){e.status?alert(t.displayAlert(e.msg)):t.alertErrors(e.errors)}).always(function(){t.hideAjaxLoader(e)})},clearSubscribersTemp:function(e){var t=NewsletterPro;t.showAjaxLoader(e),$.postAjax({submit:"clearSubscribersTemp"}).done(function(e){e.status?alert(t.displayAlert(e.msg)):t.alertErrors(e.errors)}).always(function(){t.hideAjaxLoader(e)})},clearLogFiles:function(e){var t=NewsletterPro;t.showAjaxLoader(e),$.postAjax({submit:"clearLogFiles"}).done(function(e){e.status?alert(t.displayAlert(e.msg)):t.alertErrors(e.errors)}).always(function(){t.hideAjaxLoader(e)})},showLoadBackup:function(){var e=this,t=e.l,n=NewsletterPro;if("undefined"==typeof e.loadBackupWindow){var s,a,r,i;e.loadBackupWindow=new gkWindow({width:800,height:500,title:t("load backup"),content:function(o){$.postAjax({submit:"showLoadBackup"},"html").done(function(l){o.setContent(l),s=o.getContent(),s.css({padding:0}),i=s.find("#load-global-templates"),a=new gk.data.Model({id:"id"}),r=e.loadBackupDataSource=new gk.data.DataSource({pageSize:9,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=ajaxGetBackup",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=ajaxDeleteBackup&id",type:"POST",dateType:"json",success:function(e,t){
e.status||alert(e.errors.join("\n"))},error:function(e,n){alert(t("delete record error"))},complete:function(e,t){}}},schema:{model:a},trySteps:2,errors:{read:function(e,t,n){r.syncStepAvailableAdd(3e3,function(){r.sync()})}}}),i.gkGrid({dataSource:r,selectable:!1,currentPage:1,pageable:!0,template:{actions:function(e){var s=$('<div style="text-align: center;"></div>'),a=$("#delete-backup-global").gkButton({name:"delete",title:t("delete"),className:"btn btn-default btn-margin pull-right ",click:function(n){return confirm(t("delete record confirm"))?void e.destroy("status"):!1},icon:'<i class="icon icon-trash-o"></i> '}),r=$("#load-backup-global").gkButton({name:"load",title:t("load"),className:"btn btn-default btn-margin pull-right ",click:function(s){var a=confirm(t("load backup confirm"));return a&&""!=a?(n.showAjaxLoader(r),void $.postAjax({submit:"ajaxLoadBackup",name:e.data.name}).done(function(e){e.status?(n.alertErrors(e.msg),window.location.reload()):n.alertErrors(e.errors.join("\n"))}).always(function(){n.hideAjaxLoader(r)})):!1},icon:'<span class="btn-ajax-loader" style="margin-top: 4px;"></span> <i class="icon icon-upload"></i> '});return s.append(r),s.append(a),s}}})})}}),e.loadBackupWindow.show()}else e.loadBackupWindow.show();"undefined"!=typeof e.loadBackupDataSource&&e.loadBackupDataSource.sync()},ready:function(e){var t=this;$(document).ready(function(){var n=$("#nav-sidebar");t.dom={newsletterpro:$("#newsletterpro"),npLeftSize:$("#np-left-side"),npRightSize:$("#np-right-side"),navSlider:n,menuCollapse:n.find(".menu-collapse"),alertDanger:$(".alert.alert-danger"),noBootstrap:$("#content.nobootstrap"),npMenuTopBg:$("#np-menu-top-bg"),newsletterproTab:$("#tab.newsletter"),newsletterproTabContent:$("#tab_content.newsletter"),menuToggle:$("#menu-toggle"),pageHead:$(".page-head"),npSubscribeSettings:$("#newsletter-pro-subscribe-settings"),bnSubscribeSettings:$("#block-newsletter-subscribe-settings"),npSubscribeOptions:$("#newsletter-pro-subscribe-options"),moduleCreateBackupButton:$("#module-create-backup-button"),moduleLoadBackupButton:$("#module-load-backup-button"),topShortcuts:$("#np-top-shortcuts input"),openLogFIle:$(".np-btn-open-log-file"),clearModuleCache:$("#pqnp-clear-module-cache")},e(t.dom)})}}.init(NewsletterPro),NewsletterPro.namespace("modules.syncTask"),NewsletterPro.modules.syncTask={speed:{slow:60,normal:45,fast:15},dom:null,box:null,interval:null,progressIds:[],init:function(e){var t=this;return t.box=e,t.ready(function(e){function n(e,t){r=r||NewsletterPro.modules.task.ui.components.taskList,i=i||NewsletterPro.modules.task.ui.components.taskHistory;var n=o.indexOf(e),s=l.indexOf(e);-1==n&&-1==s&&o.push(e),"undefined"!=typeof r&&r.syncDataById(e,t)}function s(e){e.length>0&&($.each(e,function(e,t){var n=t.id_newsletter_pro_task,s=!!parseInt(t.done);if(s){var a=r.getItemById(n);a&&(r.sync(),i.sync())}}),r.refreshView())}function a(e){e.length>0?(t.runInterval(t.speed.fast),$.each(e,function(e,t){var s=t.id_newsletter_pro_task;n(s,t)})):t.runInterval(t.speed.normal)}var r,i,o=t.progressIds||[],l=[];t.updateRow=function(e,t){n(e,t)},t.syncAjax=function(){r=r||NewsletterPro.modules.task.ui.components.taskList,i=i||NewsletterPro.modules.task.ui.components.taskHistory,$.postAjax({submit:"getTasksInProgress",getTasksInProgress:!0,progressIds:o},"json",!1).done(function(e){"object"==typeof e?(a(e.result),s(e.result_look)):e>0&&e!==r.items.length&&(r.sync(),i.sync())})},t.runInterval(t.speed.normal)}),t},runInterval:function(e){var t=this;null!=t.interval&&clearInterval(t.interval),t.interval=setInterval(function(){t.syncAjax()},1e3*e)},ready:function(e){var t=this;$(document).ready(function(){t.dom={},e(t.dom)})}}.init(NewsletterPro),NewsletterPro.namespace("modules.task"),NewsletterPro.modules.task={storage:null,dom:null,box:null,init:function(e){var t=this,n=NewsletterPro.modules.syncTask;return t.box=e,t.ready(function(s){function a(e){e=$.extend(!0,{},e);var t=$.map(e,function(e){var t={name:e.name,value:e.id_newsletter_pro_smtp,data:e};return e.hasOwnProperty("selected")&&(delete e.selected,t.selected=!0),t});return t}function r(e,t){var n,s=t.key,a=t.value,r=!1;for(n in e){var i=e[n];i.data.hasOwnProperty(s)&&i.data[s]===a?(i.selected=!0,r=!0):i.hasOwnProperty("selected")&&delete i.selected}return!r&&e.length>0&&(e[0].selected=!0),e}function i(e){$.postAjax({submit:"isSendNewsletterInProgress"}).done(function(t){if(!t)return e(!1);var n=confirm("The newsletter is in progress. Do you want to stop the sending process before to proceed?");return n?void NewsletterProControllers.SendController.stopNewsletters().done(function(){return e(!1)}):e(!0)})}var o=NewsletterPro.translations.l(NewsletterPro.translations.modules.task);t.initStorage(),s.taskButton.on("click",function(){t.taskClick.call(s.taskButton,t)}),s.taskTemplateSelect.on("click",function(e){t.setStorage("template",$(this).val())});var l=a(NewsletterPro.dataStorage.get("all_smtp")),c=NewsletterPro.modules.smtp,d=c.ui.SelectOption({name:"taskSmptSelect",template:s.taskSmptSelect,className:"gk-smtp-select",options:l,onChange:function(){var e=d.getSelected();if(null!=e){var n=e.data,a=NewsletterPro.dataStorage.get("configuration.PS_SHOP_EMAIL"),r=n.name,i=n.id_newsletter_pro_smtp;s.taskEmailTest.val(a),t.setStorage("smtp",r),t.setStorage("id_newsletter_pro_smtp",i)}}}),u=d.getSelected();null!=u&&t.setStorage("smtp",u.data.name);var p=s.taskTemplate,m=s.datepicker,f=t.ui,h=f.TaskWindow({width:425,className:"gk-task-window",show:function(e){s.emailsCount.text(t.getEmails().length);var n=c.ui.components.smptSelect,r=n.getData(),i=a(r);d.refresh(i)}});h.setHeader(o("new task")),m.datetimepicker({prevText:"",nextText:"",dateFormat:e.dataStorage.get("jquery_date_format"),currentText:o("Now"),closeText:o("Done"),ampm:!1,amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"hh:mm:ss tt",timeSuffix:"",timeOnlyTitle:o("Choose Time"),timeText:o("Time"),hourText:o("Hour"),onSelect:function(e,n){var s=$(this).datepicker("getDate"),e=new Date(s),a=e.getMonth()+1,r=e.getDate(),i=e.getFullYear(),o=1==String(a).length?"0"+String(a):String(a),l=1==String(r).length?"0"+String(r):String(r),c=e.getHours(),d=e.getMinutes(),u=e.getSeconds(),p=i+"-"+o+"-"+l+" "+c+":"+d+":"+u;t.setStorage("mysql_date",p)},minDate:new Date}),h.setContent(p);var g=parseInt(s.taskSleep.val());s.taskSleep.on("change",function(e){var n=$(this),s=parseInt(n.val());0>s?s=g:g=s,n.val(s),t.setStorage("sleep",s)}),s.taskSmtpTest.on("click",function(n){var a=d.getSelected();t.storage.template=s.taskTemplateSelect.val();var r=s.taskEmailTest.val(),i=null!=a?a.data.id_newsletter_pro_smtp:0,l=s.taskSmtpTestMessage,c=t.storage.template,u=t.storage.send_method,p=t.storage.id_lang?t.storage.id_lang:e.dataStorage.get("id_selected_lang");e.showAjaxLoader(s.taskSmtpTest),$.postAjax({submit:"sendTestEmail",sendTestEmail:r,smtpId:i,templateName:c,sendMethod:u,idLang:p}).done(function(e){e.status?l.empty().show().append('<div class="alert alert-success">'+o("email sent")+"</div>"):l.empty().show().append('<div class="alert alert-danger">'+e.msg+"</div>"),setTimeout(function(){l.hide()},15e3)}).always(function(){e.hideAjaxLoader(s.taskSmtpTest)})}),s.btnTaskLangSelectTest=$("#task-test-email-lang-select");new e.components.LanguageSelect({selector:s.btnTaskLangSelectTest,languages:e.dataStorage.get("all_languages"),click:function(e,n){var s=Number(e.id_lang);t.storage.id_lang=s}});s.addTask.on("click",function(e){var n=s.taskSmtpTestMessage,a=JSON.stringify(t.storage.emails);t.storage.emails=[],t.storage.template=s.taskTemplateSelect.val(),$.postAjax({submit:"addTask",addTask:t.storage,emails:a}).done(function(e){if(e.errors.length>0)n.empty().show().append('<div class="alert alert-danger">'+e.errors.join("<br />")+"</div>");else{var t=t||NewsletterPro.modules.task.ui.components.taskList;h.hide().done(function(){t.sync()})}setTimeout(function(){n.hide()},15e3)})});var v=new gk.data.Model({id:"id_newsletter_pro_task"}),w=new gk.data.DataSource({pageSize:10,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getTasks",dataType:"json"},update:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=updateTask&updateTask",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteTask&deleteTask",type:"POST",dateType:"json",success:function(e,t){e||alert(o("delete task"))},error:function(e,t){alert(o("delete task"))},complete:function(e,t){}}},schema:{model:v},trySteps:2,errors:{read:function(e,t,n){w.syncStepAvailableAdd(3e3,function(){w.sync()})}}});s.mailMethod.on("change",function(){s.mailMethod.is(":checked")&&(t.setStorage("send_method","mail"),s.smtpSelectContainer.slideUp())}),s.smtpMethod.on("change",function(){s.smtpMethod.is(":checked")&&(t.setStorage("send_method","smtp"),s.smtpSelectContainer.slideDown())}),s.taskList.gkGrid({dataSource:w,selectable:!1,currentPage:1,pageable:!0,template:{template:function(t,n){function s(e){var t=e.name,n=e.value,s=e.selected,a=$('<option value="'+n+'" '+(s?'selected="selected"':"")+">"+t+"</option>");c.append(a)}function a(){var t=e.dataStorage.get("templates"),s=[];for(var a in t){var r=t[a],i={name:r.name,value:r.filename,selected:!1};$.trim(i.value)===$.trim(n)&&(i.selected=!0),s.push(i)}return s}var r=$("<div></div>"),i=t.data,l=a(),c=$('<select id="template-select-list" class="template-select-list gk-select"></select>');for(var d in l){var u=l[d];s(u)}return c.on("change",function(e){var n=c.val();n&&(t.data.template=n,t.update().done(function(e){e||alert(o("template not found"))}))}),1==parseInt(i.status)&&0==parseInt(i.done)&&0==parseInt(i.pause)?r.append($('<span class="task-text-p">'+n+"</span>")):r.append(c),r},actions:function(t,s){function a(){d.is(":visible")?(d.hide(),u.css({display:"inline-block"})):(d.css({display:"inline-block"}),u.hide()),c.hide()}var r=t.data,i=$("#task-delete").gkButton({name:"delete",title:o("delete"),className:"btn btn-default btn-margin task-delete",item:t,css:{display:"inline-block"},command:"delete",confirm:function(){return confirm(o("delete record"))},icon:'<i class="icon icon-trash-o"></i> '}),l=$("<div></div>"),c=$("#task-send").gkButton({name:"send-task",title:o("send"),className:"btn btn-default btn-margin send-task",css:{display:"inline-block"},click:function(t){n.runInterval(n.speed.fast);var s=r.id_newsletter_pro_task;c.hide(),u.show(),$.postAjax({submit:"sendTaskAjax",sendTaskAjax:s}).done(function(t){t.status?(c.disable(),n.syncAjax()):e.alertErrors(t.errors)})},icon:'<i class="icon icon-send"></i> '});c.hide();var d=$("#continue-send").gkButton({name:"continue-task",title:o("continue"),className:"btn btn-default btn-margin continue-task",css:{display:"inline-block"},click:function(e){n.runInterval(n.speed.fast);var t=r.id_newsletter_pro_task;a(),$.postAjax({submit:"continueTaskAjax",id:t}).done(function(e){n.syncAjax()})},icon:'<i class="icon icon-refresh"></i> '});d.hide();var u=$("#pause-task").gkButton({name:"pause-task",title:o("pause"),className:"btn btn-default btn-margin pause-task",css:{display:"inline-block"},click:function(e){n.runInterval(n.speed.fast);var t=r.id_newsletter_pro_task;a(),$.postAjax({submit:"pauseTask",id:t}).done(function(e){n.syncAjax()})},icon:'<i class="icon icon-pause"></i> '});return u.hide(),l.append(d),l.append(u),l.append(c),1==parseInt(r.status)&&0==parseInt(r.done)?parseInt(r.pause)?d.css({display:"inline-block"}):u.css({display:"inline-block"}):c.css({display:"inline-block"}),l.append(i),l},smtp:function(e,t){function n(){return"mail"==e.data.send_method}function s(){return"mail"===m.val()?"mail()":"SMTP"}var i=a(NewsletterPro.dataStorage.get("all_smtp")),l=$('<select id="smtp-select-list" class="gk-select" style="min-width: 160px !important; width: auto;"></select>'),d=e.data.id_newsletter_pro_smtp,u=r(i,{key:"id_newsletter_pro_smtp",value:d}),p=c.ui.SelectOption({name:"taskSmptSelectList",template:l,className:"gk-smtp-select",options:u,onChange:function(){var t=p.getSelected();if(null!=t){var n=t.data,s=n.id_newsletter_pro_smtp;e.data.id_newsletter_pro_smtp=s,e.update().done(function(e){e||alert(o("smtp not update"))})}}});n()&&p.template.hide();var m=$('<select id="send-method-select" class="send-method-select gk-select" autocomplete="off"><option value="smtp">SMTP</option><option value="mail" '+(n()?'selected="selected"':"")+">mail()</option></select>");m.on("change",function(){var t=m.val();if("mail"===t)p.template.hide(),e.data.id_newsletter_pro_smtp=0;else{var n=p.getSelected();if(null!=n){var s=n.data,a=s.id_newsletter_pro_smtp;e.data.id_newsletter_pro_smtp=a}p.template.show()}e.data.send_method=t,e.update().done(function(e){e||alert(o("send method not update"))})});var f=$("<div></div>"),h=$('<span class="send-test-list-message" style="margin-top: 4px; display: inline-block;"></span>'),g=$("#send-test-list").gkButton({name:"send-test-list",className:"btn btn-default task-smtp-test-list",title:o("test"),click:function(){var t=p.getSelected(),n=null!=t?t.data.id_newsletter_pro_smtp:0,s=NewsletterPro.dataStorage.get("configuration.PS_SHOP_EMAIL"),a=e.data.template,r=e.data.send_method;h.empty().show().append('<span class="ajax-loader">&nbsp;</span>'),$.postAjax({submit:"sendTestEmail",sendTestEmail:s,smtpId:n,templateName:a,sendMethod:r}).done(function(e){e.status?h.empty().show().append('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>'):(h.empty().show().append('<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>'),NewsletterPro.alertErrors(e.msg)),setTimeout(function(){h.hide()},1e4)})},icon:'<i class="icon icon-envelope"></i> '}),v={"float":"left"};return l.css(v),g.css(v),h.css(v),1==parseInt(e.data.status)&&0==parseInt(e.data.done)&&0==parseInt(e.data.pause)?f.append('<span class="task-text-p">'+s()+"</span>"):(f.append(m),f.append(l),f.append(g),f.append(h)),f},active:function(e,t){function n(){return"0"!==String(e.data.active)}var s=(e.data.id_newsletter_pro_task,$('<a class="status-button" href="javascript:{}"></a>')),a='<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>',r='<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>';return n()?s.html(a):s.html(r),s.toggleActive=function(){var t=s;e.data.active=n()?0:1,n()?t.html(a):t.html(r)},s.on("click",function(){var t=s;t.toggleActive(),e.update().done(function(e){e||t.toggleActive()})}),s},date_start:function(t,n){var s,a=new Date,r=a.getFullYear(),i=a.getMonth(),l=a.getDate(),c=t.data,d=new Date(t.data.date_start),u=new Date(r,i,l,0,0,0),p=e.dataStorage.get("jquery_date_format");return 1==parseInt(c.status)&&0==parseInt(c.done)&&0==parseInt(c.pause)?s=$("<span>"+$.datepicker.formatDate(p,d)+"</span>"):(s=$('<input type="text" class="task-list-date-input gk-input" style="position: relative; z-index: 100000;">').datetimepicker({prevText:"",nextText:"",dateFormat:p,currentText:o("Now"),closeText:o("Done"),ampm:!1,amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"hh:mm:ss tt",timeSuffix:"",timeOnlyTitle:o("Choose Time"),timeText:o("Time"),hourText:o("Hour"),onSelect:function(e,n){var s=$(this).datepicker("getDate"),a=new Date(s),r=a.getMonth()+1,i=a.getDate(),l=a.getFullYear(),c=1==String(r).length?"0"+String(r):String(r),d=1==String(i).length?"0"+String(i):String(i),u=a.getHours(),p=a.getMinutes(),m=a.getSeconds(),f=l+"-"+c+"-"+d+" "+u+":"+p+":"+m;t.data.date_start=f,t.update().done(function(e){e||alert(o("date not changed"))})},minDate:u}),s.datetimepicker("setDate",d)),s},status:function(e,t){function s(e){var t=[];for(var n in e)t.push(e[n]);return t.length>0?t.join("<br />"):!1}function a(e,t){var s=n.progressIds.indexOf(e);-1==s&&n.progressIds.push(e)}var r=$("<div></div>"),i=e.data,l=$('<span class="task-emails-status"> ( '+parseInt(i.emails_count)+" ) "+i.status+" </span>"),c=$('<span class="task-emails-count"> ( <span class="count">'+parseInt(i.emails_count)+"</span> ) emails </span>"),d=$('<span class="task-emails-error"> ( <span class="count">'+parseInt(i.emails_error)+"</span> ) </span>"),u=$('<span class="task-emails-success"> ( <span class="count">'+parseInt(i.emails_success)+"</span> ) </span>"),p=$('<a href="javascript:{}" class="task-error-msg" style="display:none;"></a>'),m=s(e.data.error_msg);return m&&(p.show(),p.on("click",function(){var e=f.TaskWindow({width:425,className:"gk-task-window",show:function(e){}});e.setHeader(o("errors")),e.setContent('<span class="error-msg" style="float: none;">'+m.replace(/\\'/g,'"')+"</span>"),e.show()})),1===parseInt(i.status)?(r.append(c),r.append(u),r.append(d),a(i.id_newsletter_pro_task,i)):r.append(l),r.append(p),r}}});var b=new gk.data.Model({id:"id_newsletter_pro_send"}),y=new gk.data.DataSource({pageSize:10,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getSendHistory",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteSendHistory&deleteSendHistory",dateType:"json",success:function(e,t){e||alert(o("delete send history"))},error:function(e,t){alert(o("delete send history"))},complete:function(e,t){}}},schema:{model:b},trySteps:2,errors:{read:function(e,t,n){y.syncStepAvailableAdd(3e3,function(){y.sync()})}}});s.sendHistory.gkGrid({dataSource:y,selectable:!1,currentPage:1,pageable:!0,template:{actions:function(t,n){function s(e,t,n){var s=";",a=$('									<form id="'+NewsletterPro.uniqueId()+'" method="POST" action="'+NewsletterPro.dataStorage.get("ajax_url")+'#history">										<input type="hidden" name="export_send_history" value="1">										<input type="hidden" name="id_history" value="'+e+'">										<input type="hidden" name="export_emails_to_send" value="'+t+'">										<input type="hidden" name="export_emails_sent" value="'+n+'">										<input type="hidden" name="csv_separator" value="'+s+'">									</form>								'),r=prompt(o("CSV Separator"),s);if(null!=r)return r=$.trim(r),";"!=r&&","!=r?void alert(o("Invalid CSV separator.")):(a.find('input[name="csv_separator"]').val(r),void a.submit())}function a(t){$.postAjax({submit:"getSendHistoryDetail",getSendHistoryDetail:t},"html").done(function(t){m.html(t);var n={btnResend:m.find("#np-btn-resend-send"),checkboxResendLeft:m.find("#resend-left-list-send"),checkboxResendUndelivered:m.find("#resend-undelivered-list-send"),exportSend:m.find("#np-btn-export-send-history"),exportSendRem:m.find("#np-btn-export-send-history-rem")};n.exportSendRem.on("click",function(e){s(h,1,0)}),n.exportSend.on("click",function(e){s(h,0,1)}),n.btnResend.on("click",function(t){i(function(t){t||(e.showAjaxLoader(n.btnResend),$.postAjax({submit:"resendSendHistory",id:h,resendLeft:Number(n.checkboxResendLeft.is(":checked")),resendUndelivered:Number(n.checkboxResendUndelivered.is(":checked"))}).done(function(t){t.success?("undefined"!=typeof d&&d.hide(),NewsletterProComponents.objs.tabItems.trigger("tab_newsletter_5"),$("html, body").animate({scrollTop:parseInt($("#emails-to-send").offset().top)-120},1e3),NewsletterProControllers.SendController.prepareEmails(t.emails)):e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(n.btnResend)}))})})})}function r(e){var t={id:null,instance:null,init:function(e){function t(e){if(null!=c){var t=c.find("a.selected");$.each(t,function(e,t){$(t).removeClass("selected")})}this.addClass("selected"),a(e.id)}var n=this;return id=e.step,count=e.count,n.id=id,n.instance=$('<a href="javascript:{}" class="history-details-steps" data-id="'+id+'">'+o("step")+" "+count+"</a>"),1==count&&(a(n.id),n.instance.addClass("selected")),function(e){e.on("click",function(s){t.call(e,n,s)})}(n.instance),n},getInstance:function(){return this.instance}}.init(e);return t}function l(){var e=0,t=$('<div class="detail-buttons"></div>');return $.each(p,function(n,s){var a=r({step:s,count:++e});t.append(a.getInstance())}),t}var c,d,u=(t.data,$("<div></div>")),p="undefined"!=typeof t.data.steps&&t.data.steps?t.data.steps.split(","):null,m=$('<div class="detail-content"></div>'),h=parseInt(t.data.id_newsletter_pro_tpl_history),g=$("#task-history-delete").gkButton({name:"delete",title:o("delete"),className:"btn btn-default btn-margin task-delete",item:t,command:"delete",confirm:function(){return confirm(o("delete record"))},icon:'<i class="icon icon-trash-o"></i> '}),v=$("#send-history-details").gkButton({name:"send-history-details",title:o("details"),className:"btn-margin send-history-details",click:function(e){var t=$("<div></div>");c=l(),d=f.TaskWindow({width:800,height:500,className:"gk-task-window-details",show:function(e){}}),d.setHeader(o("details")),p.length>1&&t.append(c),t.append(m),d.setContent(t),d.show()},icon:'<i class="icon icon-info-circle"></i> '}),w=$("#send-history-view").gkButton({name:"send-history-view",title:o("view"),className:"btn btn-default btn-margin task-history-view",click:function(e){var t,n,s,a=$("<div></div>"),r=gkWindow({width:800,height:500,className:"gk-task-window-view",show:function(e){}}),i=$("<span></span>");n=o("view template"),t=$('<a href="javascript:{}" target="_blank" class="history-details-steps view-template-in-br-button">'+o("veiw in a new window")+"</a>"),i.append(n),i.append(t),r.setHeader(i),s=$('<div class="view-template-in-br"></div>'),$.postAjax({submit:"renderTemplateHistory",renderTemplateHistory:h}).done(function(e){t.attr("href",e.url);var n=$('<iframe style="display: block; vertical-align: top; height: 462px;" scrolling="yes" src="'+e.url+'"> </iframe>');s.html(n);var r=s.find("table").first();r.length&&a.parent().length&&a.parent().css({"background-color":r.css("background-color")})}),a.append(s),r.setContent(a),r.show()},icon:'<i class="icon icon-eye"></i> '});return h>0&&u.append(w),u.append(v),u.append(g),u},emails_count:function(e,t){return'<span style="padding: 0; margin: 0; font-weight: bold; float: none;">'+(parseInt(t)?t:"0")+"</span>"},emails_success:function(e,t){return'<span class="success-msg" style="padding: 0; margin: 0; float: none;">'+(parseInt(t)?t:"0")+"</span>"},emails_error:function(e,t){return'<span class="error-msg" style="padding: 0; margin: 0; float: none;">'+(parseInt(t)?t:"0")+"</span>"},unsubscribed:function(e,t){function n(e){$.postAjax({submit:"getUnsubscribedDetails",id_newsletter:e},"html").done(function(e){a.html(e)})}var s=$('<a href="javascript:{}" class="btn btn-default task-error-msg-text" style="display:none;"><span class="icon"></span><span style="font-weight: bold; color: #F00;">'+t+"</span></a>");if(parseInt(t)<=0)return t;var a=$("<div></div>");return s.css({display:"inline-block"}),s.on("click",function(){n(e.data.id_newsletter_pro_tpl_history);var t=$("<div></div>"),s=f.TaskWindow({width:800,height:500,className:"gk-task-window-details",show:function(e){}});s.setHeader(o("unsubscribed")),t.append(a),s.setContent(t),s.show()}),s},fwd_unsubscribed:function(e,t){function n(e){$.postAjax({submit:"getTaskFwdUnsubscribedDetails",id_newsletter:e},"html").done(function(e){a.html(e)})}var s=$('<a href="javascript:{}" class="btn btn-default task-error-msg-text" style="display:none;"><span class="icon"></span><span style="font-weight: bold; color: #F00;">'+t+"</span></a>");if(parseInt(t)<=0)return t;var a=$("<div></div>");return s.css({display:"inline-block"}),s.on("click",function(){n(e.data.id_newsletter_pro_tpl_history);var t=$("<div></div>"),s=f.TaskWindow({width:800,height:500,className:"gk-task-window-details",show:function(e){}});s.setHeader(o("unsubscribed")),t.append(a),s.setContent(t),s.show()}),s},error_msg:function(e,t){function n(e){if("object"==typeof t){var n=[];for(var s in e)n.push(e[s]);if(n.length>0)return n.join("<br />")}else if("string"==typeof t)return t;return!1}var s=$('<a href="javascript:{}" class="btn btn-default task-error-msg-text" style="display:none;"><span class="icon"></span>'+o("View")+"</a>"),a=n(t);return a&&(s.css({display:"inline-block"}),s.show(),s.on("click",function(){var e=f.TaskWindow({width:425,className:"gk-task-window",show:function(e){}});e.setHeader(o("errors")),e.setContent('<span class="error-msg" style="float: none;">'+a.replace(/\\'/g,'"')+"</span>"),e.show()})),s}}});var S=new gk.data.Model({id:"id_newsletter_pro_task"}),k=new gk.data.DataSource({pageSize:10,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getTasksHistory",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteTask&deleteTask",type:"DELETE",dateType:"json",success:function(e,t){e||alert(o("delete task"))},error:function(e,t){alert(o("delete task"))},complete:function(e,t){}}},schema:{model:S},trySteps:2,errors:{read:function(e,t,n){k.syncStepAvailableAdd(3e3,function(){k.sync()})}}});s.taskHistory.gkGrid({dataSource:k,selectable:!1,currentPage:1,pageable:!0,template:{actions:function(e,t){function n(e){$.postAjax({submit:"getTasksHistoryDetail",getTasksHistoryDetail:e},"html").done(function(e){c.html(e)})}function s(e){var t={id:null,instance:null,init:function(e){function t(e){if(null!=r){var t=r.find("a.selected");$.each(t,function(e,t){$(t).removeClass("selected")})}this.addClass("selected"),n(e.id)}var s=this;return id=e.step,count=e.count,s.id=id,s.instance=$('<a href="javascript:{}" class="history-details-steps" data-id="'+id+'">'+o("step")+" "+count+"</a>"),1==count&&(n(s.id),s.instance.addClass("selected")),function(e){e.on("click",function(n){t.call(e,s,n)})}(s.instance),s},getInstance:function(){return this.instance}}.init(e);return t}function a(){var e=0,t=$('<div class="detail-buttons"></div>');return $.each(l,function(n,a){var r=s({step:a,count:++e});t.append(r.getInstance())}),t}var r,i=(e.data,$("<div></div>")),l="undefined"!=typeof e.data.steps?e.data.steps.split(","):null,c=$('<div class="detail-content"></div>'),d=parseInt(e.data.id_newsletter_pro_tpl_history),u=$("#task-history-delete").gkButton({name:"delete",title:o("delete"),className:"btn btn-default btn-margin task-delete",item:e,command:"delete",confirm:function(){return confirm(o("delete record"))},icon:'<i class="icon icon-trash-o"></i> '}),p=$("#task-history-details").gkButton({name:"history-details",title:o("details"),className:"btn-margin task-history-details",click:function(e){var t=$("<div></div>");r=a();var n=f.TaskWindow({width:800,height:500,className:"gk-task-window-details",show:function(e){}});n.setHeader(o("details")),l.length>1&&t.append(r),t.append(c),n.setContent(t),n.show()},icon:'<i class="icon icon-info-circle"></i> '}),m=$("#task-history-view").gkButton({name:"history-view",title:o("view"),className:"btn btn-default btn-margin task-history-view",click:function(e){var t,n,s=$("<div></div>"),a=gkWindow({width:800,height:500,className:"gk-task-window-view",show:function(e){}}),r=$("<span></span>");title=o("view template"),t=$('<a href="javascript:{}" target="_blank" class="history-details-steps view-template-in-br-button">'+o("veiw in a new window")+"</a>"),r.append(title),r.append(t),a.setHeader(r),n=$('<div class="view-template-in-br"></div>'),$.postAjax({submit:"renderTemplateHistory",renderTemplateHistory:d}).done(function(e){t.attr("href",e.url);var a=$('<iframe style="display: block; vertical-align: top; height: 462px;" scrolling="yes" src="'+e.url+'"> </iframe>');n.html(a);var r=n.find("table").first();r.length&&s.parent().length&&s.parent().css({"background-color":r.css("background-color")})}),s.append(n),a.setContent(s),a.show()},icon:'<i class="icon icon-eye"></i> '});return d>0&&i.append(m),i.append(p),i.append(u),i},emails_count:function(e,t){return'<span style="padding: 0; margin: 0; font-weight: bold; float: none;">'+(parseInt(t)?t:"0")+"</span>"},emails_success:function(e,t){return'<span class="success-msg" style="padding: 0; margin: 0; float: none;">'+(parseInt(t)?t:"0")+"</span>"},emails_error:function(e,t){return'<span class="error-msg" style="padding: 0; margin: 0; float: none;">'+(parseInt(t)?t:"0")+"</span>"},unsubscribed:function(e,t){function n(e){$.postAjax({submit:"getTaskUnsubscribedDetails",id_newsletter:e},"html").done(function(e){a.html(e)})}var s=$('<a href="javascript:{}" class="btn btn-default task-error-msg-text" style="display:none;"><span class="icon"></span><span style="font-weight: bold; color: #F00;">'+t+"</span></a>");if(parseInt(t)<=0)return t;var a=$("<div></div>");return s.css({display:"inline-block"}),s.on("click",function(){n(e.data.id_newsletter_pro_tpl_history);var t=$("<div></div>"),s=f.TaskWindow({width:800,height:500,className:"gk-task-window-details",show:function(e){}});s.setHeader(o("unsubscribed")),t.append(a),s.setContent(t),s.show()}),s},fwd_unsubscribed:function(e,t){function n(e){$.postAjax({submit:"getTaskFwdUnsubscribedDetails",id_newsletter:e},"html").done(function(e){a.html(e)})}var s=$('<a href="javascript:{}" class="btn btn-default task-error-msg-text" style="display:none;"><span class="icon"></span><span style="font-weight: bold; color: #F00;">'+t+"</span></a>");if(parseInt(t)<=0)return t;var a=$("<div></div>");return s.css({display:"inline-block"}),s.on("click",function(){n(e.data.id_newsletter_pro_tpl_history);var t=$("<div></div>"),s=f.TaskWindow({width:800,height:500,className:"gk-task-window-details",show:function(e){}});s.setHeader(o("unsubscribed")),t.append(a),s.setContent(t),s.show()}),s},error_msg:function(e,t){function n(e){if("object"==typeof t){var n=[];for(var s in e)n.push(e[s]);if(n.length>0)return n.join("<br />")}else if("string"==typeof t)return t;return!1}var s=$('<a href="javascript:{}" class="btn btn-default task-error-msg-text" style="display:none;"><span class="icon"></span>'+o("View")+"</a>"),a=n(t);return a&&(s.css({display:"inline-block"}),s.show(),s.on("click",function(){var e=f.TaskWindow({width:425,className:"gk-task-window",show:function(e){}});e.setHeader("Errors"),e.setContent('<span class="error-msg" style="float: none;">'+a.replace(/\\'/g,'"')+"</span>"),e.show()})),s}}}),s.clearTaskHistory.on("click",function(){$.postAjax({submit:"clearTaskHistory",clearTaskHistory:!0}).done(function(e){if(e.status){var t=k||NewsletterPro.modules.task.ui.components.taskHistory;t.sync()}else alert(e.msg)})}),s.clearSendHistory.on("click",function(){$.postAjax({submit:"clearSendHistory",clearSendHistory:!0}).done(function(e){if(e.status){var t=y||NewsletterPro.modules.task.ui.components.sendHistory;t.sync()}else alert(e.msg)})}),s.clearSendDetails.on("click",function(){e.showAjaxLoader(s.clearSendDetails),$.postAjax({submit:"clearSendHistoryDetails"}).done(function(t){t.status||e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(s.clearSendDetails)})}),s.clearTaskDetails.on("click",function(){e.showAjaxLoader(s.clearTaskDetails),$.postAjax({submit:"clearTaskHistoryDetails"}).done(function(t){t.status||e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(s.clearTaskDetails)})}),s.taskMoreInfoButton.on("click",function(e){s.taskMoreInfo.toggle(),s.taskMoreInfo.is(":visible")?$(this).text(o("less info")):$(this).text(o("more info"))}),f.add("taskList",w),f.add("taskHistory",k),f.add("sendHistory",y),f.add("taskWindow",h)}),t},initStorage:function(){this.storage={template:this.dom.taskTemplateSelect.val(),emails:[],mysql_date:"",smtp:"",id_lang:null,id_newsletter_pro_smtp:0,sleep:parseInt(this.dom.taskSleep.val())||5,send_method:"mail"}},setStorage:function(e,t){this.storage[e]=t},ready:function(e){var t=this;$(document).ready(function(){var n=$("#task-template"),s=$($.trim(n.html()));"undefined"!=typeof s[1]&&(s=$(s[1])),t.dom={chooseNewsletterTemplate:$("#change-newsletter-template"),taskButton:$("#new-task"),testEmailInput:$("#test-email-input"),taskList:$("#task-list"),taskHistory:$("#task-history"),clearTaskHistory:$("#clear-task-history"),clearTaskDetails:$("#clear-task-details"),clearSendHistory:$("#clear-send-history"),clearSendDetails:$("#clear-send-details"),sendHistory:$("#send-history"),taskMoreInfo:$("#task-more-info"),taskMoreInfoButton:$("#task-more-info-button"),taskTemplate:s,datepicker:s.find("#task-datepicker"),emailsCount:s.find("#selected_emails_count"),
taskSmptSelect:s.find("#task-smtp-select"),taskTemplateSelect:s.find("#task-select-template"),taskSmtpTest:s.find("#task-smtp-test"),taskSmtpTestMessage:s.find("#task-smtp-test-message"),taskEmailTest:s.find("#task-email-test"),addTask:s.find("#add-task"),taskSleep:s.find("#task-sleep"),btnTaskLangSelectTest:$("#task-test-email-lang-select"),mailMethod:s.find("#task-mail-method"),smtpMethod:s.find("#task-smtp-method"),smtpSelectContainer:s.find("#div-task-smtp-select")},e(t.dom)})},getStorage:function(){return this.storage},taskClick:function(e){var t=e.dom,n=e.getEmails();if(0==n.length)return alert(this.data("trans-noemail")),!1;e.setStorage("emails",n);var s=e.ui,a=s.components.taskWindow;a.show(),$.postAjax({submit_template_controller:"getNewsletterTemplates"}).done(function(e){if(e.length){t.taskTemplateSelect.empty();for(var n=0;n<e.length;n++){var s=e[n],a='<option value="'+s.filename+'" '+(s.selected?'selected="selected"':"")+">"+s.name+"</option>";t.taskTemplateSelect.append(a)}}});var r=NewsletterPro.modules.smtp.ui.components.taskSmptSelect,i=r.getSelected();null!=i&&e.setStorage("id_newsletter_pro_smtp",i.data.id_newsletter_pro_smtp)},getEmails:function(){return NewsletterProControllers.SendController.getSelectedEmails()},ui:{components:{},init:function(){return this},add:function(e,t){this.components[e]=t},TaskWindow:function o(e){function t(){var t=$('<div class="gk-background"></div>'),s=$('<div><div class="gk-header"><span class="gk-title"></span><a href="javascript:{}" class="gk-close"><i class="icon icon-remove"></i></a></div><div class="bootstrap gk-content"></div></div>'),a=$("body"),r=e.width||0,i=e.height||0;return t.css({width:"100%",height:"100%",top:0,left:0,position:"fixed",display:"none","z-index":"99999"}),t.appendTo(a),s.css({width:e.width||"auto",height:e.height||"auto",position:"fixed",left:0!=r?a.width()/2-r/2:a.width()/2,top:0!=i?$(window).height()/2-i/2:$(window).height()/2,display:"none","z-index":"999999"}),s.header=s.find(".gk-header"),s.content=s.find(".gk-content"),s.close=s.find(".gk-close"),s.background=t,s.addClass("gk-task-window"),s.addClass(e.className),t.addClass(e.className+"-background"),s.appendTo(a),n(s,t),s}function n(e,t){e.close.on("click",function(e){s.hide()}),t.on("click",function(){e.close.trigger("click")}),$(window).resize(function(e){s.resetPosition()})}if(!(this instanceof o))return new o(e);var s=this;return task=NewsletterPro.modules.task,l=NewsletterPro.translations.l(NewsletterPro.translations.modules.task),this.template=t(),this.resetPosition=function(){s.template.css({left:$("body").width()/2-s.template.width()/2,top:$(window).height()/2-s.template.height()/2})},this.setHeader=function(e){this.template.header.find(".gk-title").html(e)},this.setContent=function(e){this.template.content.html(e)},this.hide=function(){return this.template.fadeOut(200),this.template.background.fadeOut(200).promise()},this.show=function(){return this.resetPosition(),this.template.fadeIn(200),"function"==typeof e.show&&e.show(s),this.template.background.fadeIn(200).promise()},this}}.init()}.init(NewsletterPro),NewsletterPro.namespace("modules.forward"),NewsletterPro.modules.forward={dom:null,box:null,init:function(e){var t=this;return t.box=e,t.ready(function(e){var t=NewsletterPro.translations.l(NewsletterPro.translations.modules.forward),n=new gk.data.Model({id:"id_newsletter_pro_forward"}),s=new gk.data.DataSource({pageSize:10,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getForwardList",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteForwardFromEmail&id",dateType:"json",success:function(e,n){e||alert(t("delete record"))},error:function(e,n){alert(t("delete record"))},complete:function(e,t){}},search:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=searchForwarder&value",dataType:"json"}},schema:{model:n},trySteps:2,errors:{read:function(e,t,n){s.syncStepAvailableAdd(3e3,function(){s.sync()})}}});e.forwardList.gkGrid({dataSource:s,selectable:!1,currentPage:1,pageable:!0,template:{count:function(e,t){return'<span style="font-weight: bold;">'+e.data.count+"</span>"},actions:function(e,n){function s(e){o.append(e)}function a(e){$.postAjax({submit:"getForwarderDetails",email:e},"html").done(function(e){l.html(e)})}var r,i,o=(e.data,$("<div></div>"));r=$("#forwarder-delete").gkButton({name:"delete",title:t("delete"),className:"btn btn-default btn-margin pull-right forwarder-delete",item:e,command:"delete",icon:'<i class="icon icon-trash-o"></i> ',confirm:function(){return confirm(t("delete added confirm"))}});var l=$("<div></div>");return i=$("#forwarder-details").gkButton({name:"forwarder-details",title:t("details"),className:"btn btn-default btn-margin pull-right forwarder-details",icon:'<i class="icon icon-info-circle"></i> ',click:function(n){a(e.data.from);var s=$("<div></div>"),r=gkWindow({width:800,height:500,className:"gk-task-window-details",show:function(e){}});r.setHeader(t("forward to emails")),s.append(l),r.setContent(s),r.show()}}),s(i),s(r),o}}}),e.forwardList.addHeader(function(e){function n(t){return a=$("<tr></tr>"),r=$('<th class="gk-header-datagrid customers-header" colspan="'+e+'"></th>'),$.each(t,function(e,t){r.append(t)}),a.html(r),a}var a,r,i,o,l=null;i=$('<div class="customers-search-div"></div>'),search=$('<input class="gk-input customers-search" type="text">'),searchLoading=$('<span class="customers-search-loading" style="display: none;"></span>'),search.on("keyup",function(e){var t=$.trim(search.val());return t.length<3?(s.clearSearch(),!0):(searchLoading.show(),null!=l&&clearTimeout(l),void(l=setTimeout(function(){s.search(t).done(function(e){s.applySearch(e),searchLoading.hide()})},300)))}),o=$("<span>"+t("search")+":</span>"),i.append(search),i.append(searchLoading);var c=$("#clear-filters").gkButton({name:"clear-filters",title:t("clear filters"),className:"clear-filters",css:{"padding-left":"10px","padding-right":"10px","margin-left":"0","margin-right":"0","float":"right"},attr:{"data-checked":0},click:function(e){search.val(""),s.clearSearch()},icon:'<i class="icon icon-times"></i> '});return n([o,i,c])},"prepend"),e.clearForwarders.on("click",function(){$.postAjax({submit:"clearForwarders"},"html").done(function(e){parseInt(e)?s.sync():alert(t("delete forwards records error"))})})}),t},ready:function(e){var t=this;$(document).ready(function(){t.dom={forwardList:$("#forward-list"),clearForwarders:$("#clear-forwarders")},e(t.dom)})},deleteForwardToEmail:function(e){var t=NewsletterPro.translations.l(NewsletterPro.translations.modules.forward);$.postAjax({submit:"deleteForwardToEmail",email:e.data("email")},"html").done(function(n){parseInt(n)?e.parent().parent().parent().remove():alert(t("delete record"))})}}.init(NewsletterPro),NewsletterPro.namespace("modules.statistics"),NewsletterPro.modules.statistics={domSave:null,dom:null,box:null,vars:{},events:{},init:function(e){var t,n,s=this;return s.box=e,s.ready(function(e){var s=new gk.data.Model({id:"id_product"});t=new gk.data.DataSource({pageSize:15,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getStatistics",dataType:"json"}},schema:{model:s},trySteps:2,errors:{read:function(e,n,s){t.syncStepAvailableAdd(3e3,function(){t.sync()})}}}),n=e.statisticsTable.gkGrid({dataSource:t,selectable:!1,currentPage:1,pageable:!0,template:{image:function(e,t){return'<img src="'+e.data.thumb_path+'">'},name:function(e,t){function n(e,t){return t=t||200,e.length>t?e.slice(0,t)+"...":e}return'<a href="'+e.data.link+'" target="_blank" style="color: #00aff0;">'+n(t)+"</a>"}}}),e.clearStatistics.on("click",function(){$.postAjax({submit:"clearStatistics"}).done(function(e){e.status?t.sync():alert(e.errors.join("\n"))})})}),s},ready:function(e){var t=this;$(document).ready(function(){t.dom={statisticsTable:$("#statistics-table"),clearStatistics:$("#clear-statistics")},e(t.dom)})}}.init(NewsletterPro),NewsletterPro.namespace("modules.filters"),NewsletterPro.modules.filters={dom:null,box:null,init:function(e){var t=this;t.box=e,t.ready(function(e){})},ready:function(e){var t=this;$(document).ready(function(){t.dom={},e(t.dom)})}}.init(NewsletterPro),NewsletterPro.namespace("modules.selectProducts"),NewsletterPro.modules.selectProducts={dom:null,box:null,timer:null,productSelection:null,vars:{},init:function(e){function t(){var e,t=NewsletterPro,n=0,s=t.dataStorage.get("id_selected_lang"),a=t.components.Product.view[s];return null==a?!1:(e=a.find('[class="np-newsletter-layout-'+s+'"]'),n=e.length>0?e.width():a.width(),void m.dom.spWidth.html(n))}function n(e,t){null!=m.timer&&clearTimeout(m.timer),m.timer=setTimeout(function(){e()},t)}function s(e){var t=$.trim(e.html());return!!/\{\$\w+/.test(t)}function a(e,t,n){var s=e.data.image_height,a=e.data.image_width,r=s/a,i=n*r;t.width(n),t.height(i),t.attr({width:n,height:i})}function r(e,t){return parseInt(e.width)<parseInt(t.width)?-1:parseInt(e.width)>parseInt(t.width)?1:0}function i(e){var t=NewsletterPro.dataStorage.data.images_size,n="";t.sort(r);for(var s=0;s<t.length;s++){var a=t[s],i=Number(a.width);e>i&&"undefined"!=typeof t[s+1]&&(n=t[s+1].name)}return t.length&&!n.length&&(n=t[0].name),n}function o(e){var t=NewsletterProComponents.objs.selectedProducts,n=t.getItemsIds(),s=i(e),a=new $.Deferred;return $.postAjax({submit:"getImagesOfProducts",ids:n,image_type:s}).done(function(e){e.status?a.resolve(e.products):alert(e.errors.join("\n"))}),a.promise()}function l(e){var t=NewsletterProComponents.objs.selectedProducts;o(e).done(function(n){t.parseProducts(function(t,s,r){c(n,t),a(t,t.dom.image,e)})})}function c(e,t){var n=parseInt(t.id);e.hasOwnProperty(n)&&(t.data.image_path=e[n].src,t.data.image_width=e[n].width,t.data.image_height=e[n].height,t.dom.image.attr({src:e[n].src,width:e[n].width,height:e[n].height}))}function d(){NewsletterProComponents.objs.selectedProducts.renderImages=!0}function u(){var e=NewsletterProComponents.objs.categoryList,t=NewsletterProComponents.objs.selectedProducts;null!==e.currentItem&&(e.categoryListCallback(e.currentItem.id),t.resetItems())}function p(){var e=m.dom,t=e.selectedProducts.width();e.spWidth.html(t)}var m=this;return m.box=e,m.vars.lastImageWidth=0,m.updateProductTemplateView=function(t,n){if(t){var s=e.parseProductHeader(t,n);s.hasOwnProperty("content")&&"template"==s.content?e.dataStorage.set("is_product_template",!0):e.dataStorage.set("is_product_template",!1)}var a=m.dom;e.dataStorage.get("is_product_template")?(a.productTemplateContentTextarea.show(),a.productTemplateContent.hide()):(a.productTemplateContentTextarea.hide(),a.productTemplateContent.show())},m.trimString=function(e,t,n){return trimString(e,t,n)},m.setImageSizeByWidth=function(e,t,n){return a(e,t,n)},m.setImagesOfProducts=function(e){return l(e)},m.getImagesOfProducts=function(e){return o(e)},m.setImageOfProduct=function(e,t){return c(e,t)},m.refreshProducts=function(){return u()},m.getImageTypeByWidthValue=function(e){return i(e)},m.isDynamicVar=function(e){return s(e)},m.updateProductsWidth=function(){p()},m.displayProductsWidth=function(){return t()},m.ready(function(s){function a(t){var n=s.tinyProduct,a=s.viewProductTemplate;NewsletterProComponents.objs.selectedProducts;$.each(p.items,function(e,t){t.data.selected=!1}),t.data.selected=!0,$.postAjax({submit:"getProductTemplateContent",readcontent:1,data:t.data}).done(function(r){if(r.status){"undefined"==typeof m.lastItemChangedName?(m.lastItemChangedName=t.data.filename,v.val(r.columns)):(m.lastItemChangedName!==t.data.filename?v.val(r.columns):v.val(_.data.product_tpl_nr),m.lastItemChangedName=t.data.filename),s.productTemplateContentTextarea.val(r.render),n.setContent(r.render),e.modules.selectProducts.updateProductTemplateView(r.render);try{a.html(r.render)}catch(i){}e.dataStorage.set("product_template",r.content),e.components.Product.changeTemplate(r.content),N(),h.setValue(parseInt(v.val())),_.add("product_tpl_nr",parseInt(v.val()))}else alert(r.errors.join("\n"))})}function r(){var e=p.selected;null!=e&&a(e)}function i(e){var t=$.grep(_.data.images_size,function(t){return t.name===e});return t.length?parseInt(t[0].width):!1}try{s.productTemplateContentTextarea.on("keydown",function(e){var t=e.keyCode,n=s.productTemplateContentTextarea.get(0);if(9==t)try{var a;return a=n.getCaretPosition()+"    ".length,n.value=n.value.substring(0,n.getCaretPosition())+"    "+n.value.substring(n.getCaretPosition(),n.value.length),n.setCaretPosition(a),!1}catch(r){console.warn(r)}if(8==t)try{if("    "==n.value.substring(n.getCaretPosition()-4,n.getCaretPosition())){var a;a=n.getCaretPosition()-3,n.value=n.value.substring(0,n.getCaretPosition()-3)+n.value.substring(n.getCaretPosition(),n.value.length),n.setCaretPosition(a)}}catch(r){console.warn(r)}})}catch(o){console.warn(o)}$(window).resize(function(){m.refreshSliders()});var c,p,f,h,g,v,w,b,y,S,k=NewsletterPro.translations.l(NewsletterPro.translations.modules.selectProducts),P=s.templateGrid,_=e.dataStorage;m.productSelection=new e.components.ProductSelection({}),m.updateProductTemplateView(e.dataStorage.get("product_tpl_header"),!1);var N=function(){if(e.components.Product.count()){var t=e.components.Product.first(),n=e.dataStorage.getNumber("id_selected_lang"),s=t.viewInstance.hasOwnProperty(n)?t.viewInstance[n]:!1,a=s?s.find(".newsletter-pro-name"):[],r=s?s.find(".newsletter-pro-description_short"):[],i=s?s.find(".newsletter-pro-description"):[];h.show(),g.show(),s&&s.find(".newsletter-pro-image").length>0?f.show():f.hide(),a.length>0?a.html().match(/\{\$name/i)?x.hide():x.show():x.hide(),r.length>0?r.html().match(/\{\$description_short/i)?C.hide():C.show():C.hide(),i.length>0?r.html().match(/\{\$description/i)?T.hide():T.show():T.hide(),e.objSize(t.templateHeader)&&(t.templateHeader.hasOwnProperty("displayColumns")&&(t.templateHeader.displayColumns?h.show():h.hide()),t.templateHeader.hasOwnProperty("displayImageSize")&&(t.templateHeader.displayImageSize?f.show():f.hide()),t.templateHeader.hasOwnProperty("displayProductWidth")&&(t.templateHeader.displayProductWidth?g.show():g.hide()))}else f.hide(),g.hide(),x.hide(),C.hide(),T.hide(),h.show()};m.productSelection.subscribe("add",function(e){t(),N()}),m.productSelection.subscribe("remove",function(e){var n=NewsletterProComponents.objs.productList;t(),N(),n.parseItems(function(t,n){return Number(t)==Number(e.idProduct)?(n.setToAdd(),!0):void 0})}),c=new gk.data.Model({id:"id"}),p=new gk.data.DataSource({pageSize:6,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getProductTemplates",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteProductTemplate&id",type:"POST",dateType:"json",success:function(e,t){e.status||alert(e.errors.join("\n"))},error:function(e,t){alert(k("delete template error"))},complete:function(e,t){}}},schema:{model:c},trySteps:2,errors:{read:function(e,t,n){p.syncStepAvailableAdd(3e3,function(){p.sync()})}}}),P.gkGrid({dataSource:p,selectable:!0,currentPage:1,pageable:!0,template:{info:function(e){var t=e.data.info;return t.hasOwnProperty("color")?'								<div style="background-color: '+t.color+"; padding: 5px 10px; color: "+t.display_text_color+'">'+t.for_template_name+"</div>							":""},actions:function(e){function t(e){var t=$("<div></div>");return $.each(e,function(e,n){t.append(n)}),t}var n=e.data.name.toLowerCase(),s=(e.data.filename,"");return"default"!==n&&(s=$("#delete-product-template").gkButton({title:k("delete template"),name:"delete-product-template",click:function(t){var n=e.data.selected;if(!confirm(k("confirm delete template")))return!1;if(e.destroy("status"),n){var s=p.getItemByValue("data.filename","default.html");p.setSelected(s),a(s)}},icon:'<i class="icon icon-trash-o"></i> '})),t([s])}},events:{select:function(e){a(e)}},defineSelected:function(e){return e.data.selected},done:function(){N()}}),P.addFooter(function(e){function t(t){return a=$("<tr></tr>"),o=$('<td class="form-inline gk-footer" colspan="'+e+'"></td>'),$.each(t,function(e,t){o.append(t)}),a.html(o),a}function n(e){return e.hasOwnProperty("selected")?e.selected?' selected="selected" ':"":!1}function s(e,t,s,a){var r=$('<select class="gk-select"></select>');return $.each(e,function(e,i){var o=$("<option "+("function"==typeof a?a(i):"")+' value="'+i[t]+'" '+n(i)+">"+s(i)+"</option>");r.append(o)}),r.css({width:"auto","margin-left":"6px","margin-right":"6px"}),r}var a,o,l,c,p,g,P;return y=$("<span>"+k("image size")+"</span>"),S=s(_.data.images_size,"name",function(e){return e.width+"x"+e.height+" ( "+e.name+" )"},function(e){return' data-width="'+e.width+'" data-height="'+e.height+'" '}),S.on("change",function(e){var t=$(this);val=t.val(),width=i(val),width&&(f.setValue(width),m.addVar("lastImageWidth",width)),$.postAjax({submit:"changeProductImageSize",value:val}).done(function(e){e.length?alert(e.join("\n")):(r(),u())})}),l=$("<span>"+k("language")+"</span>"),c=s(_.data.languages,"id_lang",function(e){return e.name}),c.on("change",function(e){var t=$(this);val=t.val(),d(),$.postAjax({submit:"changeProductLanguage",value:val}).done(function(e){e.length?alert(e.join("\n")):u()}).always(function(){})}),p=$("<span>"+k("currency")+"</span>"),g=s(_.data.currencies,"id_currency",function(e){return e.sign+" ( "+e.name+" ) "}),g.on("change",function(e){var t=$(this);val=t.val(),d(),$.postAjax({submit:"changeProductCurrency",value:val}).done(function(e){e.length?alert(e.join("\n")):u()}).always(function(){})}),w=$("<span>"+k("products per row")+"</span>"),v=$('<input class="form-control text-center" type="text" value="'+_.data.product_tpl_nr+'">'),v.css({width:"40px","margin-right":"6px","margin-left":"6px"}),b=$("<span></span>"),v.on("change",function(e){var t=$(this),n=parseInt(t.val());d(),n=/^\d{1}$/.test(n)?parseInt(n):3,t.val(n),$.postAjax({submit:"saveProductNumberPerRow",number:n}).done(function(e){e.status||(alert(e.errors.join("\n")),n=3,t.val(n)),_.add("product_tpl_nr",parseInt(n)),h.setValue(n),u()})}),P=$('<a href="'+_.data.new_image_size_link+'" class="btn btn-default pull-right" target="_blank"><i class="icon icon-plus-square"> </i> '+k("add image size")+"</a>"),t([y,S,l,c,p,g,w,v,b,P])},"append");var x=gkSlider({target:s.sliderName,min:0,max:250,value:250,values:[0,250],corectPosition:-5,move:function(t){n(function(){e.components.Product.setNameLenght(t.getValue())},100)},done:function(e){}}),T=gkSlider({target:s.sliderDescription,min:0,max:500,value:500,values:[0,500],corectPosition:-5,move:function(t){n(function(){e.components.Product.setDescriptionLength(t.getValue())},100)},done:function(e){}}),C=gkSlider({target:s.sliderDescriptionShort,min:0,max:250,value:250,values:[0,250],corectPosition:-5,move:function(t){n(function(){e.components.Product.setShortDescriptionLenght(t.getValue())},100)},done:function(e){}});e.components.Product.setLayout(parseInt(_.data.product_tpl_nr)),h=gkSlider({target:s.sliderProductsPerRow,min:0,max:9,value:parseInt(_.data.product_tpl_nr),values:[0,1,9],corectPosition:-2,remplaceValues:{0:k("auto")},move:function(e){},start:function(e){},done:function(n){e.components.Product.setLayout(n.getValue()),t()},onSetValue:function(n,s){e.components.Product.setLayout(s.getValue()),t()}});var I=0,E=$.map(_.data.images_size,function(e){return e.selected&&(I=parseInt(e.width)),parseInt(e.width)});f=gkSlider({target:s.sliderImageSize,snap:6,min:E.length?E[0]:0,max:E.length?E[E.length-1]:0,value:I,values:E,prefix:"px",corectPosition:-10,move:function(t){n(function(){var n=t.getValue();e.components.Product.setImageSize(n)},100)},done:function(e){l(e.getValue()),m.addVar("lastImageWidth",e.getValue())}});var j=E.length?E[0]:0,A=E.length?E[E.length-1]:0,D=860;D=A>=D-100?A+200:D;var L={0:"auto"};g=gkSlider({target:s.sliderProductsWidth,snap:6,min:0,max:D,value:0,values:[0,j,A,D],remplaceValues:L,prefix:"px",corectPosition:-10,move:function(t){n(function(){e.components.Product.setWidth(t.getValue())},100)},done:function(e){}}),m.addVar("sliderName",x),m.addVar("sliderDescription",T),m.addVar("sliderDescriptionShort",C),m.addVar("sliderProductsPerRow",h),m.addVar("sliderImageSize",f),m.addVar("sliderProductsWidth",g),m.addVar("nbProducts",v),m.addVar("templateDataSource",p)}),this},refreshSliders:function(){var e=this;e.vars.sliderName.refresh(),e.vars.sliderDescription.refresh(),e.vars.sliderDescriptionShort.refresh(),e.vars.sliderProductsPerRow.refresh(),e.vars.sliderImageSize.refresh(),e.vars.sliderProductsWidth.refresh()},ready:function(e){var t=this;$(document).ready(function(){t.dom={templateGrid:$("#product-template-list"),viewProductTemplate:$("#view-product-template-content"),productsAdjustments:$("#products-adjustments"),sliderName:$("#slider-name"),sliderDescription:$("#slider-description"),sliderDescriptionShort:$("#slider-description-short"),sliderProductsPerRow:$("#slider-products-per-row"),sliderImageSize:$("#slider-image-size"),sliderProductsWidth:$("#slider-product-width"),sliderPprLoading:$("#slider-ppr-loading"),selectedProducts:$("#selected-products"),spWidth:$("#sp-width"),viewProductsBox:$("#np-view-products-box"),productTemplateContentTextarea:$("#product-template-content-textarea"),productTemplateContent:$("#product-content-box")},NewsletterPro.onObject.setCallback("tinyProduct",function(e){t.dom.tinyProduct=e}),e(t.dom)})},addVar:function(e,t){this.vars=this.vars||{},this.vars[e]=t}}.init(NewsletterPro),NewsletterPro.namespace("modules.manageImages"),NewsletterPro.modules.manageImages={dom:null,box:null,init:function(e){function t(){var e=$.trim(a.dom.imageWidth.val());return/^\d+$/.test(e)?parseInt(e):(a.dom.imageWidth.val(""),0)}function n(){var n=a.dom,r=n.form;$.submitAjax({submit:"uploadImage",name:"uploadImage",form:r,data:{width:t()}}).done(function(t){t.status?s.sync():e.alertErrors(t.errors)})}var s,a=this;a.box=e,a.ready(function(e){var t=e.imagesGrid,a=NewsletterPro.translations.l(NewsletterPro.translations.modules.manageImages),r=new gk.data.Model({id:"id"});s=new gk.data.DataSource({pageSize:15,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getImages",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteImage&id",type:"POST",dateType:"json",success:function(e,t){e.status||alert(e.errors.join("\n"))},error:function(e,t){alert(a("delete image error"))},complete:function(e,t){}}},schema:{model:r},trySteps:2,errors:{read:function(e,t,n){s.syncStepAvailableAdd(3e3,function(){s.sync()})}}}),t.gkGrid({dataSource:s,selectable:!1,currentPage:1,pageable:!0,template:{preview:function(e){var t=e.data,n=$('<img src="'+t.thumb_link+'" style="width: 50px; height: 50px;">');return n},size:function(e,t){return t=parseInt(t),String(Math.round(t/1024))+"kb"},dimensions:function(e){var t=e.data;return t.width+"x"+t.height},actions:function(e){var t=e.data,n=t.link,s=$("<div></div>"),r=$('<a href="'+n+'" target="_blank" class="btn btn-default btn-margin pull-right"><i class="icon icon-eye"></i> <span>'+a("view image")+"</span></a>"),i=$('<a href="javascript:{}" class="btn btn-default btn-margin pull-right"><i class="icon icon-trash-o"></i> <span>'+a("delete image")+"</span></a>");return i.on("click",function(){e.destroy("status")}),s.append(r),s.append(i),s}}}),e.btnUpload.on("click",function(){n()})})},ready:function(e){var t=this;$(document).ready(function(){t.dom={imagesGrid:$("#images-list"),imagesGridBox:$("#images-grid-box"),form:$("#upload-image-form"),btnUpload:$("#upload-image"),imageWidth:$("#upload-image-width")},e(t.dom)})}}.init(NewsletterPro),NewsletterPro.namespace("modules.createTemplate"),NewsletterPro.modules.createTemplate={tinyWasInit:!1,dom:null,box:null,vars:{},tabName:"tab_newsletter_4",newsletterTemplate:null,tinySetupArray:[],initTinyCallback:function(e,t){this.tinySetupArray.push(e)},isTinyInit:function(){return this.tinyWasInit},initTiny:function(){var e=this;return this.tinyInitDfd=$.Deferred(),this.tinyWasInit=!0,setTimeout(function(){var t="Deffered was never resolved.";"function"==typeof e.tinyInitDfd.state?"resolved"!==e.tinyInitDfd.state()&&(e.tinyInitDfd.resolve(),console.warn(t)):"function"==typeof e.tinyInitDfd.isResolved&&(e.tinyInitDfd.isResolved()||(e.tinyInitDfd.resolve(),console.warn(t)))},1e4),this.tinySetupArray.length>0&&$.each(this.tinySetupArray,function(e,t){tinySetup(t)}),this.tinyInitDfd.promise()},init:function(e){function t(e,t,n,s){c.newsletterTemplate.setStyle(e,t,n,s)}function n(e,t){c.newsletterTemplate.setStyleObject(e,t)}function s(e){var t=c.newsletterTemplate.template.products;for(idLang in t)if(t[idLang].length>0)for(var n=0;n<t[idLang].length;n++)e(idLang,t[idLang][n])}function a(e){var t=c.newsletterTemplate.view.products;if(t.length>0)for(var n=0;n<t.length;n++)e(t[n])}function r(e){var t=c.newsletterTemplate.template.links;for(idLang in t)if(t[idLang].length>0)for(var n=0;n<t[idLang].length;n++){var s=$(t[idLang][n]);e(idLang,s)}}function i(e){var t=c.newsletterTemplate.view.links;if(t.length>0)for(var n=0;n<t.length;n++){var s=$(t[n]);e(s)}}function o(t){var n=t.data.filename;$.each(l.items,function(e,t){t.data.selected=!1}),t.data.selected=!0,e.dataStorage.set("configuration.NEWSLETTER_TEMPLATE",n),$.postAjax({submit_template_controller:"changeTemplate",name:n}).done(function(t){if(t.success){var n=t.html;e.modules.createTemplate.newsletterTemplate.setTemplate(n)}else e.alertErrors(t.errors)})}var l,c=this;c.vars,new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return c.box=e,c.varExists=function(e){return c.vars.hasOwnProperty(e)},c.changeTemplate=function(e){return o(e)},c.ready(function(e){function d(){return c.newsletterTemplate.isLoadTemplate()}function u(){return c.newsletterTemplate.isViewActive()}$(window).resize(function(){c.refreshSliders()});var p,m,f=NewsletterPro.translations.l(NewsletterPro.translations.modules.createTemplate),h=e.templateGrid;p=new gk.data.Model({id:"id"}),l=new gk.data.DataSource({pageSize:6,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit_template_controller=getNewsletterTemplates",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit_template_controller=deleteTemplate&id",type:"POST",dateType:"json",success:function(e,t){e.status||alert(e.errors.join("\n"))},error:function(e,t){alert(f("delete template error"))},complete:function(e,t){}}},schema:{model:p},trySteps:2,errors:{read:function(e,t,n){l.syncStepAvailableAdd(3e3,function(){l.sync()})}}}),h.gkGrid({dataSource:l,selectable:!0,currentPage:1,pageable:!0,template:{attachment:function(e){var t=e.data.attachments.length;return t>0?'<span style="font-weight: bold;">'+t+"</span>":""},actions:function(e){function t(e){var t=$("<div></div>");return $.each(e,function(e,n){t.append(n)}),t}var n=e.data.name.toLowerCase(),s=(e.data.filename,"");return"default"!==n&&(s=$("#delete-newsletter-template").gkButton({title:f("delete template"),name:"delete-newsletter-template",click:function(t){if(!confirm(f("confirm delete template")))return!1;var n=e.data.selected;if(e.destroy("status"),n){var s=l.getItemByValue("data.filename","default.html");l.setSelected(s),o(s)}},icon:'<i class="icon icon-trash-o"></i> '})),t([s])}},events:{select:function(e){o(e)}},defineSelected:function(e){return e.data.selected}}),m=gkSlider({target:e.templateWidthSlider,snap:6,min:400,max:1080,value:400,values:[400,600,640,700,760,800,860,900,1080],corectPosition:-10,remplaceValues:{400:"auto",1080:"100%"},move:function(e){var n=parseInt(e.getValue()),s=400,a=1080,r=c.newsletterTemplate.template.content;if(d()&&(s>=n?t(r,"width","auto"):n>=a?t(r,"width","100%"):t(r,"width",n)),u()){var i=c.newsletterTemplate.view;s>=n?i.content.width("auto"):n>=a?i.content.width("100%"):i.content.width(n)}},done:function(e){}}),e.templateContainerColor.on("change",function(){var e=$(this).val();d()&&(t(c.newsletterTemplate.template.container,"background-color","#"+e),n(c.newsletterTemplate.template.tinyBody,{"background-color":"#"+e})),u()&&c.newsletterTemplate.view.container.css({"background-color":"#"+e})}),e.templateContentColor.on("change",function(){var e=$(this).val();d()&&t(c.newsletterTemplate.template.content,"background-color","#"+e),u()&&c.newsletterTemplate.view.content.css({"background-color":"#"+e})}),e.productsBgColor.on("change",function(){var e=$(this).val();d()&&s(function(n,s){s.product.length>0&&t(s.product,"background-color","#"+e,n)}),u()&&a(function(t){t.product.length>0&&t.product.css({"background-color":"#"+e})})}),e.productsBorderColor.on("change",function(){var e=$(this).val();d()&&s(function(n,s){s.product.length>0&&t(s.product,"border-color","#"+e,n)}),u()&&a(function(t){t.product.length>0&&t.product.css({"border-color":"#"+e})})}),e.productsNameColor.on("change",function(){var e=$(this).val();d()&&s(function(n,s){s.name.length>0&&t(s.name,"color","#"+e,n)}),u()&&a(function(t){t.name.length>0&&t.name.css({color:"#"+e})})}),e.productsSDescriptionColor.on("change",function(){var e=$(this).val();d()&&s(function(n,s){s.description_short.length>0&&t(s.description_short,"color","#"+e,n)}),u()&&a(function(t){t.description_short.length>0&&t.description_short.css({color:"#"+e})})}),e.productsDescriptionColor.on("change",function(){var e=$(this).val();d()&&s(function(n,s){s.description.length>0&&t(s.description,"color","#"+e,n)}),u()&&a(function(e){e.description.length>0})}),e.productsPriceColor.on("change",function(){var e=$(this).val();d()&&s(function(n,s){s.price.length>0&&t(s.price,"color","#"+e,n)}),u()&&a(function(t){t.price.length>0&&t.price.css({color:"#"+e})})}),e.linksColor.on("change",function(){var e=$(this).val();d()&&r(function(n,s){t(s,"color","#"+e)}),u()&&i(function(t){t.css({color:"#"+e})})}),c.addVar("templateWidthSlider",m),c.addVar("templateDataSource",l)}),this},addVar:function(e,t){this.vars[e]=t},ready:function(e){var t=this;$(document).ready(function(){t.dom={templateGrid:$("#newsletter-template-list"),templateWidthSlider:$("#template-width-slider"),templateContainerColor:$("#template-container-color"),templateContentColor:$("#template-content-color"),sliderContainer:$("#slider-container"),tabGlobalCss:$(".tab-global-css"),productsBgColor:$("#products-bg-color"),productsNameColor:$("#products-name-color"),productsSDescriptionColor:$("#products-s-description-color"),productsDescriptionColor:$("#products-description-color"),productsPriceColor:$("#products-price-color"),linksColor:$("#links-color"),productsBorderColor:$("#products-border-color"),template:{container:null,content:null,products:[]}},t.newsletterTemplate=new NewsletterPro.components.NewsletterTemplate,e(t.dom)})},refreshSliders:function(){var e=this;e.vars.templateWidthSlider.refresh()}}.init(NewsletterPro),NewsletterPro.namespace("components.NewsletterTemplate"),NewsletterPro.components.NewsletterTemplate=function c(e){if(!(this instanceof c))return new c(e);var t=this,n=NewsletterPro,s=n.dataStorage.get("all_languages").length;n.extendSubscribeFeature(this),this.l=NewsletterPro.translations.l(n.translations.components.NewsletterTemplate),this.cfg=e,this.createTemplate=n.modules.createTemplate,this.dom={},this.tiny=[],this.tinyLangIndex=[],this.viewTabActive=!1,this.view={},this.view.products=[],this.template={container:null,content:null,products:{}},this.triggerTitleChange=!0,n.onObject.setCallback("tinyNewsletter",function(e){t.add(e),t.tiny.length==s&&$(document).ready(function(){t.createTemplate.tinyInitDfd.resolve(),t.dom={viewNewsletterTemplate:$("#view-newsletter-template-content"),saveTemplate:$("#save-newsletter-template"),saveAsTemplate:$("#save-as-newsletter-template"),exportHTML:$("#export-html"),inputImportHTML:$("#inputImportHTML"),inputImportHTMLForm:$("#inputImportHTMLForm"),templateStyle:$("#template-css-style"),templateGlobalStyle:$("#template-css"),templateTitle:$('[id^="page-title-"]'),templateHeader:$('[id^="template-header-"]'),templateFooter:$('[id^="template-footer-"]'),saveMessage:$("#save-newsletter-template-message"),langSelect:$("#newsletter-template-lang-select"),
pageTitleMessage:$("#page-title-message"),vewInBrowser:$("#np-view-newsletter-template-in-browser"),color:{templateContainerColorObj:new jscolor.color(document.getElementById("template-container-color")),templateContentColorObj:new jscolor.color(document.getElementById("template-content-color")),productsBgColorObj:new jscolor.color(document.getElementById("products-bg-color")),productsNameColorObj:new jscolor.color(document.getElementById("products-name-color")),productsSDescriptionColorObj:new jscolor.color(document.getElementById("products-s-description-color")),productsDescriptionColorObj:new jscolor.color(document.getElementById("products-description-color")),productsPriceColorObj:new jscolor.color(document.getElementById("products-price-color")),linksColorObj:new jscolor.color(document.getElementById("links-color")),productsBorderColorObj:new jscolor.color(document.getElementById("products-border-color"))}},t.ready(t.dom)})})},NewsletterPro.components.NewsletterTemplate.prototype.add=function(e){var t=parseInt(e.id.match(/\d+$/));this.tiny.push({id:e.id,idLang:t,ed:e}),this.tinyLangIndex.push(t)},NewsletterPro.components.NewsletterTemplate.prototype.ready=function(e){var t=this,n=NewsletterPro;n.components.LanguageSelect.getInstanceById("#newsletter-template-lang-select");try{t.updateTemplate()}catch(s){}t.parseTiny(function(e,s,a){n.isTinyHigherVersion()?a.on("change",function(e,n){t.updateBoth()}):a.onChange.add(function(e,n){t.updateBoth()})});try{var a=[e.templateStyle,e.templateGlobalStyle,e.templateHeader,e.templateFooter];$.each(a,function(e,t){t.on("keydown",function(e){var n=e.keyCode,s=t.get(0);if(9==n)try{var a;return a=s.getCaretPosition()+"    ".length,s.value=s.value.substring(0,s.getCaretPosition())+"    "+s.value.substring(s.getCaretPosition(),s.value.length),s.setCaretPosition(a),!1}catch(r){console.warn(r)}if(8==n)try{if("    "==s.value.substring(s.getCaretPosition()-4,s.getCaretPosition())){var a;a=s.getCaretPosition()-3,s.value=s.value.substring(0,s.getCaretPosition()-3)+s.value.substring(s.getCaretPosition(),s.value.length),s.setCaretPosition(a)}}catch(r){console.warn(r)}})})}catch(r){console.warn(r)}n.components.LanguageSelect.updateLanguages(),this.subscribe("save",function(e){}),this.subscribe("afterSave",function(e){});var i=function(e){return e=e||NewsletterPro.dataStorage.get("id_selected_lang"),n.getUrl({submit_template_controller:"viewTemplate",name:n.dataStorage.get("configuration.NEWSLETTER_TEMPLATE"),id_lang:e})};e.vewInBrowser.on("click",function(){event.preventDefault(),$(this).attr("href",i()),window.open($(this).attr("href"),"_blank")}),NewsletterProComponents.objs.tabNewsletterTemplate.subscribe("change",function(e){var n=e.attr("id");"tab_newsletter-template_1"===n?(t.viewTabActive=!0,t.saveWriteView()):"tab_newsletter-template_0"===n&&t.tinyRefresh(),"tab_newsletter-template_5"===n||"tab_newsletter-template_2"===n?t.dom.langSelect.hide():t.dom.langSelect.show(),"tab_newsletter-template_1"!==n&&(t.viewTabActive=!1)}),n.dataStorage.on("change","id_selected_lang",function(e){t.viewTabActive&&t.render()}),e.saveTemplate.on("click",function(){var e=$(this);n.showAjaxLoader(e),t.saveTemplate().always(function(){n.hideAjaxLoader(e)})}),e.saveAsTemplate.on("click",function(){var e=prompt(t.l("Enter the template name."));if(""==e||null==e)return!1;var s=$(this);n.showAjaxLoader(s),t.saveTemplate(e).always(function(){$.postAjax({submit_template_controller:"getNewsletterTemplates"}).done(function(e){n.dataStorage.set("templates",e)}),n.hideAjaxLoader(s)})}),e.templateTitle.on("change",function(e){var n=$(e.currentTarget),s=n.val(),a=Number(n.data("lang")),r=t.getHeaderByIdLang(a),i=r.val(),o=i.replace(/<\s*?(title)\s*?.*?>(.*?)<\s*?\/\s*?\1\s*?>/,"<title>"+s+"</title>");r.val(o)}),e.templateTitle.on("blur",function(){if(!t.triggerTitleChange)return!1;var s=$(this),a=s.val(),r=Number(s.data("lang"));$.postAjax({submit_template_controller:"saveNewsletterPageTitle",saveNewsletterPageTitle:a,id_lang:r}).done(function(t){t.success?e.pageTitleMessage.empty().show().append('					<span class="list-action-enable action-enabled">						<i class="icon-check"></i>					</span>				'):n.alertErrors(t.errors),setTimeout(function(){e.pageTitleMessage.hide()},5e3)})}),e.templateHeader.on("blur",function(){t.saveTemplate().done(function(e){t.setTitle(e.html),t.refreshStyle()})}),e.templateFooter.on("blur",function(){t.saveTemplate().done(function(e){})}),e.templateStyle.on("blur",function(){t.saveTemplate().done(function(e){t.refreshStyle()})}),e.templateGlobalStyle.on("blur",function(){t.saveTemplate().done(function(e){t.refreshStyle()})}),e.exportHTML.on("click",function(){event.preventDefault();var e=$(this),n=e.attr("href"),s=confirm(t.l("Do you want to render the template variables?"));s&&(n=n.replace(/exportHTML(=\w+)?/,"exportHTML&renderView"),e.attr("href",n)),t.saveTemplate().done(function(e){window.location.href=n})}),e.inputImportHTML.on("change",function(){""!=$.trim(e.inputImportHTML.val())&&$.submitAjax({submit_template_controller:"inputImportHTML",form:e.inputImportHTMLForm}).done(function(e){e.success?t.createTemplate.vars.templateDataSource.sync(function(n){var s=n.getItemByValue("data.filename",e.name);s&&(n.setSelected(s),t.createTemplate.changeTemplate(s))}):n.alertErrors(e.errors)})})},NewsletterPro.components.NewsletterTemplate.prototype.refreshStyle=function(e){this.parseTiny(function(e,t,n){n.refreshStyle()})},NewsletterPro.components.NewsletterTemplate.prototype.setTitle=function(e){for(var t in e){this.triggerTitleChange=!1;var n=this.getTitleByIdLang(t);n.val(e[t].title),this.triggerTitleChange=!0}},NewsletterPro.components.NewsletterTemplate.prototype.setTinyContent=function(e){for(var t in e){var n=this.getTinyByIdLang(t);n&&n.setContent(e[t].body)}},NewsletterPro.components.NewsletterTemplate.prototype.saveTemplate=function(e){var t,n,s=this,a=NewsletterPro,r=this.dom,i=s.stripComments(r.templateStyle.val()),o=s.stripComments(r.templateGlobalStyle.val());"undefined"!=typeof e?(n="saveAsNewsletterTemplate",t=e):(n="saveNewsletterTemplate",t=a.dataStorage.get("configuration.NEWSLETTER_TEMPLATE"));var l=s.buildContent();return this.publish("save",{saveAs:"saveAsNewsletterTemplate"==n,action:n,templateName:t,content:l,css:i,cssGlobal:o}),$.postAjax({submit_template_controller:n,name:t,content:l,css:i,css_global:o}).done(function(e){e.success?("saveAsNewsletterTemplate"===n&&s.createTemplate.vars.templateDataSource.sync(function(t){var n=t.getItemByValue("data.filename",e.template_name);t.setSelected(n),s.createTemplate.changeTemplate(n)}),r.saveMessage.show().html('<p class="np-success-message">'+e.message+"</p>"),setTimeout(function(){r.saveMessage.hide()},5e3)):a.alertErrors(e.errors),s.publish("afterSave",{status:!0,response:e})}).fail(function(e){s.publish("afterSave",{status:!1,response:e})}).promise()},NewsletterPro.components.NewsletterTemplate.prototype.buildContent=function(){var e=this,t=(this.dom,{});return this.parseTiny(function(n,s,a){t[s]={title:e.getTitleByIdLang(s).val(),body:a.getContent(),header:e.stripComments(e.getHeaderByIdLang(s).val()),footer:e.getFooterByIdLang(s).val()}}),t},NewsletterPro.components.NewsletterTemplate.prototype.setTemplate=function(e){var t=this,n=NewsletterPro,s=this.dom,a=e.title,r=e.header,i=e.body,o=e.footer,l=e.css_file,c=e.css_global_file,d=e.css_link,u=n.dataStorage.getNumber("id_selected_lang");this.parseTiny(function(e,t,n){i.hasOwnProperty(t)&&(n.setContent(i[t]),d.hasOwnProperty(t)&&n.refreshStyle(d[t]))}),this.parseTitle(function(e,t,n){a.hasOwnProperty(t)&&n.val(a[t])}),this.parseHeader(function(e,t,n){r.hasOwnProperty(t)&&n.val(r[t])}),this.parseFooter(function(e,t,n){o.hasOwnProperty(t)&&n.val(o[t])}),l.hasOwnProperty(u)&&s.templateStyle.val(l[u]),c.hasOwnProperty(u)&&s.templateGlobalStyle.val(c[u]),t.isViewActive&&t.render(),t.updateBoth()},NewsletterPro.components.NewsletterTemplate.prototype.getTitleByIdLang=function(e){return $(this.dom.templateTitle.filter(function(t,n){return Number($(n).data("lang"))==Number(e)})[0])},NewsletterPro.components.NewsletterTemplate.prototype.getHeaderByIdLang=function(e){return $(this.dom.templateHeader.filter(function(t,n){return Number($(n).data("lang"))==Number(e)})[0])},NewsletterPro.components.NewsletterTemplate.prototype.getFooterByIdLang=function(e){return $(this.dom.templateFooter.filter(function(t,n){return Number($(n).data("lang"))==Number(e)})[0])},NewsletterPro.components.NewsletterTemplate.prototype.parseTitle=function(e){$.each(this.dom.templateTitle,function(t,n){n=$(n);var s=Number(n.data("lang"));e(t,s,n)})},NewsletterPro.components.NewsletterTemplate.prototype.parseHeader=function(e){$.each(this.dom.templateHeader,function(t,n){n=$(n);var s=Number(n.data("lang"));e(t,s,n)})},NewsletterPro.components.NewsletterTemplate.prototype.parseFooter=function(e){$.each(this.dom.templateFooter,function(t,n){n=$(n);var s=Number(n.data("lang"));e(t,s,n)})},NewsletterPro.components.NewsletterTemplate.prototype.parseTiny=function(e){for(var t=0;t<this.tiny.length;t++){var n=this.tiny[t],s=n.ed,a=n.id,r=Number(n.idLang),i=e(a,r,s);if("undefined"!=typeof i)return i}},NewsletterPro.components.NewsletterTemplate.prototype.getTinyByIdLang=function(e){var t=this.tinyLangIndex.indexOf(Number(e));return-1!=t?this.tiny[t].ed:void 0},NewsletterPro.components.NewsletterTemplate.prototype.stripComments=function(e){return e.replace(/\/\*[\s\S]*?\*\//,"")},NewsletterPro.components.NewsletterTemplate.prototype.tinyRefresh=function(){this.parseTiny(function(e,t,n){$.browser.hasOwnProperty("mozilla")&&n.setContent(n.getContent())})},NewsletterPro.components.NewsletterTemplate.prototype.saveWriteView=function(){var e=this;this.saveTemplate().done(function(t){t.success&&e.render()})},NewsletterPro.components.NewsletterTemplate.prototype.render=function(){var e=NewsletterPro,t=this,n=e.dataStorage.getNumber("id_selected_lang"),s=e.dataStorage.get("configuration.NEWSLETTER_TEMPLATE");$.postAjax({submit_template_controller:"renderTemplate",name:s,id_lang:n}).done(function(n){n.success?t.writeView(n.render):(e.displayAlert(n.errors),t.writeView(""))}).promise()},NewsletterPro.components.NewsletterTemplate.prototype.writeView=function(e){var t=this;if(this.getView().length>0){var n=this.getView().get(0);n.innerHTML=e,setTimeout(function(){t.resizeView(),t.updateBoth()},50)}},NewsletterPro.components.NewsletterTemplate.prototype.resizeView=function(){if(this.getView().length>0){var e=this.getView().find("body");if(e.length>0){var t=this.dom.viewNewsletterTemplate.get(0);t.height="",t.height=t.contentWindow.document.body.scrollHeight+"px"}}},NewsletterPro.components.NewsletterTemplate.prototype.getView=function(){return this.dom.viewNewsletterTemplate.contents().find("html")},NewsletterPro.components.NewsletterTemplate.prototype.updateBoth=function(){this.updateView(),this.updateTemplate()},NewsletterPro.components.NewsletterTemplate.prototype.updateView=function(){var e=this.view;e.container=this.getView().find(".newsletter-pro-container"),e.content=e.container.find(".newsletter-pro-content"),e.links=e.container.find("a");var t=e.container.find(".newsletter-pro-product");if(e.products=[],t.length>0)for(var n=0;n<t.length;n++){var s=$(t[n]),a=s.find(".newsletter-pro-name"),r=s.find(".newsletter-pro-description"),i=s.find(".newsletter-pro-description_short"),o=s.find(".newsletter-pro-price"),l={product:s,name:a,description:r,description_short:i,price:o};e.products.push(l)}},NewsletterPro.components.NewsletterTemplate.prototype.updateTemplate=function(){var e=this,t=NewsletterPro,n=this.template,s=t.dataStorage.getNumber("id_selected_lang"),a=this.createTemplate,r=this.createTemplate.vars,i=this.createTemplate.dom,o=e.dom,l=NewsletterProComponents.objs.tabNewsletterTemplate;n.tinyBody=this.tinySelect("body"),n.container=this.tinySelect(".newsletter-pro-container"),n.content=this.tinySelect(".newsletter-pro-content"),n.links=this.tinySelect("a");var c=this.tinySelect(".newsletter-pro-product");n.products={};for(var d in c)if(c[d].length>0){for(var u=[],p=0;p<c[d].length;p++){var m=$(c[d][p]),f=m.find(".newsletter-pro-name"),h=m.find(".newsletter-pro-description"),g=m.find(".newsletter-pro-description_short"),v=m.find(".newsletter-pro-price"),w={product:m,name:f,description:h,description_short:g,price:v};u.push(w)}n.products[d]=u}if(a.varExists("templateWidthSlider")){var b=n.content[s].innerWidth();r.templateWidthSlider.setValue(b)}var y=n.container[s].css("background-color");/rgb/i.test(y)&&(y=e.rgb2hex(y)),i.templateContainerColor.val(y),e.setStyleObject(n.tinyBody,{"background-color":"#"+y}),n.container[s].length>0?(o.color.templateContainerColorObj.importColor(),i.templateContainerColor.parent().show()):i.templateContainerColor.parent().hide();var S=n.content[s].css("background-color");/rgb/i.test(S)&&(S=e.rgb2hex(S)),i.templateContentColor.val(S),n.content[s].length>0?(o.color.templateContentColorObj.importColor(),i.templateContentColor.parent().show(),i.sliderContainer.show(),i.tabGlobalCss.show()):(i.tabGlobalCss.hide(),null!==l.lastItem&&"undefined"!=typeof l.lastItem&&"tab_newsletter-template_2"===l.lastItem.attr("id")&&l.buttons[0].click(),i.sliderContainer.hide(),i.templateContentColor.parent().hide());var c=n.products;if(c.hasOwnProperty(s)&&c[s].length>0){var m=c[s][0].product;if(m.length>0){var k=m.css("background-color");/rgb/i.test(k)&&(k=e.rgb2hex(k)),i.productsBgColor.val(k),i.productsBgColor.parent().show();var P=m.css("border-width");if(/^[1-9]+/.test(P)){var k=m.css("border-color");/rgb/i.test(k)&&(k=e.rgb2hex(k)),i.productsBorderColor.parent().show(),i.productsBorderColor.val(k)}else i.productsBorderColor.parent().hide()}else i.productsBgColor.parent().hide(),i.productsBorderColor.parent().hide();var f=c[s][0].name;if(f.length>0){var k=f.css("color");/rgb/i.test(k)&&(k=e.rgb2hex(k)),i.productsNameColor.val(k),i.productsNameColor.parent().show()}else i.productsNameColor.parent().hide();var g=c[s][0].description_short;if(g.length>0){var k=g.css("color");/rgb/i.test(k)&&(k=e.rgb2hex(k)),i.productsSDescriptionColor.val(k),i.productsSDescriptionColor.parent().show()}else i.productsSDescriptionColor.parent().hide();var h=c[s][0].description;if(h.length>0){var k=h.css("color");/rgb/i.test(k)&&(k=e.rgb2hex(k)),i.productsDescriptionColor.val(k),i.productsDescriptionColor.parent().show()}else i.productsDescriptionColor.parent().hide();var v=c[s][0].price;if(v.length>0){var k=v.css("color");/rgb/i.test(k)&&(k=e.rgb2hex(k)),i.productsPriceColor.val(k),i.productsPriceColor.parent().show()}else i.productsPriceColor.parent().hide()}else i.productsBgColor.val("FFFFFF"),i.productsBgColor.parent().hide(),i.productsBorderColor.val("FFFFFF"),i.productsBorderColor.parent().hide(),i.productsNameColor.val("FFFFFF"),i.productsNameColor.parent().hide(),i.productsSDescriptionColor.val("FFFFFF"),i.productsSDescriptionColor.parent().hide(),i.productsDescriptionColor.val("FFFFFF"),i.productsDescriptionColor.parent().hide(),i.productsPriceColor.val("FFFFFF"),i.productsPriceColor.parent().hide();o.color.productsBgColorObj.importColor(),o.color.productsBorderColorObj.importColor(),o.color.productsNameColorObj.importColor(),o.color.productsSDescriptionColorObj.importColor(),o.color.productsDescriptionColorObj.importColor(),o.color.productsPriceColorObj.importColor(),i.linksColor.val("FFFFFF"),n.links[s].length>0?i.linksColor.parent().show():i.linksColor.parent().hide(),o.color.linksColorObj.importColor(),a.refreshSliders()},NewsletterPro.components.NewsletterTemplate.prototype.tinySelect=function(e,t){var n=!1;if("undefined"==typeof t)n={},this.parseTiny(function(t,s,a){n[s]=$(a.dom.select(e))});else{var s=this.getTinyByIdLang(t);n=$(s.dom.select(e))}return n},NewsletterPro.components.NewsletterTemplate.prototype.setStyle=function(e,t,n,s){if("undefined"!=typeof s){var a=this.getTinyByIdLang(s);a&&a.dom.setStyle(e,t,n)}else for(var r in e){var a=this.getTinyByIdLang(r);a&&a.dom.setStyle(e[r],t,n)}},NewsletterPro.components.NewsletterTemplate.prototype.setStyleObject=function(e,t){for(var n in e)e[n].css(t)},NewsletterPro.components.NewsletterTemplate.prototype.isViewActive=function(){return this.view.hasOwnProperty("container")},NewsletterPro.components.NewsletterTemplate.prototype.isLoadTemplate=function(){return"undefined"!=typeof this.template.container&&null!==this.template.container},NewsletterPro.components.NewsletterTemplate.prototype.rgb2hex=function(e){return e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),null!=e?("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):void 0},NewsletterPro.namespace("modules.sendNewsletters"),NewsletterPro.modules.sendNewsletters={domSave:null,dom:null,box:null,vars:{},events:{},init:function(e){var t=this;return t.box=e,t.initCustomersGrid(),t.initVisitorsGrid(),t.initVisitorsGridNewsletterPro(),t.initAddedGrid(),this.ready(function(n){function s(){var t=Number(e.dataStorage.get("count_send_connections")),n=1;return isNaN(t)?n:0==t?n:t}function a(){var t=e.dataStorage,a=e.define,r=s(),i="",o="",l=t.getNumber("configuration.SEND_ANTIFLOOD_EMAILS"),c=t.getNumber("configuration.SEND_ANTIFLOOD_SLEEP"),d=t.getNumber("configuration.SEND_THROTTLER_LIMIT");if("undefined"!=typeof w&&w){var u=w.find("#np-send-antiflood-info"),p=w.find("#np-send-throttler-info");if(t.getNumber("count_send_connections")>0){var m=v("With #s connections send #s emails, and pause #s seconds.").replace(/\#s/,r).replace(/\#s/,l*r).replace(/\#s/,c),f=v("With #s connections limit #s emails per minute.").replace(/\#s/,r).replace(/\#s/,d*r);u.show().find("span").html(m),p.show().find("span").html(f)}else u.hide(),p.hide()}if(t.getNumber("configuration.SEND_METHOD")==a.SEND_METHOD_DEFAULT)o=v("Send one newsletter at #s seconds - (for all connections).").replace(/\#s/,t.getNumber("configuration.SLEEP"));else{var h=v("(Antiflood) Send #s emails, and pause #s seconds.").replace(/\#s/,l*r).replace(/\#s/,c),g=v(t.getNumber("configuration.SEND_THROTTLER_TYPE")==a.SEND_THROTTLER_TYPE_EMAILS?"(Speed limits) Limit  #s emails per minute.":"(Speed limits) Limit  #s MB per minute.").replace(/\#s/,d*r);o=t.getNumber("configuration.SEND_ANTIFLOOD_ACTIVE")&&t.getNumber("configuration.SEND_THROTTLER_ACTIVE")?h+" / "+g:t.getNumber("configuration.SEND_ANTIFLOOD_ACTIVE")?h:t.getNumber("configuration.SEND_THROTTLER_ACTIVE")?g:v("No send method was selected.")}return i='<label class="control-label">'+o+'</label>							<span style="display: block; font-style: italic;">('+v("#s connections").replace(/\#s/,r)+")</span>",n.sendMethodDisplay.html(i),o}function r(e,t){"undefined"!=typeof e&&(e.uncheckAll(),t.data("checked",!1),t.changeTitle(v("check all")))}var i,o,l,c,d,u,p,m,f,h,g,v=NewsletterPro.translations.l(NewsletterPro.translations.modules.sendNewsletters);e.dataStorage.on("change","count_send_connections",function(e){a()}),i=new gkWindow({width:640,height:540,title:v("exclusion emails"),className:"exclusion-window",show:function(e){"undefined"!=typeof c&&c.sync()},close:function(e){},content:function(s){var a=$('						<div id="exclusion-email-box">							<div class="form-group clearfix">								<div class="col-sm-4">									<label for="input-exclude-emails" class="control-label"><span class="label-tooltip">'+v("import from csv file")+'</span></label>								</div>								<div class="col-sm-8">									<form id="form-exclusion-emails" method="post" enctype="multipart/form-data">										<div class="input-group">											<span class="input-group-addon">'+v("File")+'</span>											<input type="file" name="exclusion_emails_emails" class="form-control">											<span class="input-group-addon">'+v("Separator")+'</span>											<input type="text" name="exclusion_emails_csv_separator" class="form-control text-center" value=";" style="width: 35px;">											<div class="clear"></div>										</div>									</form>								</div>								<div class="col-sm-8 col-sm-offset-4">									<a id="btn-add-exclusion-csv" class="btn btn-default pull-left" href="javascript:{}"><span class="btn-ajax-loader"></span><i class="icon icon-plus-square"></i> '+v("add to exclusion")+'</a>								</div>							</div>							<div style="margin-top: 10px;">								<h4>'+v("select emails from history")+'</h4>								<table id="exclusion-email-send-history" class="table table-bordered exclusion-email-send-history">									<thead>										<tr>											<th class="np-checkbox" data-template="checkbox">&nbsp;</th>											<th class="template" data-field="template">'+v("template name")+'</th>											<th class="date" data-field="date">'+v("template date")+'</th>											<th class="emails-count" data-field="emails_count">'+v("total emails")+'</th>											<th class="emails-success" data-field="emails_success">'+v("sent success")+'</th>											<th class="emails-error" data-field="emails_error">'+v("sent errors")+'</th>											<th class="type" data-template="type">'+v("type")+"</th>										</tr>										</thead>								</table>							</div>						<div>					"),r=a.find("#exclusion-email-send-history");r.length&&(l=new gk.data.Model({id:"id_newsletter_pro_tpl_history"}),c=new gk.data.DataSource({pageSize:7,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getHistoryExclusion",dataType:"json"}},schema:{model:l},trySteps:2,errors:{read:function(e,t,n){c.syncStepAvailableAdd(3e3,function(){c.sync()})}}}),r.gkGrid({dataSource:c,checkable:!0,selectable:!1,currentPage:1,pageable:!0,template:{actions:function(e,t){},checkbox:function(e,t){var n=$('<input type="checkbox" value="'+t+'" '+(e.isChecked()?'checked="checked"':"")+"> ");return n},emails_count:function(e,t){return'<span style="font-weight: bold;">'+t+"</span>"},emails_success:function(e,t){return'<span style="color: green; font-weight: bold;">'+t+"</span>"},emails_error:function(e,t){return'<span style="color: red; font-weight: bold;">'+t+"</span>"},type:function(e,t){return e.data.type}}}),r.addFooter(function(s){var a=t.createCheckToggle("btn-exclusion-checkall",c);a.addClass("pull-left");var i=$('								<div class="clearfix pull-left" style="margin-left: 4px;">									<input id="exclusion-remaingin-emails" class="valign-middle pull-left" type="checkbox" style="margin-left: 8px; margin-top: 9px; margin-right: 5px;">									<label for="exclusion-remaingin-emails" class="control-label valign-middle pull-left">'+v("remaining email")+'</label>									<input id="exclusion-sent-emails" class="align-middle pull-left" type="checkbox" checked="checked" style="margin-left: 8px; margin-top: 9px; margin-right: 5px;">									<label for="exclusion-sent-emails" class="control-label valign-middle pull-left">'+v("sent email")+"</label>								</div>							"),o=$('<a href="javascript:{}" class="btn btn-default pull-right"><span class="btn-ajax-loader"></span><i class="icon icon-plus-square"></i> '+v("add to exclusion")+"</a>");return o.on("click",function(){var t=c.getSelection(),s=[];if(t.length>0)for(var a in t){var r=t[a].data,i=r.type,l=r.hasOwnProperty("id_newsletter_pro_send")?r.id_newsletter_pro_send:r.id_newsletter_pro_task;s.push({id:l,type:i})}var d=$("#exclusion-remaingin-emails").is(":checked")?1:0,u=$("#exclusion-sent-emails").is(":checked")?1:0;e.showAjaxLoader(o),$.postAjax({submit:"addHistoryEmailsToExclusion",data:s,remainingEmails:d,sentEmails:u}).done(function(t){e.hideAjaxLoader(o),t.success?(n.exclusionEmailsCount.html(t.count),alert(e.displayAlert(t.msg))):e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(o)})}),r.makeRow([a,i,o])},"prepend"));var i=a.find("#btn-add-exclusion-csv");return i.on("click",function(){e.showAjaxLoader(i),$.submitAjax({submit:"addCsvEmailsToExclusion",name:"addCsvEmailsToExclusion",form:$("#form-exclusion-emails")}).done(function(t){e.hideAjaxLoader(i),t.success?(n.exclusionEmailsCount.html(t.count),alert(e.displayAlert(t.msg))):e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(i)})}),o=a}});var w;d=new gkWindow({width:640,height:475,title:v("Performances & Limits"),className:"performances-window",setScrollContent:415,show:function(n){"undefined"!=typeof m&&m.sync(function(){e.dataStorage.set("count_send_connections",this.count())});var s=e.modules.smtp.ui.components.smptSelect;if("undefined"!=typeof s&&"undefined"!=typeof h){var a=s.getData(),r=t.getSelectOptions(a);h.refresh(r)}},close:function(e){},content:function(n){var r=e.dataStorage,i=function(t){return t=t||r.getNumber("configuration.SEND_THROTTLER_TYPE"),t==e.define.SEND_THROTTLER_TYPE_EMAILS?v("emails"):"MB"},o=function(t){return t=t||r.getNumber("configuration.SEND_THROTTLER_TYPE"),"("+v(t==e.define.SEND_THROTTLER_TYPE_EMAILS?"change limit to MB":"change limit to emails")+")"},l=w=$('						<div id="np-performances-window-content" class="np-performances-window-content">							<h4>'+v("Define the sending performances and limits.")+'</h4>							<div class="np-send-method-sleep">								<input id="np-radio-send-method-sleep" name="SEND_METHOD" value="'+e.define.SEND_METHOD_DEFAULT+'" type="radio" '+(r.getNumber("configuration.SEND_METHOD")==e.define.SEND_METHOD_DEFAULT?' checked="checked" ':"")+'>								<span data-for="np-radio-send-method-sleep">'+v("Send one newsletter at")+'</span> 								<input id="np-send-method-sleep-input" class="gk-input" type="number" min="0" max="60" value="'+r.get("configuration.SLEEP")+'"> 								<span data-for="np-radio-send-method-sleep">'+v("seconds")+'</span>								<span style="display: inline-block; margin-bottom: 5px; font-style: italic;">('+v("for all connections")+')</span>							</div>							<div class="np-send-method-antiflod">								<input id="np-radio-send-method-antiflood" class="np-radio-send-method-antiflood" name="SEND_METHOD" value="'+e.define.SEND_METHOD_ANTIFLOOD+'" type="radio" '+(r.getNumber("configuration.SEND_METHOD")==e.define.SEND_METHOD_ANTIFLOOD?' checked="checked" ':"")+'> 								<span data-for="np-radio-send-method-antiflood">'+v("Antiflood & Speed limits")+'</span>								<span style="display: inline-block; margin-bottom: 5px; font-style: italic;">('+v("for each connection")+')</span>								<div class="np-send-method-antiflod-settings">									<div class="np-send-method-antiflod-row">										<input id="np-send-antifllod-active" name="SEND_ANTIFLOOD_ACTIVE" type="checkbox" '+(r.getNumber("configuration.SEND_ANTIFLOOD_ACTIVE")?' checked="checked" ':"")+'> 										<span data-for="np-send-antifllod-active">'+v("Reconnect after")+'</span> 										<input id="np-send-antiflood-emails"class="gk-input" type="number" min="1" max="100" value="'+r.get("configuration.SEND_ANTIFLOOD_EMAILS")+'"> 										<span data-for="np-send-antifllod-active">'+v("emails sent, and pause")+'</span> 										<input id="np-send-antiflood-sleep" class="gk-input" type="number" min="0" max="60" value="'+r.get("configuration.SEND_ANTIFLOOD_SLEEP")+'"> 										<span>'+v("seconds")+'</span>										<div id="np-send-antiflood-info" style="display: none; margin-left: 22px; margin-bottom: 5px;">											<br>											<span style="display: inline-block; font-style: italic;"></span>										</div>									</div>									<div class="np-send-method-antiflod-row">										<input id="np-send-throttler-active" name="SEND_THROTTLER_ACTIVE" type="checkbox" '+(r.getNumber("configuration.SEND_THROTTLER_ACTIVE")?' checked="checked" ':"")+'> 										<span data-for="np-send-throttler-active">'+v("Limit")+'</span> 										<input id="np-send-throttler-limit" class="gk-input" type="number" min="1" max="5000" value="'+r.getNumber("configuration.SEND_THROTTLER_LIMIT")+'"> 										<span id="np-send-throttler-type-text" data-for="np-send-throttler-active">'+i()+'</span> 										<span data-for="np-send-throttler-active">'+v("per minute")+'</span> 										<a id="np-send-throttler-changetype" class="np-send-throttler-changetype" href="javascript:{}">'+o()+'</a>										<div id="np-send-throttler-info" style="display:none; margin-left: 22px; margin-bottom: 5px;">											<br>											<span style="display: inline-block; font-style: italic;"></span>										</div>									</div>								</div>							</div>							<div style="margin-top: 20px;">								<h4 for="input-exclude-emails" class="label-spacing" style="margin-bottom: 0;">'+v("Add or remove connections")+'</h4>								<span style="color: red; font-style: italic;">'+v("Don't add to many connections from the same server. You will risk to be banned.")+'</span>								<span style="display: inline-block; margin-bottom: 5px; font-style: italic;">'+v("Leave the table empty if you want to have a single connection with the default configuration")+'</span>								<table id="np-send-connection" class="table table-bordered np-send-connection">									<thead>										<tr>											<th class="name" data-field="name">'+v("Connection Name")+'</th>											<th class="connection-type" data-field="connection_type">'+v("Connection Type")+'</th>											<th class="connection-test" data-template="connection_test">'+v("Test Connection")+'</th>											<th class="actions" data-template="actions">'+v("Actions")+'</th>										</tr>									</thead>								</table>							</div>							<div class="form-group clearfix" style="margin-top: 10px;">								<label class="control-label col-sm-3"><span class="label-tooltip">'+v("Backend limit")+'</span></label>								<div class="col-sm-9">									<input id="np-send-backend-limit" type="number" class="form-control fixed-width-xs" value="'+e.dataStorage.get("configuration.SEND_LIMIT_END_SCRIPT")+'" min="3" max="100">								<div>								<p class="help-block">'+v("Decrease this number if the newsletter stops from the sending process, and it's not continue.")+"</p>							</div>						</div>					"),c=l.find("[data-for]");c.css("cursor","default"),c.on("click",function(e){var t=$(e.currentTarget),n=t.data("for"),s=$("#"+n);s.length&&s.trigger("click")});var d=/^\d+$/;l.find("#np-send-backend-limit").on("change",function(){var t=Number($(this).val());isNaN(t)&&(t=e.dataStorage.getNumber("configuration.SEND_LIMIT_END_SCRIPT")),t>=100?t=100:3>=t&&(t=3),$(this).val(t),e.dataStorage.set("configuration.SEND_LIMIT_END_SCRIPT",t),$.updateConfiguration("SEND_LIMIT_END_SCRIPT",t).done(function(t){t.success||e.alertErrors(t.errors)})}),l.find("#np-send-throttler-changetype").on("click",function(){var t=r.getNumber("configuration.SEND_THROTTLER_TYPE"),n=t?0:1,s=$(this);l.find("#np-send-throttler-type-text").html(i(n)),s.html(o(n)),$.updateConfiguration("SEND_THROTTLER_TYPE",n).done(function(t){t.success?r.set("configuration.SEND_THROTTLER_TYPE",n):e.alertErrors(t.errors)}).always(function(){l.find("#np-send-throttler-type-text").html(i()),s.html(o()),a()})}),l.find('[name="SEND_METHOD"]').on("change",function(){var t=$(this),n=t.val();$.updateConfiguration("SEND_METHOD",n).done(function(t){t.success?r.set("configuration.SEND_METHOD",n):e.alertErrors(t.errors)}).always(function(){a()})}),l.find("#np-send-method-sleep-input").on("blur",function(){var t=$(this),n=t.val();return null===String(n).match(d)||0>n||n>100?void t.val(r.get("configuration.SLEEP")):void $.updateConfiguration("SLEEP",n).done(function(t){t.success?r.set("configuration.SLEEP",n):e.alertErrors(t.errors)}).always(function(){a()})}),l.find("#np-send-throttler-limit").on("blur",function(){var t=$(this),n=t.val();return null===String(n).match(d)||1>n||n>5e3?void t.val(r.get("configuration.SEND_THROTTLER_LIMIT")):void $.updateConfiguration("SEND_THROTTLER_LIMIT",n).done(function(t){t.success?r.set("configuration.SEND_THROTTLER_LIMIT",n):e.alertErrors(t.errors)}).always(function(){a()})});var g=v("At least one antiflood option needs to be activated. If you want to activate the other antiflood option select it first.");return l.find("#np-send-throttler-active").on("change",function(){if(!$(this).is(":checked")&&!l.find("#np-send-antifllod-active").is(":checked"))return $(this).prop("checked",!0),
void e.alertErrors([g]);var t=$(this),n=Number(t.is(":checked"));$.updateConfiguration("SEND_THROTTLER_ACTIVE",n).done(function(t){t.success?r.set("configuration.SEND_THROTTLER_ACTIVE",n):e.alertErrors(t.errors)}).always(function(){a()})}),l.find("#np-send-antifllod-active").on("change",function(){if(!$(this).is(":checked")&&!l.find("#np-send-throttler-active").is(":checked"))return $(this).prop("checked",!0),void e.alertErrors([g]);var t=$(this),n=Number(t.is(":checked"));$.updateConfiguration("SEND_ANTIFLOOD_ACTIVE",n).done(function(t){t.success?r.set("configuration.SEND_ANTIFLOOD_ACTIVE",n):e.alertErrors(t.errors)}).always(function(){a()})}),l.find("#np-send-antiflood-emails").on("blur",function(){var t=$(this),n=t.val();return null===String(n).match(d)||1>n||n>100?void t.val(r.get("configuration.SEND_ANTIFLOOD_EMAILS")):void $.updateConfiguration("SEND_ANTIFLOOD_EMAILS",n).done(function(t){t.success?r.set("configuration.SEND_ANTIFLOOD_EMAILS",n):e.alertErrors(t.errors)}).always(function(){a()})}),l.find("#np-send-antiflood-sleep").on("blur",function(){var t=$(this),n=t.val();return null===String(n).match(d)||0>n||n>60?void t.val(r.get("configuration.SEND_ANTIFLOOD_SLEEP")):void $.updateConfiguration("SEND_ANTIFLOOD_SLEEP",n).done(function(t){t.success?r.set("configuration.SEND_ANTIFLOOD_SLEEP",n):e.alertErrors(t.errors)}).always(function(){a()})}),p=new gk.data.Model({id:"id_newsletter_pro_send_connection"}),m=new gk.data.DataSource({pageSize:7,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=ajaxGetConnections",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=ajaxDeleteConnection&id",type:"POST",dateType:"json",success:function(t,n){if(t.success){var a=s();a>2?e.dataStorage.set("count_send_connections",--a):e.dataStorage.set("count_send_connections",1)}else m.sync(function(){e.dataStorage.set("count_send_connections",this.count())}),e.alertErrors(t.errors)},error:function(t,n){m.sync(function(){e.dataStorage.set("count_send_connections",this.count())}),alert(v("The connection cannot be deleted."))},complete:function(e,t){}}},schema:{model:p},trySteps:2,errors:{read:function(t,n,s){m.syncStepAvailableAdd(3e3,function(){m.sync(function(){e.dataStorage.set("count_send_connections",this.count())})})}},done:function(){e.dataStorage.set("count_send_connections",this.count())}}),f=l.find("#np-send-connection"),f.gkGrid({dataSource:m,checkable:!1,selectable:!1,currentPage:1,pageable:!0,template:{actions:function(e,t){var n=$("#delete-connection").gkButton({name:"delete",title:v("delete"),className:"connection-delete",item:e,command:"delete",icon:'<i class="icon icon-trash-o"></i> '});return n},connection_test:function(t){var n=$('<a href="javascript:{}" class="btn btn-default" style="float: right;">												<span class="btn-ajax-loader" style="margin-top: 4px;"></span>												<span class="pull-left np-connection-status" style="display: none;"></span>												<i class="icon icon-envelope"></i> 												'+v("Test")+"											</a>"),s=n.find(".np-connection-status"),a=function(){s.hide()},r=function(){s.show().html('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>')},i=function(){s.show().html('<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>')};return n.on("click",function(){var s=isNaN(Number(t.data.id_newsletter_pro_smtp))?0:Number(t.data.id_newsletter_pro_smtp);a(),e.showAjaxLoader(n),$.postAjax({submit:"sendMailTest",sendMailTest:e.dataStorage.get("configuration.PS_SHOP_EMAIL"),id_smtp:s}).done(function(t){t.success?r():(i(),e.alertErrors(t.errors))}).always(function(){e.hideAjaxLoader(n)})}),n}}}),f.addFooter(function(n){var s=e.modules.smtp,a=$('<select id="connection-smtp-select" class="fixed-width-xxl"></select>');h=s.ui.SelectOption({name:"connectionSmptSelect",template:a,className:"gk-smtp-select",options:t.getSelectOptions(NewsletterPro.dataStorage.get("all_smtp"))});var r=$('<a href="javascript:{}" class="btn btn-default" style="float: right;">										<span class="btn-ajax-loader"></span>										<i class="icon icon-plus-square"></i> '+v("Add Connection")+"									</a>");return r.on("click",function(){var t=h.getSelected();return null==t?void alert(e.displayAlert(v("You smtp value has been selected."))):void(confirm(v("Are you sure you want to add a new connection? If you don't setup the connections properly you risk to be banned."))&&(e.showAjaxLoader(r),$.postAjax({submit:"ajaxAddConnection",id_smtp:t.data.id_newsletter_pro_smtp}).done(function(t){e.hideAjaxLoader(r),t.success?m.sync(function(){e.dataStorage.set("count_send_connections",this.count())}):e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(r)})))}),this.makeRow([a,r])},"prepend"),u=l}}),a(),n.btnAddExclusion.on("click",function(){i.show()}),n.btnClearExclusion.on("click",function(){e.showAjaxLoader(n.btnClearExclusion),$.postAjax({submit:"clearExclusionEmails"}).done(function(t){t.success?(e.hideAjaxLoader(n.btnClearExclusion),n.exclusionEmailsCount.html(0),alert(e.displayAlert(t.msg))):e.alertErrors(t.errors)}).always(function(){e.hideAjaxLoader(n.btnClearExclusion)})}),n.btnPerformances.on("click",function(){d.show()}),g=new e.components.FilterSelection({customers:t.vars.filterCustomers,visitors:t.vars.filterVisitor,visitors_np:t.vars.filterVisitorNP,added:t.vars.filterAdded,customers_apply_callback:t.vars.applyFilerCustomersCallback,visitor_apply_callback:t.vars.applyFilerVisitorCallback,visitor_np_apply_callback:t.vars.applyFilerVisitorNpCallback,added_apply_callback:t.vars.applyFilerAddedCallback}),n.addFilterSelection.on("click",function(){var t=g.getFilters(),s=n.nameFilterSelection.val();$.postAjax({submit:"addFilterSelection",name:s,filters:t}).done(function(t){if(t.success){n.deleteFilterSelection.show(),n.nameFilterSelection.val(""),n.filterSelection.empty(),n.filterSelection.append('<option value="0">- '+v("none")+" -</option>");for(var a=0;a<t.filters.length;a++){var r=t.filters[a],i='<option value="'+r.id_newsletter_pro_filters_selection+'" '+($.trim(s)===$.trim(r.name)?'selected="selected"':"")+">"+r.name+"</option>";n.filterSelection.append(i)}}else e.alertErrors(t.errors)})}),n.addFilterSelection.on("change",function(){var e=Number(n.filterSelection.val());e>0?n.deleteFilterSelection.show():n.deleteFilterSelection.hide()}),n.deleteFilterSelection.on("click",function(){var t=Number(n.filterSelection.val());return 0==t?!1:void $.postAjax({submit:"deleteFilterSelection",id:t}).done(function(s){s.success?($(n.filterSelection.selector+' option[value="'+t+'"]').remove(),g.clearfilters(),n.filterSelection.children().length<=1&&n.deleteFilterSelection.hide()):e.alertErrors(s.errors)})}),n.filterSelection.on("change",function(){var s=Number(n.filterSelection.val());return 0==s?(n.deleteFilterSelection.hide(),g.clearfilters(),!1):(n.deleteFilterSelection.show(),r(t.vars.customers,t.vars.customersCheckAll),r(t.vars.visitors,t.vars.visitorsCheckAll),r(t.vars.visitorsNP,t.vars.visitorsNPCheckAll),r(t.vars.added,t.vars.addedCheckAll),void $.postAjax({submit:"getFilterSelectionById",id:s}).done(function(t){t.success?t.hasOwnProperty("value")?(g.clearfilters(),g.applyFilters(t.value)):e.alertErrors([v("An error occured.")]):e.alertErrors(t.errors)}))})}),t},addEvent:function(e,t){this.events[e]=t},triggerEvent:function(e){this.events.hasOwnProperty(e)&&"function"==typeof this.events[e]&&this.events[e]()},addVar:function(e,t){this.vars=this.vars||{},this.vars[e]=t},ready:function(e){var t=this;$(document).ready(function(){t.domSave=t.domSave||{template:$($.trim($("#add-new-email-template").html()))},"undefined"!=typeof t.domSave.template[1]&&(t.domSave.template=$(t.domSave.template[1]));var n=t.domSave.template;$($("#list-of-interest-template").html());t.dom=t.dom||{customersGrid:$("#customers-list"),visitorsGrid:$("#visitors-list"),visitorsNPGrid:$("#visitors-np-list"),addedGrid:$("#added-list"),customersCount:$("#customers-count"),visitorsCount:$("#visitors-count"),visitorsNPCount:$("#visitors-np-count"),addedCount:$("#added-count"),addNewEmailTemplate:n,addNewEmail:n.find("#add-new-email-action"),addNewEmailForm:n.find("#add-new-email-from"),addNewEmailError:n.find("#add-new-email-error"),btnAddExclusion:$("#btn-add-exclusion"),btnClearExclusion:$("#btn-clear-exclusion"),exclusionEmailsCount:$("#exclusion-emails-count"),usersAjaxLoader:$("#users-ajax-loader"),visitorsAjaxLoader:$("#visitors-ajax-loader"),visitorsNPAjaxLoader:$("#visitors-np-ajax-loader"),addedAjaxLoader:$("#added-ajax-loader"),btnBouncedEmails:$("#btn-bounced-emails"),btnPerformances:$("#np-btn-performances"),sendMethodDisplay:$("#np-send-method-display"),addFilterSelection:$("#np-add-filter-selection"),deleteFilterSelection:$("#np-delete-filter-selection"),nameFilterSelection:$("#np-name-filter-selection"),filterSelection:$("#np-filter-selection")},e(t.dom)})},createCheckToggle:function(e,t){var n=NewsletterPro.translations.l(NewsletterPro.translations.modules.sendNewsletters),s=$("#"+e).gkButton({name:e,title:n("check all"),className:e,css:{"padding-left":"10px","padding-right":"10px","margin-left":"0",display:"inline-block"},attr:{"data-checked":0},click:function(e){function a(){return!!s.data("checked")}function r(e,t){return a()?(s.data("checked",!1),s.changeTitle(t),!1):(s.data("checked",!0),s.changeTitle(e),!0)}r(n("uncheck all"),n("check all"))?t.checkAll():t.uncheckAll()}});return s},getGenderImageById:function(e){var t="";switch(parseInt(e)){case 1:t='<img src="../modules/newsletterpro/views/img/gender_1.png" style="margin-left: 7px;">';break;case 2:t='<img src="../modules/newsletterpro/views/img/gender_2.png" style="margin-left: 7px;">'}return t},isNewsletterProSubscriptionActive:function(){return NewsletterPro.dataStorage.getNumber("configuration.SUBSCRIPTION_ACTIVE")},getAjaxLoader:function(){var e=$('<span class="ajax-loader" style="display: block;"></span>');return e},getRangeSelectionContent:function(e){$.postAjax({submit:"getRangeSelectionContent"},"html").done(function(t){e($(t))})},resetButtons:function(){},isPS16:function(){return this.box.dataStorage.data.isPS16},resetCustomersButton:function(){},resetVisitorsButton:function(){},resetVisitorsNPButton:function(){},resetAddedButton:function(){},buildExportToCSVData:function(e,t){var n=NewsletterPro.translations.l(NewsletterPro.translations.modules.sendNewsletters),s=";",a=$('				<form id="'+NewsletterPro.uniqueId()+'" method="POST" action="'+NewsletterPro.dataStorage.get("ajax_url")+'#sendNewsletters">					<input type="hidden" name="export_all_columns" value="1">					<input type="hidden" name="export_email_addresses" value="1">					<input type="hidden" name="csv_separator" value="'+s+'">					<input type="hidden" name="list_ref" value="'+t+'">					<div id="np-export-csv-range-box">					</div>				</form>			'),r=a.find('input[name="csv_separator"]'),i=a.find("#np-export-csv-range-box"),o=$('			<a id="'+NewsletterPro.uniqueId()+'" href="javascript:{}" class="btn btn-default pull-right">				<i class="icon icon-download"></i>				'+n("Export Selection")+"			</a>");return o.on("click",function(){var t=e.getSelectedIds(!0);if(separator=prompt(n("CSV Separator"),s),!t.length)return void alert(n("You must select at least an email address."));if(null!=separator){if(separator=$.trim(separator),";"!=separator&&","!=separator)return void alert(n("Invalid CSV separator."));i.empty();for(var o=0,l=t.length;l>o;o++)i.append('<input type="hidden" name="export_range[]" value="'+t[o]+'">');r.val(separator),a.submit()}}),o},initCustomersGrid:function(){var e=this;e.ready(function(t){function n(){var e=NewsletterPro.modules.categoriesTree;e.setNeedUncheckAll(!0),e.uncheckAllCategories(!1)}function s(){j.clearVal(),A.removeItems(),D.dataSource.parse(function(e){e.removeFromScreen()}),D.dataSource.setData([]),D.dataSource.sync()}function a(e){L.from=e}function r(e){L.to=e}function i(){"undefined"!=typeof C&&(C.val(""),a("")),"undefined"!=typeof I&&(I.val(""),r(""))}function o(){c("clear",1,l())}function l(){return f.items.length}function c(e,t,n){if("range"!==e&&"undefined"!=typeof x){var s={min:t,max:n,valueMin:t,valueMax:n,values:[t,n]};0>=n&&(s.snap=0,s.min=0,s.max=1),x.reset(s),x.resetPositionMin(),x.resetPositionMax()}}function d(e,t){if("undefined"!=typeof T){var n={min:e,max:t,valueMin:e,valueMax:t,values:[e,t]};T.reset(n),T.resetPositionMin(),T.resetPositionMax()}}function u(){d(0,S)}function p(){"undefined"!=typeof g&&(w.val(""),g.clearSearch(),g.uncheckAll())}var m,f,h,g,v,w,b=NewsletterPro.translations.l(NewsletterPro.translations.modules.sendNewsletters),y=t.customersGrid,S=0;m=new gk.data.Model({id:"id_customer"}),f=new gk.data.DataSource({pageSize:10,trySteps:2,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getCustomers",dataType:"json"},update:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=updateCustomer&id",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteCustomer&id",type:"POST",dateType:"json",success:function(e,t){e||alert(b("delete customer"))},error:function(e,t){alert(b("delete customer"))},complete:function(e,t){}},search:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=searchCustomer&value",dataType:"json"},filter:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=filterCustomer",dataType:"json"}},schema:{model:m},errors:{read:function(e,t,n){f.syncStepAvailableAdd(3e3,function(){f.sync()})}}}),y.gkGrid({dataSource:f,selectable:!1,checkable:!0,currentPage:1,pageable:!0,start:function(){t.usersAjaxLoader.show()},done:function(e){t.customersCount.html(e.items.length),t.usersAjaxLoader.hide()},template:{img_path:function(t,n){var s=$("<div></div>"),a='<img src="'+n+'">',r=e.getGenderImageById(t.data.id_gender);return s.append(a),s.append(r),s.width("38"),s},newsletter:function(e,t){function n(){return!!parseInt(e.data.newsletter)}function s(){return!!NewsletterPro.dataStorage.getNumber("configuration.VIEW_ACTIVE_ONLY")}function a(){n()?r.html('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>'):r.html('<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>')}var r=$('<a href="javascript:{}"></a>'),i=e.data;return a(),r.on("click",function(t){t.stopPropagation(),i.newsletter=n()?0:1,e.update().done(function(t){t?s()?e.removeFromScreen():a():alert("error on subscribe or unsubscribe")})}),r},chackbox:function(e,t){var n=$('<input type="checkbox" value="'+t+'" '+(e.isChecked()?'checked="checked"':"")+"> ");return n},actions:function(e){var t=$("#delete-customer").gkButton({name:"delete",title:b("delete"),className:"customer-delete",item:e,command:"delete",confirm:function(){return confirm(b("delete customer confirm"))},icon:'<i class="icon icon-trash-o"></i> '});return t}}});var k,P,_,N,x,T,C,I,E,j,A,D,L=(y.addFooter(function(t){function n(e){return a=$("<tr></tr>"),r=$('<td class="form-inline gk-footer" colspan="'+t+'"></td>'),$.each(e,function(e,t){r.append(t)}),a.html(r),a}function s(e){var t=$("#"+e).gkButton({name:e,title:b("check all"),className:e,css:{"padding-left":"10px","padding-right":"10px","margin-left":"0",display:"inline-block"},attr:{"data-checked":0},click:function(e){function n(){return!!t.data("checked")}function s(e,s){return n()?(t.data("checked",!1),t.changeTitle(s),!1):(t.data("checked",!0),t.changeTitle(e),!0)}s(b("uncheck all"),b("check all"))?f.checkAll():f.uncheckAll()}});return t}var a,r;return k=s("check-toggle"),P=s("check-toggle-search"),P.addClass("gk-onfilter"),P.hide(),e.addVar("customersCheckAll",k),btnExportCsv=e.buildExportToCSVData(f,NewsletterPro.dataStorage.get("csv_export_list_ref.LIST_CUSTOMERS")),n([k,P,btnExportCsv])},"prepend"),{from:"",to:""});y.addHeader(function(t){function n(e){return F=$("<tr></tr>"),R=$('<th class="gk-header-datagrid customers-header" colspan="'+t+'"></th>'),$.each(e,function(e,t){R.append(t)}),F.html(R),F}function s(e){var t=e.find('input[type="checkbox"]');return t.length>0?t:[]}function o(e){var t=[];return"array"!=typeof e&&"undefined"!=typeof e&&(t=$.map(e,function(e){var e=$(e),t=e.val();return"undefined"!==t&&e.is(":checked")?parseInt(t):void 0})),t}function d(e){$.postAjax({submit:"getFilterByPurchaseContent"},"html").done(function(t){e($(t))})}function u(){var e=[];return D.dataSource.parse(function(t){e.push(t.data.id)}),e}function m(e,t){t=t||[];var n=new gk.data.Model({id:"id_product"}),s=new gk.data.DataSource({pageSize:7,transport:{data:t},schema:{model:n}});return e.gkGrid({dataSource:s,selectable:!1,currentPage:1,pageable:!0,template:{actions:function(e){var t=$('<a href="javascript:{}" class="btn btn-default"><i class="icon icon-times" style="margin-right: 7px;"></i> '+b("remove")+"</a>");return t.on("click",function(){var t=e.data.id_product,n=D.dataSource.getItemByValue("data.id_product",t),s=D.dataSource.getData();n&&(n.removeFromScreen(),index=y(s,t),index>-1&&s.splice(index,1));var a=A.getItems(!1),r=a.length;if(r>0)for(var i,o=0;r>o;o++)if(i=a[o],i.data.id==t){i.remove();break}}),t},price_display:function(e,t){return'<span style="font-weight: bold;">'+t+"</span>"},reference:function(e,t){return'<span style="font-weight: bold;">'+t+"</span>"},image:function(e){return'<img src="'+e.data.thumb_path+'" style="width: 40px; height: 40px;">'}}}),{dataSource:s,dataModel:n,dataGrid:e}}function y(e,t){for(var n=0;n<e.length;n++){var s=e[n];if(s.id_product==t)return n}return-1}function _(e){$.postAjax({submit:"getFilterByBirthdayContent",fbb_class:"customers"},"html").done(function(t){e($(t))})}function O(){return L}function M(e){var t=e.selectedYear,n=1==String(e.selectedMonth).length?"0"+String(e.selectedMonth+1):String(e.selectedMonth+1),s=1==String(e.selectedDay).length?"0"+String(e.selectedDay):String(e.selectedDay);return mysql_date=t+"-"+n+"-"+s}function B(){return{min:"undefined"==typeof x||isNaN(x.getValueMin())?0:x.getValueMin(),max:"undefined"==typeof x||isNaN(x.getValueMax())?0:x.getValueMax()}}function V(e){var t={groups:H.getSelected(),shops:z.getSelected(),gender:U.getSelected(),subscribed:q.getSelected(),languages:G.getSelected(),categories:o(Y),by_interest:Z.getSelected(),purchased_product:u(),by_birthday:O(),total_spent:de(),filter_by_country:ue()},n=!1;$.each(t,function(e,t){t.length&&(n=!0)}),""==$.trim(t.by_birthday.from)||""==$.trim(t.by_birthday.to)?delete t.by_birthday:n=!0,"range"==e&&(t.range_selection=B(),0==$.trim(t.range_selection.min)||0==$.trim(t.range_selection.max)?delete t.range_selection:n=!0),0==t.total_spent.from&&0==t.total_spent.to||0==t.total_spent.from&&t.total_spent.to==S?delete t.total_spent:n=!0,0==t.filter_by_country.length?delete t.filter_by_country:n=!0,n?(N.val(""),k.hide(),P.css({display:"inline-block"}),f.filter(t).done(function(t){f.applySearch(t),c(e,1,t.length)})):(c(e,1,l()),k.show(),P.hide(),f.clearSearch())}var F,R,H=$("#gk-filter-groups").gkDropDownMenu({title:b("groups"),name:"gk-filter-groups",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.data.filter_groups,change:function(e){V("groups")}}),W=NewsletterPro.dataStorage.data.filter_languages;$.each(W,function(e,t){W[e].title='<img src="'+t.img_path+'" width="16" height="11"><span style="margin-left: 10px;">'+t.title+"</span>"});var G=$("#gk-filter-languages").gkDropDownMenu({title:b("languages"),name:"gk-filter-languages",css:{"float":"left","margin-right":"10px"},data:W,change:function(e){V("languages")}}),z=$("#gk-filter-shops").gkDropDownMenu({title:b("shops"),name:"gk-filter-shops",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.data.filter_shops,change:function(e){V("shops")}}),U=$("#gk-filter-gender").gkDropDownMenu({title:b("gender"),name:"gk-filter-gender",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.get("filter_genders"),change:function(e){V("gender")}}),q=$("#gk-filter-subscribed").gkDropDownMenu({title:b("subscribed"),name:"gk-filter-gender",css:{"float":"left","margin-right":"10px"},data:[{title:b("yes"),value:1},{title:b("no"),value:0}],change:function(e){V("subscribed")}});NewsletterPro.dataStorage.get("view_active_only")&&q.hide();var Y,X=new gkWindow({width:640,height:540,title:b("category filter title"),className:"category-filters",show:function(e){},close:function(e){},content:function(e){return $.postAjax({submit:"getCategoryTree"},"html").done(function(t){e.setContent(t)}),""}}),K=$("#filter-categories").gkButton({name:"filter-categories",title:b("categories"),className:"filter-categories",css:{"padding-left":"10px","padding-right":"10px","float":"left","margin-right":"10px",position:"relative"},attr:{"data-checked":0},click:function(e){X.show()}});e.addEvent("clickOnCategoryBox",function(){Y=s(X.template),V("categories")});var Q,J,Z=$("#gk-customer-filter-by-interest-np").gkDropDownMenu({title:b("by list of interest"),name:"gk-filter-loi",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.get("filter_list_of_interest"),activeClass:{enable:"",disable:"btn-filter-list-of-interst-inactive"},change:function(e){V()}}),ee=new gkWindow({width:640,height:540,title:b("filter by purchase"),className:"filter-by-purchase-window",show:function(e){},close:function(e){},content:function(e,t){return d(function(t){e.setContent(t),j=new gkSearch({read:{submit:"searchByPurchase"},element:t.find("#filter-poduct-search"),ajaxLoader:t.find(".product-search-span"),result:function(e){var t=e.products;A.createItems(t)},reset:function(){A.removeItems()}}),A=new gkProductList({element:t.find("#filter-product-list"),inList:function(e){var t=e.id_product,n=D.dataSource.getData();return index=y(n,t),!(index>-1)},add:function(e,t){var n=D.dataSource.getData(),s=e.id_product;D.dataSource.getItemByValue("data.id_product",s)||n.push(e),D.dataSource.setData(n),D.dataSource.sync().done(function(){V("purchase")})},remove:function(e,t){var n=e.id_product,s=D.dataSource.getItemByValue("data.id_product",n),a=D.dataSource.getData();s&&(s.removeFromScreen(),index=y(a,n),index>-1&&a.splice(index,1)),V("purchase")}}),D=m(t.find("#fbp-grid"))}),'<span class="ajax-loader" style="margin-left: 312px; margin-top: 224px;"></span>'}}),te=$("#by-purchase-filters").gkButton({name:"by-purchase-filters",title:b("by purchase"),className:"by-purchase-filters",css:{"padding-left":"10px","padding-right":"10px","float":"left","margin-right":"10px"},attr:{"data-checked":0},click:function(e){ee.show()}}),ne=new gkWindow({width:640,height:320,title:b("filter by birthday"),className:"filter-by-birthday-window",show:function(e){},close:function(e){},content:function(t,n){return _(function(n){t.setContent(n),C=n.find("#fbb-from-customers"),I=n.find("#fbb-to-customers"),E=n.find("#fbb-clear-customers"),C.datepicker({dateFormat:e.box.dataStorage.get("jquery_date_birthday"),onSelect:function(e,t){a(M(t)),V("birthday")},beforeShow:function(e,t){t.dpDiv.hasClass("date-birthday")||t.dpDiv.addClass("date-birthday")}}),I.datepicker({dateFormat:e.box.dataStorage.get("jquery_date_birthday"),onSelect:function(e,t){r(M(t)),V("birthday")},beforeShow:function(e,t){t.dpDiv.hasClass("date-birthday")||t.dpDiv.addClass("date-birthday")}}),C.on("change",function(){""==$.trim($(this).val())&&(a(""),V("birthday"))}),I.on("change",function(){""==$.trim($(this).val())&&(r(""),V("birthday"))}),E.on("click",function(){i(),V("birthday")})}),'<span class="ajax-loader" style="margin-left: 310px; margin-top: 119px;"></span>'}}),se=$("#by-birthday-filters").gkButton({name:"by-birthday-filters",title:b("by birthday"),className:"by-birthday-filters",css:{"padding-left":"10px","padding-right":"10px","margin-right":"10px","float":"left"},attr:{"data-checked":0},click:function(e){ne.show()}}),ae=new gkWindow({width:640,height:150,title:b("range selection"),className:"range-selection-window",show:function(e){"undefined"!=typeof x&&x.refresh()},close:function(e){},content:function(t,n){return f.ready().done(function(){e.getRangeSelectionContent(function(e){t.setContent(e),x=gkSliderRange({target:e.find("#slider-range-selection"),min:1,max:l(),valueMin:1,valueMax:l(),editable:!0,values:[1,l()],move:function(e){},done:function(e){V("range")}})})}),'<span class="ajax-loader" style="margin-left: 310px; margin-top: 36px;"></span>'}}),re=$("#range-selection").gkButton({name:"range-selection",title:b("range selection"),className:"range-selection",css:{"padding-left":"10px","padding-right":"10px","margin-right":"10px","float":"left"},attr:{"data-checked":0},click:function(e){ae.show()}}),ie=new gkWindow({width:640,height:150,title:b("Total spent filter"),className:"win-filter-total-spent",show:function(e){"undefined"==typeof T?$.postAjax({submit:"getMaxTotalSpent"}).done(function(e){S=Number(e),T=gkSliderRange({target:Q,min:0,max:S,prefix:" "+NewsletterPro.dataStorage.get("currency_default.sign"),valueMin:0,valueMax:S,values:[0,S],move:function(e){},done:function(e){V("total_spent")}})}):T.refresh()},close:function(e){},content:function(e,t){return Q=$('							<div id="slider-filter-total-spent" class="slider-filter-total-spent">								<div class="slider-container">									<label>'+b("Total spent")+'</label>									<div id="slider-range-selection"></div>								</div>							</div>						')}}),oe=$("#filter-total-spent").gkButton({name:"",icon:'<i class="icon icon-usd"></i>',title:"",className:"filter-total-spent",css:{"padding-left":"10px","padding-right":"10px","margin-right":"10px","float":"left"},attr:{"data-checked":0},click:function(e){ie.show()}}),le=new gkWindow({width:640,height:475,setScrollContent:415,title:b("Filter customers by country"),className:"win-filter-total-spent",show:function(e){"undefined"==typeof g&&(h=new gk.data.Model({id:"id_country"}),g=new gk.data.DataSource({pageSize:10,trySteps:2,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getCountries",dataType:"json"},search:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=searchCountries&value",dataType:"json"}},schema:{model:h},errors:{read:function(e,t,n){g.syncStepAvailableAdd(3e3,function(){g.sync()})}}}),v=J.find("#filter-by-country-list"),v.gkGrid({dataSource:g,selectable:!1,checkable:!0,currentPage:1,pageable:!0,start:function(){},done:function(e){},template:{active:function(e,t){var n=Number(t);return n?'<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>':'<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>'},chackbox:function(e,t){var n=$('<input type="checkbox" value="'+t+'" '+(e.isChecked()?'checked="checked"':"")+"> ");return n}}}),v.addHeader(function(e){var t=null,n=$('										<div class="clearfix">											<span>'+b("Search")+':</span>											<div class="fixed-width-xxl filter-by-country-search-box">												<input id="filter-by-country-search" class="form-control filter-by-country-search" type="text">												<span id="filter-by-country-search-loading" class="filter-by-country-search-loading" style="display: none;"></span>											</div>											<a id="filter-by-country-clear-selection" href="javascript:{}" class="btn btn-default pull-right">												<i class="icon icon-remove"></i>												'+b("Clear Selection")+"											</a>										</div>									"),s=n.find("#filter-by-country-search-loading"),a=n.find("#filter-by-country-clear-selection");return w=n.find("#filter-by-country-search"),w.on("keyup",function(e){var n=$.trim(w.val());return n.length<3?(g.clearSearch(),!0):(s.show(),null!=t&&clearTimeout(t),void(t=setTimeout(function(){g.search(n).done(function(e){g.applySearch(e),s.hide()})},300)))}),a.on("click",function(e){p()}),v.makeRow([n])}))},close:function(e){V("filter_by_country")},content:function(e,t){return J=$('							<div class="form-group clearfix">								<table id="filter-by-country-list" class="table table-bordered filter-by-country-list">									<thead>										<tr>											<th class="chackbox" data-template="chackbox">&nbsp;</th>											<th class="np-fc-country-name" data-field="name">'+b("Country Name")+'</th>											<th class="np-fc-iso-code" data-field="iso_code">'+b("ISO Code")+'</th>											<th class="np-fc-active" data-field="active">'+b("Active")+"</th>										</tr>									</thead>								</table>							</div>						")}}),ce=$("#filter-by-country").gkButton({name:"",icon:'<i class="icon icon-globe"></i>',title:"",className:"filter-by-country",css:{"padding-left":"10px","padding-right":"10px","margin-right":"10px","float":"left"},attr:{"data-checked":0},click:function(e){le.show()}}),de=function(){return{from:"undefined"==typeof T||isNaN(T.getValueMin())?0:T.getValueMin(),to:"undefined"==typeof T||isNaN(T.getValueMax())?0:T.getValueMax()}},ue=function(){var e,t=[];if("undefined"!=typeof g){e=g.getSelection();for(var n=0;n<e.length;n++)t.push(e[n].data.iso_code)}return t},pe=$('<span style="margin-left: 0px; margin-right: 10px; float: left; line-height: 28px;">'+b("filters")+"</span>");return e.reset=e.reset||{},e.reset.customer=e.reset.customer||{},e.reset.customer.filterGroups=H,e.reset.customer.filterLanguages=G,e.reset.customer.filterShops=z,e.reset.customer.filterGender=U,e.reset.customer.filterSubscribed=q,e.reset.customer.filterCategories=K,e.reset.customer.filterByInterest=Z,e.reset.customer.filterByPurchase=te,e.reset.customer.filterByBirthday=se,e.reset.customer.filterTotalSpent=oe,e.reset.customer.filterByCountry=ce,e.reset.customer.rangeSelection=re,e.addVar("filterCustomers",{groups:H,languages:G,shops:z,gender:U,subscribed:q,by_category:K,by_interest:Z,by_purchase:te,by_birthday:se,total_spent:oe,filter_by_country:ce,range:re}),e.addVar("applyFilerCustomersCallback",V),e.addVar("customers",f),n([pe,H,G,z,U,q,oe,ce,K,Z,te,se,re])},"prepend"),y.addHeader(function(t){function a(e){return r=$("<tr></tr>"),l=$('<th class="gk-header-datagrid customers-header" colspan="'+t+'"></th>'),$.each(e,function(e,t){l.append(t)}),r.html(l),r}var r,l,c,d,m=null;c=$('<div class="customers-search-div"></div>'),N=$('<input class="form-control customers-search" type="text">'),_=$('<span class="customers-search-loading" style="display: none;"></span>'),N.on("keyup",function(e){var t=$.trim(N.val());return t.length<3?(k.show(),P.hide(),f.clearSearch(),!0):(k.hide(),P.css({display:"inline-block"}),_.show(),null!=m&&clearTimeout(m),void(m=setTimeout(function(){f.search(t).done(function(e){f.applySearch(e),_.hide()})},300)))}),d=$("<span>"+b("search")+":</span>"),c.append(N),c.append(_);var h=$("#clear-filters").gkButton({name:"clear-filters",title:b("clear filters"),className:"clear-filters",css:{"padding-left":"10px","padding-right":"10px","margin-left":"0","margin-right":"0",position:"absolute",right:"5px"},attr:{"data-checked":0},click:function(t){N.val(""),e.reset.customer.filterGroups.uncheckAll(),e.reset.customer.filterShops.uncheckAll(),e.reset.customer.filterLanguages.uncheckAll(),e.reset.customer.filterGender.uncheckAll(),e.reset.customer.filterSubscribed.uncheckAll(),n(),s(),i(),o(),u(),p(),k.show(),P.hide(),f.clearSearch()},icon:'<i class="icon icon-times"></i> '});return e.reset=e.reset||{},e.reset.customer=e.reset.customer||{},e.reset.customer.clearFilters=h,e.vars.filterCustomers.clear=h,a([d,c,h])},"prepend");e.resetCustomersButton();var O=NewsletterPro,M=new gkWindow({width:640,title:b("bounced emails"),className:"bounced-emails-window",show:function(e){},close:function(e){},content:function(e,t){var n=$('						<form id="form-bounced-emails" method="post" enctype="multipart/form-data">							<div class="form-group clearfix">								<label class="control-label col-sm-4"><span class="label-tooltip">'+b("select the csv file")+'</span></label>								<div class="col-sm-8 clearfix">									<div class="input-group">										<span class="input-group-addon">'+b("File")+'</span>										<input type="file" name="bounced_emails" class="form-control" style="float: left; margin-right: 10px;">										<span class="input-group-addon">'+b("Separator")+'</span>										<input type="text" name="bounced_csv_separator" class="form-control" value=";" style="width: 30px; text-align: center; float: left;">										<div class="clear"></div>									</div>								</div>								<div class="clear"></div>							</div>							<div class="clear"></div>							<div class="form-group clearfix">								<label class="control-label padding-top col-sm-4">'+b("bounced emails method")+'</label>								<div class="col-sm-8 clearfix">									<div class="radio">										<label for="bounced-method-delete" class="in-win">											<input id="bounced-method-delete" type="radio" name="bounced_method" value="-1" checked>'+b("delete bounced emails")+'										</label>									</div>									<div class="radio">										<label for="bounced-method-unsubscribe" class="in-win">											<input id="bounced-method-unsubscribe" type="radio" name="bounced_method" value="0"> '+b("unsubscribe bounced emails")+'										</label>									</div>									<p class="help-block">'+b("bounced emails info")+'</p>									<div class="clear"></div>								</div>							</div>							<label class="control-label padding-top col-sm-4">'+b("apply on the lists")+'</label>							<div class="col-sm-8 clearfix">								<div class="checkbox">									<label for="bounced-customers" class="in-win">										<input id="bounced-customers" type="checkbox" name="bounced_customers_list" value="1">'+b("customers list")+'									</label>								</div>								<div class="checkbox">									<label for="bounced-visitors" class="in-win">										<input id="bounced-visitors" type="checkbox" name="bounced_visitors_list" value="1">'+b("visitors subscribed at module block newsletter")+'									</label>								</div>								<div class="checkbox">									<label for="bounced-visitors-np" class="in-win">										<input id="bounced-visitors-np" type="checkbox" name="bounced_visitors_np_list" value="1">'+b("visitors subscribed at module newsletter pro")+'									</label>								</div>								<div class="checkbox">									<label for="bounced-added" class="in-win">										<input id="bounced-added" type="checkbox" name="bounced_added_list" value="1">'+b("added list")+'									</label>								</div>							</div>							<div class="form-group clearfix">								<div class="col-sm-8 col-sm-offset-4">									<a id="submit-bounced-emails" href="javascript:{}" class="btn btn-default"><span class="btn-ajax-loader"></span> <i class="icon icon-eraser"></i> '+b("remove bounced")+'</a>								</div>							</div>							<div class="form-group clearfix">								<div style="display: block; height: auto; background-position: 5px; padding-top: 10px; padding-bottom: 10px;" class="hint clear">									<p style="margin-top: 0;" class="cron-link"><span style="color: black;">'+b("webhook url")+'</span> <span class="icon icon-cron-link"></span>'+O.dataStorage.get("bounce_link")+'</p>									<p style="margin-bottom: 0;">'+b("webhook info")+'</p>									<div class="clear"></div>								</div>							</div>						</form>					'),s=n.find("#submit-bounced-emails");
return s.on("click",function(e){var t=confirm(b("confirm delete bounced"));t&&(O.showAjaxLoader(s),$.submitAjax({submit:"deleteBouncedEmails",name:"deleteBouncedEmails",form:n}).done(function(e){if(O.hideAjaxLoader(s),e.success){var t=O.modules.sendNewsletters.vars;-1!=e.lists.indexOf("customers")&&t.hasOwnProperty("customers")&&t.customers.sync(),-1!=e.lists.indexOf("visitors")&&t.hasOwnProperty("visitors")&&t.visitors.sync(),-1!=e.lists.indexOf("visitors_np")&&t.hasOwnProperty("visitorsNP")&&t.visitorsNP.sync(),-1!=e.lists.indexOf("added")&&t.hasOwnProperty("added")&&t.added.sync(),alert(O.displayAlert(e.msg))}else O.alertErrors(e.errors)}))}),n}});t.btnBouncedEmails.on("click",function(e){M.show()})})},initVisitorsGrid:function(){var e=this;e.ready(function(t){function n(e,t,n){if("range"!==e&&"undefined"!=typeof m){var s={min:t,max:n,valueMin:t,valueMax:n,values:[t,n]};0>=n&&(s.snap=0,s.min=0,s.max=1),m.reset(s),m.resetPositionMin(),m.resetPositionMax()}}function s(){n("clear",1,a())}function a(){return i.items.length}if(!e.isNewsletterProSubscriptionActive()){var r,i,o=NewsletterPro.translations.l(NewsletterPro.translations.modules.sendNewsletters),l=t.visitorsGrid;r=new gk.data.Model({id:"id"}),i=new gk.data.DataSource({pageSize:5,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getVisitors",dataType:"json"},update:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=updateVisitor&id",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteVisitor&id",type:"POST",dateType:"json",success:function(e,t){e||alert(o("delete visitor"))},error:function(e,t){alert(o("delete visitor"))},complete:function(e,t){}},search:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=searchVisitor&value",dataType:"json"},filter:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=filterVisitor",dataType:"json"}},schema:{model:r},trySteps:2,errors:{read:function(e,t,n){i.syncStepAvailableAdd(3e3,function(){i.sync()})}}}),l.gkGrid({dataSource:i,selectable:!1,checkable:!0,currentPage:1,pageable:!0,start:function(){t.visitorsAjaxLoader.show()},done:function(e){t.visitorsCount.html(e.items.length),t.visitorsAjaxLoader.hide()},template:{chackbox:function(e,t){var n=$('<input type="checkbox" value="'+t+'" '+(e.isChecked()?'checked="checked"':"")+"> ");return n},img_path:function(e,t){return'<img src="'+t+'">'},active:function(e,t){function n(){return!!parseInt(e.data.active)}function s(){return!!NewsletterPro.dataStorage.getNumber("configuration.VIEW_ACTIVE_ONLY")}function a(){n()?r.html('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>'):r.html('<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>')}var r=$('<a href="javascript:{}"></a>'),i=e.data;return a(),r.on("click",function(t){t.stopPropagation(),i.active=n()?0:1,e.update().done(function(t){t?s()?e.removeFromScreen():a():alert("error on subscribe or unsubscribe")})}),r},actions:function(e){var t=$("#delete-visitor").gkButton({name:"delete",title:o("delete"),className:"visitor-delete",item:e,command:"delete",confirm:function(){return confirm(o("delete visitor confirm"))},icon:'<i class="icon icon-trash-o"></i> '});return t}}});var c,d,u,p,m;l.addFooter(function(t){function n(e){return a=$("<tr></tr>"),r=$('<td class="gk-footer" colspan="'+t+'"></td>'),$.each(e,function(e,t){r.append(t)}),a.html(r),a}function s(e){var t=$("#"+e).gkButton({name:e,title:o("check all"),className:e,css:{"padding-left":"10px","padding-right":"10px","margin-left":"0"},attr:{"data-checked":0},click:function(e){function n(){return!!t.data("checked")}function s(e,s){return n()?(t.data("checked",!1),t.changeTitle(s),!1):(t.data("checked",!0),t.changeTitle(e),!0)}s(o("uncheck all"),o("check all"))?i.checkAll():i.uncheckAll()}});return t}var a,r;return c=s("check-toggle"),d=s("check-toggle-search"),d.addClass("gk-onfilter"),d.hide(),e.addVar("visitorsCheckAll",c),btnExportCsv=e.buildExportToCSVData(i,NewsletterPro.dataStorage.get("csv_export_list_ref.LIST_VISITORS")),n([c,d,btnExportCsv])},"prepend"),l.addHeader(function(t){function r(e){return h=$("<tr></tr>"),g=$('<th class="gk-header-datagrid visitors-header" colspan="'+t+'"></th>'),$.each(e,function(e,t){g.append(t)}),h.html(g),h}function l(){return{min:"undefined"!=typeof m?m.getValueMin():0,max:"undefined"!=typeof m?m.getValueMax():0}}function f(e){var t={shops:y.getSelected(),subscribed:S.getSelected()},s=!1;$.each(t,function(e,t){t.length&&(s=!0)}),"range"==e&&(t.range_selection=l(),0==$.trim(t.range_selection.min)||0==$.trim(t.range_selection.max)?delete t.range_selection:s=!0),s?(p.val(""),c.hide(),d.css({display:"inline-block"}),i.filter(t).done(function(t){i.applySearch(t),n(e,1,t.length)})):(n(e,1,a()),c.show(),d.hide(),i.clearSearch())}var h,g,v,w,b=null;v=$('<div class="visitors-search-div" style="float: left; margin-right: 10px;"></div>'),p=$('<input class="gk-input visitors-search" type="text">'),u=$('<span class="visitors-search-loading" style="display: none;"></span>'),p.on("keyup",function(e){var t=$.trim(p.val());return t.length<3?(c.show(),d.hide(),i.clearSearch(),!0):(c.hide(),d.css({display:"inline-block"}),u.show(),null!=b&&clearTimeout(b),void(b=setTimeout(function(){i.search(t).done(function(e){i.applySearch(e),u.hide()})},300)))}),w=$('<span style="float: left; margin-right: 10px;">'+o("search")+":</span>"),v.append(p),v.append(u);var y=$("#gk-filter-shops").gkDropDownMenu({title:o("shops"),name:"gk-filter-shops",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.data.filter_shops,change:function(e){f("shops")}}),S=$("#gk-filter-subscribed-visitors").gkDropDownMenu({title:o("subscribed"),name:"gk-filter-gender",css:{"float":"left","margin-right":"10px"},data:[{title:o("yes"),value:1},{title:o("no"),value:0}],change:function(e){f("subscribed")}});NewsletterPro.dataStorage.get("view_active_only")&&S.hide();var k=new gkWindow({width:640,height:150,title:o("range selection"),className:"range-selection-window",show:function(e){"undefined"!=typeof m&&m.refresh()},close:function(e){},content:function(t,n){return i.ready().done(function(){e.getRangeSelectionContent(function(e){t.setContent(e),m=gkSliderRange({target:e.find("#slider-range-selection"),min:1,max:a(),valueMin:1,valueMax:a(),editable:!0,values:[1,a()],move:function(e){},done:function(e){f("range")}})})}),'<span class="ajax-loader" style="margin-left: 310px; margin-top: 36px;"></span>'}}),P=$("#range-selection-visitors").gkButton({name:"range-selection-visitors",title:o("range selection"),className:"range-selection",css:{"padding-left":"10px","padding-right":"10px","float":"left","margin-right":"10px",position:"relative"},attr:{"data-checked":0},click:function(e){k.show()}}),_=$('<span style="margin-left: 20px; margin-right: 10px; float: left; line-height: 28px;">'+o("filters")+"</span>"),N=$("#clear-filters-visitors").gkButton({name:"clear-filters-visitors",title:o("clear filters"),className:"clear-filters",css:{"padding-left":"10px","padding-right":"10px","margin-left":"0","margin-right":"0",position:"absolute",right:"5px"},attr:{"data-checked":0},click:function(e){p.val(""),y.uncheckAll(),S.uncheckAll(),s(),c.show(),d.hide(),i.clearSearch()},icon:'<i class="icon icon-times"></i> '});return e.reset=e.reset||{},e.reset.visitor={filterShops:y,filterSubscribed:S,rangeSelection:P,clearFilters:N},e.addVar("filterVisitor",{shops:y,subscribed:S,range:P,clear:N}),e.addVar("applyFilerVisitorCallback",f),e.addVar("visitors",i),r([w,v,_,y,S,P,N])},"prepend");e.resetVisitorsButton()}})},initVisitorsGridNewsletterPro:function(){var e=this,t=this.box;e.ready(function(n){function s(e){H.from=e}function a(e){H.to=e}function r(){"undefined"!=typeof j&&(j.val(""),s("")),"undefined"!=typeof A&&(A.val(""),a(""))}function i(){l("clear",1,o())}function o(){return d.items.length}function l(e,t,n){if("range"!==e&&"undefined"!=typeof E){var s={min:t,max:n,valueMin:t,valueMax:n,values:[t,n]};0>=n&&(s.snap=0,s.min=0,s.max=1),E.reset(s),E.resetPositionMin(),E.resetPositionMax()}}if(e.isNewsletterProSubscriptionActive()){var c,d,u,p=NewsletterPro.translations.l(NewsletterPro.translations.modules.sendNewsletters),m=n.visitorsNPGrid;c=new gk.data.Model({id:"id_newsletter_pro_subscribers"}),d=new gk.data.DataSource({pageSize:5,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getVisitorsNP",dataType:"json"},update:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=updateVisitorNP&id",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteVisitorNP&id",type:"POST",dateType:"json",success:function(e,t){e||alert(p("delete visitor"))},error:function(e,t){alert(p("delete visitor"))},complete:function(e,t){}},search:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=searchVisitorNP&value",dataType:"json"},filter:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=filterVisitorNP",dataType:"json"}},schema:{model:c},trySteps:2,errors:{read:function(e,t,n){d.syncStepAvailableAdd(3e3,function(){d.sync()})}}});var f={img_path:function(t,n){var s=$("<div></div>"),a='<img src="'+n+'">',r=e.getGenderImageById(t.data.id_gender);return s.append(a),s.append(r),s.width("38"),s},active:function(e,t){function n(){return!!parseInt(e.data.active)}function s(){return!!NewsletterPro.dataStorage.getNumber("configuration.VIEW_ACTIVE_ONLY")}function a(){n()?r.html('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>'):r.html('<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>')}var r=$('<a href="javascript:{}"></a>'),i=e.data;return a(),r.on("click",function(t){t.stopPropagation(),i.active=n()?0:1,e.update().done(function(t){t?s()?e.removeFromScreen():a():alert("error on subscribe or unsubscribe")})}),r},chackbox:function(e,t){var n=$('<input type="checkbox" value="'+t+'" '+(e.isChecked()?'checked="checked"':"")+"> ");return n},actions:function(e){var t=$("#delete-visitor-np").gkButton({name:"delete",title:p("delete"),className:"added-delete",item:e,command:"delete",confirm:function(){return confirm(p("delete added confirm"))},icon:'<i class="icon icon-trash-o"></i> '});return t}},h=t.dataStorage.get("configuration.SHOW_CUSTOM_COLUMNS"),g=t.dataStorage.get("custom_field.variables_types"),v=t.dataStorage.get("custom_field.types_cost"),w=25,b=new gkWindow({width:600,height:400,setScrollContent:340,title:p("Details"),className:"np-costum-fields-win",show:function(e){},close:function(e){},content:function(e){}}),y=[];if(g.length>0){for(var S=0;S<g.length;S++){var k=g[S];-1!=h.indexOf(k.variable_name)&&y.push(k)}for(var S=0;S<y.length;S++){var P=y[S];Number(P.type)==Number(v.TYPE_CHECKBOX)?f[P.variable_name]=function(e,t){var n=$('<a href="javascript:{}">...</a>'),s=t,a=t;try{var r=jQuery.parseJSON(t);s=r.join(", ")}catch(i){}return s.length<=w?(s=s,a=s):(a=s,tmpDisplayStr=s.slice(0,w),s=$("<span>"),s.append(tmpDisplayStr),s.append(n)),n.on("click",function(e){e.stopPropagation(),b.show(a)}),s}:f[P.variable_name]=function(e,t){var n=$('<a href="javascript:{}">...</a>'),s=t;return s.length<=w?s=s:(tmpDisplayStr=s.slice(0,w),s=$("<span>"),s.append(tmpDisplayStr),s.append(n)),n.on("click",function(e){e.stopPropagation(),b.show(t)}),s}}}m.gkGrid({dataSource:d,selectable:!1,checkable:!0,currentPage:1,pageable:!0,start:function(){n.visitorsNPAjaxLoader.show()},done:function(e){n.visitorsNPCount.html(e.items.length),n.visitorsNPAjaxLoader.hide()},template:f});var _,N,x,T,C,I,E,j,A,D,L,O,M,B,V,F,R,H={from:"",to:""},W=t.dataStorage.get("search_conditions.conditions"),G=t.dataStorage.get("search_conditions.conditions_const"),z=t.dataStorage.get("search_conditions.visitors_np_columns"),U=Number(G.SEARCH_CONDITION_CONTAINS),q=0;m.addFooter(function(n){function s(e){return r=$("<tr></tr>"),i=$('<td class="gk-footer" colspan="'+n+'"></td>'),$.each(e,function(e,t){i.append(t)}),r.html(i),r}function a(e){var t=$("#"+e).gkButton({name:e,title:p("check all"),className:e,css:{"padding-left":"10px","padding-right":"10px","margin-left":"0"},attr:{"data-checked":0},click:function(e){function n(){return!!t.data("checked")}function s(e,s){return n()?(t.data("checked",!1),t.changeTitle(s),!1):(t.data("checked",!0),t.changeTitle(e),!0)}s(p("uncheck all"),p("check all"))?d.checkAll():d.uncheckAll()}});return t}var r,i,o=function(){for(var e=t.dataStorage.get("custom_field.variables"),n=t.dataStorage.get("configuration.SHOW_CUSTOM_COLUMNS"),s="",a=0;a<e.length;a++){var r,i=e[a],o="",l=-1!=n.indexOf(i);r=i.split("_");for(var c=1;c<r.length;c++)o+=r[c][0].toUpperCase()+r[c].slice(1);s+='							<div class="checkbox">								<label class="control-label in-win">									<input type="checkbox" name="np_show_custom_colums_'+a+'" value="'+i+'" '+(l?'checked="checked"':"")+">									"+o+"								</label>							</div>"}var d=$('						<div class="form-group clearfix">							<label class="control-label col-sm-3" style="padding-top: 13px;">'+p("Show Columns")+'</label>							<div class="col-sm-9">								'+s+'							</div>						</div>						<div class="form-group clearfix">							<div class="col-sm-9 col-sm-offset-3">								<a href="javascript:{}" id="np-save-show-columns" class="btn btn-success pull-left"><i class="icon icon-save"></i> '+p("Save")+"</a>							</div>						</div>					"),u=d.find("#np-save-show-columns");return u.on("click",function(){var e=[];$.each(d.find('[name^="np_show_custom_colums"]:checked'),function(t,n){e.push($(n).val())}),$.postAjax({submit_custom_field:"saveShowColumns",columns:e}).done(function(e){e.success?location.reload():t.alertErrors(e.errors)})}),d},l=new gkWindow({width:600,height:400,setScrollContent:340,title:p("Display Custom Columns"),className:"np-costum-fields-win",show:function(e){$.postAjax({submit_custom_field:"getCustomColumns"}).done(function(n){n.success&&(t.dataStorage.set("custom_field.variables",n.variables),e.setContent(o()))})},close:function(e){},content:function(e){return o()}});e.addVar("winDisplayCustomColumns",l);var c=$('<a href="javascript:{}" class="btn btn-default pull-right"><i class="icon icon-eye"></i> '+p("Display Custom Columns")+"</a>");return c.on("click",function(){l.show()}),_=a("check-toggle"),N=a("check-toggle-search"),N.addClass("gk-onfilter"),N.hide(),e.addVar("visitorsNPCheckAll",_),btnExportCsv=e.buildExportToCSVData(d,NewsletterPro.dataStorage.get("csv_export_list_ref.LIST_VISITORS_NP")),btnExportCsv.css({"margin-right":"3px"}),s([_,N,c,btnExportCsv])},"prepend"),m.addHeader(function(n){function i(e){return g=$("<tr></tr>"),v=$('<th class="gk-header-datagrid visitors-np-header" colspan="'+n+'"></th>'),$.each(e,function(e,t){v.append(t)}),g.html(v),g}function c(e){$.postAjax({submit:"getFilterByBirthdayContent",fbb_class:"visitorsNP"},"html").done(function(t){e($(t))})}function u(){return H}function m(e){var t=e.selectedYear,n=1==String(e.selectedMonth).length?"0"+String(e.selectedMonth+1):String(e.selectedMonth+1),s=1==String(e.selectedDay).length?"0"+String(e.selectedDay):String(e.selectedDay);return mysql_date=t+"-"+n+"-"+s}function f(){return{min:"undefined"!=typeof E?E.getValueMin():0,max:"undefined"!=typeof E?E.getValueMax():0}}function h(e){var n={shops:O.getSelected(),languages:L.getSelected(),gender:M.getSelected(),subscribed:B.getSelected(),by_interest:V.getSelected(),by_birthday:u()},s=!1;$.each(n,function(e,t){t.length&&(s=!0)}),""==$.trim(n.by_birthday.from)||""==$.trim(n.by_birthday.to)?delete n.by_birthday:s=!0,"range"==e&&(n.range_selection=f(),0==$.trim(n.range_selection.min)||0==$.trim(n.range_selection.max)?delete n.range_selection:s=!0),s?(T.val(""),"undefined"!=typeof C&&(C.val(U),I.val(q),t.dataStorage.set("search_conditions.selected_condition",U),t.dataStorage.set("search_conditions.selected_field",q)),_.hide(),N.css({display:"inline-block"}),d.filter(n).done(function(t){d.applySearch(t),l(e,1,t.length)})):(l(e,1,o()),_.show(),N.hide(),d.clearSearch())}var g,v;L=$("#gk-filter-languages").gkDropDownMenu({title:p("languages"),name:"gk-filter-languages",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.data.filter_languages,change:function(e){h()}}),O=$("#gk-filter-shops").gkDropDownMenu({title:p("shops"),name:"gk-filter-shops",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.data.filter_shops,change:function(e){h()}}),M=$("#gk-filter-gender-np").gkDropDownMenu({title:p("gender"),name:"gk-filter-gender",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.get("filter_genders"),change:function(e){h()}}),B=$("#gk-filter-subscribed-np").gkDropDownMenu({title:p("subscribed"),name:"gk-filter-gender",css:{"float":"left","margin-right":"10px"},data:[{title:p("yes"),value:1},{title:p("no"),value:0}],change:function(e){h("subscribed")}}),NewsletterPro.dataStorage.get("view_active_only")&&B.hide(),V=$("#gk-filter-by-interest-np").gkDropDownMenu({title:p("by list of interest"),name:"gk-filter-gender",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.get("filter_list_of_interest"),activeClass:{enable:"",disable:"btn-filter-list-of-interst-inactive"},change:function(e){h()}});var w=new gkWindow({width:640,height:320,title:p("filter by birthday"),className:"filter-by-birthday-window",show:function(e){},close:function(e){},content:function(t,n){return c(function(n){t.setContent(n),j=n.find("#fbb-from-visitorsNP"),A=n.find("#fbb-to-visitorsNP"),D=n.find("#fbb-clear-visitorsNP"),j.datepicker({dateFormat:e.box.dataStorage.get("jquery_date_birthday"),onSelect:function(e,t){s(m(t)),h("birthday")},beforeShow:function(e,t){t.dpDiv.hasClass("date-birthday")||t.dpDiv.addClass("date-birthday")}}),A.datepicker({dateFormat:e.box.dataStorage.get("jquery_date_birthday"),onSelect:function(e,t){a(m(t)),h("birthday")},beforeShow:function(e,t){t.dpDiv.hasClass("date-birthday")||t.dpDiv.addClass("date-birthday")}}),j.on("change",function(){""==$.trim($(this).val())&&(s(""),h("birthday"))}),A.on("change",function(){""==$.trim($(this).val())&&(a(""),h("birthday"))}),D.on("click",function(){r(),h("birthday")})}),'<span class="ajax-loader" style="margin-left: 310px; margin-top: 119px;"></span>'}});F=$("#by-birthday-filters").gkButton({name:"by-birthday-filters",title:p("by birthday"),className:"by-birthday-filters",css:{"padding-left":"10px","padding-right":"10px","float":"left","margin-right":"10px",position:"relative"},attr:{"data-checked":0},click:function(e){w.show()}});var b=new gkWindow({width:640,height:150,title:p("range selection"),className:"range-selection-window",show:function(e){"undefined"!=typeof E&&E.refresh()},close:function(e){},content:function(t,n){return d.ready().done(function(){e.getRangeSelectionContent(function(e){t.setContent(e),E=gkSliderRange({target:e.find("#slider-range-selection"),min:1,max:o(),valueMin:1,valueMax:o(),editable:!0,values:[1,o()],move:function(e){},done:function(e){h("range")}})})}),'<span class="ajax-loader" style="margin-left: 310px; margin-top: 36px;"></span>'}});R=$("#range-selection-added").gkButton({name:"range-selection-added",title:p("range selection"),className:"range-selection",css:{"padding-left":"10px","padding-right":"10px","float":"left","margin-right":"10px",position:"relative"},attr:{"data-checked":0},click:function(e){b.show()}});var y=$('<span style="margin-left: 0px; margin-right: 10px; float: left; line-height: 28px;">'+p("filters")+"</span>");return e.reset=e.reset||{},e.reset.visitorsNP=e.reset.visitorsNP||{},e.reset.visitorsNP.filterLanguages=L,e.reset.visitorsNP.filterShops=O,e.reset.visitorsNP.filterGender=M,e.reset.visitorsNP.filterSubscribed=B,e.reset.visitorsNP.filterByInterest=V,e.reset.visitorsNP.filterByBirthday=F,e.reset.visitorsNP.rangeSelection=R,e.addVar("filterVisitorNP",{languages:L,shops:O,gender:M,subscribed:B,filter_by_interest:V,by_birthday:F,range:R}),e.addVar("applyFilerVisitorNpCallback",h),i([y,L,O,M,B,V,F,R])},"prepend"),m.addHeader(function(n){function s(e){return a=$("<tr></tr>"),o=$('<th class="gk-header-datagrid visitors-np-header" colspan="'+n+'"></th>'),$.each(e,function(e,t){o.append(t)}),a.html(o),a}var a,o,l,c,m,f=null;t.dataStorage.set("search_conditions.selected_condition",U),t.dataStorage.set("search_conditions.selected_field",q),l=$('<div class="visitors-np-search-div"></div>'),T=$('<input class="gk-input visitors-np-search" type="text">'),x=$('<span class="visitors-np-search-loading" style="display: none;"></span>'),T.on("keyup",function(e){var t=$.trim(T.val());return t.length<=0?(_.show(),N.hide(),d.clearSearch(),!0):(_.hide(),N.css({display:"inline-block"}),x.show(),null!=f&&clearTimeout(f),void(f=setTimeout(function(){var e={};"undefined"!=typeof C&&(e={selected_condition:Number(C.val()),selected_field:I.val()}),d.search(t,{conditions:e}).done(function(e){d.applySearch(e),x.hide()})},300)))}),c=$("<span>"+p("search")+":</span>"),l.append(T),l.append(x),u=$("#clear-filters").gkButton({name:"clear-filters",title:p("clear filters"),className:"clear-filters",css:{"padding-left":"10px","padding-right":"10px","margin-left":"0","margin-right":"0",position:"absolute",right:"5px"},attr:{"data-checked":0},click:function(e){T.val(""),"undefined"!=typeof C&&(C.val(U),I.val(q),t.dataStorage.set("search_conditions.selected_condition",U),t.dataStorage.set("search_conditions.selected_field",q)),O.uncheckAll(),M.uncheckAll(),B.uncheckAll(),V.uncheckAll(),L.uncheckAll(),i(),r(),_.show(),N.hide(),d.clearSearch()},icon:'<i class="icon icon-times"></i> '});var h="";for(var g in W)h+='<option value="'+g+'" '+(Number(g)==U?'selected="selected"':"")+">"+W[g]+"</option>";for(var v="",w=0;w<z.length;w++){for(var b=z[w],y=b.replace(/^np_/,"").split("_"),S="",k=0;k<y.length;k++)y[k]=y[k][0].toUpperCase()+y[k].slice(1);S=y.join(" "),v+='<option value="'+b+'">'+S+"</option>"}return m=$('					<div class="np-visitors-np-search-filter-condition-div">						<select id="np-visitors-np-select-search-filter-condition-div" class="form-control fixed-width-l">							'+h+'						</select>					</div>					<div class="np-visitors-np-search-filter-columns-div">						<select id="np-visitors-np-select-search-filter-columns-div" class="form-control fixed-width-l">							<option value="'+q+'" selected="selected">'+p("all fields")+"</option>							"+v+"						</select>					</div>				"),C=m.find("#np-visitors-np-select-search-filter-condition-div"),I=m.find("#np-visitors-np-select-search-filter-columns-div"),C.on("change",function(){t.dataStorage.set("search_conditions.selected_condition",Number($(this).val())),T.trigger("keyup")}),I.on("change",function(){t.dataStorage.set("search_conditions.selected_field",$(this).val()),T.trigger("keyup")}),e.reset=e.reset||{},e.reset.visitorsNP=e.reset.visitorsNP||{},e.reset.visitorsNP.clearFilters=u,e.vars.filterVisitorNP.clear=u,e.addVar("visitorsNP",d),s([c,l,m,u])},"prepend");e.resetVisitorsNPButton()}})},initAddedGrid:function(){var e=this;e.ready(function(t){function n(){a("clear",1,s())}function s(){return i.items.length}function a(e,t,n){if("range"!==e&&"undefined"!=typeof m){var s={min:t,max:n,valueMin:t,valueMax:n,values:[t,n]};0>=n&&(s.snap=0,s.min=0,s.max=1),m.reset(s),m.resetPositionMin(),m.resetPositionMax()}}var r,i,o=NewsletterPro.translations.l(NewsletterPro.translations.modules.sendNewsletters),l=t.addedGrid;r=new gk.data.Model({id:"id_newsletter_pro_email"}),i=new gk.data.DataSource({pageSize:10,transport:{read:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=getAdded",dataType:"json"},create:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=createAdded",dataType:"json"},update:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=updateAdded&id",dataType:"json"},destroy:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=deleteAdded&id",type:"POST",dateType:"json",success:function(e,t){e||alert(o("delete record"))},error:function(e,t){alert(o("delete record"))},complete:function(e,t){}},search:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=searchAdded&value",dataType:"json"},filter:{url:NewsletterPro.dataStorage.get("ajax_url")+"&submit=filterAdded",dataType:"json"}},schema:{model:r},trySteps:2,errors:{read:function(e,t,n){i.syncStepAvailableAdd(3e3,function(){i.sync()})}}}),l.gkGrid({dataSource:i,selectable:!1,checkable:!0,currentPage:1,pageable:!0,start:function(){t.addedAjaxLoader.show()},done:function(e){t.addedCount.html(e.items.length),t.addedAjaxLoader.hide()},template:{img_path:function(e,t){return'<img src="'+t+'">'},active:function(e,t){function n(){return!!parseInt(e.data.active)}function s(){return!!NewsletterPro.dataStorage.getNumber("configuration.VIEW_ACTIVE_ONLY")}function a(){n()?r.html('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>'):r.html('<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>')}var r=$('<a href="javascript:{}"></a>'),i=e.data;return a(),r.on("click",function(t){t.stopPropagation(),i.active=n()?0:1,e.update().done(function(t){t?s()?e.removeFromScreen():a():alert("error on subscribe or unsubscribe")})}),r},chackbox:function(e,t){var n=$('<input type="checkbox" value="'+t+'" '+(e.isChecked()?'checked="checked"':"")+"> ");return n},actions:function(e){var t=$("#delete-added").gkButton({name:"delete",title:o("delete"),className:"added-delete",item:e,command:"delete",confirm:function(){return confirm(o("delete added confirm"))},icon:'<i class="icon icon-trash-o"></i> '});return t}}});var c,d,u,p,m;l.addFooter(function(n){function s(e){return l=$("<tr></tr>"),u=$('<td class="gk-footer" colspan="'+n+'"></td>'),$.each(e,function(e,t){u.append(t)}),l.html(u),l}function a(e){var t=$("#"+e).gkButton({name:e,title:o("check all"),className:e,css:{"padding-left":"10px","padding-right":"10px","margin-left":"0"},attr:{"data-checked":0},click:function(e){function n(){return!!t.data("checked")}function s(e,s){return n()?(t.data("checked",!1),t.changeTitle(s),!1):(t.data("checked",!0),t.changeTitle(e),!0)}s(o("uncheck all"),o("check all"))?i.checkAll():i.uncheckAll()}});return t}function r(){var e=t.addNewEmailTemplate.find('input[name="firstname"], input[name="lastname"], input[name="email"]');e.length&&$.each(e,function(e,t){$(t).val("")}),t.addNewEmailError.html("")}var l,u,p,m;c=a("check-toggle"),d=a("check-toggle-search"),d.addClass("gk-onfilter"),d.hide(),e.addVar("addedCheckAll",c),p=$("#add-new-email").gkButton({title:o("add"),name:"add-new-email",className:"add-new-email btn-margin",css:{"margin-right":"0"},click:function(e){m.show()},icon:'<i class="icon icon-plus-square"></i> '}),m=new gkWindow({width:400,title:o("add title"),className:"add-new-email-window",show:function(e){},close:function(e){r()},content:function(e){var n=t.addNewEmail,s=t.addNewEmailForm,a=t.addNewEmailError;return n.on("click",function(t){i.create(s.getFormData()).done(function(t){t.status?(i.sync(),i.dataGrid.footer.setCheckedInfo(0),r(),e.hide()):t.errors.length&&a.html(t.errors[0])})}),t.addNewEmailTemplate}});var f=$("#added-empty").gkButton({title:o("empty list"),name:"added-empty",className:"added-empty btn-margin",css:{"padding-left":"10px","padding-right":"10px"},click:function(e){confirm(o("empty list confirm"))&&$.postAjax({submit:"emptyAddedEmails"}).done(function(e){e.status?i.sync():alert(o("empty list error"))})},icon:'<i class="icon icon-trash-o"></i> '}),h=$("<div></div>");return h.css({display:"inline-block","float":"right"}),h.append(f),h.append(p),btnExportCsv=e.buildExportToCSVData(i,NewsletterPro.dataStorage.get("csv_export_list_ref.LIST_ADDED")),btnExportCsv.css({"margin-right":"2px"}),s([c,d,h,btnExportCsv])},"prepend"),l.addHeader(function(t){function r(e){return h=$("<tr></tr>"),g=$('<th class="gk-header-datagrid added-header" colspan="'+t+'"></th>'),$.each(e,function(e,t){g.append(t)}),h.html(g),h}function l(){return{min:"undefined"!=typeof m?m.getValueMin():0,max:"undefined"!=typeof m?m.getValueMax():0}}function f(e){var t={shops:S.getSelected(),subscribed:P.getSelected(),languages:y.getSelected(),csv_name:k.getSelected()},n=!1;$.each(t,function(e,t){t.length&&(n=!0)}),"range"==e&&(t.range_selection=l(),0==$.trim(t.range_selection.min)||0==$.trim(t.range_selection.max)?delete t.range_selection:n=!0),n?(p.val(""),c.hide(),d.css({display:"inline-block"}),i.filter(t).done(function(t){i.applySearch(t),a(e,1,t.length)})):(a(e,1,s()),c.show(),d.hide(),i.clearSearch())}var h,g,v,w,b=null;v=$('<div class="added-search-div" style="margin-right: 10px; float: left;"></div>'),p=$('<input class="gk-input added-search" type="text">'),u=$('<span class="added-search-loading" style="display: none;"></span>'),p.on("keyup",function(e){var t=$.trim(p.val());return t.length<3?(c.show(),d.hide(),i.clearSearch(),!0):(c.hide(),d.css({display:"inline-block"}),u.show(),null!=b&&clearTimeout(b),void(b=setTimeout(function(){i.search(t).done(function(e){i.applySearch(e),u.hide()})},300)))}),w=$('<span style="margin-right: 10px; float: left;">'+o("search")+":</span>"),v.append(p),v.append(u);var y=$("#gk-filter-languages").gkDropDownMenu({title:o("languages"),name:"gk-filter-languages",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.data.filter_languages,change:function(e){f()}}),S=$("#gk-filter-shops").gkDropDownMenu({title:o("shops"),name:"gk-filter-shops",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.data.filter_shops,change:function(e){f()}}),k=$("#gk-filter-csv-name").gkDropDownMenu({title:o("CSV Name"),name:"gk-filter-csv-name",css:{"float":"left","margin-right":"10px"},data:NewsletterPro.dataStorage.get("csv_name"),change:function(e){f()}}),P=$("#gk-filter-subscribed-add").gkDropDownMenu({title:o("subscribed"),name:"gk-filter-gender",css:{"float":"left","margin-right":"10px"},data:[{title:o("yes"),value:1},{title:o("no"),value:0}],change:function(e){f("subscribed")}});NewsletterPro.dataStorage.get("view_active_only")&&P.hide();var _=new gkWindow({width:640,height:150,title:o("range selection"),className:"range-selection-window",show:function(e){"undefined"!=typeof m&&m.refresh()},close:function(e){},content:function(t,n){return i.ready().done(function(){e.getRangeSelectionContent(function(e){t.setContent(e),m=gkSliderRange({target:e.find("#slider-range-selection"),min:1,max:s(),valueMin:1,valueMax:s(),editable:!0,values:[1,s()],move:function(e){},done:function(e){f("range")}})})}),'<span class="ajax-loader" style="margin-left: 310px; margin-top: 36px;"></span>'}}),N=$("#range-selection-added").gkButton({name:"range-selection-added",title:o("range selection"),className:"range-selection",css:{"padding-left":"10px","padding-right":"10px","float":"left","margin-right":"10px",position:"relative"},attr:{"data-checked":0},click:function(e){_.show()}}),x=$('<span style="margin-left: 20px; margin-right: 10px; float: left; line-height: 28px;">'+o("filters")+"</span>"),T=$("#clear-filters").gkButton({name:"clear-filters",title:o("clear filters"),className:"clear-filters",css:{"padding-left":"10px","padding-right":"10px","margin-left":"0","margin-right":"0",position:"absolute",right:"5px"},attr:{"data-checked":0},click:function(e){p.val(""),S.uncheckAll(),k.uncheckAll(),P.uncheckAll(),y.uncheckAll(),n(),c.show(),d.hide(),i.clearSearch()},icon:'<i class="icon icon-times"></i> '});return e.reset=e.reset||{},e.reset.added={filterLanguages:y,filterShops:S,filterCSVName:k,filterSubscribed:P,rangeSelection:N,clearFilters:T},e.addVar("filterAdded",{languages:y,shops:S,csv_name:k,subscribed:P,range:N,clear:T}),e.addVar("applyFilerAddedCallback",f),e.addVar("added",i),r([w,v,x,y,S,k,P,N,T])},"prepend");e.resetAddedButton()})},getSelectOptions:function(e){e=$.extend(!0,{},e);var t=$.map(e,function(e){var t={name:e.name,value:e.id_newsletter_pro_smtp,data:e};return e.hasOwnProperty("selected")&&(delete e.selected,t.selected=!0),t});return t}}.init(NewsletterPro),NewsletterPro.namespace("modules.sendManager"),NewsletterPro.modules.sendManager={define:{STATE_DEFAULT:0,
STATE_PAUSE:1,STATE_IN_PROGRESS:2,STATE_DONE:3},dom:null,box:null,vars:{},events:{},showErrorTimer:null,init:function(e){var t,n,s,a,r,i,o=this,l=!1,c=!1;return this.ready(function(d){function u(){a.clear(),r.clear(),i.clear(),o.hideError(),o.step3(!1)}function p(){i.setPause(!1),d.pauseSendNewsletters.show(),d.stopSendNewsletters.show(),d.continueSendNewsletters.hide(),d.startSendNewsletters.hide(),d.newTask.hide(),d.prevStep.hide(),o.step3(!0)}function m(){i.setPause(!0),d.continueSendNewsletters.show(),d.stopSendNewsletters.show(),d.pauseSendNewsletters.hide(),d.startSendNewsletters.hide(),d.newTask.hide(),d.prevStep.hide(),o.step3(!1)}function f(){i.setPause(!1),d.startSendNewsletters.show(),d.newTask.show(),d.prevStep.show(),d.stopSendNewsletters.hide(),d.pauseSendNewsletters.hide(),d.continueSendNewsletters.hide(),o.step3(!1)}function h(){return{startSendNewsletters:d.startSendNewsletters.is(":visible"),stopSendNewsletters:d.stopSendNewsletters.is(":visible"),pauseSendNewsletters:d.pauseSendNewsletters.is(":visible"),continueSendNewsletters:d.continueSendNewsletters.is(":visible"),prevStep:d.prevStep.is(":visible"),newTask:d.newTask.is(":visible")}}function g(e){for(var t in e){var n=e[t];n?d[t].show():d[t].hide()}}var v=1e3*Number(e.dataStorage.get("email_sleep")),w=3e3,b=v>w?v:w;t=o.l=e.translations.l(e.translations.modules.sendManager),n=NewsletterProControllers,s=new e.components.SyncNewsletters({syncErrorsLimit:250,connection:{url:e.getUrl({submit:"syncNewsletters"}),limit:250,data:{},refreshRate:b},subscription:{ready:["emailsToSend","emailsSent","progressbar"]}}),o.addVar("syncNewsletters",s),a=new e.components.EmailsToSend({selector:d.emailsToSend,fastPerformance:!0,subscription:[[s,"emailsToSend","sync"]]}),o.addVar("emailsToSend",a),r=new e.components.EmailsSent({selector:d.emailsSent,fastPerformance:!0,subscription:[[s,"emailsSent","sync"]]}),o.addVar("emailsSent",r),i=new e.components.SendProgressbar({selector:$("#send-progressbar"),subscription:[[s,"progressbar","sync"]]}),o.addVar("sendProgressbar",i),s.subscribe("syncStart",function(e){p()}),s.subscribe("syncPause",function(e){m()}),s.subscribe("syncDone",function(t){f(),e.modules.task.ui.components.sendHistory.sync()}),s.subscribe("syncContinue",function(e){}),s.subscribe("syncSuccess",function(e){}),s.subscribe("syncError",function(t){var n=t.message,s=t.alertErrors,a=t.display;a?o.showError(n,1e4):s&&(o.showError(n,0),e.alertErrors(n))}),s.subscribe("syncEnd",function(e){l&&(l=!1,u())}),s.subscribe("beforeRequest",function(){c?(s.setData("getLastId",!0),c=!1):s.setData("getLastId",!1)}),r.subscribe("lastItemCreated",function(e){}),r.subscribe("firstItemCreated",function(e){e&&e.errors.length&&o.showError(e.errors,7e3)}),d.startSendNewsletters.on("click",function(){u();var e=n.SendController.prepareEmails();if("undefined"!=typeof e){var t=h();p(),e.done(function(e){e.status?c=!0:g(t)}).fail(function(){g(t)})}}),d.pauseSendNewsletters.on("click",function(){var e=h();m(),o.pauseSendNewsletters().done(function(t){t.success||g(e)}).fail(function(){g(e)})}),d.stopSendNewsletters.on("click",function(){var t=h();f(),o.stopSendNewsletters().done(function(n){n.success?(l=!0,u(),e.modules.task.ui.components.sendHistory.sync()):g(t)}).fail(function(){g(t)})}),d.continueSendNewsletters.on("click",function(){var e=h();p(),o.continueSendNewsletters(!0).done(function(t){t.success||g(e)}).fail(function(){g(e)})})}),o},requireConnection:function(e){var t=this;return e.hasOwnProperty("require_connection")&&e.require_connection?(setTimeout(function(){t.continueSendNewsletters()},2500),!0):!1},step3:function(e){var t=this;e?t.dom.step3.html('<i class="icon icon-refresh icon-spin"></i>'):t.dom.step3.html("3")},connectionAvailable:function(e){$.postAjax({submit:"connectionAvailable"},"json",!1).done(function(t){e(t)})},startSendNewsletters:function(e){var t=NewsletterPro,n=this;return e="undefined"==typeof e?0:Number(e),n.vars.syncNewsletters.sync(),$.postAjax({submit:"startSendNewsletters",trigger:e},"json",!1).done(function(e){e.success||n.showError(e.errors),n.requireConnection(e)}).fail(function(e,s,a){n.showError(n.l("Error")+" : "+t.getXHRError(e))}).promise()},continueSendNewsletters:function(e){var t=NewsletterPro,n=this;return e="undefined"==typeof e?0:Number(e),n.vars.syncNewsletters.sync(),$.postAjax({submit:"continueSendNewsletters",trigger:e},"json",!1).done(function(e){e.success||n.showError(e.errors),n.requireConnection(e)}).fail(function(e,s,a){n.showError(n.l("Error")+" : "+t.getXHRError(e))}).promise()},pauseSendNewsletters:function(){var e=NewsletterPro;return $.postAjax({submit:"pauseSendNewsletters"}).done(function(t){t.success||e.alertErrors(t.errors)}).promise()},stopSendNewsletters:function(){var e=NewsletterPro;return $.postAjax({submit:"stopSendNewsletters"}).done(function(t){t.success||e.alertErrors(t.errors)}).promise()},showError:function(e,t){var n=this,s=n.dom;if("string"!=typeof e&&(e=e.join("<br>")),s.lastSendErrorDiv.show(),s.lastSendError.show().html(e),"undefined"!=typeof t){if(null!=n.showErrorTimer&&clearTimeout(n.showErrorTimer),0===t)return;n.showErrorTimer=setTimeout(function(){n.hideError()},t)}},hideError:function(){var e=this,t=e.dom;t.lastSendErrorDiv.hide(),t.lastSendError.hide().html("")},addEvent:function(e,t){this.events[e]=t},triggerEvent:function(e){this.events.hasOwnProperty(e)&&"function"==typeof this.events[e]&&this.events[e]()},addVar:function(e,t){this.vars=this.vars||{},this.vars[e]=t},ready:function(e){var t=this;$(document).ready(function(){t.dom=t.dom||{startSendNewsletters:$("#send-newsletters"),stopSendNewsletters:$("#stop-send-newsletters"),pauseSendNewsletters:$("#pause-send-newsletters"),continueSendNewsletters:$("#continue-send-newsletters"),prevStep:$("#previous-send-newsletters"),newTask:$("#new-task"),emailsToSend:$("#emails-to-send"),emailsSent:$("#emails-sent"),lastSendErrorDiv:$("#last-send-error-div"),lastSendError:$("#last-send-error"),step3:$("#np-step-3")},e(t.dom)})}}.init(NewsletterPro),NewsletterPro.namespace("modules.smtp"),NewsletterPro.modules.smtp={dom:null,init:function(e){var t=this;return t.ready(function(n){function s(){i()?r():a()}function a(){n.smptConfigBox.is(":visible")&&n.smptConfigBox.slideUp("slow")}function r(){n.smptConfigBox.is(":visible")||n.smptConfigBox.slideDown("slow")}function i(){return Boolean(e.dataStorage.data.smtp_active)}function o(e){e?(n.listUnsubscribeEmailBox.show(),$('input[name="list_unsubscribe_active"][value="1"]').prop("checked",!0),$('input[name="list_unsubscribe_active"][value="0"]').prop("checked",!1)):(n.listUnsubscribeEmailBox.hide(),$('input[name="list_unsubscribe_active"][value="0"]').prop("checked",!0),$('input[name="list_unsubscribe_active"][value="1"]').prop("checked",!1))}function l(e){var t=Number(e.list_unsubscribe_active);o(t?1:0),n.listUnsubscribeEmail.val(e.list_unsubscribe_email),$("#smtpForm [name=method]").prop("checked",!1),1==e.method?n.smtpMethodMail.prop("checked",!0):n.smtpMethodSmtp.prop("checked",!0),d(e.method),n.smptId.val(e.id_newsletter_pro_smtp),n.smtpName.val(e.name),n.smtpFromName.val(e.from_name),n.smtpFromEmail.val(e.from_email),n.smtpFromReplyTo.val(e.reply_to),n.smtpDomain.val(e.domain),n.smtpServer.val(e.server),n.smtpUser.val(e.user),n.smtpPasswd.val(e.passwd),n.smtpEncryption.val(e.encryption),n.smtpPort.val(e.port)}function c(){o(0),n.listUnsubscribeEmail.val(""),n.smptId.val("0"),n.smtpName.val(""),n.smtpFromName.val(""),n.smtpFromEmail.val(""),n.smtpFromReplyTo.val(""),n.smtpDomain.val(""),n.smtpServer.val(""),n.smtpUser.val(""),n.smtpPasswd.val(""),n.smtpEncryption.val(""),n.smtpPort.val("")}function d(e){switch(e){case"1":n.smtpOnly.slideUp();break;case"2":n.smtpOnly.slideDown()}}var u,p;s(),$('input[name="list_unsubscribe_active"]').on("change",function(){var e=Number($(this).val());e?n.listUnsubscribeEmailBox.slideDown():n.listUnsubscribeEmailBox.slideUp()});var m=$.map(NewsletterPro.dataStorage.get("all_smtp"),function(e){var t={name:e.name,value:e.id_newsletter_pro_smtp,data:e};if(e.hasOwnProperty("selected")&&(delete e.selected,t.selected=!0,n.smtpActive.is(":checked"))){var s=$.extend(!0,{},e);s.passwd="",l(s)}return t});m.length>0?(n.saveSmtp.show(),n.deleteSmtp.show()):(n.saveSmtp.hide(),n.deleteSmtp.hide());var f=t.ui,h=f.SelectOption({name:"smptSelect",template:n.selectSmtp,className:"gk-smtp-select",options:m,onChange:function(e){var t=e.getSelected();if(null!=t){var s=t.data,a=Number(t.data.id_newsletter_pro_smtp),r=$.extend(!0,{},s);d(s.method),r.passwd="",l(r),$.postAjax({submit:"changeSMTP",changeSMTP:a}).done(function(e){e.status||n.smtpMessage.empty().show().append('<div class="alert alert-danger">'+e.msg+"</div>"),setTimeout(function(){n.smtpMessage.hide()},5e3)})}}});f.Button({name:"saveSmtp",template:n.saveSmtp,click:function(){n.saveSmtpMessage.hide(),$.submitAjax({submit:"saveSMTP",name:"saveSMTP",form:n.smtpForm}).done(function(e){if(u=u||NewsletterPro.modules.task.ui.components.taskList,p=p||NewsletterPro.dataStorage,e.status){var t=e.obj;h.updateOption(t),n.saveSmtpSuccess.empty().show().append('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>')}else e.errors.length>0?n.saveSmtpMessage.empty().show().append(e.errors.join("<br />")):n.saveSmtpSuccess.empty().show().append('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>');$.postAjax({submit:"getAllSMTPJson",getAllSMTPJson:!0}).done(function(e){p.add("all_smtp",e),u.sync()}),setTimeout(function(){n.saveSmtpSuccess.hide()},5e3),setTimeout(function(){n.saveSmtpMessage.hide()},5e3)})}}),f.Button({name:"addSmtp",template:n.addSmtp,click:function(){$.submitAjax({submit:"addSMTP",name:"addSMTP",form:n.smtpForm}).done(function(e){if(u=u||NewsletterPro.modules.task.ui.components.taskList,p=p||NewsletterPro.dataStorage,e.status){var t=e.obj;h.addOption({name:t.name,value:t.name,data:t,selected:!0}),n.smptId.val(t.id_newsletter_pro_smtp),n.saveSmtpSuccess.empty().show().append('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>');var s=h.getOptions();s.length>0&&(n.saveSmtp.show(),n.deleteSmtp.show())}else n.saveSmtpMessage.empty().show().append(e.errors.join("<br />"));$.postAjax({submit:"getAllSMTPJson",getAllSMTPJson:!0}).done(function(e){p.add("all_smtp",e),u.sync()}),setTimeout(function(){n.saveSmtpSuccess.hide()},5e3),setTimeout(function(){n.saveSmtpMessage.hide()},15e3)})}}),f.Button({name:"deleteSmtp",template:n.deleteSmtp,click:function(){var t=h.getSelected();if(null!=t){var s=t.data.id_newsletter_pro_smtp;$.postAjax({submit:"deleteSMTP",deleteSMTP:s}).done(function(s){if(s.hasOwnProperty("demo_mode")&&1==s.demo_mode&&s.errors.length>0)return void NewsletterPro.alertErrors(s.errors);if(u=u||NewsletterPro.modules.task.ui.components.taskList,p=p||NewsletterPro.dataStorage,s.status){t.destroy();var a=h.getSelected();if(null!=a){var r=$.extend(!0,{},a.data),i=r.id_newsletter_pro_smtp;r.passwd="",n.smptId.val(r.id_newsletter_pro_smtp),$.postAjax({submit:"changeSMTP",changeSMTP:i}).done(function(e){e.status||n.smtpMessage.empty().show().append('<span class="error-msg">'+e.msg+"</span>"),setTimeout(function(){n.smtpMessage.hide()},5e3)}),l(r)}else c(),n.saveSmtp.hide(),n.deleteSmtp.hide()}else e.alertErrors(s.errors);$.postAjax({submit:"getAllSMTPJson",getAllSMTPJson:!0}).done(function(e){p.add("all_smtp",e),u.sync()})})}}});n.smtpActive.on("change",function(){$(this).is(":checked")?$.postAjax({submit:"smtpActive",smtpActive:!0}).done(function(e){if(1==e.status){h.enable();var t=h.getSelected();if(null!=t){var n=t.data,s=$.extend(!0,{},n);s.passwd="",l(s)}r()}}):$.postAjax({submit:"smtpActive",smtpActive:!1}).done(function(e){1==e.status&&(h.disable(),c(),a())})}),n.smtpTestInput.on("blur",function(){e.dataStorage.set("configuration.PS_SHOP_EMAIL",$(this).val())});f.Button({name:"smtpTestButton",template:n.smtpTestButton,click:function(){var t=n.smtpTestMessage,s=n.smtpTestSuccess,a=n.smtpTestInput.val(),r=$(this);s.hide(),t.hide(),e.showAjaxLoader(r),$.postAjax({submit:"sendMailTest",sendMailTest:a}).done(function(e){e.status?s.empty().show().append('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>'):t.empty().show().append('<div class="alert alert-danger">'+e.msg+"</div>"),setTimeout(function(){s.hide(),t.hide()},1e4)}).always(function(){e.hideAjaxLoader(r)})}});$('#smtpForm [name="method"]').on("change",function(){d($(this).val())})}),t},ready:function(e){var t=this;$(document).ready(function(){t.dom={smtpOnly:$("#smtp-only"),selectSmtp:$("#select-smtp"),smtpActive:$("#smtp-active"),smtpFromName:$("#smtp-from-name"),smtpFromEmail:$("#smtp-from-email"),smtpFromReplyTo:$("#smtp-reply-to"),smtpMethodSmtp:$("#method-smtp"),smtpMethodMail:$("#method-mail"),smtpName:$("#smtp-name"),smtpDomain:$("#smtp-domain"),smtpServer:$("#smtp-server"),smtpUser:$("#smtp-user"),smtpPasswd:$("#smtp-passwd"),smtpEncryption:$("#smtp-encryption"),smtpPort:$("#smtp-port"),saveSmtp:$("#save-smtp"),addSmtp:$("#add-smtp"),deleteSmtp:$("#delete-smtp"),smtpMessage:$("#change-smtp-message"),saveSmtpMessage:$("#save-smtp-message"),saveSmtpSuccess:$("#save-smtp-success"),smtpForm:$("#smtpForm"),smtpTestInput:$("#smtp-test-email"),smtpTestMessage:$("#smtp-test-email-message"),smtpTestSuccess:$("#smtp-test-email-success"),smtpTestButton:$("#smtp-test-email-button"),listUnsubscribeEmailBox:$("#smtp-list-unsubscribe-email-box"),listUnsubscribeEmail:$("#smtp-list-unsubscribe-email"),smptId:$("#smpt-id"),smptConfigBox:$("#smpt-config-box")},e(t.dom)})},each:function(e,t){for(var n in e)t(e[n],n)},ui:{components:{},init:function(){return this},add:function(e,t){this.components[e]=t},SelectOption:function d(e){function t(e){e=$(e),o.template=e,e.attr({autocomplete:"off"}),e.addClass("gk-select"),e.addClass(u),e.options=[],r.each(p,function(e){s(e)}),n(e)}function n(e){e.on("change",function(t){o.onChange.call(e,o)})}function s(e){o.template.show();var t=$('<option value="'+e.value+'">'+e.name+"</option>"),n=e.data||{};e.hasOwnProperty("selected")&&e.selected&&(t.prop("selected",!0),o.selected=t),t.data=n,t.dataInit=e,o.template.options.push(t),o.template.append(t),t.destroy=function(){var e=o.template.options.indexOf(this);e>-1&&o.template.options.splice(e,1),this.remove();var t=o.getOptions();t.length>0?o.setSelected(t[0]):(o.hide(),o.selected=null)}}if(!(this instanceof d))return new d(e);var a,r=NewsletterPro.modules.smtp,i=NewsletterPro.modules.smtp.ui,o=this,l=e.name,c=e.template,u=e.className||"",p=e.options||[],m=e.onChange||null;e.sameAs||null;return o.name=l,i.add(l,o),t(c),o.addOption=function(e){s(e)},o.updateOption=function(e){var t=o.getSelected();null!=t&&(t.data=e,t.text(e.name),t.val(e.name))},o.getData=function(){var e=[];return r.each(o.template.options,function(t){e.push(t.data)}),e},o.getOptions=function(){var e=[];return r.each(o.template.options,function(t){e.push(t)}),e},o.getSelected=function(){return o.selected},o.setSelected=function(e){e.selected=!0,e.prop("selected",!0),o.selected=e},o.onChange=function(){var e=o.getOptions(),t=this.val(),n=$.grep(e,function(e){return e.dataInit.value===t}),s=o.getSelected();null!=s&&delete s.data.selected,n.length>0&&o.setSelected(n[0]),"function"==typeof m&&m.call(this,o)},o.disable=function(){o.template.prop("disabled",!0)},o.enable=function(){o.template.prop("disabled",!1)},o.hide=function(){o.template.hide()},o.show=function(){o.template.show()},o.refresh=function(e){var t=o.getOptions();a=!1,r.each(e,function(e){e.hasOwnProperty("selected")&&1==e.selected&&(a=!0)}),r.each(t,function(e){e.destroy()}),r.each(e,function(e){a||(e.selected=!0,a=!1),s(e)})},o},Button:function u(e){function t(e){e=$(e),n(e),a.template=e}function n(e){e.on("click",function(){a.click.call(e,a)})}if(!(this instanceof u))return new u(e);var s=(NewsletterPro.modules.smtp,NewsletterPro.modules.smtp.ui),a=this,r=e.template,i=e.name;return t(r),a.click=function(){"function"==typeof e.click&&e.click.call(this,a)},s.add(i,a),a}}.init()}.init(NewsletterPro),NewsletterPro.namespace("modules.csv"),NewsletterPro.modules.csv={dom:null,init:function(e){function t(){r.dom.container.hide(),r.dom.exportDetails.show()}function n(){r.dom.container.show(),r.dom.exportDetails.hide()}function s(e){r.dom.exportOptions.empty();for(var t="",n=0;n<e.length;n++){var s=e[n];t+='					<div class="checkbox">						<label class="control-label  in-win">							<input type="checkbox" name="export_csv_selected_columns[]" value="'+s+'">							'+a(s)+"						</label>					</div>"}r.dom.exportOptions.html(t)}function a(e){for(var t=e.split("_"),n=0;n<t.length;n++){var s=t[n][0],a=t[n].slice(1);t[n]=s.toUpperCase()+a}return t.join(" ")}var r=this;return r.ready(function(a){a.nextStep.on("click",function(){var n=Number($('[name="exportEmailAddresses"]:checked').val());$.postAjax({submit:"getExportOptions",value:n}).done(function(r){if(r.success){var i=r.columns;s(i),a.listRef.val(n),t()}else e.alertErrors(r.errors)})}),a.btnBack.on("click",function(){n()}),a.btnExport.on("click",function(){a.form.submit()}),a.checkAll.on("click",function(){$.each($('[name="export_csv_selected_columns[]"]'),function(e,t){$(t).prop("checked",!0)})})}),r},ready:function(e){var t=this;$(document).ready(function(){t.dom={btnBack:$("#np-export-email-addresses-back"),nextStep:$("#btn-export-email-addresses"),container:$("#import-export-container"),exportDetails:$("#export-details"),exportOptions:$("#np-export-email-options"),btnExport:$("#btn-export-csv"),form:$("#export-csv-form"),listRef:$("#export-csv-list-ref"),checkAll:$("#btn-export-csv-checkall")},e(t.dom)})}}.init(NewsletterPro),NewsletterPro.namespace("modules.mailChimp"),NewsletterPro.modules.mailChimp={dom:null,box:null,init:function(e){function t(t,n){var r=te.dom;return s(r.installLoading),$.postAjax({chimp:"installChimp",api_key:t,list_id:n}).always(function(){a(r.installLoading)}).done(function(t){t.status?(Y(),alert(t.message)):e.alertErrors(t.errors)})}function n(){if(confirm(Z("confirm uninstall chimp"))){var t=te.dom;return s(t.uninstallLoading),$.postAjax({chimp:"uninstallChimp"}).always(function(){a(t.uninstallLoading)}).done(function(n){n.status?(t.inputChimpApiKey.val(""),t.inputChimpListId.val(""),X(),alert(n.message)):e.alertErrors(n.errors)})}return!1}function s(e){e.hasClass("ajax-loader")||e.addClass("ajax-loader")}function a(e){e.removeClass("ajax-loader")}function r(){return $.postAjax({chimp:"pingChimp"}).done(function(t){t.status?alert(t.message):e.alertErrors(t.errors)})}function i(){var e=te.dom;e.btnUninstallChimp.hide(),e.btnInstallChimp.show(),e.chimpMenu.slideUp()}function o(){var e=te.dom;e.btnUninstallChimp.show(),e.btnInstallChimp.hide(),e.chimpMenu.slideDown()}function l(e){return e.is(":checked")?1:0}function c(e){return Q.hasOwnProperty(e)?Q[e]:!1}function d(t,n,s){n=n?1:0,$.postAjax({chimp:"updateSyncCheckbox",name:t,value:n}).done(function(a){"function"==typeof s&&s(a),a.status?e.dataStorage.data.chimp_config[t]=n:e.alertErrors(a.errors)})}function u(e,t){e.total.html(t.total),e.created.html(t.created),e.updated.html(t.updates),e.errors.html(t.errors),t.done?f(e):(m(e.box)||e.box.slideDown(),t.in_progress&&e.ajaxLoader.show())}function p(e){m(e.box)?e.box.slideUp("slow",function(){e.total.html(0),e.created.html(0),e.updated.html(0),e.errors.html(0),e.ajaxLoader.hide()}):(e.total.html(0),e.created.html(0),e.updated.html(0),e.errors.html(0),e.ajaxLoader.hide())}function m(e){return!!e.is(":visible")}function f(e){var t=new $.Deferred;return m(e.box)&&(e.ajaxLoader.hide(),setTimeout(function(){t.resolve(),p(e)},15e3)),t.promise()}function h(){f(te.dom.objSyncCustomersProgress),f(te.dom.objSyncVisitorsProgress),f(te.dom.objSyncAddedProgress),f(te.dom.objSyncOrdersProgress)}function g(){return $.postAjax({chimp:"stopSync"}).done(function(t){t.status?(h(),y(),S()):e.alertErrors(t.errors)})}function v(e){var t=e.chimp_sync;if(t.hasOwnProperty("ADDED_CHECKBOX")?(users=t.ADDED_CHECKBOX,u(te.dom.objSyncAddedProgress,users)):f(te.dom.objSyncAddedProgress),t.hasOwnProperty("VISITORS_CHECKBOX")?(users=t.VISITORS_CHECKBOX,u(te.dom.objSyncVisitorsProgress,users)):f(te.dom.objSyncVisitorsProgress),t.hasOwnProperty("CUSTOMERS_CHECKBOX")?(users=t.CUSTOMERS_CHECKBOX,u(te.dom.objSyncCustomersProgress,users)):f(te.dom.objSyncCustomersProgress),t.hasOwnProperty("ORDERS_CHECKBOX")?(users=t.ORDERS_CHECKBOX,u(te.dom.objSyncOrdersProgress,users),te.dom.lastSyncOrders.html(users.date_add)):f(te.dom.objSyncOrdersProgress),t.hasOwnProperty("ERRORS")&&t.ERRORS.length>0&&(te.dom.objErrorMessageBox.box.show(),te.dom.objErrorMessageBox.span.html(t.ERRORS.join("<br>")),setTimeout(function(){te.dom.objErrorMessageBox.box.hide(),te.dom.objErrorMessageBox.span.html("")},15e3)),t.hasOwnProperty("ERRORS_MESSAGE")&&t.ERRORS_MESSAGE.length>0){for(var n,s=t.ERRORS_MESSAGE,a=[],r=0,i=s.length;i>=r;r++)"object"==typeof s[r]&&s[r].hasOwnProperty("error")&&a.push(s[r].error);if(a.length>0){n=a.splice(0,10);var o=Z("Display first #s errors:").replace("#s",10)+"<br><br>";o+=n.join("<br>"),te.dom.syncChimpErrorsMessage.show().html(o),setTimeout(function(){te.dom.syncChimpErrorsMessage.hide().html("")},15e3)}}return 0==w(t).length?(g(),!0):!1}function w(e){return $.map(e,function(e,t){return e.hasOwnProperty("done")&&0==e.done?e.done:void 0})}function b(){var e=te.dom;m(e.syncListsProgressBox)||e.syncListsProgressBox.show()}function y(){var e=te.dom;m(e.syncListsProgressBox)&&setTimeout(function(){e.syncListsProgressBox.slideUp()},15e3)}function S(){var e=te.dom;e.btnSyncLists.show(),e.btnDeleteChimpOrders.show(),e.btnStopSyncLists.hide()}function k(){var e=te.dom;e.btnSyncLists.hide(),e.btnDeleteChimpOrders.hide(),e.btnStopSyncLists.show()}function P(){te.dom;b(),k(),$.postAjax({chimp:"getSyncListsStatus"}).done(function(e){v(e)}),_(function(e,t){v(e)&&clearInterval(t)},"getSyncListsStatus",ne)}function _(e,t,n){var s=setInterval(function(){$.postAjax({chimp:t}).done(function(t){e(t,s)})},n)}function N(t){var n=te.dom;E(n.btnSyncLists),$.postAjax({chimp:"setSyncLists",data:t}).done(function(t){t.status?(P(),T()):e.alertErrors(t.errors)}).always(function(){j(n.btnSyncLists)})}function x(){var t=te.dom;E(t.btnDeleteChimpOrders),t.btnSyncLists.hide(),$.postAjax({chimp:"deleteChimpOrders"}).done(function(n){alert(e.displayAlert(n.msg)),t.lastSyncOrders.html(n.date_add)}).always(function(){j(t.btnDeleteChimpOrders),t.btnSyncLists.show()})}function T(){$.postAjax({chimp:"startSyncLists"}).done(function(e){return e.hasOwnProperty("ADDED_CHECKBOX")&&!e.ADDED_CHECKBOX.done?T():e.hasOwnProperty("VISITORS_CHECKBOX")&&!e.VISITORS_CHECKBOX.done?T():e.hasOwnProperty("CUSTOMERS_CHECKBOX")&&!e.CUSTOMERS_CHECKBOX.done?T():e.hasOwnProperty("ORDERS_CHECKBOX")&&!e.ORDERS_CHECKBOX.done?T():void 0})}function C(e){w(e).length>0?P():S()}function I(e,t){return-1!==t.indexOf(e)}function E(e){var t=e.find(".ajax-loader");t.length>0&&t.show()}function j(e){var t=e.find(".ajax-loader");t.length>0&&t.hide()}function A(e,t){var n='<table id="'+e+'" class="table table-bordered '+e+'">				<thead>				<tr>';return I("preview_image",t)&&(n+='<th class="preview_image" data-field="preview_image">'+Z("preview image")+"</th>"),I("name",t)&&(n+='<th class="name" data-field="name">'+Z("name")+"</th>"),I("layout",t)&&(n+='<th class="layout" data-field="layout">'+Z("layout")+"</th>"),I("category",t)&&(n+='<th class="category" data-field="category">'+Z("category")+"</th>"),I("date_created",t)&&(n+='<th class="date_created" data-field="date_created">'+Z("date created")+"</th>"),I("active",t)&&(n+='<th class="np-active" data-field="active">'+Z("active")+"</th>"),n+='<th class="actions" data-template="actions">'+Z("actions")+"</th>				</tr>				</thead>			</table>",$(n)}function D(e){return M("chimp-template-gallery",e,"gallery")}function L(e){return M("chimp-template-base",e,"base")}function O(e){return M("chimp-template-user",e,"user")}function M(e,t,n){var s,a,r=A(e,["name","layout","category","active"]);return s=new gk.data.Model({id:"id"}),a=new gk.data.DataSource({pageSize:7,transport:{data:t},schema:{model:s}}),r.gkGrid({dataSource:a,selectable:!1,currentPage:1,pageable:!0,template:{active:function(e,t){return t?'<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>':'<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>'},actions:function(e){var t=e.data.preview_image,s=$("<div></div>"),a=null==t?"":$('<a href="'+t+'" class="btn btn-default btn-margin pull-right" target="_blank"><i class="icon icon-eye" style="margin-right: 8px;"></i> '+Z("preview")+"</a>"),r=$('<a href="javascript:{}" class="btn btn-default btn-margin pull-right btn-import-chimp-tpl"><span class="ajax-loader" style="display: none; margin-left: 0; margin-top: 0;"></span><span class="import-text" style="display: inline-block;"><i class="icon icon-download" style="margin-right: 8px;"></i> '+Z("import")+"</span></a>");return r.on("click",function(){var t=r.find(".import-text"),s=e.data.name;E(r),t.css({"padding-right":"7px"}),B(e.data.id,n,s).always(function(){j(r),t.css({"padding-right":"0"})})}),s.append(a),s.append(r),s}}}),{dataSource:a,dataModel:s,dataGrid:r}}function B(e,t,n){return $.postAjax({chimp:"getTemplateSource",template_id:e,type:t}).done(function(e){if(e.status){var t=e.template,s=Z("template name"),a=W(s,n);if(""==a||null==a)return!1;if(!a)return!1;V(a,t,0)}else alertErrors(e.errors)})}function V(e,t,n){var n=(te.dom,"undefined"!=typeof n?n:0);return $.postAjax({chimp:"importTemplate",name:e,content:t,override:n}).done(function(n){if(n.status){if(n.worning.hasOwnProperty("101")){var s=n.worning[101].replace(/\&quot;/g,'"');if(!prompt(s,e))return!1;V(e,t,1)}var a=NewsletterPro.modules.createTemplate;a.vars.templateDataSource.sync(function(e){var t=e.getItemByValue("data.filename",n.template_name);e.setSelected(t),a.changeTemplate(t)})}else NewsletterPro.alertErrors(n.errors)}).fail(function(e){NewsletterPro.alertErrors([Z("import failure")])}).always(function(e){})}function F(e){importTemplateData.user=e.user,importTemplateData.base=e.base,importTemplateData.gallery=e.gallery}function R(){return importTemplateData}function H(e){return $.postAjax({chimp:"getAllTemplates"}).done(function(t){e(t)})}function W(e,t){return prompt(e,t)}function G(e,t){e.css({opacity:"0.5"}),t.show(),t.css({position:"absolute",display:"block",margin:"0",padding:"0",left:390-t.width()/2,top:200-t.height()/2})}function z(e,t){e.css({opacity:"1"}),t.hide()}function U(t,n,s,a){e.modules.createTemplate.newsletterTemplate.saveTemplate().done(function(r){r.status?(e.showAjaxLoader(se.btnExport),$.postAjax({chimp:"exportTemplate",name:t,id_lang:n,filename:s,override:a}).done(function(s){if(s.status){if(s.name_exists){var a=e.displayAlert(s.message),r=confirm(a);return r?(q(t,n,1),!0):!1}se.success.show(),setTimeout(function(){se.success.hide()},7e3)}else e.alertErrors(s.errors)}).always(function(){e.hideAjaxLoader(se.btnExport)})):e.alertErrors(r.errors)})}function q(e,t,n){var s=NewsletterPro.modules.createTemplate.vars.templateDataSource.selected.data,e=e||s.name,a=s.filename,n="undefined"==typeof n?0:n;U(e,t,a,n)}function Y(){var e=te.dom;e.btnChimpImportHtml.show(),e.btnChimpExportHtml.show(),o(),e.syncBackChimpContent.show()}function X(){var e=te.dom;e.btnChimpImportHtml.hide(),e.btnChimpExportHtml.hide(),i(),e.syncBackChimpContent.hide()}var K,Q,J,Z,ee,te=this,ne=5e3,se={};te.box=e,te.ready(function(s){Z=NewsletterPro.translations.l(NewsletterPro.translations.modules.mailChimp),K=e.dataStorage.data,Q=K.chimp_config,J=K.chimp_sync,contentIsSet=null,importTemplateComponents={user:null,base:null,gallery:null},importTemplateData={user:null,base:null,gallery:null};var a=function(t,n){for(var s=e.dataStorage.get("configuration.NEWSLETTER_TEMPLATE").replace(/_/," ").replace(/\.html$/,"").split(" "),a="",r=e.dataStorage.get("all_languages")[0],t="undefined"!=typeof t?t:r.iso_code,n="undefined"!=typeof n?n:!0,i=0;i<s.length;i++)a+=e.ucfirst(s[i])+" ";return n&&(a+=t.toUpperCase()),a};ee=new gkWindow({width:600,height:400,setScrollContent:340,title:Z("Export Template To MailChimp"),className:"np-export-mailchimp-template-win",show:function(e){se.templateName.html(a(null,!1)),se.chimpTemplateName.val(a())},close:function(e){},content:function(t){for(var n,s,r=e.dataStorage.get("all_languages"),i="",o=0;o<r.length;o++)s=r[o],i+='<option value="'+s.iso_code+'">'+s.name+"</option>";return n=$('						<div class="form-group clearfix">							<div class="row">								<div class="form-group clearfix">									<label class="control-label col-sm-4"><span class="label-tooltip">'+Z("Template Name")+'</span></label>									<div class="col-sm-8">										<span id="np-export-mailchimp-template-name" style="margin-top: 6px; display: block;"></span>									</div>								</div>								<div class="form-group clearfix">									<label class="control-label col-sm-4"><span class="label-tooltip">'+Z("Language")+'</span></label>									<div class="col-sm-8">										<select id="np-export-mailchimp-template-lang-select" class="form-control fixed-width-xxl">											'+i+'										</select>									</div>								</div>								<div class="form-group clearfix">									<label class="control-label col-sm-4"><span class="label-tooltip">'+Z("MailChimp Name")+'</span></label>									<div class="col-sm-8">										<input id="np-export-mailchimp-template-input-tn" type="text" class="form-control fixed-width-xxl" value="">									</div>								</div>								<div class="form-group clearfix">									<div class="col-sm-8 col-sm-offset-4">										<a id="np-export-mailchimp-template-btn" href="javascript:{}" class="btn btn-default">											<span class="btn-ajax-loader"></span>											<i class="icon icon-download"></i>											'+Z("Export")+'										</a>										<span id="np-export-mailchimp-template-success" style="display: none;"><span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span></span>									</div>								</div>							</div>						</div>					'),se={templateName:n.find("#np-export-mailchimp-template-name"),langSelect:n.find("#np-export-mailchimp-template-lang-select"),chimpTemplateName:n.find("#np-export-mailchimp-template-input-tn"),btnExport:n.find("#np-export-mailchimp-template-btn"),success:n.find("#np-export-mailchimp-template-success")},se.langSelect.on("change",function(){var e=se.chimpTemplateName,t=$(this).val(),n=a(t);e.val(n)}),se.btnExport.on("click",function(){for(var t=se.chimpTemplateName.val(),n=se.langSelect.val(),s=e.dataStorage.get("all_languages"),a=0,r=0;r<s.length;r++){var i=s[r];if(i.iso_code===n){a=Number(i.id_lang);break}}q(t,a)}),n}});var i=gkWindow({width:800,height:500,title:Z("import template from chimp"),className:"gk-import-template-window-view",show:function(t){var n=null!=contentIsSet?contentIsSet:$('<div id="gk-import-content" style="position: relative;"><div id="gk-import-template-content-box"></div><span class="tpl-content ajax-loader"></span></div>'),s=n.find("#gk-import-template-content-box"),a=n.find(".tpl-content.ajax-loader");G(s,a),H(function(t){if(z(s,a),t.status){if(F({user:t.templates.user,base:t.templates.base,gallery:t.templates.gallery}),null==importTemplateComponents.user){importTemplateComponents.user=O(R().user);var n=$("<div></div>");n.append('<h4 class="chimp-import-tpl-title user-template">'+Z("user template")+"</h4>"),n.append(importTemplateComponents.user.dataGrid),s.append(n)}else importTemplateComponents.user.dataSource.setData(R().user),importTemplateComponents.user.dataSource.sync();if(null==importTemplateComponents.gallery){importTemplateComponents.gallery=D(R().gallery);var n=$("<div></div>");n.append('<h4 class="chimp-import-tpl-title">'+Z("gallery template")+"</h4>"),n.append(importTemplateComponents.gallery.dataGrid),s.append(n)}else importTemplateComponents.gallery.dataSource.sync(R().gallery);if(null==importTemplateComponents.base){
importTemplateComponents.base=L(R().base);var n=$("<div></div>");n.append('<h4 class="chimp-import-tpl-title">'+Z("base template")+"</h4>"),n.append(importTemplateComponents.base.dataGrid),s.append(n)}else importTemplateComponents.base.dataSource.sync(R().base)}else e.alertErrors(t.errors)}),null==contentIsSet&&(contentIsSet=n,i.setContent(n))}});C(J),K.chimpIsInstalled?Y():X(),c("ORDERS_CHECKBOX")?s.syncOrdersButtonText.show():s.syncOrdersButtonText.hide(),s.checkboxSyncCustomers.prop("checked",c("CUSTOMERS_CHECKBOX")),s.checkboxSyncVisitors.prop("checked",c("VISITORS_CHECKBOX")),s.checkboxSyncAdded.prop("checked",c("ADDED_CHECKBOX")),s.checkboxSyncOrders.prop("checked",c("ORDERS_CHECKBOX")),s.btnUninstallChimp.on("click",function(){n()}),s.btnInstallChimp.on("click",function(){var e=s.inputChimpApiKey.val(),n=s.inputChimpListId.val();t(e,n)}),s.btnPingChimp.on("click",function(){r()}),s.checkboxSyncCustomers.on("change",function(){d("CUSTOMERS_CHECKBOX",l($(this)))}),s.checkboxSyncVisitors.on("change",function(){d("VISITORS_CHECKBOX",l($(this)))}),s.checkboxSyncAdded.on("change",function(){d("ADDED_CHECKBOX",l($(this)))}),s.checkboxSyncOrders.on("change",function(){var e=l($(this));e?s.syncOrdersButtonText.show():s.syncOrdersButtonText.hide(),d("ORDERS_CHECKBOX",e)}),s.btnSyncLists.on("click",function(){N({CUSTOMERS_CHECKBOX:l(s.checkboxSyncCustomers),VISITORS_CHECKBOX:l(s.checkboxSyncVisitors),ADDED_CHECKBOX:l(s.checkboxSyncAdded),ORDERS_CHECKBOX:l(s.checkboxSyncOrders)})}),s.btnStopSyncLists.on("click",function(){g()}),s.btnChimpImportHtml.on("click",function(){i.show()}),s.btnChimpExportHtml.on("click",function(){ee.show()}),s.btnDeleteChimpOrders.on("click",function(){x()}),s.resetSyncOrderDate.on("click",function(){$.postAjax({chimp:"resetSyncOrderDate"}).done(function(t){t.success?s.lastSyncOrders.html(t.date_add):e.alertErrors(t.errors)})});var o=0,u=25,p=0,m=0,f=0,h=0,v=function(){var t=e.modules.sendNewsletters;t.vars.customers.sync(),t.isNewsletterProSubscriptionActive()?t.vars.visitorsNP.sync():t.vars.visitors.sync(),t.vars.added.sync()},w=function(t,n){s.syncListsBack.show(),s.objSyncListBack.box.show(),s.objSyncListBack.ajaxLoader.show(),s.btnSyncListsBack.addClass("disabled"),e.showAjaxLoader(s.btnSyncListsBack),$.postAjax({chimp:"syncListsBack",start:t,limit:n}).done(function(a){a.success?(p+=a.total,m+=a.created,f+=a.updated,h+=a.errors_count,s.objSyncListBack.total.html(a.member_count),s.objSyncListBack.created.html(m),s.objSyncListBack.updated.html(f),s.objSyncListBack.errors.html(h),a.total>0?(t++,w(t,n)):(s.btnSyncListsBack.removeClass("disabled"),s.objSyncListBack.ajaxLoader.hide(),setTimeout(function(){s.syncListsBack.hide(),s.objSyncListBack.box.hide()},15e3),v())):(v(),s.btnSyncListsBack.removeClass("disabled"),s.objSyncBackErrorMessageBox.box.show(),s.objSyncBackErrorMessageBox.span.show().html(e.displayAlert(a.errors,"<br>")))}).always(function(){e.hideAjaxLoader(s.btnSyncListsBack)})};s.btnSyncListsBack.on("click",function(){o=0,u=25,p=0,m=0,f=0,h=0,w(o,u)})})},ready:function(e){var t=this;$(document).ready(function(){var n=$("#sync-added-progress"),s=$("#sync-visitors-progress"),a=$("#sync-customers-progress"),r=$("#sync-orders-progress"),i=$("#sync-error-message-box"),o=$("#sync-list-back-error-message-box"),l=$("#sync-list-back-progress");t.dom={btnInstallChimp:$("#install-chimp"),btnPingChimp:$("#ping-chimp"),inputChimpApiKey:$("#chimp-api-key"),inputChimpListId:$("#chimp-list-id"),installLoading:$("#install-chimp-loading"),lastSyncOrders:$("#last-sync-orders"),btnUninstallChimp:$("#uninstall-chimp"),uninstallLoading:$("#uninstall-chimp-loading"),checkboxSyncCustomers:$("#sync-customers"),checkboxSyncVisitors:$("#sync-visitors"),checkboxSyncAdded:$("#sync-added"),checkboxSyncOrders:$("#sync-orders"),resetSyncOrderDate:$("#reset-sync-order-date"),syncOrdersButtonText:$("#sync-orders-button-text"),btnSyncLists:$("#sync-lists"),btnStopSyncLists:$("#stop-sync-lists"),btnDeleteChimpOrders:$("#delete-chimp-orders"),syncListsProgressBox:$("#sync-lists-progress-box"),syncChimpErrorsMessage:$("#sync-chimp-errors-message"),chimpMenu:$("#chimp-menu"),objSyncAddedProgress:{box:n,total:n.find(".sync-emails-total"),created:n.find(".sync-emails-created"),updated:n.find(".sync-emails-updated"),errors:n.find(".sync-emails-errors"),ajaxLoader:n.find(".ajax-loader")},objSyncVisitorsProgress:{box:s,total:s.find(".sync-emails-total"),created:s.find(".sync-emails-created"),updated:s.find(".sync-emails-updated"),errors:s.find(".sync-emails-errors"),ajaxLoader:s.find(".ajax-loader")},objSyncCustomersProgress:{box:a,total:a.find(".sync-emails-total"),created:a.find(".sync-emails-created"),updated:a.find(".sync-emails-updated"),errors:a.find(".sync-emails-errors"),ajaxLoader:a.find(".ajax-loader")},objSyncOrdersProgress:{box:r,total:r.find(".sync-emails-total"),created:r.find(".sync-emails-created"),updated:r.find(".sync-emails-updated"),errors:r.find(".sync-emails-errors"),ajaxLoader:r.find(".ajax-loader")},objErrorMessageBox:{box:i,span:i.find(".sync-error-message")},btnChimpImportHtml:$("#chimp-import-html"),btnChimpExportHtml:$("#chimp-export-html"),syncListsBack:$("#sync-lists-back-progress-box"),btnSyncListsBack:$("#sync-chimp-lists-back"),objSyncBackErrorMessageBox:{box:o,span:o.find(".sync-error-message")},objSyncListBack:{box:l,total:l.find(".sync-emails-total"),created:l.find(".sync-emails-created"),updated:l.find(".sync-emails-updated"),errors:l.find(".sync-emails-errors"),ajaxLoader:l.find(".ajax-loader")},syncBackChimpContent:$("#sync-back-chimp-content")},e(t.dom)})}}.init(NewsletterPro);var NewsletterProComponents={init:function(){var e=this,t=[];$(window).resize(function(){t=[]}),jQuery(document).ready(function(n){e.addElement("productSearch",n("#poduct-search")).addElement("productSearchAjax",n(".product-search-span")).addElement("productList",n("#product-list .userlist table tbody")).addElement("selectedProducts",n("#selected-products")).addElement("productTemplateNumberPerRow",n("#save-product-nr-per-row")).addElement("categoryList",n("#categories-list ul")).addElement("tabNewsletter",n("#tab.newsletter")).addElement("tabNewsletterContent",n("#tab_content.newsletter")).addElement("tabNewsletterTemplate",n("#tab_template.newsletter-template")).addElement("tabNewsletterTemplateContent",n("#tab_template_content.newsletter-template")).addElement("emailsToSend",n("#emails-to-send .userlist")).addElement("emailsSent",n("#emails-sent .userlist")).addElement("uploadCSVForm",n("#upload-csv-form")).addElement("uploadCSV",n("#upload-csv")).addElement("uploadCSVMessage",n("#upload-csv-message")).addElement("uploadCSVFiles",n("#upload-csv-files")).addElement("importExportContainer",n("#import-export-container")).addElement("importDetails",n("#import-details")).addElement("importSeparator",n("#import-separator")).addElement("productsAdjustmentsDiv",n("#products-adjustments-div")).addElement("productsAdjustments",n("#products-adjustments")),e.addObject("productList",e.ProductList.clone().init(e.elem.productList)),e.addObject("productSearch",e.Search.clone().init(e.elem.productSearch,e.objs.productList)),e.addObject("selectedProducts",e.SelectedProducts.clone().init(e.elem.selectedProducts)),e.addObject("categoryList",e.CategoryList.clone().init(e.elem.categoryList,e.objs.productList)),e.addObject("tabItems",e.TabItems.clone().init(e.elem.tabNewsletter,e.elem.tabNewsletterContent,function(e){var s=e.attr("id");-1==t.indexOf(s)&&(t.push(s),"tab_newsletter_5"===s||("tab_newsletter_3"===s?NewsletterPro.modules.selectProducts.refreshSliders():s===NewsletterPro.modules.createTemplate.tabName?("undefined"!=typeof NewsletterPro.modules.createTemplate.dom.tinyNewsletter&&NewsletterPro.modules.createTemplate.updateBoth(),NewsletterPro.modules.createTemplate.refreshSliders(),NewsletterPro.modules.createTemplate.isTinyInit()||(n(".tab-content-loading").show(),setTimeout(function(){NewsletterPro.modules.createTemplate.initTiny().done(function(){n(".tab-content-loading").hide()})},50))):s===NewsletterPro.modules.frontSubscription.tabName&&(NewsletterPro.modules.frontSubscription.onTabShow(),NewsletterPro.modules.frontSubscription.isTinyInit()||(n(".tab-content-loading").show(),setTimeout(function(){NewsletterPro.modules.frontSubscription.initTiny().done(function(){n(".tab-content-loading").hide()})},50)))))})),e.addObject("tabNewsletterTemplate",e.TabItems.clone().init(e.elem.tabNewsletterTemplate,e.elem.tabNewsletterTemplateContent,function(e){})),e.addObject("emailsSent",e.EmailSendList.clone().init(e.elem.emailsSent)),e.addObject("emailsToSend",e.EmailSendList.clone().init(e.elem.emailsToSend,e.objs.emailsSent)),e.addObject("uploadCSV",e.UploadCSV.init({form:e.elem.uploadCSVForm,file:e.elem.uploadCSV,msg:e.elem.uploadCSVMessage,files:e.elem.uploadCSVFiles,container:e.elem.importExportContainer,details:e.elem.importDetails,separator:e.elem.importSeparator}))})},elem:{},objs:{},addElement:function(e,t){return this.elem[e]=t,this},addObject:function(e,t){return this.objs[e]=t,this},MenuCheckbox:{items:[],currentItem:null,hitTest:!1,clone:function(){return $.extend(!0,{},this)},init:function(e,t){"undefined"==typeof t&&(t="click");var n=this;return this.element=e,this.element.attr("tabindex","-1"),this.element.css({outline:"none"}),this.eHeader=this.element.children("a").first(),this.eHeader.addClass("header"),this.eHeader.append("<span>&nbsp</span>"),this.eMenu=this.element.children("ul").first(),0==this.eMenu.length?(this.eMenu=this.element.children("table").first(),this.eItems=this.eMenu.find("tr")):this.eItems=this.eMenu.children("li"),this.createItems(this.eItems),"click"==t?(this.eHeader.on("click",function(e){n.element.focus(),n.toggleMenu()}),this.element.on("focusout",function(){0==n.hitTest&&n.hideMenu()}),this.element.on("mouseleave",function(){n.hitTest=!1}),this.element.on("mouseenter",function(){n.hitTest=!0})):"over"==t&&this.element.hover(function(e){n.showMenu()},function(e){n.hideMenu()}),this},itemTemplate:function(e){var t=this,n=$(e).find("input"),s=!!n.is(":checked"),a={instance:e,input:n,click:function(){return this.instance.trigger("click"),!this.input.is(":checked")},check:function(){return 0==this.checked&&this.click(),!0},uncheck:function(){return 1==this.checked&&this.click(),!1},checked:s,val:function(){return this.input.val()},updateSelection:function(){return this.input.is(":checked")?(this.input.attr("checked",!1),this.checked=!1,!0):(this.input.attr("checked",!0),this.checked=!0,!1)}};return a.instance.on("click",function(e){t.currentItem=a,t.currentItem.updateSelection(),e.stopPropagation()}),a.input.on("click",function(e){t.currentItem=a,t.currentItem.checked=!!t.currentItem.input.is(":checked"),e.stopPropagation()}),a},createItems:function(e){var t=this;$.each(e,function(e,n){t.items.push(t.itemTemplate($(n)))})},showMenu:function(){var e=this;return e.eMenu.show(),!0},hideMenu:function(){var e=this;return e.eMenu.hide(),!1},toggleMenu:function(){var e=this;return e.eMenu.is(":visible")?(e.eMenu.hide(),!1):(e.eMenu.show(),!0)},getItems:function(e){var t=this,n=$.grep(t.items,function(n,s){return 1==e?1==t.items[s].checked:0==e?0==t.items[s].checked:!0});return n},isTriggerAll:!1,checkAll:function(){var e=this;e.isTriggerAll=!0,$.each(e.items,function(t,n){0==e.items[t].checked&&e.items[t].check(),e.items.length==t+1&&(e.isTriggerAll=!1)})},uncheckAll:function(){var e=this;e.isTriggerAll=!0,$.each(e.items,function(t,n){1==e.items[t].checked&&e.items[t].uncheck(),e.items.length==t+1&&(e.isTriggerAll=!1)})},elementCheckToggle:function(e){var t=this;1==e.data("value")?(e.data("value",0),e.html(e.data("name").check),t.uncheckAll()):(e.data("value",1),e.html(e.data("name").uncheck),t.checkAll())}},Search:{timer:null,minLength:4,title:"",clone:function(){return $.extend(!0,{},this)},init:function(e,t){var n=this;return this.element=e,this.title=e.val(),this.objTarget=t,this.element.on("keyup",function(e){var t=n.getVal();t.length>=n.minLength?n.search(n.getVal()):n.resetSearch()}),this.element.on("focus",function(e){1!=n.isEmpty()&&n.getVal()!=n.title||n.setVal("")}),this.element.on("focusout",function(e){1!=n.isEmpty()&&n.getVal()!=n.title||n.setVal(n.title)}),this},setVal:function(e){var t=this;t.element.val(e)},getVal:function(e){var t=this;return t.element.val()},resetSearch:function(){var e=NewsletterProComponents,t=this;t.isEmpty()&&e.objs.productList.element.empty()},search:function(e){var t=NewsletterProComponents,n=this;null!=n.timer&&clearTimeout(n.timer),t.elem.productSearchAjax.show(),n.timer=setTimeout(function(){$.postAjax({submit:"searchProducts",searchProducts:e}).done(function(e){t.elem.productSearchAjax.hide(),n.objTarget.createItems(e.products)})},200)},isEmpty:function(){var e=this;return""==e.getVal()?(e.element.hasClass("empty")||e.element.addClass("empty"),!0):(e.element.hasClass("empty")&&e.element.removeClass("empty"),!1)}},ProductList:{items:[],eItems:[],element:null,currentItem:null,lastItemClass:null,clone:function(){return $.extend(!0,{},this)},init:function(e){return this.element=e,this},createItems:function(e){var t=this;return t.items=[],t.eItems=[],t.currentItem=null,t.lastItemClass=null,t.element.empty(),$.each(e,function(e,n){n.thumb={path:n.thumb_path,width:n.thumb_width,height:n.thumb_height};var s=t.eItemTemplate(n);t.items.push(t.itemTemplate(s,n))}),this},parseItems:function(e){for(var t=0;t<this.items.length;t++){var n=e(Number(this.items[t].id),this.items[t]);if(null!=n)return n}},eItemTemplate:function(e){function t(){return!!parseInt(e.active)}function n(){return!!parseInt(e.quantity)}var s,a,r,i,o,l=NewsletterPro,c=this,d=l.translations.l(l.translations.global);s=null==c.lastItemClass?"even":"even"==c.lastItemClass?"odd":"even",c.lastItemClass=s,a='<td class="options">								<a class="btn btn-default add-product" href="javascript:{}" data-info=\'{"id":"'+e.id_product+'","value":"1"}\'>									<i class="icon icon icon-plus-circle"></i> <span>'+d("add")+"</span>								</a>							</td>",r='<td class="options">									<a class="btn btn-default add-product" href="javascript:{}" data-info=\'{"id":"'+e.id_product+'"}\'>										<i class="icon icon icon-plus-circle"></i> <span>'+d("remove")+"</span>									</a>								</td>",i=l.components.Product.getProductsId(),o=-1==i.indexOf(Number(e.id_product))?a:r;var u='<tr class="'+s+'">';return u+=1==NewsletterPro.dataStorage.getNumber("configuration.DISPLAY_PRODUCT_IMAGE")?'<td class="image"><img src="'+e.thumb.path+'" alt="" height="'+e.thumb.height+'" width="'+e.thumb.width+'"></td>':"",u+='<td class="name '+(t()?"":"inactive")+'">'+e.name+"</td>",u+='<td class="reference '+(t()?"":"inactive")+'">'+(null!=e.reference?e.reference:"")+"</td>",u+='<td class="search-price '+(t()?"":"inactive")+'">'+(null!=e.price_display?e.price_display:"")+"</td>",u+='<td class="search-active">'+(t()?'<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>':'<span class="list-action-enable action-disabled"><i class="icon icon-remove"></i></span>')+"</td>",u+='<td class="search-stock '+(n()?"":"inactive")+'">'+(null!=e.quantity?e.quantity:'<span style="color: red;">0</span>')+"</td>",u+=o,u+="</tr>",u=$(u),c.element.append(u),u},itemTemplate:function(e,t){var n=this,s=e.find("a.add-product"),a=s.find("span"),r=s.find("img"),i=s.data("info"),o=i.id,l=NewsletterPro,c=l.translations.l(l.translations.global),d={instance:e,button:s,click:function(){return this.button.trigger("click"),this.val()},val:function(){return this.dataInfo.value},id:o,dataInfo:i,data:t,text:a,img:r,toggleValue:function(){"1"==this.val()?this.remove():this.add()},setToAdd:function(){this.dataInfo.value="1",this.text.html(c("add"))},setAsRemove:function(){this.dataInfo.value="-1",this.text.html(c("remove"))},add:function(){var e=NewsletterPro;this.dataInfo.value="1",this.text.html(c("add")),e.modules.selectProducts.productSelection.remove(this.id)},remove:function(){var e=NewsletterPro;that=this,this.dataInfo.value="-1",this.text.html(c("remove")),e.modules.selectProducts.productSelection.add(this.id)}};return d.button.on("click",function(e){n.currentItem=d,n.currentItem.toggleValue(),e.stopPropagation()}),d},getItems:function(e){if(1==e){var t=$.grep(this.items,function(e){return"-1"==e.val()});return t}if(0==e){var t=$.grep(this.items,function(e){return"1"==e.val()});return t}return this.items}},SelectedProducts:{template:"",itemsId:[],items:[],element:null,productHeader:{},clone:function(){return $.extend(!0,{},this)},init:function(e){var t=this;return this.element=e,$.postAjax({submit:"getProductContent",getProductContent:!0},"html").done(function(e){t.template=e}),this},toggleSlider:function(e,t,n){function s(){NewsletterPro.modules.selectProducts.refreshSliders()}function a(e){return NewsletterPro.modules.selectProducts.isDynamicVar(e)}var r,i=this;if(r=t.dom.target.parent(),i.items.length){var o=i.items[0];o.dom[e].length>0&&!a(o.dom[e])||o.dom[e].length>0&&"product"===e?(r.show(),s()):r.hide()}else r.hide()},toggleSliders:function(){var e=NewsletterPro.modules.selectProducts.vars.sliderName,t=NewsletterPro.modules.selectProducts.vars.sliderDescription,n=NewsletterPro.modules.selectProducts.vars.sliderDescriptionShort,s=NewsletterPro.modules.selectProducts.vars.sliderImageSize,a=NewsletterPro.modules.selectProducts.vars.sliderProductsWidth,r=NewsletterPro.modules.selectProducts.vars.sliderProductsPerRow,i=this.productHeader;i.hasOwnProperty("displayColumns")&&0==i.displayColumns?this.hideSlider("",r):this.showSlider("",r),this.toggleSlider("name",e),this.toggleSlider("description",t),this.toggleSlider("description_short",n),i.hasOwnProperty("displayImageSize")?1==i.displayImageSize&&this.toggleSlider("image",s):this.toggleSlider("image",s),i.hasOwnProperty("displayProductWidth")?1==i.displayProductWidth&&this.toggleSlider("product",a):this.toggleSlider("product",a)},hideSlider:function(e,t){var n;n=t.dom.target.parent(),n.hide()},showSlider:function(e,t){var n;n=t.dom.target.parent(),n.show()},hideSliders:function(){var e=NewsletterPro.modules.selectProducts.vars.sliderName,t=NewsletterPro.modules.selectProducts.vars.sliderDescription,n=NewsletterPro.modules.selectProducts.vars.sliderDescriptionShort,s=NewsletterPro.modules.selectProducts.vars.sliderImageSize,a=NewsletterPro.modules.selectProducts.vars.sliderProductsWidth;this.hideSlider("name",e),this.hideSlider("description",t),this.hideSlider("description_short",n),this.hideSlider("image",s),this.hideSlider("product",a)},parseProducts:function(e){var t=this,n=t.items;$.each(n,function(t,n){e(n,n.value,n.data)})},renderImages:!1,addItem:function(e){function t(e,t,n){return NewsletterPro.modules.selectProducts.trimString(e,t,n)}function n(){var e=0;return NewsletterPro.dataStorage.data.hasOwnProperty("product_width")&&(e=parseInt(NewsletterPro.dataStorage.data.product_width)),e}function s(e){return NewsletterPro.modules.selectProducts.isDynamicVar(e)}function a(){var e=NewsletterPro.modules.selectProducts.vars.sliderName,a=NewsletterPro.modules.selectProducts.vars.sliderDescription,r=NewsletterPro.modules.selectProducts.vars.sliderDescriptionShort;NewsletterPro.modules.selectProducts.vars.sliderImageSize;s(c.dom.name)||c.dom.name.html(t(c.data.name,e.getValue())),s(c.dom.description)||c.dom.description.html(t(c.data.description,a.getValue())),s(c.dom.description_short)||c.dom.description_short.html(t(c.data.description_short,r.getValue()));var i=(NewsletterPro.modules.selectProducts.vars.sliderProductsWidth,n());45>i?c.dom.product.width("auto"):c.dom.product.width(i)}var r=this,i=r.formatItemData(e),o=$(i.product),l=i.formatedData;r.element.find("tr.last-row").last().append(o),r.itemsId.push(e.id_product);var c={id:e.id_product,value:o,data:l,dom:{name:o.find(".newsletter-pro-name"),description:o.find(".newsletter-pro-description"),description_short:o.find(".newsletter-pro-description_short"),image:o.find(".newsletter-pro-image"),product:o.find(".newsletter-pro-product")}};r.items.push(c),a(),r.toggleSliders(),NewsletterPro.modules.selectProducts.updateProductsWidth()},triggerRemoveAll:!1,removeItem:function(e){function t(){var e=parseInt(NewsletterPro.dataStorage.data.product_tpl_nr);return e?e:3}var n=NewsletterProComponents,s=this,a=t();e.parent().remove();var r=e.data("id"),i=s.itemsId.indexOf(r);if(s.itemsId.splice(i,1),"undefined"!==n.objs.productList){var o=n.objs.productList.getItems(!0);$.each(o,function(e,t){t.id==r&&t.add()})}var o=s.element.find("td.product-item");s.element.empty(),s.itemIndex=0,$.each(o,function(e,t){s.itemIndex%a!=0&&0!=s.itemIndex||s.element.append('<tr style="margin: 0; padding: 0;" class="last-row";></tr>'),s.element.find("tr.last-row").last().append(t),s.itemIndex++}),$.each(s.items,function(e,t){if("undefined"!==r&&"undefined"!==t&&"undefined"!==t.id&&parseInt(t.id)==parseInt(r)){var n=s.items.indexOf(t);return s.items.splice(n,1),!1}}),s.triggerRemoveAll?(s.triggerRemoveAll=!1,s.hideSliders()):(s.toggleSliders(),s.fixHeightOnRemove()),NewsletterPro.modules.selectProducts.updateProductsWidth()},setProductsPerRow:function(e){var t=NewsletterPro.dataStorage;t.add("product_tpl_nr",parseInt(e));var n=$.map(this.items,function(e){return e.data});return self.renderImages=!1,this.renderItems(n)},renderItems:function(e){function t(e,t,n){return NewsletterPro.modules.selectProducts.setImageSizeByWidth(e,t,n)}function n(){return"undefined"!=typeof NewsletterPro.modules.selectProducts.vars.lastImageWidth?parseInt(NewsletterPro.modules.selectProducts.vars.lastImageWidth):!1}function s(e){return NewsletterPro.modules.selectProducts.getImagesOfProducts(e)}function a(e,t){return NewsletterPro.modules.selectProducts.setImageOfProduct(e,t)}function r(){o.removeItems(),e.length&&$.each(e,function(e,t){o.addItem(t)})}var i=new $.Deferred,o=this,l=(NewsletterProComponents.objs.productList,NewsletterPro.modules.selectedProducts,n());return o.renderImages&&l?s(l).done(function(e){r(),o.parseProducts(function(n,s,r){t(n,n.dom.image,l),a(e,n)}),i.resolve()}):(i.resolve(),r()),o.fixHeight(),i.promise()},getItemsIds:function(){var e=this;return $.map(e.items,function(e){return parseInt(e.id)})},resetItems:function(){function e(e,t){$.postAjax({submit:"getProductsById",ids:e}).done(function(e){t(e.products)})}var t=this;e(t.getItemsIds(),function(e){t.renderItems(e)})},fixHeight:function(){var e=this;if(e.items.length>0){var t=$.map(e.items,function(e,t){var n=e.value.find(".newsletter-pro-product");if(n.length>0){var s=parseInt(n.css("padding-top")),a=parseInt(n.css("padding-bottom")),r=parseInt(n.css("border-top-width")),i=parseInt(n.css("border-bottom-width")),o=n.height()+a+s+r+i;return o}});return t=Math.max.apply(Math,t),$.each(e.items,function(e,n){var s=n.value.find(".newsletter-pro-product");s.length>0&&s.height(t)}),t}return!1},fixHeightOnRemove:function(){var e=this;return e.items.length>0?($.each(e.items,function(e,t){var n=t.value.find(".newsletter-pro-product");n.length>0&&n.css("height","auto")}),e.fixHeight(),!0):!1},removeItems:function(){this.triggerRemoveAll=!0;var e=this;$.each(e.element.find(".remove-item"),function(e,t){$(t).trigger("click")}),e.fixHeightOnRemove()},getHeader:function(e){var t,n,s=this,a=e.match(/<!-- start header -->\s*?<!--([\s\S]*)-->\s*?<!-- end header -->/),r={};return null!=a&&a.length>0&&(t=a[0],n=a[1],r=s.parseProductHeader(n),e=e.replace(t,"")),r},parseProductHeader:function(e){var t=e.split("\n"),n="";if(null!=t&&t.length>0)for(var s=0;s<t.length;s++){var a=t[s].replace(/\s+/g,"");""!=a&&(n+=a,";"!==a[a.length-1]&&(n+=";"))}var r=n.split(";"),i={};if(null!=r&&r.length>0)for(var s=0;s<r.length;s++){var o=r[s].replace(/\s+/g,"");if(""!=o){var l=o.split("=");"undefined"!=typeof l[1]&&(i[l[0]]="false"===l[1]?!1:"true"===l[1]?!0:isNaN(Number(l[1]))?l[1]:Number(l[1]))}}return i},removeItemById:function(e){var t=this,n=t.element.find('*[data-id="'+e+'"]');n.length>0&&n.trigger("click"),t.fixHeightOnRemove()},columns:3,itemIndex:0,formatItemData:function(e){function t(e,t){u=u.replace(new RegExp("{"+e+"}","g"),t)}function n(e,t){return t=t||2,parseFloat(e).toFixed(t)}function s(e){return'<td style="margin: 0; padding: 0;" class="product-item"><a href="javascript:{}" class="remove-item" data-id="'+e+'" onclick="NewsletterProComponents.objs.selectedProducts.removeItem($(this));">&nbsp;</a>'+u+"</td>"}function a(){var e=parseInt(NewsletterPro.dataStorage.data.product_tpl_nr);return e?e:o.columns}function r(e){var t=$("<span></span>");return t.html(e),t.text()}var i,o=this,l=a(),c=o.element,d=o.itemIndex,u=o.template,p=function(){return"undefined"!==l};o.productHeader=o.getHeader(u);var m={id_product:e.id_product,id_supplier:e.id_supplier,id_manufacturer:e.id_manufacturer,id_category_default:e.id_category_default,id_shop_default:e.id_shop_default,id_shop:e.id_shop,price:n(e.price),price_convert:n(e.price_convert),orderprice:n(e.orderprice),price_tax_exc:n(e.price_tax_exc),price_without_reduction:n(e.price_without_reduction),price_without_reduction_convert:n(e.price_without_reduction_convert),price_without_reduction_display:e.price_without_reduction_display,price_tax_exc_convert:n(e.price_tax_exc_convert),price_tax_exc_display:e.price_tax_exc_display,wholesale_price_convert:n(e.wholesale_price_convert),wholesale_price_display:e.wholesale_price_display,price_display:e.price_display,wholesale_price:e.wholesale_price,unit_price_ratio:e.unit_price_ratio,on_sale:e.on_sale,online_only:e.online_only,ecotax:e.ecotax,quantity:e.quantity,minimal_quantity:e.minimal_quantity,currency:e.currency,discount:e.discount,unity:e.unity,unit_price:e.unit_price,unit_price_convert:e.unit_price_convert,unit_price_display:e.unit_price_display,unit_price_tax_exc:e.unit_price_tax_exc,unit_price_tax_exc_convert:e.unit_price_tax_exc_convert,unit_price_tax_exc_display:e.unit_price_tax_exc_display,unit_price_bo:e.unit_price_bo,unit_price_bo_convert:e.unit_price_bo_convert,unit_price_bo_display:e.unit_price_bo_display,additional_shipping_cost:e.additional_shipping_cost,supplier_reference:e.supplier_reference,reference:e.reference,width:e.width,height:e.height,depth:e.depth,weight:e.weight,quantity_discount:e.quantity_discount,condition:e.condition,date_add:e.date_add,date_upd:e.date_upd,description:r(e.description),description_short:r(e.description_short),available_now:e.available_now,available_later:e.available_later,link_rewrite:e.link_rewrite,name:e.name,legend:e.legend,manufacturer_name:e.manufacturer_name,tax_name:e.tax_name,rate:e.rate,category_default:e.category_default,link:e.link,reduction:e.reduction,image_path:e.image_path,image_width:e.image_width,image_height:e.image_height,thumb_path:e.thumb_path,thumb_width:e.thumb_width,thumb_height:e.thumb_height},f=new NewsletterPro.components.ProductRender(u,m);return u=f.render(),p()&&t("column_width",String(100/l+"%")),t("(\\s+)?columns(\\s+)?=(\\s+)?\\d+(\\s+)?",""),i=s(m.id_product),d%l!=0&&0!=d||c.append('<tr style="margin: 0; padding: 0;" class="last-row";></tr>'),o.itemIndex++,{product:$(i),formatedData:m}}},CategoryList:{element:null,objTarget:null,targetCallback:null,currentItem:null,clone:function(){return $.extend(!0,{},this)},init:function(e,t){var n=this;return this.element=e,this.objTarget=t,this.initCallback(this.categoryListCallback),$.each(NewsletterPro.dataStorage.get("categories_list"),function(e,t){var s=n.eItemTemplate(t,n.element);n.itemTemplate(s,t)}),this},initCallback:function(e){return this.targetCallback=e,this},eItemTemplate:function(e,t){var n=e.subcategory.length>0?'class="category_arrow"':"",s="";return s+='<li class="even" data-id="'+e.id_category+'">',s+="<span "+n+">&nbsp;</span>",s+='<span style="cursor: default; margin-left: 3px; display: inline-block;">'+e.name+"</span>",s+='<span class="subcategory_lis" style="display: none; margin-bottom: 0; color: black; font-weight: normal;">&nbsp;</span>',s+="</li>",s=$(s),t.append(s),s},itemTemplate:function(e,t){var n=this,s=e.data("id"),a=t.level,t={instance:e,id:s,level:a};t.instance.on("click",function(e){e.stopPropagation(),n.currentItem=t,n.categoryListCallback(n.currentItem.id)})},categoryListCallback:function(e){var t=NewsletterProComponents,n=this,s=parseInt(n.currentItem.level);n.currentItem.instance.hasClass("selected")||(n.currentItem.instance.addClass("selected"),null!=n.lastItemSelected&&n.lastItemSelected.hasClass("selected")&&n.lastItemSelected.removeClass("selected"),null!=n.lastItemRootSelected&&2==s&&n.lastItemRootSelected.find("span.subcategory_lis").css("display","none").empty(),2==s&&(n.lastItemRootSelected=n.currentItem.instance),n.lastItemSelected=n.currentItem.instance),n.currentItem.instance.css({height:"auto"}),t.elem.productSearchAjax.show(),$.postAjax({submit:"getProducts",getProducts:e}).done(function(e){t.elem.productSearchAjax.hide(),n.objTarget.createItems(e.products)});var a=Array(),r=function(t){return $.each(t,function(t,n){return n.id_category==e?(a=n,!1):void r(n.subcategory)}),a},i=r(NewsletterPro.dataStorage.get("categories_list"));if("undefined"==typeof i||i.subcategory.length<=0)return!1;var o=n.currentItem.instance.find("span.subcategory_lis").css("display","block").empty();$.each(i.subcategory,function(e,t){var s=n.eItemTemplate(t,o);n.itemTemplate(s,t)})}},TabItems:{lastItem:null,buttons:[],onChange:null,clone:function(){return $.extend(!0,{},this)},init:function(e,t,n){NewsletterPro.extendSubscribeFeature(this);var s=this;this.onChange=n,this.content=t.children("div"),$.each(e.find("a"),function(e,t){t=$(t),t.id=t.attr("id");var n=String(t.attr("id")).match(/\d+/,"");t.idNum=n?parseInt(n):null;var a=new RegExp("^.*"+t.idNum+"$","g");t.target=$($.grep(s.content,function(e,t){return e=$(e),0!=t&&e.hide(),a.test(e.attr("id"))?e:null})[0]),0!=e||t.hasClass("selected")||(t.addClass("selected"),s.lastItem=t),s.addEvent(t),s.buttons.push(t)});var a=window.location.hash,r=s.buttons.filter(function(e){var t=e.attr("href");return t==a});return"#viewImported"!=a&&("undefined"!=typeof r[0]?(r[0].trigger("click"),r[0].target.show()):s.trigger("tab_newsletter_3")),this},addEvent:function(e){var t=this;e.on("click",function(n){return null!=t.lastItem&&t.lastItem.target===e.target?!1:(null!=t.lastItem&&(t.lastItem.target.hide(),e.target.show(),t.lastItem.hasClass("selected")&&t.lastItem.removeClass("selected")),e.hasClass("selected")||e.addClass("selected"),t.lastItem=e,t.publish("change",e),void("function"==typeof t.onChange&&t.onChange(e)))})},trigger:function(e){var t=$.grep(this.buttons,function(t,n){return t.id==e?t:null})[0];return"undefined"!=typeof t&&t.trigger("click"),this},triggerHref:function(e){var t=$.grep(this.buttons,function(t,n){return t.attr("href")==e?t:null})[0];return"undefined"!=typeof t&&t.trigger("click"),this},getLastItem:function(){return null!=this.lastItem?this.lastItem:!1}},EmailSendList:{items:[],clone:function(){return $.extend(!0,{},this)},init:function(e,t){var n=this;this.element=e,this.objTarget=t;var s=this.element.find("li");return s.length>0&&$.each(s,function(e,t){var t=$(t);if("undefined"!=typeof t.data("email")){var s=t.data("email");n.items.push(n.itemTemplate(t,s))}}),this},eItemTemplate:function(e){var t=this,n=t.getLastItem()===!1?"even":t.getLastItem().instance.hasClass("odd")?"even":"odd",s="";return s+='<li class="'+n+'">',s+='<span class="email_text">'+e+"</span> ",s+="</li>",s=$(s),t.element.append(s),s},itemTemplate:function(e,t){var n={instance:e,email:t};return n},createItems:function(e){var t=this;$.each(e,function(e,n){var s=t.eItemTemplate(n);t.items.push(t.itemTemplate(s,n))})},createObjItems:function(e,t){var n=this;t=t||"prepend",$.each(e,function(e,s){"object"==typeof s&&("append"==t?n.element.append(s.instance):n.element.prepend(s.instance),n.items.push(s))})},removeItems:function(e){var t=this;$.each(e,function(e,n){var e=t.items.indexOf(n);-1!=e&&(t.items[e].instance.remove(),t.items.splice(e,1))})},removeAllItems:function(){var e=this;e.items=[],e.element.empty()},removeLast:function(){var e=this;if(this.items.length>0){
var t=e.items.pop();return t.instance.remove(),t}return!1},removeFirst:function(){var e=this;if(this.items.length>0){var t=e.items.shift();return t.instance.remove(),t}return!1},moveFirst:function(){var e=this,t=e.removeFirst();return e.objTarget.createObjItems([t],"prepend"),t},getItems:function(){return this.items},getLastItem:function(){return this.items.length>0?this.items[this.items.length-1]:!1},getFirstItem:function(){return this.items.length>0?this.items[0]:!1},getLength:function(){return parseInt(this.items.length)}},UploadCSV:{fields:[],items:[],selected:null,form:null,file:null,msg:null,container:null,details:null,separator:null,init:function(e){var t=$.extend(!0,{},this);return t.file=e.file,t.form=e.form,t.msg=e.msg,t.files=e.files,t.container=e.container,t.details=e.details,t.separator=e.separator,t.createItems(),t.initEvents(),t},initEvents:function(){var e=this;e.file.on("change",function(t){e.uploadItem()})},setSelected:function(e){var t=this;null!=t.selected&&t.selected.instance.hasClass("selected")&&t.selected.instance.removeClass("selected"),t.selected=e,t.selected.instance.hasClass("selected")||t.selected.instance.addClass("selected")},uploadItem:function(){var e=this;$.submitAjax({submit:"uploadCSV",name:"uploadCSV",form:e.form}).done(function(t){if(t.status){var n=$('<tr data-name="'+t.data.name+'"> 										<td> '+t.data.name+' </td> 										<td class="center">											<a class="delete-added" href="javascript:{}" onclick="NewsletterProComponents.objs.uploadCSV.deleteItemByName(\''+t.data.name+'\');"><i class="icon icon-remove cross-white"></i></a>										</td> 									</tr>');e.files.append(n),e.createItem(n)}else e.writeMsg(t.msg)})},writeMsg:function(e,t){t="error",this.msg.empty().append('<span class="'+("error"==t?"error-msg":"success-msg")+'">'+e+"</span>")},deleteItemByName:function(e){var t=this;$.postAjax({submit:"deleteCSVByName",deleteCSVByName:e}).done(function(n){n.status?(t.removeItemByName(e),null!=t.selected&&t.selected.name==e&&(t.selected=null),t.items.length<=0&&t.files.hide()):t.writeMsg(n.msg)})},removeItemByName:function(e){var t=this;$.each(t.items,function(n,s){if("undefined"!=typeof s&&s.name==e){var n=t.items.indexOf(s);return s.instance.remove(),t.items.splice(n,1),!0}})},createItems:function(){var e=this,t=e.files.find("tbody tr");$.each(t,function(t,n){e.createItem($(n))})},createItem:function(e){var t=this,n={instance:e,name:e.data("name"),init:function(){n.initEvents(),t.items.push(n)},initEvents:function(){n.instance.on("click",function(e){e.stopPropagation(),n.click()})},click:function(){t.setSelected(n)}};n.init()},nextStep:function(e){var t=this;if(t.fields=[],null==t.selected)alert(e.data("no-file"));else{var n=t.selected.name,s=$.trim(t.separator.val()),a=$("#from-linenumber").val(),r=$("#to-linenumber").val();if(","!=s&&";"!=s)return alert(e.data("bad-separator")),!1;$.postAjax({submit:"loadCSV",loadCSV:n,delimiter:s,line:{from:a,to:r}},"html").done(function(e){t.container.hide(),t.writeDetails(e)})}},importCSV:function(e){var t=this,n=t.selected.name,s=$.trim(t.separator.val()),a=t.fields,r=$("#import-csv-filter-name").val();if(0==a.length)alert(e.data("no-fields"));else{var i=$.grep(t.fields,function(e,t){return"email"==e.db_field});if(0==i.length)return alert(e.data("no-email")),!1;var o=$("#from-linenumber").val(),l=$("#to-linenumber").val();$.postAjax({submit:"importCSV",importCSV:n,delimiter:s,fields:a,line:{from:o,to:l},filter_name:r},"html").done(function(e){t.writeDetails(e)})}},geBack:function(){var e=this;e.writeDetails(""),e.details.hide(),e.container.show(),e.fields=[]},writeDetails:function(e){this.details.show().empty().append(e)},addField:function(e){var t=this,n=e.data("field"),s=e.val(),a={csv_field:n,db_field:s};if(0!=s){var r=$.grep(t.fields,function(e,t){return e.csv_field==a.csv_field});if(0==r.length)t.fields.push(a);else{var i=t.fields.indexOf(r[0]);t.fields[i]=a}}else $.each(t.fields,function(e,n){if(n.csv_field==a.csv_field){var s=t.fields.indexOf(n);t.fields.splice(s,1)}})}}};NewsletterProComponents.init();var NewsletterProControllers={init:function(){var e=this,t=NewsletterPro;jQuery(document).ready(function(n){t.components.CurrencySelect.initBySelection(n(".gk_currency_select")),e.l=NewsletterPro.translations.l(NewsletterPro.translations.constrollers),e.IndexController.init({}),e.NavigationController.init(),e.SendController.init(),e.SettingsController.init(),e.TemplateController.init(),e.UpgradeController.init(),e.ClearCacheController.init()})},elem:{},vars:{},objs:{},fcts:{},addElement:function(e,t){return this.elem[e]=t,this},addVariable:function(e,t){return this.vars[e]=t,this},addObject:function(e,t){return this.objs[e]=t,this},addFunction:function(e,t){},IndexController:{init:function(e){}},SendController:{vars:{},elem:{},addVariable:function(e,t){return this.vars[e]=t,this},addElement:function(e,t){return this.elem[e]=t,this},init:function(){var e=this;e.addElement("testEmail",$("#test-email")).addElement("testEmailButton",e.elem.testEmail.find("#test-email-button")).addElement("testEmailInput",e.elem.testEmail.find("#test-email-input")).addElement("testEmailCheckbox",e.elem.testEmail.find("#test-email-checkbox")).addElement("testEmailMessage",e.elem.testEmail.find("#test-email-message")).addElement("smtpTestEmail",$("#smtp-test-email")).addElement("smtpTestEmailMessage",$("#smtp-test-email-message")).addElement("selectAllCustomersUserList",$("#user-list")).addElement("selectAllCustomersFilters",$(".dropdown-menu")).addElement("selectAllCustomersCount",$("#select-all-customers-count")).addElement("testSendEmailBox",$("#test-send-email-box")).addElement("sendTestEmailLangSwitcher",$("#send-test-email-language-switcher")).addElement("addEmailButton",$("#add-email-button")).addElement("addEmailInput",$("#add-email-input")).addElement("addEmailMessage",$("#add-email-message")).addElement("addedSubscribedList",$("#added-subscribed ul")).addElement("usersMessage",$("#users-subscribed-message")).addElement("visitorsMessage",$("#visitors-subscribed-message")).addElement("addedMessage",$("#add-email-message")).addElement("sleepNewsletterMessage",$("#email-sleep-message")).addElement("sendNewsletters",$("#send-newsletters")).addElement("newTask",$("#new-task")).addElement("stopSendNewsletters",$("#stop-send-newsletters")).addElement("continueSendNewsletters",$("#continue-send-newsletters")).addElement("pauseSendNewsletters",$("#pause-send-newsletters")).addElement("emailsToSendCount",$("#emails-to-send-count")).addElement("emailsSentCountSucc",$("#emails-sent-count-succ")).addElement("emailsSentCountErr",$("#emails-sent-count-err")).addElement("previousSendNewsletters",$("#previous-send-newsletters")).addElement("lastSendErrorDiv",$("#last-send-error-div")).addElement("lastSendError",$("#last-send-error")),e.addVariable("pauseNewsletters",!1).addVariable("stopNewsletters",!1).addVariable("emailsSentCountSucc",0).addVariable("emailsSentCountErr",0),e.elem.testEmailCheckbox.on("change",function(t){$(this).is(":checked")?e.elem.testSendEmailBox.show():e.elem.testSendEmailBox.hide()});new NewsletterPro.components.LanguageSelect({selector:e.elem.sendTestEmailLangSwitcher,languages:NewsletterPro.dataStorage.get("all_languages"),click:function(e,t){Number(e.id_lang)}})},sendTestEmail:function(e){var t=this,n=NewsletterPro,s=t.elem.testEmailMessage,a=$("#test-email-success-message"),r=t.elem.testEmailInput.val(),i=n.dataStorage.get("id_selected_lang");a.hide(),s.hide(),n.showAjaxLoader(e),$.postAjax({submit:"sendTestEmail",sendTestEmail:r,idLang:i}).done(function(e){e.status?a.show().html('<span class="list-action-enable action-enabled"><i class="icon icon-check"></i></span>'):s.empty().show().append('<div class="alert alert-danger">'+e.msg+"</div>"),setTimeout(function(){a.hide(),s.hide()},5e3)}).always(function(){n.hideAjaxLoader(e)})},addEmail:function(){var e=this;$.postAjax({submit:"addEmail",addEmail:e.elem.addEmailInput.val()}).done(function(t){if(1==t.status){var n=e.elem.addedSubscribedList.find("li:last").hasClass("odd")?"even":"odd",s="";s+='<li class="'+n+'">',s+=t.template,s+="</li>",e.elem.addedSubscribedList.append(s);var a=e.elem.addedSubscribedList.find("li").last();NewsletterProComponents.objs.addedSubscribed.createItems(a),e.elem.addEmailMessage.empty().show().append('<span class="success-msg">'+t.msg+"</span>")}else e.elem.addEmailMessage.empty().show().append('<span class="error-msg">'+t.msg+"</span>");setTimeout(function(){e.elem.addEmailMessage.fadeOut("slow")},5e3)})},sleepNewsletter:function(e){var t=this;$.postAjax({submit:"sleepNewsletter",sleepNewsletter:e.val()}).done(function(e){e.status?t.elem.sleepNewsletterMessage.empty().show().append('<span class="success-icon">&nbsp;</span>'):t.elem.sleepNewsletterMessage.empty().show().append('<span class="error-msg">'+e.msg+"</span>"),setTimeout(function(){t.elem.sleepNewsletterMessage.hide()},5e3)})},allCustomers:[],selectAllCustomers:function(e){var t=this;e.is(":checked")?(t.elem.selectAllCustomersFilters.css({position:"relative",zoom:"1"}),t.elem.selectAllCustomersUserList.slideUp("slow"),$.postAjax({submit:"selectAllCustomers",selectAllCustomers:!0}).done(function(e){t.elem.selectAllCustomersCount.empty().append(e.length),t.allCustomers=e})):(t.elem.selectAllCustomersCount.empty().append("0"),t.elem.selectAllCustomersUserList.slideDown("slow",function(){t.elem.selectAllCustomersFilters.css({position:"absolute",zoom:"1"}),t.allCustomers=[]}))},getSelectedEmails:function(){var e,t,n=[],s=[],a=[],r=NewsletterPro.modules.sendNewsletters.vars.customers,i=NewsletterPro.modules.sendNewsletters.vars.added,o=[];return e=NewsletterPro.modules.sendNewsletters.isNewsletterProSubscriptionActive()?NewsletterPro.modules.sendNewsletters.vars.visitorsNP:NewsletterPro.modules.sendNewsletters.vars.visitors,n.length?console.warn("this feature is not active"):(t=r.getSelectedEmails(),o=o.concat(t)),s.length?console.warn("this feature is not active"):(t=e.getSelectedEmails(),o=o.concat(t)),a.length?console.warn("this feature is not active"):(t=i.getSelectedEmails(),o=o.concat(t)),o},prepareEmails:function(e){var t,n=this;if(t="undefined"!=typeof e?e:n.getSelectedEmails(),0==t.length)return void alert(NewsletterProControllers.l("no email selected"));var s=JSON.stringify(t);return $.postAjax({submit:"prepareEmails",prepareEmails:s}).done(function(e){e.status?NewsletterPro.modules.sendManager.startSendNewsletters(!0):NewsletterPro.alertErrors(e.errors.join("\n"))}).promise()},goToNextStep:function(){var e=this,t=NewsletterProComponents.objs.emailsToSend,n=NewsletterProComponents.objs.emailsSent;$.postAjax({submit:"goToNextStep",goToNextStep:!0}).done(function(s){return 1==s.exit||1==e.vars.stopSendNewsletters?void e.exitAction():void(1!=e.vars.pauseNewsletters&&(t.createItems(s.emails),n.removeAllItems(),e.sendNewsletters()))})},sendNewsletters:function(){return void console.warn('This function "sendNewsletters" is no longer used.')},exitAction:function(){var e=this,t=e.elem;e.setPause(!0),e.elem.sendNewsletters.is(":visible")||(e.elem.sendNewsletters.show(),e.elem.newTask.show()),e.elem.stopSendNewsletters.is(":visible")&&e.elem.stopSendNewsletters.hide(),e.elem.continueSendNewsletters.is(":visible")&&e.elem.continueSendNewsletters.hide(),e.elem.previousSendNewsletters.is(":visible")||e.elem.previousSendNewsletters.show(),setTimeout(function(){t.lastSendErrorDiv.slideUp()},7e3),NewsletterPro.modules.task.ui.components.sendHistory.sync()},setPause:function(e){var t=this;t.vars.pauseNewsletters=e,1==e?(t.elem.pauseSendNewsletters.hide(),t.elem.continueSendNewsletters.show()):(t.elem.pauseSendNewsletters.show(),t.elem.continueSendNewsletters.hide())},setStop:function(e){var t=this;t.vars.stopSendNewsletters=e},stopNewsletters:function(){var e=$.Deferred(),t=this,n=NewsletterProComponents.objs.emailsToSend,s=NewsletterProComponents.objs.emailsSent;return t.setStop(!0),$.postAjax({submit:"stopNewsletters",stopNewsletters:!0}).done(function(){NewsletterPro.modules.task.ui.components.sendHistory.sync(),e.resolve()}),n.removeAllItems(),s.removeAllItems(),t.elem.sendNewsletters.show(),t.elem.newTask.show(),t.elem.stopSendNewsletters.hide(),t.elem.continueSendNewsletters.hide(),t.elem.pauseSendNewsletters.hide(),t.elem.previousSendNewsletters.show(),t.elem.emailsSentCountSucc.text("0"),t.elem.emailsSentCountErr.text("0"),t.elem.emailsToSendCount.html("0"),e.promise()}},SettingsController:{init:function(){var e=this;e.addElement("smtpForm",$("#smtpForm")),e.addElement("smtpName",$("#smtp-name")),e.addElement("smtpDomain",$("#smtp-domain")),e.addElement("smtpPasswd",$("#smtp-passwd")),e.addElement("smtpServer",$("#smtp-server")),e.addElement("smtpEncryption",$("#smtp-encryption")),e.addElement("smtpPort",$("#smtp-port")),e.addElement("smtpUser",$("#smtp-user")),e.addElement("saveSmtp",$("#save-smtp")),e.addElement("addSmtp",$("#add-smtp")),e.addElement("deleteSmtp",$("#delete-smtp")),e.addElement("saveSmtpMessage",$("#save-smtp-message")),e.addElement("ganalyticsId",$("#ganalytics-id")),e.addElement("ganalyticsIdMessage",$("#ganalytics-id-message")),e.addElement("setParams",$("#set-params")),e.addElement("setParamsDefault",$("#set-params-default")),e.addElement("setParamsSave",$("#set-params-save")),e.addElement("setParamsSaveMessage",$("#set-params-save-message")),e.addElement("campaignForm",$("#campaignForm")),e.addElement("utm_source",$("#utm_source")),e.addElement("utm_medium",$("#utm_medium")),e.addElement("utm_campaign",$("#utm_campaign")),e.addElement("utm_content",$("#utm_content"))},vars:{},addVariable:function(e,t){return this.vars[e]=t,this},elem:{},addElement:function(e,t){return this.elem[e]=t,this},objs:{},addObject:function(e,t){return this.objs[e]=t,this},viewActiveOnly:function(e){$.postAjax({submit:"viewActiveOnly",viewActiveOnly:e.val()}).done(function(e){e.status&&location.reload()})},convertCssToInlineStyle:function(e){$.postAjax({submit:"convertCssToInlineStyle",convertCssToInlineStyle:e.val()}).done(function(e){e.status&&location.reload()})},productFriendlyURL:function(e){$.postAjax({submit:"productFriendlyURL",productFriendlyURL:e.val()}).done(function(e){e.status&&location.reload()})},debugMode:function(e){$.postAjax({submit:"debugMode",debugMode:e.val()}).done(function(e){e.status&&location.reload()})},useCache:function(e){$.postAjax({submit:"useCache",value:e.val()}).done(function(e){e.status&&location.reload()})},runMultimpleTasks:function(e){$.postAjax({submit:"runMultimpleTasks",runMultimpleTasks:e.val()}).done(function(e){e.status&&location.reload()})},displayCustomerAccountSettings:function(e){$.postAjax({submit:"displayCustomerAccountSettings",value:e.val()}).done(function(e){e.status&&location.reload()})},subscribeByCategory:function(e){$.postAjax({submit:"subscribeByCategory",value:e.val()}).done(function(e){e.status&&location.reload()})},subscribeByCListOfInterest:function(e){$.postAjax({submit:"subscribeByCListOfInterest",value:e.val()}).done(function(e){e.status&&location.reload()})},sendNewsletterOnSubscribe:function(e){$.postAjax({submit:"sendNewsletterOnSubscribe",value:e.val()}).done(function(e){e.status&&location.reload()})},forwardingFeatureActive:function(e){$.postAjax({submit:"forwardingFeatureActive",value:e.val()}).done(function(e){e.status&&location.reload()})},sendEmbededImagesActive:function(e){$.postAjax({submit:"sendEmbededImagesActive",value:e.val()}).done(function(e){e.status?location.reload():NewsletterPro.alertErrors(e.errors)})},chimpSyncUnsubscribed:function(e){$.postAjax({submit:"chimpSyncUnsubscribed",value:e.val()}).done(function(e){e.status?location.reload():NewsletterPro.alertErrors(e.errors)})},displayOnliActiveProducts:function(e){$.postAjax({submit:"displayOnliActiveProducts",displayOnliActiveProducts:e.val()}).done(function(e){e.status&&location.reload()})},emptyAddedEmails:function(){$.postAjax({submit:"emptyAddedEmails",emptyAddedEmails:!0}).done(function(e){1==e.status&&location.reload()})},updateGAnalyticsID:function(e){var t=this,n=e.val();$.postAjax({submit:"updateGAnalyticsID",updateGAnalyticsID:n}).done(function(e){1==e.status?t.elem.ganalyticsIdMessage.empty().show().append('<span class="success-icon">&nbsp;</span>'):t.elem.ganalyticsIdMessage.empty().show().append('<span class="error-icon">&nbsp;</span>'),setTimeout(function(){t.elem.ganalyticsIdMessage.hide()},5e3)})},checkIfCampaignIsRunning:function(e){NewsletterPro.showAjaxLoader(e),$.postAjax({submit:"checkIfCampaignIsRunning"}).done(function(e){e.status?alert(e.msg):alert(e.errors.join("\n"))}).always(function(){NewsletterPro.hideAjaxLoader(e)})},activeGAnalytics:function(e){var t=this;e.is(":checked")?$.postAjax({submit:"activeGAnalytics",activeGAnalytics:!0}).done(function(e){1==e.status&&t.elem.ganalyticsId.prop("disabled",!1)}):$.postAjax({submit:"activeGAnalytics",activeGAnalytics:!1}).done(function(e){1==e.status&&t.elem.ganalyticsId.prop("disabled",!0)})},universalAnaliytics:function(e){e.is(":checked")?$.postAjax({submit:"universalAnaliytics",universalAnaliytics:!0}):$.postAjax({submit:"universalAnaliytics",universalAnaliytics:!1})},activeCampaign:function(e){var t=this;e.is(":checked")?$.postAjax({submit:"activeCampaign",activeCampaign:!0}).done(function(e){1==e.status&&(NewsletterProComponents.objs.selectedProducts.removeItems(),NewsletterProComponents.objs.productList.element.empty(),t.elem.utm_source.prop("disabled",!1),t.elem.utm_medium.prop("disabled",!1),t.elem.utm_campaign.prop("disabled",!1),t.elem.utm_content.prop("disabled",!1),t.elem.setParams.prop("disabled",!1),t.elem.setParamsDefault.hasClass("disabled")&&t.elem.setParamsDefault.removeClass("disabled"),t.elem.setParamsDefault.attr("onclick","NewsletterProControllers.SettingsController.makeDefaultParameteres();"),t.elem.setParamsSave.hasClass("disabled")&&t.elem.setParamsSave.removeClass("disabled"),t.elem.setParamsSave.attr("onclick","NewsletterProControllers.SettingsController.saveCampaign();"))}):$.postAjax({submit:"activeCampaign",activeCampaign:!1}).done(function(e){1==e.status&&(NewsletterProComponents.objs.selectedProducts.removeItems(),NewsletterProComponents.objs.productList.element.empty(),t.elem.utm_source.prop("disabled",!0),t.elem.utm_medium.prop("disabled",!0),t.elem.utm_campaign.prop("disabled",!0),t.elem.utm_content.prop("disabled",!0),t.elem.setParams.prop("disabled",!0),t.elem.setParamsDefault.hasClass("disabled")||t.elem.setParamsDefault.addClass("disabled"),t.elem.setParamsDefault.prop("onclick",!1),t.elem.setParamsSave.hasClass("disabled")||t.elem.setParamsSave.addClass("disabled"),t.elem.setParamsSave.prop("onclick",!1))})},makeDefaultParameteres:function(){var e=this;$.postAjax({submit:"makeDefaultParameteres",makeDefaultParameteres:!0}).done(function(t){1==t.status&&(e.elem.setParams.val(t.params),e.elem.utm_source.val(t.campaign.UTM_SOURCE),e.elem.utm_medium.val(t.campaign.UTM_MEDIUM),e.elem.utm_campaign.val(t.campaign.UTM_CAMPAIGN),e.elem.utm_content.val(t.campaign.UTM_CONTENT))})},saveCampaign:function(){var e=this,t=e.elem.utm_source,n=e.elem.utm_medium,s=e.elem.utm_campaign,a=e.elem.utm_content;t.val(t.val().replace(/[&?]/,"")),n.val(n.val().replace(/[&?]/,"")),s.val(s.val().replace(/[&?]/,"")),a.val(a.val().replace(/[&?]/,"")),$.submitAjax({submit:"saveCampaign",name:"saveCampaign",form:e.elem.campaignForm}).done(function(t){t.status?e.elem.setParamsSaveMessage.empty().show().append('<span class="success-icon">&nbsp;</span>'):t.status===!1&&e.elem.setParamsSaveMessage.empty().show().append('<span class="error-icon">&nbsp;</span>'),setTimeout(function(){e.elem.setParamsSaveMessage.hide()},5e3)})}},TemplateController:{init:function(){var e=this;e.addElement("newsletterTemplateTitle",$("#page-title")).addElement("saveNewsletterTemplateMessage",$("#save-newsletter-template-message")).addElement("viewNewsletterTemplateContent",$("#view-newsletter-template-content")).addElement("newsletterTemplateContent",$("#newsletter-template-content")).addElement("productTemplate",$("#product-template")).addElement("saveProductTemplateMessage",$("#save-product-template-message")).addElement("productTemplateContent",$("#product-template-content")).addElement("viewProductTemplateContent",$("#view-product-template-content")).addElement("deleteImageMessage",$("#delete-image-message")).addElement("deleteImage",$("#images")).addElement("deleteImageEmptyShow",$(".images-empty-show")).addElement("deleteImageEmptyHide",$(".images-empty-hide")).addElement("deleteImageNavigation",$(".images-navigation"))},vars:{},addVariable:function(e,t){return this.vars[e]=t,this},elem:{},addElement:function(e,t){return this.elem[e]=t,this},objs:{},addObject:function(e,t){return this.objs[e]=t,this},viewNewsletterTemplate:function(){var e=this;return $.postAjax({submit:"viewNewsletterTemplate",viewNewsletterTemplate:!0},"html").done(function(t){var n=$(t);e.elem.viewNewsletterTemplateContent.show().empty().append(n);var s=NewsletterPro.modules.createTemplate;s.updateBoth()})},saveToggleNewsletterTemplate:function(e){var t=this,n=e.find("span");t.elem.newsletterTemplateContent.is(":visible")?(t.saveNewsletterTemplate(),n.html(e.data("name").edit)):(t.elem.newsletterTemplateContent.show(),t.elem.viewNewsletterTemplateContent.hide(),n.html(e.data("name").view))},saveAsNewsletterTemplate:function(e){var t=this,n=prompt(e.data("message"),"");return""==n||null==n?!1:void $.postAjax({submit:"saveAsNewsletterTemplate",saveAsNewsletterTemplate:n,content:tinyMCE.get("newsletter_template_text").getContent(),title:t.elem.newsletterTemplateTitle.val()}).done(function(e){var n="";e.status?location.reload():n='<p class="error-save">'+e.msg+"</p>",t.elem.saveNewsletterTemplateMessage.show().empty().append(n)})},changeNewsletterTemplate:function(e){var t=this;$.postAjax({submit:"changeNewsletterTemplate",changeNewsletterTemplate:e.val()}).done(function(e){e.status?location.reload():t.elem.changeNewsletterTemplateMessage.empty().append('<span class="error-msg">'+e.msg+"</span>"),setTimeout(function(){t.elem.changeNewsletterTemplateMessage.hide()},5e3)})},changeProductTemplate:function(e){var t=this;$.postAjax({submit:"changeProductTemplate",changeProductTemplate:e.val()}).done(function(e){e.status?location.reload():t.elem.changeProductTemplateMessage.empty().append('<span class="error-msg">'+e.msg+"</span>"),setTimeout(function(){t.elem.changeProductTemplateMessage.hide()},5e3)})},changeProductImageSize:function(e){var t=this;$.postAjax({submit:"changeProductImageSize",changeProductImageSize:e.val()}).done(function(e){1==e.status?location.reload():t.elem.changeProductImageSizeMessage.empty().append('<span class="error-msg">'+e.msg+"</span>"),setTimeout(function(){t.elem.changeProductImageSizeMessage.hide()},5e3)})},changeProductCurrency:function(e){var t=this;$.postAjax({submit:"changeProductCurrency",changeProductCurrency:e.val()}).done(function(e){e.status?location.reload():t.elem.changeProductCurrencyMessage.empty().append('<span class="error-msg">'+e.msg+"</span>"),setTimeout(function(){t.elem.changeProductCurrencyMessage.hide()},5e3)})},changeProductLanguage:function(e){$.postAjax({submit:"changeProductLanguage",changeProductLanguage:e}).done(function(e){e.status?location.reload():self.changeProductLanguageMessage.empty().append('<span class="error-msg">'+e.msg+"</span>"),setTimeout(function(){self.elem.changeProductLanguageMessage.hide()},5e3)})},saveProductNumberPerRow:function(e){var t=this,n=parseInt(e.val());n=/^\d{1}$/.test(n)?parseInt(n):3,e.val(n),$.postAjax({submit:"saveProductNumberPerRow",saveProductNumberPerRow:e.val()}).done(function(n){1==n.status?t.elem.saveProductNumberPerRowMessage.empty().show().append('<span class="success-icon">&nbsp;</span>'):t.elem.saveProductNumberPerRowMessage.empty().show().append('<span class="error-msg">'+n.msg+"</span>"),setTimeout(function(){t.elem.saveProductNumberPerRowMessage.hide()},5e3),"undefined"!==NewsletterProComponents.objs.selectedProducts&&(NewsletterProComponents.objs.selectedProducts.columns=e.val())})},toggleShowProductTpl:function(e){var t=this;t.elem.productTemplate.is(":visible")?(t.elem.productTemplate.slideUp("slow"),e.find("span.text").empty().html(e.data("name").show)):(t.elem.productTemplate.css("display","inline-block").hide().slideDown("slow"),e.find("span.text").empty().html(e.data("name").hide))},saveProductTemplate:function(){var e,t=this;e=NewsletterPro.dataStorage.get("is_product_template")?$("#product-template-content-textarea").val():tinyMCE.get("product_template_text").getContent(),NewsletterPro.modules.selectProducts.updateProductTemplateView(e),$.postAjax({submit:"saveProductTemplate",saveProductTemplate:e,numberPerRow:NewsletterPro.dataStorage.data.product_tpl_nr}).done(function(e){var n="";n=e.type?'<p class="success-save">'+e.message+"</p>":'<p class="error-save">'+e.message+"</p>",t.elem.saveProductTemplateMessage.show().empty().append(n),NewsletterPro.dataStorage.set("product_template",e.content),NewsletterPro.components.Product.changeTemplate(e.content)}).fail(function(e){t.elem.saveProductTemplateMessage.show().empty().append('<p class="error-save">Save failure</p>')}).always(function(e){t.viewProductTemplate().always(function(){t.elem.productTemplateContent.hide()})})},saveToggleProductTemplate:function(e){var t=this,n=e.find("span");t.elem.productTemplateContent.is(":visible")?(t.saveProductTemplate(),n.html(e.data("name").edit)):(t.elem.productTemplateContent.show(),t.elem.viewProductTemplateContent.hide(),n.html(e.data("name").view))},viewProductTemplate:function(){var e=this;return selectProducts=NewsletterPro.modules.selectProducts,$.postAjax({submit:"getProductContent",getProductContent:!0},"html").done(function(e){"undefined"!==NewsletterProComponents.objs.selectedProducts&&(NewsletterProComponents.objs.selectedProducts.template=e)}),$.postAjax({submit:"viewProductTemplate",viewProductTemplate:!0},"html").done(function(t){e.elem.viewProductTemplateContent.show().empty().append(t+'<div style="clear: both; height: 7px;">&nbsp</div>'),selectProducts.refreshProducts()})},loadProductTemplate:function(){return $.postAjax({submit:"getProductContent",getProductContent:!0},"html").done(function(e){"undefined"!==NewsletterProComponents.objs.selectedProducts&&(NewsletterProComponents.objs.selectedProducts.template=e)}).promise()},isProductTemplateLoaded:function(){return""!=NewsletterProComponents.objs.selectedProducts.template},saveAsProductTemplate:function(e){var t=this,n=NewsletterPro.modules.selectProducts.vars.nbProducts,s=prompt(e.data("message"),"");if(""==s||null==s)return!1;var a;a=NewsletterPro.dataStorage.get("is_product_template")?$("#product-template-content-textarea").val():tinyMCE.get("product_template_text").getContent(),$.postAjax({submit:"saveAsProductTemplate",saveAsProductTemplate:s,content:a,numberPerRow:n.val()}).done(function(e){var n="";if(e.status){NewsletterPro.modules.selectProducts.vars.templateDataSource.sync();var s=e.full_content;NewsletterPro.dataStorage.set("product_template",s)}else n='<p class="error-save">'+e.msg+"</p>";t.elem.saveProductTemplateMessage.show().empty().append(n)})},deleteImage:function(e,t){var n=this;$.postAjax({submit:"deleteImage",deleteImage:t}).done(function(t){t.status?(e.parent().parent().remove(),0==n.elem.deleteImage.children().length&&(n.elem.deleteImageEmptyShow.show(),n.elem.deleteImageEmptyHide.hide(),n.elem.deleteImageNavigation.hide())):n.elem.deleteImageMessage.empty().show().append('<span class="error-msg">'+t.msg+"</span>"),setTimeout(function(){n.elem.deleteImageMessage.hide()},5e3)})},showProductHelp:function(){var e=this,t=NewsletterProControllers.l;"undefined"==typeof e.productTemplateWin&&(e.productTemplateWin=new gkWindow({width:640,height:540,title:t("view available variables product"),className:"newsletter-help-win",show:function(e){},close:function(e){},content:function(t){return $.postAjax({submit:"showProductHelp"},"html").done(function(n){"undefined"==typeof e.showProductHelpContent&&(e.showProductHelpContent=e.showProductHelpContent||n,t.setContent(n))}),""}})),e.productTemplateWin.show()},showNewsletterHelp:function(){var e=this,t=NewsletterProControllers.l;"undefined"==typeof e.newsletterTemplateWin&&(e.newsletterTemplateWin=new gkWindow({width:640,height:540,title:t("view available variables"),className:"newsletter-help-win",show:function(e){},close:function(e){},content:function(t){return $.postAjax({submit:"showNewsletterHelp"},"html").done(function(n){"undefined"==typeof e.showNewsletterHelpContent&&(e.showNewsletterHelpContent=e.showNewsletterHelpContent||n,t.setContent(n))}),""}})),e.newsletterTemplateWin.show()}},NavigationController:{init:function(){var e=this;NewsletterProControllers.l;e.addElement("categoriesList",$("#categories-list")).addElement("categoriesListLi",e.elem.categoriesList.find("li")).addElement("productList",$("#product-list")).addElement("productListDsiplayImages",$("#display-product-image-container")).addElement("productListDsiplayImagesMessage",$("#display-product-image-message")).addElement("toggleCategoriesButton",$("#toggle-categories")).addElement("productSearch",$("#poduct-search")).addElement("addedList",$("#added-list")),e.addVariable("categoriesListWidth",parseFloat(e.elem.categoriesList.width())/parseFloat(e.elem.categoriesList.parent().width())*100+"%").addVariable("productListMarginLeft",parseFloat(e.elem.productList.css("margin-left"))/parseFloat(e.elem.productList.parent().css("width"))*100+"%"),"undefined"==typeof $.getCookie("toggleCategories")||"false"==$.getCookie("toggleCategories")?e.addVariable("categoriesVisibility",!0):(e.elem.categoriesList.addClass("categories-list-slide-toggle-hide"),e.elem.productList.addClass("product-list-slide-toggle-hide"),e.elem.productListDsiplayImages.css("margin-left",0),e.addVariable("categoriesVisibility",!1),e.elem.toggleCategoriesButton.css("background-position","bottom left")),"#viewImported"==window.location.hash&&(window.location.hash="#sendNewsletters",e.goToStep(5,e.elem.addedList))},vars:{},addVariable:function(e,t){return this.vars[e]=t,this},elem:{},addElement:function(e,t){return this.elem[e]=t,this},objs:{},addObject:function(e,t){return this.objs[e]=t,this},toggleCategories:function(e){var t=this,n=500;1==t.vars.categoriesVisibility?(t.elem.categoriesListLi.css("width",t.elem.categoriesListLi.width()+"px"),t.elem.categoriesList.css("overflow","hidden"),t.elem.productList.animate({"margin-left":0},n),t.elem.productListDsiplayImages.animate({"margin-left":0},n),t.elem.categoriesList.animate({width:"1px","padding-left":"1px"},n,function(){t.vars.categoriesVisibility=!1,e.css("background-position","bottom left"),$.setCookie("toggleCategories",!0)})):(t.elem.productList.animate({"margin-left":t.vars.productListMarginLeft},n),t.elem.productListDsiplayImages.animate({"margin-left":t.vars.productListMarginLeft},n),t.vars.categoriesVisibility=!0,t.elem.categoriesList.animate({width:t.vars.categoriesListWidth,"padding-left":0},n,function(){t.elem.categoriesList.css("overflow","visible"),e.css("background-position","top left"),t.elem.categoriesListLi.css("width","auto"),$.setCookie("toggleCategories",!1)}))},displayProductImage:function(e){var t=this;$.postAjax({submit:"displayProductImage",displayProductImage:e.prop("checked")}).done(function(e){e.status?location.reload():t.elem.productListDsiplayImagesMessage.empty().show().append('<span class="error-msg">'+e.msg+"</span>"),setTimeout(function(){t.elem.productListDsiplayImagesMessage.hide()},5e3)})},goToStep:function(e,t){t=t||$("#content"),NewsletterProComponents.objs.tabItems.trigger("tab_newsletter_"+e),$("html, body").animate({scrollTop:t.offset().top},1e3)},viewImported:function(){NewsletterPro.modules.sendNewsletters.vars.added.sync().done(function(e){NewsletterProComponents.objs.tabItems.trigger("tab_newsletter_5"),$("html, body").animate({scrollTop:parseInt($("#added-list").offset().top)-120},1e3)})}},UpgradeController:{init:function(){NewsletterProControllers.l},execute:function(e){
var t=NewsletterPro,n=$("#update-module-response");t.showAjaxLoader(e),n.hide().removeClass("error").removeClass("success"),$.postAjax({submit:"updateModule"}).done(function(s){if(s.status){var a=s.message.join("<br>"),r=5;n.addClass("success").show(),n.html(a.replace("%s",r));var i=setInterval(function(){n.html(a.replace("%s",--r)),0>=r&&(location.reload(),clearInterval(i))},1e3);e.hide()}else{var o=t.displayAlert(s.errors.join("<br>"));n.addClass("error").html(o).show()}}).always(function(){t.hideAjaxLoader(e)})}},ClearCacheController:{init:function(){NewsletterProControllers.l},clear:function(e){var t=NewsletterPro;$.updateConfiguration("SHOW_CLEAR_CACHE",0).done(function(e){e.success?$("#clear-cache-box").hide():t.alertErrors(e.errors)})}}};NewsletterProControllers.init(),NewsletterPro.namespace("modules.ourModules"),NewsletterPro.modules.ourModules={dom:null,init:function(e){var t=this;return t.ready(function(e){}),t},ready:function(e){var t=this;$(document).ready(function(){t.dom={},e(t.dom)})},each:function(e,t){for(var n in e)t(e[n],n)}}.init(NewsletterPro);